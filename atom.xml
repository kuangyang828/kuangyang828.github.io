<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://kuangyang828.github.io</id>
    <title>kuangyang&apos;s Blog</title>
    <updated>2023-01-03T15:11:59.657Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://kuangyang828.github.io"/>
    <link rel="self" href="https://kuangyang828.github.io/atom.xml"/>
    <subtitle>è®°å½•æˆ‘çš„å­¦ä¹ ç‚¹æ»´ã€‚</subtitle>
    <logo>https://kuangyang828.github.io/images/avatar.png</logo>
    <icon>https://kuangyang828.github.io/favicon.ico</icon>
    <rights>All rights reserved 2023, kuangyang&apos;s Blog</rights>
    <entry>
        <title type="html"><![CDATA[Zookeeper ç¬”è®°]]></title>
        <id>https://kuangyang828.github.io/zookeeper-bi-ji/</id>
        <link href="https://kuangyang828.github.io/zookeeper-bi-ji/">
        </link>
        <updated>2022-09-14T07:22:00.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p><a href="https://www.bilibili.com/video/BV1to4y1C7gw">è§†é¢‘åœ°å€ ğŸ”—bilibili</a></p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220914153034.png" alt="" loading="lazy"></figure>
<h1 id="zookeeper-å…¥é—¨">Zookeeper å…¥é—¨</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>Zookeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼æ¡†æ¶æä¾›åè°ƒæœåŠ¡çš„ Apache é¡¹ç›®ã€‚<br>
ï¼ˆZookeeper æ˜¯ä¸€ä¸ªä¸ºå…¶ä»–åˆ†å¸ƒå¼æ¡†æ¶æä¾›æœåŠ¡çš„åˆ†å¸ƒå¼æ¡†æ¶ï¼‰</p>
<h2 id="å·¥ä½œæœºåˆ¶">å·¥ä½œæœºåˆ¶</h2>
<p>Zookeeperä»è®¾è®¡æ¨¡å¼è§’åº¦æ¥ç†è§£ï¼šæ˜¯ä¸€ä¸ªåŸºäº<code>è§‚å¯Ÿè€…æ¨¡å¼</code>è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒ<code>è´Ÿè´£å­˜å‚¨å’Œç®¡ç†å¤§å®¶éƒ½å…³å¿ƒçš„æ•°æ®</code>ï¼Œç„¶å<code>æ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œ</code>ï¼Œ<code>ä¸€æ—¦</code>è¿™äº›<code>æ•°æ®</code>çš„çŠ¶æ€å‘ç”Ÿ<code>å˜åŒ–</code>ï¼ŒZookeeperå°±å°†<code>è´Ÿè´£é€šçŸ¥å·²ç»åœ¨Zookeeperä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…</code>åšå‡ºç›¸åº”çš„ååº”ã€‚<br>
<br><br>
<code>Zookeeper=æ–‡ä»¶ç³»ç»Ÿ+é€šçŸ¥æœºåˆ¶</code></p>
<h2 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h2>
<p><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220914155529.png" alt="" loading="lazy"><br>
1ï¼‰	Zookeeperï¼šä¸€ä¸ªé¢†å¯¼è€…ï¼ˆLeaderï¼‰ï¼Œå¤šä¸ªè·Ÿéšè€…ï¼ˆFollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚<br>
2ï¼‰	é›†ç¾¤ä¸­åªè¦æœ‰<code>åŠæ•°</code>ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚æ‰€ä»¥ Zookeeper é€‚åˆå®‰è£…<code>å¥‡æ•°</code>å°æœåŠ¡å™¨ã€‚<br>
3ï¼‰	å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ªServerä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼ŒClientæ— è®ºè¿æ¥åˆ°å“ªä¸ªServerï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚<br>
4ï¼‰	æ›´æ–°è¯·æ±‚é¡ºåºæ‰§è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªClientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚<br>
5ï¼‰	æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</p>
<h2 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</h2>
<p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ <code>Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼</code>ï¼Œ<code>æ•´ä½“</code>ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µ<code>æ ‘</code>ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚æ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ <code>1MB</code> çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥<code>é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†</code>ã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220914160014.png" alt="" loading="lazy"></p>
<h2 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h2>
<p>æä¾›çš„æœåŠ¡åŒ…æ‹¬ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€é›†ç¾¤ç®¡ç†ã€æœåŠ¡å™¨èŠ‚ç‚¹åŠ¨æ€ä¸Šä¸‹çº¿ã€è½¯è´Ÿè½½å‡è¡¡ç­‰ã€‚</p>
<h1 id="é¢è¯•é‡ç‚¹">é¢è¯•é‡ç‚¹</h1>
<h2 id="é€‰ä¸¾æœºåˆ¶">é€‰ä¸¾æœºåˆ¶</h2>
<p>åŠæ•°æœºåˆ¶ï¼Œè¶…è¿‡åŠæ•°çš„æŠ•ç¥¨é€šè¿‡ï¼Œå³é€šè¿‡ã€‚<br>
ï¼ˆ1ï¼‰ç¬¬ä¸€æ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™ï¼š<br>
æŠ•ç¥¨è¿‡åŠæ•°æ—¶ï¼ŒæœåŠ¡å™¨ id å¤§çš„èƒœå‡ºã€‚<br>
å³æ¯å°æœºå™¨ä¼šå…ˆæŠ•ç»™è‡ªå·±ï¼Œä¸è¡Œå†æŠ•ç»™ id å¤§çš„ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°æŸå°æœºå™¨è·å¾—è¶…è¿‡åŠæ•°çš„ç¥¨ï¼Œå®ƒå°±æˆä¸ºLeaderã€‚æ‰€ä»¥ä¸€èˆ¬æ˜¯æ’åœ¨ä¸­é—´æœåŠ¡å™¨å½“ Leaderã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220914161440.png" alt="" loading="lazy"></p>
<p>ï¼ˆ2ï¼‰ç¬¬äºŒæ¬¡å¯åŠ¨é€‰ä¸¾è§„åˆ™ï¼š<br>
â‘ 	EPOCH å¤§çš„ç›´æ¥èƒœå‡º<br>
â‘¡	EPOCH ç›¸åŒï¼Œäº‹åŠ¡ id å¤§çš„èƒœå‡º<br>
â‘¢	äº‹åŠ¡ id ç›¸åŒï¼ŒæœåŠ¡å™¨ id å¤§çš„èƒœå‡º</p>
<h2 id="ç›‘å¬å™¨å®¢æˆ·ç«¯åŸç†">ç›‘å¬å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰åŸç†</h2>
<figure data-type="image" tabindex="2"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220914162750.png" alt="" loading="lazy"></figure>
<h2 id="ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘zkåˆé€‚">ç”Ÿäº§é›†ç¾¤å®‰è£…å¤šå°‘zkåˆé€‚ï¼Ÿ</h2>
<p>å®‰è£…å¥‡æ•°å°ã€‚<br>
<code>ç”Ÿäº§ç»éªŒï¼š</code></p>
<ul>
<li>10 å°æœåŠ¡å™¨ï¼š3 å° zkï¼›</li>
<li>20 å°æœåŠ¡å™¨ï¼š5 å° zkï¼›</li>
<li>100 å°æœåŠ¡å™¨ï¼š11 å° zkï¼›</li>
<li>200 å°æœåŠ¡å™¨ï¼š11 å° zk</li>
</ul>
<p><code>æœåŠ¡å™¨å°æ•°å¤šï¼šå¥½å¤„ï¼Œæé«˜å¯é æ€§ï¼›åå¤„ï¼šæé«˜é€šä¿¡å»¶æ—¶</code></p>
<h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2>
<p>lsã€getã€createã€delete</p>
<h1 id="éšå ‚ç¬”è®°">éšå ‚ç¬”è®°</h1>
<p><a href="https://github.com/kuangyang828/share_doc/blob/master/Zookeeper%E9%9A%8F%E5%A0%82%E7%AC%94%E8%AE%B0.pdf">https://github.com/kuangyang828/share_doc/blob/master/Zookeeperéšå ‚ç¬”è®°.pdf</a></p>
<h1 id="è¯¾ä»¶">è¯¾ä»¶</h1>
<p><a href="https://github.com/kuangyang828/share_doc/blob/master/08_%E5%B0%9A%E7%A1%85%E8%B0%B7%E6%8A%80%E6%9C%AF%E4%B9%8BZookeeperV3.3.pdf">https://github.com/kuangyang828/share_doc/blob/master/08_å°šç¡…è°·æŠ€æœ¯ä¹‹ZookeeperV3.3.pdf</a></p>
<h1 id="æºç åˆ†æ">æºç åˆ†æ</h1>
<p><a href="https://github.com/kuangyang828/share_doc/blob/master/08_%E5%B0%9A%E7%A1%85%E8%B0%B7%E6%8A%80%E6%9C%AF%E4%B9%8BZookeeper%EF%BC%88%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%89V3.3.pdf">https://github.com/kuangyang828/share_doc/blob/master/08_å°šç¡…è°·æŠ€æœ¯ä¹‹Zookeeperï¼ˆæºç è§£æï¼‰V3.3.pdf</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Flutter ç¬”è®°]]></title>
        <id>https://kuangyang828.github.io/flutter-bi-ji/</id>
        <link href="https://kuangyang828.github.io/flutter-bi-ji/">
        </link>
        <updated>2022-09-02T01:45:00.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h1>
<h2 id="å®‰è£…-flutter-sdk">å®‰è£… Flutter SDK</h2>
<h2 id="è¿è¡Œ-flutter-doctor-å‘½ä»¤">è¿è¡Œ flutter doctor å‘½ä»¤</h2>
<p>https://flutter.cn/docs/get-started/install/macos#update-your-path</p>
<h3 id="é…ç½®ç¯å¢ƒå˜é‡">é…ç½®ç¯å¢ƒå˜é‡</h3>
<p>https://flutter.cn/docs/get-started/install/macos#update-your-path</p>
<h2 id="é…ç½®-ios-ç¯å¢ƒ">é…ç½® iOS ç¯å¢ƒ</h2>
<h2 id="é…ç½®-android-ç¯å¢ƒ">é…ç½® Android ç¯å¢ƒ</h2>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SpringBoot åº”ç”¨ç¯‡ç¬”è®°]]></title>
        <id>https://kuangyang828.github.io/springboot-ying-yong-pian-bi-ji/</id>
        <link href="https://kuangyang828.github.io/springboot-ying-yong-pian-bi-ji/">
        </link>
        <updated>2022-08-29T16:12:39.000Z</updated>
        <content type="html"><![CDATA[<p>https://youtube.com/playlist?list=PLD3Xyx6ef38xcNhCaCV_fUqB9vjTDA7hX</p>
<h1 id="æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½">æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½</h1>
<h2 id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </h2>
<ul>
<li>Spring Boot å®ç°æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½åŠŸèƒ½æœ¬è´¨è¿˜æ˜¯ä¾é  Spring MVC</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè·å–å­˜æ”¾ä¸Šä¼ ä¸ä¸‹è½½æ–‡ä»¶çš„ç›®å½•çš„æ–¹å¼ä¸åŒ</li>
</ul>
<pre><code class="language-java">@RequestMapping(&quot;/uploadDocument&quot;)
public Result uploadDocument(MultipartFile uploadFile) throws IOException {
    // è·å–ä¸Šä¼ çš„æ–‡ä»¶çš„æ–‡ä»¶å
    String fileName = uploadFile.getOriginalFilename();
    // å¤„ç†æ–‡ä»¶é‡åé—®é¢˜
    String suffixName = fileName.substring(fileName.lastIndexOf(&quot;.&quot;));
    String prefixName = fileName.substring(0, fileName.lastIndexOf(&quot;.&quot;));
    fileName = prefixName + &quot;-&quot; + UUID.randomUUID() + suffixName;
    // è·å–æœåŠ¡å™¨ä¸­ Document ç›®å½•çš„è·¯å¾„
    File documentPath = new File(ResourceUtils.getURL(&quot;classpath:static/uploadPath/document&quot;).getPath());
    if (!documentPath.exists()) {
        documentPath.mkdir();
    }
    String finalPath = documentPath + File.separator + fileName;
    // å®ç°ä¸Šä¼ åŠŸèƒ½
    uploadFile.transferTo(new File(finalPath));
    return Result.OK(&quot;/uploadPath/document/&quot; + fileName);
}
</code></pre>
<h2 id="æ–‡ä»¶ä¸‹è½½">æ–‡ä»¶ä¸‹è½½</h2>
<pre><code class="language-java">@GetMapping(&quot;/downloadDocument/{fileName}&quot;)
public ResponseEntity&lt;byte[]&gt; downloadDocument(@PathVariable(&quot;fileName&quot;) String fileName) throws IOException {
    // è·å–æœåŠ¡å™¨ä¸­æ–‡ä»¶çš„çœŸå®è·¯å¾„
    String realPath = ResourceUtils.getURL(&quot;classpath:static/uploadPath/document/&quot;).getPath() + fileName;
    // åˆ›å»ºè¾“å…¥æµ
    //InputStream is = new FileInputStream(realPath);
    InputStream is = Files.newInputStream(Paths.get(realPath));
    // åˆ›å»ºå­—èŠ‚æ•°ç»„
    byte[] bytes = new byte[is.available()];
    // å°†æµè¯»åˆ°å­—èŠ‚æ•°ç»„ä¸­
    is.read(bytes);
    // åˆ›å»ºHttpHeaderså¯¹è±¡è®¾ç½®å“åº”å¤´ä¿¡æ¯
    MultiValueMap&lt;String, String&gt; headers = new HttpHeaders();
    // å¯¹æ–‡ä»¶åé‡æ–°ç¼–ç ï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç 
    fileName = new String(fileName.getBytes(StandardCharsets.UTF_8), StandardCharsets.ISO_8859_1);
    // è®¾ç½®è¦ä¸‹è½½æ–¹å¼ä»¥åŠä¸‹è½½æ–‡ä»¶çš„åå­—
    headers.add(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + fileName);
    // è®¾ç½®å“åº”çŠ¶æ€ç 
    HttpStatus statusCode = HttpStatus.OK;
    // åˆ›å»ºResponseEntityå¯¹è±¡
    ResponseEntity&lt;byte[]&gt; responseEntity = new ResponseEntity&lt;&gt;(bytes, headers, statusCode);
    // å…³é—­è¾“å…¥æµ
    is.close();
    return responseEntity;
}
</code></pre>
<h1 id="5-æ•´åˆç¬¬ä¸‰æ–¹æŠ€æœ¯">5-æ•´åˆç¬¬ä¸‰æ–¹æŠ€æœ¯</h1>
<h2 id="5-2-å®šæ—¶ä»»åŠ¡">5-2 å®šæ—¶ä»»åŠ¡</h2>
<p>å®šæ—¶ä»»åŠ¡æ˜¯ä¼ä¸šçº§å¼€å‘ä¸­å¿…ä¸å¯å°‘çš„ç»„æˆéƒ¨åˆ†ï¼Œè¯¸å¦‚é•¿å‘¨æœŸä¸šåŠ¡æ•°æ®çš„è®¡ç®—ï¼Œä¾‹å¦‚å¹´åº¦æŠ¥è¡¨ï¼Œè¯¸å¦‚ç³»ç»Ÿè„æ•°æ®çš„å¤„ç†ï¼Œå†æ¯”å¦‚ç³»ç»Ÿæ€§èƒ½ç›‘æ§æŠ¥å‘Šï¼Œè¿˜æœ‰æŠ¢è´­ç±»æ´»åŠ¨çš„å•†å“ä¸Šæ¶ï¼Œè¿™äº›éƒ½ç¦»ä¸å¼€å®šæ—¶ä»»åŠ¡ã€‚æœ¬èŠ‚å°†ä»‹ç»ä¸¤ç§ä¸åŒçš„å®šæ—¶ä»»åŠ¡æŠ€æœ¯ã€‚</p>
<h3 id="quartz">Quartz</h3>
<p>QuartzæŠ€æœ¯æ˜¯ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„å®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Ÿæœ‰ç‚¹ç¹çï¼Œç”¨è¿‡çš„éƒ½çŸ¥é“ï¼Œé…ç½®ç•¥å¾®å¤æ‚ã€‚springbootå¯¹å…¶è¿›è¡Œæ•´åˆåï¼Œç®€åŒ–äº†ä¸€ç³»åˆ—çš„é…ç½®ï¼Œå°†å¾ˆå¤šé…ç½®é‡‡ç”¨é»˜è®¤è®¾ç½®ï¼Œè¿™æ ·å¼€å‘é˜¶æ®µå°±ç®€åŒ–äº†å¾ˆå¤šã€‚åœ¨</p>
<p>å­¦ä¹ springbootæ•´åˆQuartzå‰å…ˆæ™®åŠå‡ ä¸ªQuartzçš„æ¦‚å¿µã€‚</p>
<ul>
<li>å·¥ä½œï¼ˆJobï¼‰ï¼šç”¨äºå®šä¹‰å…·ä½“æ‰§è¡Œçš„å·¥ä½œ</li>
<li>å·¥ä½œæ˜ç»†ï¼ˆJobDetailï¼‰ï¼šç”¨äºæè¿°å®šæ—¶å·¥ä½œç›¸å…³çš„ä¿¡æ¯</li>
<li>è§¦å‘å™¨ï¼ˆTriggerï¼‰ï¼šæè¿°äº†å·¥ä½œæ˜ç»†ä¸è°ƒåº¦å™¨çš„å¯¹åº”å…³ç³»</li>
<li>è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ï¼šç”¨äºæè¿°è§¦å‘å·¥ä½œçš„æ‰§è¡Œè§„åˆ™ï¼Œé€šå¸¸ä½¿ç”¨cronè¡¨è¾¾å¼å®šä¹‰è§„åˆ™</li>
</ul>
<p><strong>æ­¥éª¤â‘ </strong>ï¼šå¯¼å…¥springbootæ•´åˆQuartzçš„starte</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p><strong>æ­¥éª¤â‘¡</strong>ï¼šå®šä¹‰ä»»åŠ¡Beanï¼ŒæŒ‰ç…§Quartzçš„å¼€å‘è§„èŒƒåˆ¶ä½œï¼Œéœ€è¦ç»§æ‰¿QuartzJobBean</p>
<ul>
<li>æ³¨æ„ï¼Œä»»åŠ¡Bean<mark>ä¸éœ€è¦</mark>æ ‡æ³¨ä¸ºç»„ä»¶äº¤ç»™Springå®¹å™¨ç®¡ç†ã€‚</li>
</ul>
<pre><code class="language-java">public class MyQuartz extends QuartzJobBean {
    @Override
    protected void executeInternal(JobExecutionContext context) throws JobExecutionException {
        System.out.println(&quot;quartz task run...&quot;);
    }
}
</code></pre>
<p><strong>æ­¥éª¤â‘¢</strong>ï¼šåˆ›å»ºQuartzé…ç½®ç±»ï¼Œå®šä¹‰å·¥ä½œæ˜ç»†ï¼ˆJobDetailï¼‰ä¸è§¦å‘å™¨çš„ï¼ˆTriggerï¼‰bean</p>
<pre><code class="language-java">@Configuration
public class QuartzConfig {
  
  	/**
     * å·¥ä½œæ˜ç»†
     * @return
     */
    @Bean
    public JobDetail printJobDetail(){
        //ç»‘å®šå…·ä½“çš„å·¥ä½œ
        return JobBuilder.newJob(MyQuartz.class).storeDurably().build();
    }
  
  	/**
     * è§¦å‘å™¨
     * @return
     */
    @Bean
    public Trigger printJobTrigger(){
        ScheduleBuilder schedBuilder = CronScheduleBuilder.cronSchedule(&quot;0/5 * * * * ?&quot;);
        //ç»‘å®šå¯¹åº”çš„å·¥ä½œæ˜ç»†ä¸æ‰§è¡Œæ—¶é—´ï¼ˆè°ƒåº¦å™¨ï¼‰
        return  TriggerBuilder.newTrigger().forJob(printJobDetail()).withSchedule(schedBuilder).build();
    }
}
</code></pre>
<ul>
<li><mark>å·¥ä½œæ˜ç»†</mark>ä¸­è¦è®¾ç½®å¯¹åº”çš„å…·ä½“<mark>å·¥ä½œ</mark>ï¼Œ</li>
<li>ä½¿ç”¨newJob()æ“ä½œä¼ å…¥å¯¹åº”çš„å·¥ä½œä»»åŠ¡ç±»å‹å³å¯ã€‚</li>
<li><mark>è§¦å‘å™¨</mark>éœ€è¦ç»‘å®š<mark>ä»»åŠ¡</mark>ï¼Œä½¿ç”¨forJob()æ“ä½œä¼ å…¥ç»‘å®šçš„å·¥ä½œæ˜ç»†å¯¹è±¡ï¼Œ</li>
<li>æ­¤å¤„å¯ä»¥ä¸ºå·¥ä½œæ˜ç»†è®¾ç½®åç§°ï¼Œç„¶åä½¿ç”¨åç§°ç»‘å®šï¼Œ</li>
<li>ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨å¯¹åº”æ–¹æ³•ç»‘å®šï¼›</li>
<li>è§¦å‘å™¨ä¸­æœ€æ ¸å¿ƒçš„è§„åˆ™æ˜¯<mark>æ‰§è¡Œæ—¶é—´</mark>ï¼Œæ­¤å¤„ä½¿ç”¨è°ƒåº¦å™¨å®šä¹‰æ‰§è¡Œæ—¶é—´ï¼Œ</li>
<li>æ‰§è¡Œæ—¶é—´æè¿°æ–¹å¼ä½¿ç”¨çš„æ˜¯cronè¡¨è¾¾å¼ã€‚æœ‰å…³cronè¡¨è¾¾å¼çš„è§„åˆ™ï¼Œå„ä½å°ä¼™ä¼´å¯ä»¥å»å‚çœ‹ç›¸å…³è¯¾ç¨‹å­¦ä¹ ï¼Œç•¥å¾®å¤æ‚ï¼Œè€Œä¸”æ ¼å¼ä¸èƒ½ä¹±è®¾ç½®ï¼Œä¸æ˜¯å†™ä¸ªæ ¼å¼å°±èƒ½ç”¨çš„ï¼Œå†™ä¸å¥½å°±ä¼šå‡ºç°å†²çªé—®é¢˜ã€‚</li>
</ul>
<p><strong>æ€»ç»“</strong></p>
<ol>
<li>springbootæ•´åˆQuartzå°±æ˜¯å°†Quartzå¯¹åº”çš„ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡äº¤ç»™springå®¹å™¨ç®¡ç†ï¼ŒåŒ…å«ä¸¤ä¸ªå¯¹è±¡ï¼ŒJobDetailå’ŒTriggerå¯¹è±¡</li>
<li>JobDetailå¯¹è±¡æè¿°çš„æ˜¯å·¥ä½œçš„æ‰§è¡Œä¿¡æ¯ï¼Œéœ€è¦ç»‘å®šä¸€ä¸ªQuartzJobBeanç±»å‹çš„å¯¹è±¡</li>
<li>Triggerå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªè§¦å‘å™¨ï¼Œéœ€è¦ä¸ºå…¶æŒ‡å®šç»‘å®šçš„JobDetailæ˜¯å“ªä¸ªï¼ŒåŒæ—¶è¦è®¾ç½®æ‰§è¡Œå‘¨æœŸè°ƒåº¦å™¨</li>
</ol>
<h3 id="spring-task">Spring Task</h3>
<p>ä¸Šé¢çš„æ“ä½œçœ‹ä¸Šå»ä¸å¤šï¼Œä½†æ˜¯Quartzå°†å…¶ä¸­çš„å¯¹è±¡åˆ’åˆ†ç²’åº¦è¿‡ç»†ï¼Œå¯¼è‡´å¼€å‘çš„æ—¶å€™æœ‰ç‚¹ç¹çï¼ŒSpringé’ˆå¯¹ä¸Šè¿°è§„åˆ™è¿›è¡Œäº†ç®€åŒ–ï¼Œå¼€å‘äº†è‡ªå·±çš„ä»»åŠ¡ç®¡ç†ç»„ä»¶â€”â€”Taskï¼Œ</p>
<p>Springæ ¹æ®å®šæ—¶ä»»åŠ¡çš„ç‰¹å¾ï¼Œå°†å®šæ—¶ä»»åŠ¡çš„å¼€å‘ç®€åŒ–åˆ°äº†æè‡´ã€‚æ€ä¹ˆè¯´å‘¢ï¼Ÿè¦åšå®šæ—¶ä»»åŠ¡æ€»è¦å‘Šè¯‰å®¹å™¨æœ‰è¿™åŠŸèƒ½å§ï¼Œç„¶åå®šæ—¶æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ç›´æ¥å‘Šè¯‰å¯¹åº”çš„beanä»€ä¹ˆæ—¶é—´æ‰§è¡Œå°±è¡Œäº†ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œä¸€èµ·æ¥çœ‹æ€ä¹ˆåš</p>
<p><strong>æ­¥éª¤â‘ </strong>ï¼šå¼€å¯å®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼Œä½¿ç”¨æ³¨è§£ @EnableScheduling</p>
<pre><code class="language-java">@SpringBootApplication
//å¼€å¯å®šæ—¶ä»»åŠ¡åŠŸèƒ½
@EnableScheduling
public class Springboot22TaskApplication {
    public static void main(String[] args) {
        SpringApplication.run(Springboot22TaskApplication.class, args);
    }
}
</code></pre>
<p><strong>æ­¥éª¤â‘¡</strong>ï¼šå®šä¹‰Beanï¼Œåœ¨å¯¹åº”è¦å®šæ—¶æ‰§è¡Œçš„æ“ä½œä¸Šæ–¹ï¼Œä½¿ç”¨æ³¨è§£@Scheduledå®šä¹‰æ‰§è¡Œçš„æ—¶é—´ï¼Œæ‰§è¡Œæ—¶é—´çš„æè¿°æ–¹å¼è¿˜æ˜¯cronè¡¨è¾¾å¼</p>
<pre><code class="language-java">@Component
public class MyTask {
    @Scheduled(cron = &quot;0/1 * * * * ?&quot;)
    public void print(){
        System.out.println(Thread.currentThread().getName()+&quot; :spring task run...&quot;);
    }
}
</code></pre>
<p>å®Œäº‹ï¼Œè¿™å°±å®Œæˆäº†å®šæ—¶ä»»åŠ¡çš„é…ç½®ã€‚æ€»ä½“æ„Ÿè§‰å…¶å®ä»€ä¹ˆä¸œè¥¿éƒ½æ²¡å°‘ï¼Œåªä¸è¿‡æ²¡æœ‰å°†æ‰€æœ‰çš„ä¿¡æ¯éƒ½æŠ½å–æˆbeanï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æ³¨è§£ç»‘å®šå®šæ—¶æ‰§è¡Œä»»åŠ¡çš„äº‹æƒ…è€Œå·²ã€‚</p>
<ul>
<li>å¦‚æœæƒ³å¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œç›¸å…³é…ç½®ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œ</li>
</ul>
<pre><code class="language-yaml">spring:
  task:
   	scheduling:
      pool:
       	size: 1							# ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± å¤§å° é»˜è®¤ 1
      thread-name-prefix: spring_task_      	# è°ƒåº¦çº¿ç¨‹åç§°å‰ç¼€ é»˜è®¤ scheduling-      
        shutdown:
          await-termination: false		# çº¿ç¨‹æ± å…³é—­æ—¶ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
          await-termination-period: 10s	# è°ƒåº¦çº¿ç¨‹å…³é—­å‰æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œç¡®ä¿æœ€åä¸€å®šå…³é—­
</code></pre>
<p><strong>æ€»ç»“</strong></p>
<ol>
<li>
<p>Spring Taskéœ€è¦ä½¿ç”¨æ³¨è§£ @EnableScheduling å¼€å¯å®šæ—¶ä»»åŠ¡åŠŸèƒ½</p>
</li>
<li>
<p>ä¸ºå®šæ—¶æ‰§è¡Œçš„çš„ä»»åŠ¡è®¾ç½®æ‰§è¡Œå‘¨æœŸï¼Œæè¿°æ–¹å¼cronè¡¨è¾¾å¼</p>
</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¸¸ç”¨æ–‡ä»¶å’Œä»£ç æ¨¡ç‰ˆ]]></title>
        <id>https://kuangyang828.github.io/chang-yong-wen-jian-he-dai-ma-mo-ban/</id>
        <link href="https://kuangyang828.github.io/chang-yong-wen-jian-he-dai-ma-mo-ban/">
        </link>
        <updated>2022-08-22T08:47:16.000Z</updated>
        <content type="html"><![CDATA[<h1 id="java">Java</h1>
<h2 id="java-2">Java</h2>
<h3 id="result">Result</h3>
<ul>
<li>Result.java</li>
</ul>
<pre><code class="language-Java">public class Result&lt;T&gt; implements Serializable {
    
    public Result() {
    }

    public Result(boolean success, String message, Integer code, T result, long timestamp) {
        this.success = success;
        this.message = message;
        this.code = code;
        this.result = result;
        this.timestamp = timestamp;
    }

    public boolean isSuccess() {
        return success;
    }

    public void setSuccess(boolean success) {
        this.success = success;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

    public T getResult() {
        return result;
    }

    public void setResult(T result) {
        this.result = result;
    }

    public long getTimestamp() {
        return timestamp;
    }

    public void setTimestamp(long timestamp) {
        this.timestamp = timestamp;
    }

    private static final long serialVersionUID = 1L;

    /**
     * æˆåŠŸæ ‡å¿—
     */
    private boolean success = true;

    /**
     * è¿”å›å¤„ç†æ¶ˆæ¯
     */
    private String message = &quot;æ“ä½œæˆåŠŸï¼&quot;;

    /**
     * è¿”å›çŠ¶æ€ç 
     */
    private Integer code = 0;

    /**
     * è¿”å›æ•°æ®å¯¹è±¡
     */
    private T result;

    /**
     * æ—¶é—´æˆ³
     */
    private long timestamp = System.currentTimeMillis();

    public static &lt;T&gt; Result&lt;T&gt; OK() {
        Result&lt;T&gt; rs = new Result&lt;T&gt;();
        rs.setSuccess(true);
        rs.setCode(200);
        rs.setMessage(&quot;æ“ä½œæˆåŠŸï¼&quot;);
        return rs;
    }

    public static &lt;T&gt; Result&lt;T&gt; OK(T data) {
        Result&lt;T&gt; rs = new Result&lt;T&gt;();
        rs.setSuccess(true);
        rs.setCode(200);
        rs.setResult(data);
        return rs;
    }

    public static &lt;T&gt; Result&lt;T&gt; OK(String msg) {
        Result&lt;T&gt; rs = new Result&lt;T&gt;();
        rs.setSuccess(true);
        rs.setCode(200);
        rs.setMessage(msg);
        return rs;
    }

    public static &lt;T&gt; Result&lt;T&gt; OK(String msg, T data) {
        Result&lt;T&gt; rs = new Result&lt;T&gt;();
        rs.setSuccess(true);
        rs.setCode(200);
        rs.setMessage(msg);
        rs.setResult(data);
        return rs;
    }

    public static Result&lt;Object&gt; error(String msg) {
        return error(500, msg);
    }

    public static Result&lt;Object&gt; error(int code, String msg) {
        Result&lt;Object&gt; rs = new Result&lt;Object&gt;();
        rs.setCode(code);
        rs.setMessage(msg);
        rs.setSuccess(false);
        return rs;
    }
}
</code></pre>
<h3 id="stringutils">StringUtils</h3>
<p>StringUtils.java</p>
<pre><code class="language-java">/**
 * å­—ç¬¦ä¸²å·¥å…·ç±»
 */
public class StringUtils {
    /**
     * ç©ºå­—ç¬¦ä¸²
     */
    private static final String NULLSTR = &quot;&quot;;

    /**
     * ä¸‹åˆ’çº¿
     */
    private static final char SEPARATOR = '_';

    /**
     * ç¡®ä¿è·å–çš„å‚æ•°ä¸ä¸ºç©ºå€¼
     *
     * @param value defaultValue è¦åˆ¤æ–­çš„value
     * @return value è¿”å›å€¼
     */
    public static &lt;T&gt; T nvl(T value, T defaultValue) {
        return value != null ? value : defaultValue;
    }

    /**
     * åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºä¸²
     *
     * @param str String
     * @return trueï¼šä¸ºç©º falseï¼šéç©º
     */
    public static boolean isEmpty(String str) {
        return null == str || NULLSTR.equals(str.trim());
    }

    /**
     * åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºéç©ºä¸²
     *
     * @param str String
     * @return trueï¼šéç©ºä¸² falseï¼šç©ºä¸²
     */
    public static boolean isNotEmpty(String str) {
        return !isEmpty(str);
    }


    /**
     * å»ç©ºæ ¼
     */
    public static String trim(String str) {
        return (str == null ? &quot;&quot; : str.trim());
    }

    /**
     * æ˜¯å¦ä¸ºhttp(s)://å¼€å¤´
     *
     * @param link é“¾æ¥
     * @return ç»“æœ
     */
    public static boolean ishttp(String link) {
        return link.equalsIgnoreCase(&quot;http&quot;) || link.equalsIgnoreCase(&quot;https&quot;);
    }

    /**
     * é©¼å³°è½¬ä¸‹åˆ’çº¿å‘½åæ–¹å¼ã€‚
     * ä¸åŒºåˆ†å¤§é©¼å³°æˆ–å°é©¼å³°
     * ä¾‹å¦‚ï¼š
     * â‘  HelloWorld -&gt; hello_world
     * â‘¡ helloWorld -&gt; hello_world
     *
     * @param str è½¬æ¢å‰çš„é©¼å³°æ–¹å¼å‘½åçš„å­—ç¬¦ä¸²
     * @return è½¬æ¢åçš„ä¸‹åˆ’çº¿å‘½åçš„å­—ç¬¦ä¸²
     */
    public static String toUnderScoreCase(String str) {
        if (str == null) {
            return null;
        }
        StringBuilder sb = new StringBuilder();
        // å‰ç½®å­—ç¬¦æ˜¯å¦å¤§å†™
        boolean preCharIsUpperCase = true;
        // å½“å‰å­—ç¬¦æ˜¯å¦å¤§å†™
        boolean curreCharIsUpperCase = true;
        // ä¸‹ä¸€å­—ç¬¦æ˜¯å¦å¤§å†™
        boolean nexteCharIsUpperCase = true;
        for (int i = 0; i &lt; str.length(); i++) {
            char c = str.charAt(i);
            if (i &gt; 0) {
                preCharIsUpperCase = Character.isUpperCase(str.charAt(i - 1));
            } else {
                preCharIsUpperCase = false;
            }

            curreCharIsUpperCase = Character.isUpperCase(c);

            if (i &lt; (str.length() - 1)) {
                nexteCharIsUpperCase = Character.isUpperCase(str.charAt(i + 1));
            }

            if (preCharIsUpperCase &amp;&amp; curreCharIsUpperCase &amp;&amp; !nexteCharIsUpperCase) {
                sb.append(SEPARATOR);
            } else if ((i != 0 &amp;&amp; !preCharIsUpperCase) &amp;&amp; curreCharIsUpperCase) {
                sb.append(SEPARATOR);
            }
            sb.append(Character.toLowerCase(c));
        }

        return sb.toString();
    }

    /**
     * æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²
     *
     * @param str  éªŒè¯å­—ç¬¦ä¸²
     * @param strs å­—ç¬¦ä¸²ç»„
     * @return åŒ…å«è¿”å›true
     */
    public static boolean inStringIgnoreCase(String str, String... strs) {
        if (str != null &amp;&amp; strs != null) {
            for (String s : strs) {
                if (str.equalsIgnoreCase(trim(s))) {
                    return true;
                }
            }
        }
        return false;
    }

    /**
     * ä¸‹åˆ’çº¿æ–¹å¼å‘½åçš„å­—ç¬¦ä¸²æˆ–å°é©¼å³°ï¼Œè½¬æ¢ä¸ºå¤§é©¼å³°å¼ã€‚
     * å¦‚æœè½¬æ¢å‰çš„ä¸‹åˆ’çº¿å¤§å†™æ–¹å¼å‘½åçš„å­—ç¬¦ä¸²ä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚
     * ä¾‹å¦‚ï¼š
     * â‘  HELLO_WORLD -&gt; HelloWorld
     * â‘¡ hello_world -&gt; HelloWorld
     * â‘¢ helloWorld -&gt; HelloWorld
     *
     * @param name è½¬æ¢å‰çš„ä¸‹åˆ’çº¿å¤§å†™æ–¹å¼å‘½åçš„å­—ç¬¦ä¸²
     * @return è½¬æ¢åçš„é©¼å³°å¼å‘½åçš„å­—ç¬¦ä¸²
     */
    public static String toBigCamelCase(String name) {
        StringBuilder result = new StringBuilder();
        // å¿«é€Ÿæ£€æŸ¥
        if (name == null || name.isEmpty()) {
            // æ²¡å¿…è¦è½¬æ¢
            return &quot;&quot;;
        } else if (!name.contains(&quot;_&quot;)) {
            // ä¸å«ä¸‹åˆ’çº¿ï¼Œä»…å°†é¦–å­—æ¯å¤§å†™
            return name.substring(0, 1).toUpperCase() + name.substring(1);
        }
        // ç”¨ä¸‹åˆ’çº¿å°†åŸå§‹å­—ç¬¦ä¸²åˆ†å‰²
        String[] camels = name.split(&quot;_&quot;);
        for (String camel : camels) {
            // è·³è¿‡åŸå§‹å­—ç¬¦ä¸²ä¸­å¼€å¤´ã€ç»“å°¾çš„ä¸‹æ¢çº¿æˆ–åŒé‡ä¸‹åˆ’çº¿
            if (camel.isEmpty()) {
                continue;
            }
            // é¦–å­—æ¯å¤§å†™
            result.append(camel.substring(0, 1).toUpperCase());
            result.append(camel.substring(1).toLowerCase());
        }
        return result.toString();
    }

    /**
     * ä¸‹åˆ’çº¿æ–¹å¼å‘½åçš„å­—ç¬¦ä¸²è½¬å°é©¼å³°å¼ã€‚
     * ä¾‹å¦‚ï¼š
     * â‘  USER_NAME-&gt;userName
     * â‘¡ user_name-&gt;userName
     *
     * @param s è½¬æ¢å‰çš„ä¸‹åˆ’çº¿å°å†™æ–¹å¼å‘½åçš„å­—ç¬¦ä¸²
     * @return è½¬æ¢åçš„é©¼å³°å¼å‘½åçš„å­—ç¬¦ä¸²
     */
    public static String toSmallCamelCase(String s) {
        if (s == null) {
            return null;
        }
        s = s.toLowerCase();
        StringBuilder sb = new StringBuilder(s.length());
        boolean upperCase = false;
        for (int i = 0; i &lt; s.length(); i++) {
            char c = s.charAt(i);
            if (c == SEPARATOR) {
                upperCase = true;
            } else if (upperCase) {
                sb.append(Character.toUpperCase(c));
                upperCase = false;
            } else {
                sb.append(c);
            }
        }
        return sb.toString();
    }

}
</code></pre>
<h3 id="uuid">UUID</h3>
<ul>
<li>UUID.java</li>
</ul>
<pre><code class="language-java">/**
 * æä¾›é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆuniversally unique identifierï¼‰ï¼ˆUUIDï¼‰å®ç°
 */
public final class UUID implements java.io.Serializable, Comparable&lt;UUID&gt;
{
    private static final long serialVersionUID = -1185015143654744140L;

    /**
     * SecureRandom çš„å•ä¾‹
     *
     */
    private static class Holder
    {
        static final SecureRandom numberGenerator = getSecureRandom();
    }

    /** æ­¤UUIDçš„æœ€é«˜64æœ‰æ•ˆä½ */
    private final long mostSigBits;

    /** æ­¤UUIDçš„æœ€ä½64æœ‰æ•ˆä½ */
    private final long leastSigBits;

    /**
     * ç§æœ‰æ„é€ 
     * 
     * @param data æ•°æ®
     */
    private UUID(byte[] data)
    {
        long msb = 0;
        long lsb = 0;
        assert data.length == 16 : &quot;data must be 16 bytes in length&quot;;
        for (int i = 0; i &lt; 8; i++)
        {
            msb = (msb &lt;&lt; 8) | (data[i] &amp; 0xff);
        }
        for (int i = 8; i &lt; 16; i++)
        {
            lsb = (lsb &lt;&lt; 8) | (data[i] &amp; 0xff);
        }
        this.mostSigBits = msb;
        this.leastSigBits = lsb;
    }

    /**
     * ä½¿ç”¨æŒ‡å®šçš„æ•°æ®æ„é€ æ–°çš„ UUIDã€‚
     *
     * @param mostSigBits ç”¨äº {@code UUID} çš„æœ€é«˜æœ‰æ•ˆ 64 ä½
     * @param leastSigBits ç”¨äº {@code UUID} çš„æœ€ä½æœ‰æ•ˆ 64 ä½
     */
    public UUID(long mostSigBits, long leastSigBits)
    {
        this.mostSigBits = mostSigBits;
        this.leastSigBits = leastSigBits;
    }

    /**
     * è·å–ç±»å‹ 4ï¼ˆä¼ªéšæœºç”Ÿæˆçš„ï¼‰UUID çš„é™æ€å·¥å‚ã€‚ ä½¿ç”¨åŠ å¯†çš„æœ¬åœ°çº¿ç¨‹ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆè¯¥ UUIDã€‚
     * 
     * @return éšæœºç”Ÿæˆçš„ {@code UUID}
     */
    public static UUID fastUUID()
    {
        return randomUUID(false);
    }

    /**
     * è·å–ç±»å‹ 4ï¼ˆä¼ªéšæœºç”Ÿæˆçš„ï¼‰UUID çš„é™æ€å·¥å‚ã€‚ ä½¿ç”¨åŠ å¯†çš„å¼ºä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆè¯¥ UUIDã€‚
     * 
     * @return éšæœºç”Ÿæˆçš„ {@code UUID}
     */
    public static UUID randomUUID()
    {
        return randomUUID(true);
    }

    /**
     * è·å–ç±»å‹ 4ï¼ˆä¼ªéšæœºç”Ÿæˆçš„ï¼‰UUID çš„é™æ€å·¥å‚ã€‚ ä½¿ç”¨åŠ å¯†çš„å¼ºä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆè¯¥ UUIDã€‚
     * 
     * @param isSecure æ˜¯å¦ä½¿ç”¨{@link SecureRandom}å¦‚æœæ˜¯å¯ä»¥è·å¾—æ›´å®‰å…¨çš„éšæœºç ï¼Œå¦åˆ™å¯ä»¥å¾—åˆ°æ›´å¥½çš„æ€§èƒ½
     * @return éšæœºç”Ÿæˆçš„ {@code UUID}
     */
    public static UUID randomUUID(boolean isSecure)
    {
        final Random ng = isSecure ? Holder.numberGenerator : getRandom();

        byte[] randomBytes = new byte[16];
        ng.nextBytes(randomBytes);
        randomBytes[6] &amp;= 0x0f; /* clear version */
        randomBytes[6] |= 0x40; /* set to version 4 */
        randomBytes[8] &amp;= 0x3f; /* clear variant */
        randomBytes[8] |= 0x80; /* set to IETF variant */
        return new UUID(randomBytes);
    }

    /**
     * æ ¹æ®æŒ‡å®šçš„å­—èŠ‚æ•°ç»„è·å–ç±»å‹ 3ï¼ˆåŸºäºåç§°çš„ï¼‰UUID çš„é™æ€å·¥å‚ã€‚
     *
     * @param name ç”¨äºæ„é€  UUID çš„å­—èŠ‚æ•°ç»„ã€‚
     *
     * @return æ ¹æ®æŒ‡å®šæ•°ç»„ç”Ÿæˆçš„ {@code UUID}
     */
    public static UUID nameUUIDFromBytes(byte[] name)
    {
        MessageDigest md;
        try
        {
            md = MessageDigest.getInstance(&quot;MD5&quot;);
        }
        catch (NoSuchAlgorithmException nsae)
        {
            throw new InternalError(&quot;MD5 not supported&quot;);
        }
        byte[] md5Bytes = md.digest(name);
        md5Bytes[6] &amp;= 0x0f; /* clear version */
        md5Bytes[6] |= 0x30; /* set to version 3 */
        md5Bytes[8] &amp;= 0x3f; /* clear variant */
        md5Bytes[8] |= 0x80; /* set to IETF variant */
        return new UUID(md5Bytes);
    }

    /**
     * æ ¹æ® {@link #toString()} æ–¹æ³•ä¸­æè¿°çš„å­—ç¬¦ä¸²æ ‡å‡†è¡¨ç¤ºå½¢å¼åˆ›å»º{@code UUID}ã€‚
     *
     * @param name æŒ‡å®š {@code UUID} å­—ç¬¦ä¸²
     * @return å…·æœ‰æŒ‡å®šå€¼çš„ {@code UUID}
     * @throws IllegalArgumentException å¦‚æœ name ä¸ {@link #toString} ä¸­æè¿°çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ä¸ç¬¦æŠ›å‡ºæ­¤å¼‚å¸¸
     *
     */
    public static UUID fromString(String name)
    {
        String[] components = name.split(&quot;-&quot;);
        if (components.length != 5)
        {
            throw new IllegalArgumentException(&quot;Invalid UUID string: &quot; + name);
        }
        for (int i = 0; i &lt; 5; i++)
        {
            components[i] = &quot;0x&quot; + components[i];
        }

        long mostSigBits = Long.decode(components[0]).longValue();
        mostSigBits &lt;&lt;= 16;
        mostSigBits |= Long.decode(components[1]).longValue();
        mostSigBits &lt;&lt;= 16;
        mostSigBits |= Long.decode(components[2]).longValue();

        long leastSigBits = Long.decode(components[3]).longValue();
        leastSigBits &lt;&lt;= 48;
        leastSigBits |= Long.decode(components[4]).longValue();

        return new UUID(mostSigBits, leastSigBits);
    }

    /**
     * è¿”å›æ­¤ UUID çš„ 128 ä½å€¼ä¸­çš„æœ€ä½æœ‰æ•ˆ 64 ä½ã€‚
     *
     * @return æ­¤ UUID çš„ 128 ä½å€¼ä¸­çš„æœ€ä½æœ‰æ•ˆ 64 ä½ã€‚
     */
    public long getLeastSignificantBits()
    {
        return leastSigBits;
    }

    /**
     * è¿”å›æ­¤ UUID çš„ 128 ä½å€¼ä¸­çš„æœ€é«˜æœ‰æ•ˆ 64 ä½ã€‚
     *
     * @return æ­¤ UUID çš„ 128 ä½å€¼ä¸­æœ€é«˜æœ‰æ•ˆ 64 ä½ã€‚
     */
    public long getMostSignificantBits()
    {
        return mostSigBits;
    }

    /**
     * ä¸æ­¤ {@code UUID} ç›¸å…³è”çš„ç‰ˆæœ¬å·. ç‰ˆæœ¬å·æè¿°æ­¤ {@code UUID} æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚
     * &lt;p&gt;
     * ç‰ˆæœ¬å·å…·æœ‰ä»¥ä¸‹å«æ„:
     * &lt;ul&gt;
     * &lt;li&gt;1 åŸºäºæ—¶é—´çš„ UUID
     * &lt;li&gt;2 DCE å®‰å…¨ UUID
     * &lt;li&gt;3 åŸºäºåç§°çš„ UUID
     * &lt;li&gt;4 éšæœºç”Ÿæˆçš„ UUID
     * &lt;/ul&gt;
     *
     * @return æ­¤ {@code UUID} çš„ç‰ˆæœ¬å·
     */
    public int version()
    {
        // Version is bits masked by 0x000000000000F000 in MS long
        return (int) ((mostSigBits &gt;&gt; 12) &amp; 0x0f);
    }

    /**
     * ä¸æ­¤ {@code UUID} ç›¸å…³è”çš„å˜ä½“å·ã€‚å˜ä½“å·æè¿° {@code UUID} çš„å¸ƒå±€ã€‚
     * &lt;p&gt;
     * å˜ä½“å·å…·æœ‰ä»¥ä¸‹å«æ„ï¼š
     * &lt;ul&gt;
     * &lt;li&gt;0 ä¸º NCS å‘åå…¼å®¹ä¿ç•™
     * &lt;li&gt;2 &lt;a href=&quot;http://www.ietf.org/rfc/rfc4122.txt&quot;&gt;IETF&amp;nbsp;RFC&amp;nbsp;4122&lt;/a&gt;(Leach-Salz), ç”¨äºæ­¤ç±»
     * &lt;li&gt;6 ä¿ç•™ï¼Œå¾®è½¯å‘åå…¼å®¹
     * &lt;li&gt;7 ä¿ç•™ä¾›ä»¥åå®šä¹‰ä½¿ç”¨
     * &lt;/ul&gt;
     *
     * @return æ­¤ {@code UUID} ç›¸å…³è”çš„å˜ä½“å·
     */
    public int variant()
    {
        // This field is composed of a varying number of bits.
        // 0 - - Reserved for NCS backward compatibility
        // 1 0 - The IETF aka Leach-Salz variant (used by this class)
        // 1 1 0 Reserved, Microsoft backward compatibility
        // 1 1 1 Reserved for future definition.
        return (int) ((leastSigBits &gt;&gt;&gt; (64 - (leastSigBits &gt;&gt;&gt; 62))) &amp; (leastSigBits &gt;&gt; 63));
    }

    /**
     * ä¸æ­¤ UUID ç›¸å…³è”çš„æ—¶é—´æˆ³å€¼ã€‚
     *
     * &lt;p&gt;
     * 60 ä½çš„æ—¶é—´æˆ³å€¼æ ¹æ®æ­¤ {@code UUID} çš„ time_lowã€time_mid å’Œ time_hi å­—æ®µæ„é€ ã€‚&lt;br&gt;
     * æ‰€å¾—åˆ°çš„æ—¶é—´æˆ³ä»¥ 100 æ¯«å¾®ç§’ä¸ºå•ä½ï¼Œä» UTCï¼ˆé€šç”¨åè°ƒæ—¶é—´ï¼‰ 1582 å¹´ 10 æœˆ 15 æ—¥é›¶æ—¶å¼€å§‹ã€‚
     *
     * &lt;p&gt;
     * æ—¶é—´æˆ³å€¼ä»…åœ¨åœ¨åŸºäºæ—¶é—´çš„ UUIDï¼ˆå…¶ version ç±»å‹ä¸º 1ï¼‰ä¸­æ‰æœ‰æ„ä¹‰ã€‚&lt;br&gt;
     * å¦‚æœæ­¤ {@code UUID} ä¸æ˜¯åŸºäºæ—¶é—´çš„ UUIDï¼Œåˆ™æ­¤æ–¹æ³•æŠ›å‡º UnsupportedOperationExceptionã€‚
     *
     * @throws UnsupportedOperationException å¦‚æœæ­¤ {@code UUID} ä¸æ˜¯ version ä¸º 1 çš„ UUIDã€‚
     */
    public long timestamp() throws UnsupportedOperationException
    {
        checkTimeBase();
        return (mostSigBits &amp; 0x0FFFL) &lt;&lt; 48//
                | ((mostSigBits &gt;&gt; 16) &amp; 0x0FFFFL) &lt;&lt; 32//
                | mostSigBits &gt;&gt;&gt; 32;
    }

    /**
     * ä¸æ­¤ UUID ç›¸å…³è”çš„æ—¶é’Ÿåºåˆ—å€¼ã€‚
     *
     * &lt;p&gt;
     * 14 ä½çš„æ—¶é’Ÿåºåˆ—å€¼æ ¹æ®æ­¤ UUID çš„ clock_seq å­—æ®µæ„é€ ã€‚clock_seq å­—æ®µç”¨äºä¿è¯åœ¨åŸºäºæ—¶é—´çš„ UUID ä¸­çš„æ—¶é—´å”¯ä¸€æ€§ã€‚
     * &lt;p&gt;
     * {@code clockSequence} å€¼ä»…åœ¨åŸºäºæ—¶é—´çš„ UUIDï¼ˆå…¶ version ç±»å‹ä¸º 1ï¼‰ä¸­æ‰æœ‰æ„ä¹‰ã€‚ å¦‚æœæ­¤ UUID ä¸æ˜¯åŸºäºæ—¶é—´çš„ UUIDï¼Œåˆ™æ­¤æ–¹æ³•æŠ›å‡º
     * UnsupportedOperationExceptionã€‚
     *
     * @return æ­¤ {@code UUID} çš„æ—¶é’Ÿåºåˆ—
     *
     * @throws UnsupportedOperationException å¦‚æœæ­¤ UUID çš„ version ä¸ä¸º 1
     */
    public int clockSequence() throws UnsupportedOperationException
    {
        checkTimeBase();
        return (int) ((leastSigBits &amp; 0x3FFF000000000000L) &gt;&gt;&gt; 48);
    }

    /**
     * ä¸æ­¤ UUID ç›¸å…³çš„èŠ‚ç‚¹å€¼ã€‚
     *
     * &lt;p&gt;
     * 48 ä½çš„èŠ‚ç‚¹å€¼æ ¹æ®æ­¤ UUID çš„ node å­—æ®µæ„é€ ã€‚æ­¤å­—æ®µæ—¨åœ¨ç”¨äºä¿å­˜æœºå™¨çš„ IEEE 802 åœ°å€ï¼Œè¯¥åœ°å€ç”¨äºç”Ÿæˆæ­¤ UUID ä»¥ä¿è¯ç©ºé—´å”¯ä¸€æ€§ã€‚
     * &lt;p&gt;
     * èŠ‚ç‚¹å€¼ä»…åœ¨åŸºäºæ—¶é—´çš„ UUIDï¼ˆå…¶ version ç±»å‹ä¸º 1ï¼‰ä¸­æ‰æœ‰æ„ä¹‰ã€‚&lt;br&gt;
     * å¦‚æœæ­¤ UUID ä¸æ˜¯åŸºäºæ—¶é—´çš„ UUIDï¼Œåˆ™æ­¤æ–¹æ³•æŠ›å‡º UnsupportedOperationExceptionã€‚
     *
     * @return æ­¤ {@code UUID} çš„èŠ‚ç‚¹å€¼
     *
     * @throws UnsupportedOperationException å¦‚æœæ­¤ UUID çš„ version ä¸ä¸º 1
     */
    public long node() throws UnsupportedOperationException
    {
        checkTimeBase();
        return leastSigBits &amp; 0x0000FFFFFFFFFFFFL;
    }

    /**
     * è¿”å›æ­¤{@code UUID} çš„å­—ç¬¦ä¸²è¡¨ç°å½¢å¼ã€‚
     *
     * &lt;p&gt;
     * UUID çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ç”±æ­¤ BNF æè¿°ï¼š
     * 
     * &lt;pre&gt;
     * {@code
     * UUID                   = &lt;time_low&gt;-&lt;time_mid&gt;-&lt;time_high_and_version&gt;-&lt;variant_and_sequence&gt;-&lt;node&gt;
     * time_low               = 4*&lt;hexOctet&gt;
     * time_mid               = 2*&lt;hexOctet&gt;
     * time_high_and_version  = 2*&lt;hexOctet&gt;
     * variant_and_sequence   = 2*&lt;hexOctet&gt;
     * node                   = 6*&lt;hexOctet&gt;
     * hexOctet               = &lt;hexDigit&gt;&lt;hexDigit&gt;
     * hexDigit               = [0-9a-fA-F]
     * }
     * &lt;/pre&gt;
     * 
     * &lt;/blockquote&gt;
     *
     * @return æ­¤{@code UUID} çš„å­—ç¬¦ä¸²è¡¨ç°å½¢å¼
     * @see #toString(boolean)
     */
    @Override
    public String toString()
    {
        return toString(false);
    }

    /**
     * è¿”å›æ­¤{@code UUID} çš„å­—ç¬¦ä¸²è¡¨ç°å½¢å¼ã€‚
     *
     * &lt;p&gt;
     * UUID çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ç”±æ­¤ BNF æè¿°ï¼š
     * 
     * &lt;pre&gt;
     * {@code
     * UUID                   = &lt;time_low&gt;-&lt;time_mid&gt;-&lt;time_high_and_version&gt;-&lt;variant_and_sequence&gt;-&lt;node&gt;
     * time_low               = 4*&lt;hexOctet&gt;
     * time_mid               = 2*&lt;hexOctet&gt;
     * time_high_and_version  = 2*&lt;hexOctet&gt;
     * variant_and_sequence   = 2*&lt;hexOctet&gt;
     * node                   = 6*&lt;hexOctet&gt;
     * hexOctet               = &lt;hexDigit&gt;&lt;hexDigit&gt;
     * hexDigit               = [0-9a-fA-F]
     * }
     * &lt;/pre&gt;
     * 
     * &lt;/blockquote&gt;
     *
     * @param isSimple æ˜¯å¦ç®€å•æ¨¡å¼ï¼Œç®€å•æ¨¡å¼ä¸ºä¸å¸¦'-'çš„UUIDå­—ç¬¦ä¸²
     * @return æ­¤{@code UUID} çš„å­—ç¬¦ä¸²è¡¨ç°å½¢å¼
     */
    public String toString(boolean isSimple)
    {
        final StringBuilder builder = new StringBuilder(isSimple ? 32 : 36);
        // time_low
        builder.append(digits(mostSigBits &gt;&gt; 32, 8));
        if (!isSimple)
        {
            builder.append('-');
        }
        // time_mid
        builder.append(digits(mostSigBits &gt;&gt; 16, 4));
        if (!isSimple)
        {
            builder.append('-');
        }
        // time_high_and_version
        builder.append(digits(mostSigBits, 4));
        if (!isSimple)
        {
            builder.append('-');
        }
        // variant_and_sequence
        builder.append(digits(leastSigBits &gt;&gt; 48, 4));
        if (!isSimple)
        {
            builder.append('-');
        }
        // node
        builder.append(digits(leastSigBits, 12));

        return builder.toString();
    }

    /**
     * è¿”å›æ­¤ UUID çš„å“ˆå¸Œç ã€‚
     *
     * @return UUID çš„å“ˆå¸Œç å€¼ã€‚
     */
    @Override
    public int hashCode()
    {
        long hilo = mostSigBits ^ leastSigBits;
        return ((int) (hilo &gt;&gt; 32)) ^ (int) hilo;
    }

    /**
     * å°†æ­¤å¯¹è±¡ä¸æŒ‡å®šå¯¹è±¡æ¯”è¾ƒã€‚
     * &lt;p&gt;
     * å½“ä¸”ä»…å½“å‚æ•°ä¸ä¸º {@code null}ã€è€Œæ˜¯ä¸€ä¸ª UUID å¯¹è±¡ã€å…·æœ‰ä¸æ­¤ UUID ç›¸åŒçš„ varriantã€åŒ…å«ç›¸åŒçš„å€¼ï¼ˆæ¯ä¸€ä½å‡ç›¸åŒï¼‰æ—¶ï¼Œç»“æœæ‰ä¸º {@code true}ã€‚
     *
     * @param obj è¦ä¸ä¹‹æ¯”è¾ƒçš„å¯¹è±¡
     *
     * @return å¦‚æœå¯¹è±¡ç›¸åŒï¼Œåˆ™è¿”å› {@code true}ï¼›å¦åˆ™è¿”å› {@code false}
     */
    @Override
    public boolean equals(Object obj)
    {
        if ((null == obj) || (obj.getClass() != UUID.class))
        {
            return false;
        }
        UUID id = (UUID) obj;
        return (mostSigBits == id.mostSigBits &amp;&amp; leastSigBits == id.leastSigBits);
    }

    // Comparison Operations

    /**
     * å°†æ­¤ UUID ä¸æŒ‡å®šçš„ UUID æ¯”è¾ƒã€‚
     *
     * &lt;p&gt;
     * å¦‚æœä¸¤ä¸ª UUID ä¸åŒï¼Œä¸”ç¬¬ä¸€ä¸ª UUID çš„æœ€é«˜æœ‰æ•ˆå­—æ®µå¤§äºç¬¬äºŒä¸ª UUID çš„å¯¹åº”å­—æ®µï¼Œåˆ™ç¬¬ä¸€ä¸ª UUID å¤§äºç¬¬äºŒä¸ª UUIDã€‚
     *
     * @param val ä¸æ­¤ UUID æ¯”è¾ƒçš„ UUID
     *
     * @return åœ¨æ­¤ UUID å°äºã€ç­‰äºæˆ–å¤§äº val æ—¶ï¼Œåˆ†åˆ«è¿”å› -1ã€0 æˆ– 1ã€‚
     *
     */
    @Override
    public int compareTo(UUID val)
    {
        // The ordering is intentionally set up so that the UUIDs
        // can simply be numerically compared as two numbers
        return (this.mostSigBits &lt; val.mostSigBits ? -1 : //
                (this.mostSigBits &gt; val.mostSigBits ? 1 : //
                        (this.leastSigBits &lt; val.leastSigBits ? -1 : //
                                (this.leastSigBits &gt; val.leastSigBits ? 1 : //
                                        0))));
    }

    // -------------------------------------------------------------------------------------------------------------------
    // Private method start
    /**
     * è¿”å›æŒ‡å®šæ•°å­—å¯¹åº”çš„hexå€¼
     * 
     * @param val å€¼
     * @param digits ä½
     * @return å€¼
     */
    private static String digits(long val, int digits)
    {
        long hi = 1L &lt;&lt; (digits * 4);
        return Long.toHexString(hi | (val &amp; (hi - 1))).substring(1);
    }

    /**
     * æ£€æŸ¥æ˜¯å¦ä¸ºtime-basedç‰ˆæœ¬UUID
     */
    private void checkTimeBase()
    {
        if (version() != 1)
        {
            throw new UnsupportedOperationException(&quot;Not a time-based UUID&quot;);
        }
    }

    /**
     * è·å–{@link SecureRandom}ï¼Œç±»æä¾›åŠ å¯†çš„å¼ºéšæœºæ•°ç”Ÿæˆå™¨ (RNG)
     * 
     * @return {@link SecureRandom}
     */
    public static SecureRandom getSecureRandom()
    {
        try
        {
            return SecureRandom.getInstance(&quot;SHA1PRNG&quot;);
        }
        catch (NoSuchAlgorithmException e)
        {
            throw new RuntimeException(e);
        }
    }

    /**
     * è·å–éšæœºæ•°ç”Ÿæˆå™¨å¯¹è±¡&lt;br&gt;
     * ThreadLocalRandomæ˜¯JDK 7ä¹‹åæä¾›å¹¶å‘äº§ç”Ÿéšæœºæ•°ï¼Œèƒ½å¤Ÿè§£å†³å¤šä¸ªçº¿ç¨‹å‘ç”Ÿçš„ç«äº‰äº‰å¤ºã€‚
     * 
     * @return {@link ThreadLocalRandom}
     */
    public static ThreadLocalRandom getRandom()
    {
        return ThreadLocalRandom.current();
    }
}
</code></pre>
<h3 id="validatecodeutils">ValidateCodeUtils</h3>
<ul>
<li>ValidateCodeUtils.java</li>
</ul>
<pre><code class="language-java">/**
 * éšæœºç”ŸæˆéªŒè¯ç å·¥å…·ç±»
 */
public class ValidateCodeUtils {

    /**
     * éšæœºç”ŸæˆéªŒè¯ç 
     *
     * @param length é•¿åº¦ä¸º4ä½æˆ–è€…6ä½
     * @return
     */
    public static String generateValidateCode(int length) {
        Integer code = null;
        if (length == 4) {
            // ç”Ÿæˆéšæœºæ•°ï¼Œæœ€å¤§ä¸º9999
            code = new Random().nextInt(9999);
            if (code &lt; 1000) {
                // ä¿è¯éšæœºæ•°ä¸º4ä½æ•°å­—
                code = code + 1000;
            }
        } else if (length == 6) {
            // ç”Ÿæˆéšæœºæ•°ï¼Œæœ€å¤§ä¸º999999
            code = new Random().nextInt(999999);
            if (code &lt; 100000) {
                // ä¿è¯éšæœºæ•°ä¸º6ä½æ•°å­—
                code = code + 100000;
            }
        } else {
            throw new RuntimeException(&quot;åªèƒ½ç”Ÿæˆ4ä½æˆ–6ä½æ•°å­—éªŒè¯ç &quot;);
        }
        return String.valueOf(code);
    }

    /**
     * éšæœºç”ŸæˆæŒ‡å®šé•¿åº¦å­—ç¬¦ä¸²éªŒè¯ç  å¸¦å­—æ¯
     *
     * @param length é•¿åº¦
     * @return
     */
    public static String generateValidateCodeString(int length) {
        Random rdm = new Random();
        String hash1 = Integer.toHexString(rdm.nextInt());
        String capstr = hash1.substring(0, length);
        return capstr;
    }
}
</code></pre>
<h3 id="beanutils">BeanUtils</h3>
<ul>
<li>BeanUtils.java</li>
</ul>
<pre><code class="language-java">public class BeanUtils {

    /**
     * æ£€æŸ¥JavaBeanæ‰€æœ‰å±æ€§å­—æ®µæ˜¯å¦éç©º
     *
     * @param object
     * @return trueï¼šæ‰€æœ‰å±æ€§æ˜¯ç©º  falseï¼šæ‰€æœ‰å±æ€§éç©º
     */
    public static boolean checkAllFilesIsNull(Object object) {
        if (null == object) {
            return true;
        }
        //é€šè¿‡åå°„è·å–å¯¹è±¡æ‰€æœ‰å±æ€§å­—æ®µ
        Field[] fields = object.getClass().getDeclaredFields();
        for (Field field : fields) {
            //è®¾ç½®å­—æ®µå¯è®¿é—®
            field.setAccessible(true);
            //åˆ¤æ–­å­—æ®µæ˜¯å¦éç©º
            try {
                Object fieldValue = field.get(object);
                if (null != fieldValue &amp;&amp; !&quot;&quot;.equals(fieldValue.toString())) {
                    return false;
                }
            } catch (IllegalAccessException e) {
                throw new RuntimeException(e);
            }
        }
        return true;
    }
}
</code></pre>
<h3 id="base64utils">Base64Utils</h3>
<ul>
<li>Base64Utils.java</li>
</ul>
<pre><code class="language-java">/**
 * Base64å·¥å…·ç±»
 */
public final class Base64Utils
{
    static private final int     BASELENGTH           = 128;
    static private final int     LOOKUPLENGTH         = 64;
    static private final int     TWENTYFOURBITGROUP   = 24;
    static private final int     EIGHTBIT             = 8;
    static private final int     SIXTEENBIT           = 16;
    static private final int     FOURBYTE             = 4;
    static private final int     SIGN                 = -128;
    static private final char    PAD                  = '=';
    static final private byte[]  base64Alphabet       = new byte[BASELENGTH];
    static final private char[]  lookUpBase64Alphabet = new char[LOOKUPLENGTH];

    static
    {
        for (int i = 0; i &lt; BASELENGTH; ++i)
        {
            base64Alphabet[i] = -1;
        }
        for (int i = 'Z'; i &gt;= 'A'; i--)
        {
            base64Alphabet[i] = (byte) (i - 'A');
        }
        for (int i = 'z'; i &gt;= 'a'; i--)
        {
            base64Alphabet[i] = (byte) (i - 'a' + 26);
        }

        for (int i = '9'; i &gt;= '0'; i--)
        {
            base64Alphabet[i] = (byte) (i - '0' + 52);
        }

        base64Alphabet['+'] = 62;
        base64Alphabet['/'] = 63;

        for (int i = 0; i &lt;= 25; i++)
        {
            lookUpBase64Alphabet[i] = (char) ('A' + i);
        }

        for (int i = 26, j = 0; i &lt;= 51; i++, j++)
        {
            lookUpBase64Alphabet[i] = (char) ('a' + j);
        }

        for (int i = 52, j = 0; i &lt;= 61; i++, j++)
        {
            lookUpBase64Alphabet[i] = (char) ('0' + j);
        }
        lookUpBase64Alphabet[62] = (char) '+';
        lookUpBase64Alphabet[63] = (char) '/';
    }

    private static boolean isWhiteSpace(char octect)
    {
        return (octect == 0x20 || octect == 0xd || octect == 0xa || octect == 0x9);
    }

    private static boolean isPad(char octect)
    {
        return (octect == PAD);
    }

    private static boolean isData(char octect)
    {
        return (octect &lt; BASELENGTH &amp;&amp; base64Alphabet[octect] != -1);
    }

    /**
     * Encodes hex octects into Base64
     *
     * @param binaryData Array containing binaryData
     * @return Encoded Base64 array
     */
    public static String encode(byte[] binaryData)
    {
        if (binaryData == null)
        {
            return null;
        }

        int lengthDataBits = binaryData.length * EIGHTBIT;
        if (lengthDataBits == 0)
        {
            return &quot;&quot;;
        }

        int fewerThan24bits = lengthDataBits % TWENTYFOURBITGROUP;
        int numberTriplets = lengthDataBits / TWENTYFOURBITGROUP;
        int numberQuartet = fewerThan24bits != 0 ? numberTriplets + 1 : numberTriplets;
        char encodedData[] = null;

        encodedData = new char[numberQuartet * 4];

        byte k = 0, l = 0, b1 = 0, b2 = 0, b3 = 0;

        int encodedIndex = 0;
        int dataIndex = 0;

        for (int i = 0; i &lt; numberTriplets; i++)
        {
            b1 = binaryData[dataIndex++];
            b2 = binaryData[dataIndex++];
            b3 = binaryData[dataIndex++];

            l = (byte) (b2 &amp; 0x0f);
            k = (byte) (b1 &amp; 0x03);

            byte val1 = ((b1 &amp; SIGN) == 0) ? (byte) (b1 &gt;&gt; 2) : (byte) ((b1) &gt;&gt; 2 ^ 0xc0);
            byte val2 = ((b2 &amp; SIGN) == 0) ? (byte) (b2 &gt;&gt; 4) : (byte) ((b2) &gt;&gt; 4 ^ 0xf0);
            byte val3 = ((b3 &amp; SIGN) == 0) ? (byte) (b3 &gt;&gt; 6) : (byte) ((b3) &gt;&gt; 6 ^ 0xfc);

            encodedData[encodedIndex++] = lookUpBase64Alphabet[val1];
            encodedData[encodedIndex++] = lookUpBase64Alphabet[val2 | (k &lt;&lt; 4)];
            encodedData[encodedIndex++] = lookUpBase64Alphabet[(l &lt;&lt; 2) | val3];
            encodedData[encodedIndex++] = lookUpBase64Alphabet[b3 &amp; 0x3f];
        }

        // form integral number of 6-bit groups
        if (fewerThan24bits == EIGHTBIT)
        {
            b1 = binaryData[dataIndex];
            k = (byte) (b1 &amp; 0x03);
            byte val1 = ((b1 &amp; SIGN) == 0) ? (byte) (b1 &gt;&gt; 2) : (byte) ((b1) &gt;&gt; 2 ^ 0xc0);
            encodedData[encodedIndex++] = lookUpBase64Alphabet[val1];
            encodedData[encodedIndex++] = lookUpBase64Alphabet[k &lt;&lt; 4];
            encodedData[encodedIndex++] = PAD;
            encodedData[encodedIndex++] = PAD;
        }
        else if (fewerThan24bits == SIXTEENBIT)
        {
            b1 = binaryData[dataIndex];
            b2 = binaryData[dataIndex + 1];
            l = (byte) (b2 &amp; 0x0f);
            k = (byte) (b1 &amp; 0x03);

            byte val1 = ((b1 &amp; SIGN) == 0) ? (byte) (b1 &gt;&gt; 2) : (byte) ((b1) &gt;&gt; 2 ^ 0xc0);
            byte val2 = ((b2 &amp; SIGN) == 0) ? (byte) (b2 &gt;&gt; 4) : (byte) ((b2) &gt;&gt; 4 ^ 0xf0);

            encodedData[encodedIndex++] = lookUpBase64Alphabet[val1];
            encodedData[encodedIndex++] = lookUpBase64Alphabet[val2 | (k &lt;&lt; 4)];
            encodedData[encodedIndex++] = lookUpBase64Alphabet[l &lt;&lt; 2];
            encodedData[encodedIndex++] = PAD;
        }
        return new String(encodedData);
    }

    /**
     * Decodes Base64 data into octects
     *
     * @param encoded string containing Base64 data
     * @return Array containind decoded data.
     */
    public static byte[] decode(String encoded)
    {
        if (encoded == null)
        {
            return null;
        }

        char[] base64Data = encoded.toCharArray();
        // remove white spaces
        int len = removeWhiteSpace(base64Data);

        if (len % FOURBYTE != 0)
        {
            return null;// should be divisible by four
        }

        int numberQuadruple = (len / FOURBYTE);

        if (numberQuadruple == 0)
        {
            return new byte[0];
        }

        byte decodedData[] = null;
        byte b1 = 0, b2 = 0, b3 = 0, b4 = 0;
        char d1 = 0, d2 = 0, d3 = 0, d4 = 0;

        int i = 0;
        int encodedIndex = 0;
        int dataIndex = 0;
        decodedData = new byte[(numberQuadruple) * 3];

        for (; i &lt; numberQuadruple - 1; i++)
        {

            if (!isData((d1 = base64Data[dataIndex++])) || !isData((d2 = base64Data[dataIndex++]))
                    || !isData((d3 = base64Data[dataIndex++])) || !isData((d4 = base64Data[dataIndex++])))
            {
                return null;
            } // if found &quot;no data&quot; just return null

            b1 = base64Alphabet[d1];
            b2 = base64Alphabet[d2];
            b3 = base64Alphabet[d3];
            b4 = base64Alphabet[d4];

            decodedData[encodedIndex++] = (byte) (b1 &lt;&lt; 2 | b2 &gt;&gt; 4);
            decodedData[encodedIndex++] = (byte) (((b2 &amp; 0xf) &lt;&lt; 4) | ((b3 &gt;&gt; 2) &amp; 0xf));
            decodedData[encodedIndex++] = (byte) (b3 &lt;&lt; 6 | b4);
        }

        if (!isData((d1 = base64Data[dataIndex++])) || !isData((d2 = base64Data[dataIndex++])))
        {
            return null;// if found &quot;no data&quot; just return null
        }

        b1 = base64Alphabet[d1];
        b2 = base64Alphabet[d2];

        d3 = base64Data[dataIndex++];
        d4 = base64Data[dataIndex++];
        if (!isData((d3)) || !isData((d4)))
        {// Check if they are PAD characters
            if (isPad(d3) &amp;&amp; isPad(d4))
            {
                if ((b2 &amp; 0xf) != 0)// last 4 bits should be zero
                {
                    return null;
                }
                byte[] tmp = new byte[i * 3 + 1];
                System.arraycopy(decodedData, 0, tmp, 0, i * 3);
                tmp[encodedIndex] = (byte) (b1 &lt;&lt; 2 | b2 &gt;&gt; 4);
                return tmp;
            }
            else if (!isPad(d3) &amp;&amp; isPad(d4))
            {
                b3 = base64Alphabet[d3];
                if ((b3 &amp; 0x3) != 0)// last 2 bits should be zero
                {
                    return null;
                }
                byte[] tmp = new byte[i * 3 + 2];
                System.arraycopy(decodedData, 0, tmp, 0, i * 3);
                tmp[encodedIndex++] = (byte) (b1 &lt;&lt; 2 | b2 &gt;&gt; 4);
                tmp[encodedIndex] = (byte) (((b2 &amp; 0xf) &lt;&lt; 4) | ((b3 &gt;&gt; 2) &amp; 0xf));
                return tmp;
            }
            else
            {
                return null;
            }
        }
        else
        { // No PAD e.g 3cQl
            b3 = base64Alphabet[d3];
            b4 = base64Alphabet[d4];
            decodedData[encodedIndex++] = (byte) (b1 &lt;&lt; 2 | b2 &gt;&gt; 4);
            decodedData[encodedIndex++] = (byte) (((b2 &amp; 0xf) &lt;&lt; 4) | ((b3 &gt;&gt; 2) &amp; 0xf));
            decodedData[encodedIndex++] = (byte) (b3 &lt;&lt; 6 | b4);

        }
        return decodedData;
    }

    /**
     * remove WhiteSpace from MIME containing encoded Base64 data.
     *
     * @param data the byte array of base64 data (with WS)
     * @return the new length
     */
    private static int removeWhiteSpace(char[] data)
    {
        if (data == null)
        {
            return 0;
        }

        // count characters that's not whitespace
        int newSize = 0;
        int len = data.length;
        for (int i = 0; i &lt; len; i++)
        {
            if (!isWhiteSpace(data[i]))
            {
                data[newSize++] = data[i];
            }
        }
        return newSize;
    }
}
</code></pre>
<h3 id="md5utils">Md5Utils</h3>
<ul>
<li>Md5Utils.java</li>
</ul>
<pre><code class="language-java">/**
 * Md5åŠ å¯†æ–¹æ³•
 */
public class Md5Utils
{
    private static final Logger log = LoggerFactory.getLogger(Md5Utils.class);

    private static byte[] md5(String s)
    {
        MessageDigest algorithm;
        try
        {
            algorithm = MessageDigest.getInstance(&quot;MD5&quot;);
            algorithm.reset();
            algorithm.update(s.getBytes(&quot;UTF-8&quot;));
            byte[] messageDigest = algorithm.digest();
            return messageDigest;
        }
        catch (Exception e)
        {
            log.error(&quot;MD5 Error...&quot;, e);
        }
        return null;
    }

    private static final String toHex(byte hash[])
    {
        if (hash == null)
        {
            return null;
        }
        StringBuffer buf = new StringBuffer(hash.length * 2);
        int i;

        for (i = 0; i &lt; hash.length; i++)
        {
            if ((hash[i] &amp; 0xff) &lt; 0x10)
            {
                buf.append(&quot;0&quot;);
            }
            buf.append(Long.toString(hash[i] &amp; 0xff, 16));
        }
        return buf.toString();
    }

    public static String hash(String s)
    {
        try
        {
            return new String(toHex(md5(s)).getBytes(StandardCharsets.UTF_8), StandardCharsets.UTF_8);
        }
        catch (Exception e)
        {
            log.error(&quot;not supported charset...{}&quot;, e);
            return s;
        }
    }
}
</code></pre>
<h3 id="doublearithutils">DoubleArithUtils</h3>
<ul>
<li>DoubleArithUtils.java</li>
</ul>
<pre><code class="language-java">/**
 * ç²¾ç¡®çš„æµ®ç‚¹æ•°è¿ç®—
 */
public class DoubleArithUtils {

    /**
     * é»˜è®¤é™¤æ³•è¿ç®—ç²¾åº¦
     */
    private static final int DEF_DIV_SCALE = 10;

    /**
     * è¿™ä¸ªç±»ä¸èƒ½å®ä¾‹åŒ–
     */
    private DoubleArithUtils() {
    }

    /**
     * æä¾›ç²¾ç¡®çš„åŠ æ³•è¿ç®—ã€‚
     *
     * @param v1 è¢«åŠ æ•°
     * @param v2 åŠ æ•°
     * @return ä¸¤ä¸ªå‚æ•°çš„å’Œ
     */
    public static double add(double v1, double v2) {
        BigDecimal b1 = new BigDecimal(Double.toString(v1));
        BigDecimal b2 = new BigDecimal(Double.toString(v2));
        return b1.add(b2).doubleValue();
    }

    /**
     * æä¾›ç²¾ç¡®çš„å‡æ³•è¿ç®—ã€‚
     *
     * @param v1 è¢«å‡æ•°
     * @param v2 å‡æ•°
     * @return ä¸¤ä¸ªå‚æ•°çš„å·®
     */
    public static double sub(double v1, double v2) {
        BigDecimal b1 = new BigDecimal(Double.toString(v1));
        BigDecimal b2 = new BigDecimal(Double.toString(v2));
        return b1.subtract(b2).doubleValue();
    }

    /**
     * æä¾›ç²¾ç¡®çš„ä¹˜æ³•è¿ç®—ã€‚
     *
     * @param v1 è¢«ä¹˜æ•°
     * @param v2 ä¹˜æ•°
     * @return ä¸¤ä¸ªå‚æ•°çš„ç§¯
     */
    public static double mul(double v1, double v2) {
        BigDecimal b1 = new BigDecimal(Double.toString(v1));
        BigDecimal b2 = new BigDecimal(Double.toString(v2));
        return b1.multiply(b2).doubleValue();
    }

    /**
     * æä¾›ï¼ˆç›¸å¯¹ï¼‰ç²¾ç¡®çš„é™¤æ³•è¿ç®—ï¼Œå½“å‘ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ—¶ï¼Œç²¾ç¡®åˆ°
     * å°æ•°ç‚¹ä»¥å10ä½ï¼Œä»¥åçš„æ•°å­—å››èˆäº”å…¥ã€‚
     *
     * @param v1 è¢«é™¤æ•°
     * @param v2 é™¤æ•°
     * @return ä¸¤ä¸ªå‚æ•°çš„å•†
     */
    public static double div(double v1, double v2) {
        return div(v1, v2, DEF_DIV_SCALE);
    }

    /**
     * æä¾›ï¼ˆç›¸å¯¹ï¼‰ç²¾ç¡®çš„é™¤æ³•è¿ç®—ã€‚å½“å‘ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ—¶ï¼Œç”±scaleå‚æ•°æŒ‡
     * å®šç²¾åº¦ï¼Œä»¥åçš„æ•°å­—å››èˆäº”å…¥ã€‚
     *
     * @param v1    è¢«é™¤æ•°
     * @param v2    é™¤æ•°
     * @param scale è¡¨ç¤ºè¡¨ç¤ºéœ€è¦ç²¾ç¡®åˆ°å°æ•°ç‚¹ä»¥åå‡ ä½ã€‚
     * @return ä¸¤ä¸ªå‚æ•°çš„å•†
     */
    public static double div(double v1, double v2, int scale) {
        if (scale &lt; 0) {
            throw new IllegalArgumentException(
                    &quot;The scale must be a positive integer or zero&quot;);
        }
        BigDecimal b1 = new BigDecimal(Double.toString(v1));
        BigDecimal b2 = new BigDecimal(Double.toString(v2));
        if (b1.compareTo(BigDecimal.ZERO) == 0) {
            return BigDecimal.ZERO.doubleValue();
        }
        return b1.divide(b2, scale, RoundingMode.HALF_UP).doubleValue();
    }

    /**
     * æä¾›ç²¾ç¡®çš„å°æ•°ä½å››èˆäº”å…¥å¤„ç†ã€‚
     *
     * @param v     éœ€è¦å››èˆäº”å…¥çš„æ•°å­—
     * @param scale å°æ•°ç‚¹åä¿ç•™å‡ ä½
     * @return å››èˆäº”å…¥åçš„ç»“æœ
     */
    public static double round(double v, int scale) {
        if (scale &lt; 0) {
            throw new IllegalArgumentException(
                    &quot;The scale must be a positive integer or zero&quot;);
        }
        BigDecimal b = new BigDecimal(Double.toString(v));
        BigDecimal one = BigDecimal.ONE;
        return b.divide(one, scale, RoundingMode.HALF_UP).doubleValue();
    }

}
</code></pre>
<h3 id="dateutils">DateUtils</h3>
<ul>
<li>DateUtils.java</li>
</ul>
<pre><code class="language-java">/**
 * æ—¶é—´å·¥å…·ç±»
 */
public class DateUtils {

    /**
     * è·å–æœåŠ¡å™¨å¯åŠ¨æ—¶é—´
     */
    public static Date getServerStartDate() {
        long time = ManagementFactory.getRuntimeMXBean().getStartTime();
        return new Date(time);
    }

    /**
     * è®¡ç®—ç›¸å·®å¤©æ•°
     */
    public static int differentDaysByMillisecond(Date date1, Date date2) {
        return Math.abs((int) ((date2.getTime() - date1.getTime()) / (1000 * 3600 * 24)));
    }

    /**
     * è®¡ç®—ä¸¤ä¸ªæ—¶é—´å·®
     */
    public static String getDatePoor(Date endDate, Date nowDate) {
        long nd = 1000 * 24 * 60 * 60;
        long nh = 1000 * 60 * 60;
        long nm = 1000 * 60;
        // long ns = 1000;
        // è·å¾—ä¸¤ä¸ªæ—¶é—´çš„æ¯«ç§’æ—¶é—´å·®å¼‚
        long diff = endDate.getTime() - nowDate.getTime();
        // è®¡ç®—å·®å¤šå°‘å¤©
        long day = diff / nd;
        // è®¡ç®—å·®å¤šå°‘å°æ—¶
        long hour = diff % nd / nh;
        // è®¡ç®—å·®å¤šå°‘åˆ†é’Ÿ
        long min = diff % nd % nh / nm;
        // è®¡ç®—å·®å¤šå°‘ç§’//è¾“å‡ºç»“æœ
        // long sec = diff % nd % nh % nm / ns;
        return day + &quot;å¤©&quot; + hour + &quot;å°æ—¶&quot; + min + &quot;åˆ†é’Ÿ&quot;;
    }

}
</code></pre>
<h3 id="webutils">WebUtils</h3>
<ul>
<li>WebUtils.java</li>
</ul>
<pre><code class="language-java">public class WebUtils {
    /**
     * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯
     *
     * @param response HttpServletResponse
     * @param string   å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸²
     * @return null
     */
    public static String renderString(HttpServletResponse response, String string) {
        try {
            response.setStatus(200);
            response.setContentType(&quot;application/json&quot;);
            response.setCharacterEncoding(&quot;utf-8&quot;);
            response.getWriter().print(string);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
}
</code></pre>
<h3 id="jdbc">jdbc</h3>
<ul>
<li>jdbc.properties</li>
</ul>
<pre><code class="language-properties">jdbc.driver=com.mysql.jdbc.Driver
#jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://127.0.0.1:3305/mydb?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false
# jdbc.url=jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC
jdbc.username=root
jdbc.password=
</code></pre>
<h3 id="druid">druid</h3>
<ul>
<li>druid.properties</li>
</ul>
<pre><code class="language-properties">pool.init=1
pool.minIdle=3
pool.maxActive=20
pool.maxWait=60000
</code></pre>
<h2 id="cloud">Cloud</h2>
<h3 id="aliyunsmsutilis">AliyunSMSUtilis</h3>
<ul>
<li>AliyunSMSUtilis.java</li>
</ul>
<pre><code class="language-xml">&lt;!--é˜¿é‡Œäº‘çŸ­ä¿¡--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.aliyun&lt;/groupId&gt;
    &lt;artifactId&gt;dysmsapi20170525&lt;/artifactId&gt;
    &lt;version&gt;2.0.17&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<pre><code class="language-java">public class AliyunSMSUtilis {

    /**
     * ä½¿ç”¨AK&amp;SKåˆå§‹åŒ–è´¦å·Client
     *
     * @param accessKeyId
     * @param accessKeySecret
     * @return Client
     * @throws Exception
     */
    public static com.aliyun.dysmsapi20170525.Client createClient(String accessKeyId, String accessKeySecret) throws Exception {
        Config config = new Config()
                // æ‚¨çš„ AccessKey ID
                .setAccessKeyId(String.valueOf(XXXConstant.ALIYUN_ACCESS_KEY_ID))
                // æ‚¨çš„ AccessKey Secret
                .setAccessKeySecret(String.valueOf(XXXConstant.ALIYUN_ACCESS_KEY_SECRET));
        // è®¿é—®çš„åŸŸå
        config.endpoint = XXXConstant.ALIYUN_SMS_ENDPOINT;
        return new com.aliyun.dysmsapi20170525.Client(config);
    }

    public static void sendSMS(String phoneNumber, JsonObject validateCode) throws Exception {
        // 1.å‘é€çŸ­ä¿¡
        com.aliyun.dysmsapi20170525.Client client = AliyunSMSUtilis.createClient(&quot;accessKeyId&quot;, &quot;accessKeySecret&quot;);
        SendSmsRequest sendSmsRequest = new SendSmsRequest()
                .setSignName(&quot;XXXConstant.ALIYUN_SMS_SIGNNAME&quot;)//é˜¿é‡Œäº‘çŸ­ä¿¡æµ‹è¯•
                .setTemplateCode(&quot;XXXConstant.ALIYUN_SMS_TEMPLATECODE&quot;)//SMS_154950909
                .setPhoneNumbers(phoneNumber)
                .setTemplateParam(validateCode.toString());// {&quot;code&quot;:&quot;xxxx&quot;}
        RuntimeOptions runtime = new RuntimeOptions();
        try {
            // å¤åˆ¶ä»£ç è¿è¡Œè¯·è‡ªè¡Œæ‰“å° API çš„è¿”å›å€¼
            SendSmsResponse sendSmsResponse = client.sendSmsWithOptions(sendSmsRequest, runtime);
            System.out.println(&quot;****************&quot;);
            System.out.println(&quot;sendSmsResponse.body.message=&quot; + sendSmsResponse.body.message);
            System.out.println(&quot;sendSmsResponse.body.code=&quot; + sendSmsResponse.body.code);
            System.out.println(&quot;****************&quot;);
            String code = sendSmsResponse.body.code;
            if (!com.aliyun.teautil.Common.equalString(code, &quot;OK&quot;)) {
                String message = &quot;49-SMS-é”™è¯¯ä¿¡æ¯: &quot; + sendSmsResponse.body.message + &quot;&quot;;
                throw new RuntimeException(message);
            }
        } catch (TeaException error) {
            // å¦‚æœ‰éœ€è¦ï¼Œè¯·æ‰“å° error
            com.aliyun.teautil.Common.assertAsString(error.message);
            String message = &quot;55-SMS-TeaException&quot; + error.message;
            throw new RuntimeException(message);
        } catch (Exception _error) {
            TeaException error = new TeaException(_error.getMessage(), _error);
            // å¦‚æœ‰éœ€è¦ï¼Œè¯·æ‰“å° error
            com.aliyun.teautil.Common.assertAsString(error.message);
            String message = &quot;61-SMS-Exception&quot; + error.message;
            throw new RuntimeException(message);
        }
    }
}
</code></pre>
<h3 id="qiniuossutils">QiniuOSSUtils</h3>
<ul>
<li>QiniuOSSUtils.java</li>
</ul>
<pre><code class="language-xml">&lt;!--ä¸ƒç‰›äº‘--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.qiniu&lt;/groupId&gt;
    &lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt;
    &lt;version&gt;[7.7.0, 7.10.99]&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<pre><code class="language-java">public class QiniuOSSUtils {

    public static String uploadFile(InputStream fileInputStream, String fileName) {
        //æ„é€ ä¸€ä¸ªå¸¦æŒ‡å®š Region å¯¹è±¡çš„é…ç½®ç±»
        Configuration cfg = new Configuration(Region.region0());
        //åˆ›å»ºä¸Šä¼ å¯¹è±¡
        UploadManager uploadManager = new UploadManager(cfg);
        //...ç”Ÿæˆä¸Šä¼ å‡­è¯ï¼Œç„¶åå‡†å¤‡ä¸Šä¼ 
        String accessKey = String.valueOf(XXXConstant.QINIU_ACCESS_KEY);
        String secretKey = String.valueOf(XXXConstant.QINIU_SECRET_KEY);
        String bucket = XXXConstant.QINIU_BUCKET;

        //é»˜è®¤ä¸æŒ‡å®škeyçš„æƒ…å†µä¸‹ï¼Œä»¥æ–‡ä»¶å†…å®¹çš„hashå€¼ä½œä¸ºæ–‡ä»¶å
        String key = fileName;

        Auth auth = Auth.create(accessKey, secretKey);
        String upToken = auth.uploadToken(bucket);

        try {
            Response response = uploadManager.put(fileInputStream, key, upToken, null, null);
            //è§£æä¸Šä¼ æˆåŠŸçš„ç»“æœ
            DefaultPutRet putRet = new Gson().fromJson(response.bodyString(), DefaultPutRet.class);
            System.out.println(&quot;39 - ä¸ƒç‰›äº‘ä¸Šä¼ æˆåŠŸ - putRet.key=&quot; + putRet.key);
            System.out.println(&quot;40 - ä¸ƒç‰›äº‘ä¸Šä¼ æˆåŠŸ - putRet.hash=&quot; + putRet.hash);
            return &quot;http://&quot;+XXXConstant.QINIU_DOMAIN+&quot;/&quot; + putRet.key;
        } catch (QiniuException ex) {
            Response r = ex.response;
            System.err.println(&quot;44 - ä¸ƒç‰›äº‘ä¸Šä¼ å¤±è´¥ - response=&quot; + r.toString());
            try {
                System.err.println(&quot;46 - ä¸ƒç‰›äº‘ä¸Šä¼ å¤±è´¥ - response.bodyString=&quot; + r.bodyString());
            } catch (QiniuException ex2) {
                //ignore
                System.err.println(&quot;49 - ä¸ƒç‰›äº‘ä¸Šä¼ å¤±è´¥ - response.ex2=&quot; + ex2.toString());
            }
        }

        return null;
    }

    public static boolean deleteFile(String fileName) {
        //æ„é€ ä¸€ä¸ªå¸¦æŒ‡å®š Region å¯¹è±¡çš„é…ç½®ç±»
        Configuration cfg = new Configuration(Region.region0());

        String accessKey = String.valueOf(XXXConstant.QINIU_ACCESS_KEY);
        String secretKey = String.valueOf(XXXConstant.QINIU_SECRET_KEY);
        String bucket = XXXConstant.QINIU_BUCKET;
        String key = fileName;

        Auth auth = Auth.create(accessKey, secretKey);
        BucketManager bucketManager = new BucketManager(auth, cfg);
        try {
            bucketManager.delete(bucket, key);
            return true;
        } catch (QiniuException ex) {
            //å¦‚æœé‡åˆ°å¼‚å¸¸ï¼Œè¯´æ˜åˆ é™¤å¤±è´¥
            System.err.println(ex.code());
            System.err.println(ex.response.toString());
        }
        return false;
    }

}
</code></pre>
<h2 id="ssm">SSM</h2>
<h3 id="web">web</h3>
<ul>
<li>web.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;
         version=&quot;4.0&quot;&gt;

    &lt;!--é…ç½®springMVCçš„ç¼–ç è¿‡æ»¤å™¨--&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;encoding&lt;/param-name&gt;
            &lt;param-value&gt;UTF-8&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;forceResponseEncoding&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

    &lt;!-- é…ç½®SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ --&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;WEB-INF/dispatcher-config.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;!-- é…ç½®Springçš„ç›‘å¬å™¨ --&gt;
    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;!-- è®¾ç½®Springçš„é…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§° --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:spring/*.xml&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- druidç›‘æ§é…ç½®--&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.alibaba.druid.support.http.StatViewServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;!-- å…è®¸æ¸…ç©ºç»Ÿè®¡æ•°æ® --&gt;
            &lt;param-name&gt;resetEnable&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;!--é…ç½®è®¿é—®ç›‘æ§é¡µé¢ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç ï¼ˆå¯é€‰ï¼‰ï¼Œå®é™…å¼€å‘ä¸­éƒ½ä¼šé…ç½®--&gt;
        &lt;init-param&gt;
            &lt;!-- ç”¨æˆ·å --&gt;
            &lt;param-name&gt;loginUsername&lt;/param-name&gt;
            &lt;param-value&gt;druid&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;!-- å¯†ç  --&gt;
            &lt;param-name&gt;loginPassword&lt;/param-name&gt;
            &lt;param-value&gt;druid&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;
        &lt;!-- è®¿é—®ç›‘æ§é¡µé¢çš„æ˜ å°„è¯·æ±‚ï¼Œå®é™…è®¿é—®ä¸€èˆ¬éƒ½åœ¨æµè§ˆå™¨è¾“å…¥http://xxx/druid/index --&gt;
        &lt;url-pattern&gt;/druid/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;
</code></pre>
<h3 id="log4j-config">log4j-config</h3>
<ul>
<li>log4j.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE log4j:configuration SYSTEM &quot;log4j.dtd&quot;&gt;
&lt;log4j:configuration xmlns:log4j=&quot;http://jakarta.apache.org/log4j/&quot;&gt;
    &lt;appender name=&quot;STDOUT&quot; class=&quot;org.apache.log4j.ConsoleAppender&quot;&gt;
        &lt;param name=&quot;Encoding&quot; value=&quot;UTF-8&quot; /&gt;
        &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
         &lt;param name=&quot;ConversionPattern&quot; value=&quot;%-5p %d{MM-dd HH:mm:ss,SSS} %m (%F:%L) \n&quot; /&gt;
        &lt;/layout&gt;
    &lt;/appender&gt;
    &lt;logger name=&quot;java.sql&quot;&gt;
        &lt;level value=&quot;debug&quot; /&gt;
    &lt;/logger&gt;
    &lt;logger name=&quot;org.apache.ibatis&quot;&gt;
        &lt;level value=&quot;info&quot; /&gt;
    &lt;/logger&gt;
    &lt;root&gt;
        &lt;level value=&quot;debug&quot; /&gt;
        &lt;appender-ref ref=&quot;STDOUT&quot; /&gt;
    &lt;/root&gt;
&lt;/log4j:configuration&gt;
</code></pre>
<h3 id="dispatcher-config">dispatcher-config</h3>
<ul>
<li>dispatcher-config.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;

    &lt;!--æ‰«ææ§åˆ¶å±‚ç»„ä»¶--&gt;
    &lt;context:component-scan base-package=&quot;com.xxx.controller&quot;&gt;&lt;/context:component-scan&gt;

    &lt;!-- å¼€å¯MVCçš„æ³¨è§£é©±åŠ¨ --&gt;
    &lt;mvc:annotation-driven/&gt;

    &lt;!-- å¤„ç†CORS --&gt;
    &lt;mvc:cors&gt;
        &lt;mvc:mapping path=&quot;/api/**&quot; allowed-origin-patterns=&quot;http://localhost:*&quot; allowed-methods=&quot;GET,POST&quot; max-age=&quot;3600&quot;/&gt;
    &lt;/mvc:cors&gt;

&lt;/beans&gt;
</code></pre>
<h3 id="applicationcontext">applicationContext</h3>
<ul>
<li>applicationContext.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:content=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!--æ‰«ææœåŠ¡å±‚ç»„ä»¶--&gt;
    &lt;content:component-scan base-package=&quot;com.xxx.service.impl&quot;&gt;&lt;/content:component-scan&gt;

&lt;/beans&gt;
</code></pre>
<h3 id="applicationcontext-dao">applicationContext-dao</h3>
<ul>
<li>applicationContext-dao.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:content=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- å¼•å…¥jdbc.propertieså’Œdruid.properties --&gt;
    &lt;content:property-placeholder location=&quot;classpath:props/jdbc.properties,classpath:props/druid.properties&quot;&gt;&lt;/content:property-placeholder&gt;

    &lt;!-- é…ç½®Druidæ•°æ®æº --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
        &lt;!--æ•°æ®æºæ§åˆ¶å±æ€§--&gt;
        &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt;
        &lt;property name=&quot;initialSize&quot; value=&quot;${pool.init}&quot;/&gt;
        &lt;property name=&quot;minIdle&quot; value=&quot;${pool.minIdle}&quot;/&gt;
        &lt;property name=&quot;maxActive&quot; value=&quot;${pool.maxActive}&quot;/&gt;
        &lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt;
        &lt;property name=&quot;maxWait&quot; value=&quot;${pool.maxWait}&quot;/&gt;
        &lt;!-- é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filters --&gt;
        &lt;property name=&quot;filters&quot; value=&quot;stat&quot;/&gt;
        &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt;
        &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;2000&quot;/&gt;
        &lt;!--å…¶ä»–é…ç½®--&gt;
        &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot;/&gt;
        &lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot;/&gt;
        &lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot;/&gt;
        &lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot;/&gt;
        &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot;/&gt;
        &lt;property name=&quot;maxOpenPreparedStatements&quot; value=&quot;20&quot;/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</code></pre>
<h3 id="applicationcontext-mybatis">applicationContext-mybatis</h3>
<ul>
<li>applicationContext-mybatis.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;

    &lt;!-- é…ç½®ç”¨äºåˆ›å»ºSqlSessionFactoryçš„å·¥å‚beanï¼Œå¯ä»¥ç›´æ¥åœ¨Springçš„IOCä¸­è·å–SqlSessionFactory --&gt;
    &lt;bean class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
        &lt;!-- è®¾ç½®MyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶çš„è·¯å¾„ --&gt;
        &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis/mybatis-config.xml&quot;&gt;
        &lt;/property&gt;
        &lt;!-- è®¾ç½®æ•°æ®æº --&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
        &lt;!--è®¾ç½®æ˜ å°„æ–‡ä»¶çš„è·¯å¾„ --&gt;
        &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:com/xxx/mapper/xml/*.xml&quot;&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- é…ç½®mapperæ¥å£çš„æ‰«æ --&gt;
    &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
        &lt;property name=&quot;basePackage&quot; value=&quot;com.xxx.mapper&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<h3 id="applicationcontext-tx">applicationContext-tx</h3>
<ul>
<li>applicationContext-tx.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;&gt;

    &lt;!--é…ç½®äº‹åŠ¡ç®¡ç†å™¨--&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- å¼€å¯äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨ --&gt;
    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;

&lt;/beans&gt;
</code></pre>
<h2 id="mybatis">Mybatis</h2>
<h3 id="mybatis-config">mybatis-config</h3>
<ul>
<li>mybatis-config.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;

    &lt;properties resource=&quot;jdbc.properties&quot;&gt;&lt;/properties&gt;
    
    &lt;settings&gt;
        &lt;!--å°†è¡¨ä¸­å­—æ®µçš„ä¸‹åˆ’çº¿è‡ªåŠ¨è½¬æ¢ä¸ºé©¼å³°--&gt;
        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;
    &lt;/settings&gt;
    
    &lt;!--è®¾ç½®ç±»å‹åˆ«å--&gt;
    &lt;typeAliases&gt;
        &lt;package name=&quot;${typeAliases_PACKAGE_NAME}&quot;/&gt;
    &lt;/typeAliases&gt;
    
    &lt;plugins&gt;
        &lt;!--è®¾ç½®åˆ†é¡µæ’ä»¶--&gt;
        &lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt;
            &lt;!--reasonableï¼šåˆ†é¡µåˆç†åŒ–å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºfalse,ç›´æ¥æ ¹æ®å‚æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚
              å½“è¯¥å‚æ•°è®¾ç½®ä¸º true æ—¶ï¼ŒpageNum&lt;=0 æ—¶ä¼šæŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œ pageNum&gt;pagesï¼ˆè¶…è¿‡æ€»æ•°æ—¶ï¼‰ï¼Œä¼šæŸ¥è¯¢æœ€åä¸€é¡µã€‚--&gt;
            &lt;property name=&quot;reasonable&quot; value=&quot;true&quot;/&gt;
            &lt;property name=&quot;pageSizeZero&quot; value=&quot;true&quot;/&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
    
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot;&gt;&lt;/transactionManager&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;${jdbc.driver}&quot;/&gt;
                &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
                &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;
                &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;

    &lt;!--å¼•å…¥æ˜ å°„æ–‡ä»¶--&gt;
    &lt;mappers&gt;
        &lt;!--        &lt;mapper resource=&quot;mybatisdemo/mappers/UserMapper.xml&quot;/&gt;--&gt;
        &lt;!--
        ä»¥åŒ…ä¸ºå•ä½ï¼Œå°†åŒ…ä¸‹æ‰€æœ‰çš„æ˜ å°„æ–‡ä»¶å¼•å…¥æ ¸å¿ƒé…ç½®æ–‡ä»¶
        æ³¨æ„ï¼š
         1. æ­¤æ–¹å¼å¿…é¡»ä¿è¯mapperæ¥å£å’Œmapperæ˜ å°„æ–‡ä»¶å¿…é¡»åœ¨ç›¸åŒçš„åŒ…ä¸‹
         2. mapperæ¥å£è¦å’Œmapperæ˜ å°„æ–‡ä»¶çš„åå­—ä¸€è‡´
         &lt;package name=&quot;com.example.mybatis.mapper&quot;/&gt;
        --&gt;
        &lt;!--        &lt;package name=&quot;&quot;/&gt;--&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>
<h3 id="mybatis-mapper">mybatis-mapper</h3>
<ul>
<li>XxxxMapper.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;

&lt;mapper namespace=&quot;${NAMESPACE}&quot;&gt;
&lt;/mapper&gt;
</code></pre>
<h3 id="generatorconfig">generatorConfig</h3>
<ul>
<li>generatorConfig.xml</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE generatorConfiguration
        PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;
&lt;generatorConfiguration&gt;
    &lt;!--
    targetRuntime: æ‰§è¡Œç”Ÿæˆçš„é€†å‘å·¥ç¨‹çš„ç‰ˆæœ¬
    MyBatis3Simple: ç”ŸæˆåŸºæœ¬çš„CRUDï¼ˆæ¸…æ–°ç®€æ´ç‰ˆï¼‰
    MyBatis3: ç”Ÿæˆå¸¦æ¡ä»¶çš„CRUDï¼ˆå¥¢åå°Šäº«ç‰ˆï¼‰
    --&gt;
    &lt;context id=&quot;DB2Tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt;
        &lt;!-- æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ --&gt;
        &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot;
                        connectionURL=&quot;jdbc:mysql://127.0.0.1:3305/yaorange_office_ssm?characterEncoding=utf8&amp;amp;useSSL=false&quot;
                        userId=&quot;root&quot;
                        password=&quot;xxx&quot;&gt;
        &lt;/jdbcConnection&gt;
        &lt;!-- javaBeançš„ç”Ÿæˆç­–ç•¥--&gt;
        &lt;javaModelGenerator targetPackage=&quot;com.xxx.entity&quot; targetProject=&quot;src/main/java&quot;&gt;
            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;
            &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot; /&gt;
        &lt;/javaModelGenerator&gt;
        &lt;!-- SQLæ˜ å°„æ–‡ä»¶çš„ç”Ÿæˆç­–ç•¥ --&gt;
        &lt;sqlMapGenerator targetPackage=&quot;com.xxx.mapper&quot;
                         targetProject=&quot;src/main/resources&quot;&gt;
            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;
        &lt;/sqlMapGenerator&gt;
        &lt;!-- Mapperæ¥å£çš„ç”Ÿæˆç­–ç•¥ --&gt;
        &lt;javaClientGenerator type=&quot;XMLMAPPER&quot;
                             targetPackage=&quot;com.xxx.mapper&quot; targetProject=&quot;src/main/java&quot;&gt;
            &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;
        &lt;/javaClientGenerator&gt;
        &lt;!-- é€†å‘åˆ†æçš„è¡¨ --&gt;
        &lt;!-- tableNameè®¾ç½®ä¸º*å·ï¼Œå¯ä»¥å¯¹åº”æ‰€æœ‰è¡¨ï¼Œæ­¤æ—¶ä¸å†™domainObjectName --&gt;
        &lt;!-- domainObjectNameå±æ€§æŒ‡å®šç”Ÿæˆå‡ºæ¥çš„å®ä½“ç±»çš„ç±»å --&gt;
        &lt;table tableName=&quot;article&quot; domainObjectName=&quot;Article&quot;/&gt;
        &lt;table tableName=&quot;user&quot; domainObjectName=&quot;User&quot;/&gt;
    &lt;/context&gt;
&lt;/generatorConfiguration&gt;
</code></pre>
<h2 id="spring-boot">Spring Boot</h2>
<h3 id="banner">banner</h3>
<p>banner.txt</p>
<pre><code class="language-txt">Spring Boot Version: ${spring-boot.version}
////////////////////////////////////////////////////////////////////
//                          _ooOoo_                               //
//                         o8888888o                              //
//                         88&quot; . &quot;88                              //
//                         (| ^_^ |)                              //
//                         O\  =  /O                              //
//                      ____/`---'\____                           //
//                    .'  \\|     |//  `.                         //
//                   /  \\|||  :  |||//  \                        //
//                  /  _||||| -:- |||||-  \                       //
//                  |   | \\\  -  /// |   |                       //
//                  | \_|  ''\---/''  |   |                       //
//                  \  .-\__  `-`  ___/-. /                       //
//                ___`. .'  /--.--\  `. . ___                     //
//              .&quot;&quot; '&lt;  `.___\_&lt;|&gt;_/___.'  &gt;'&quot;&quot;.                  //
//            | | :  `- \`.;`\ _ /`;.`/ - ` : | |                 //
//            \  \ `-.   \_ __\ /__ _/   .-` /  /                 //
//      ========`-.____`-.___\_____/___.-`____.-'========         //
//                           `=---='                              //
//      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^        //
//             ä½›ç¥–ä¿ä½‘       æ°¸ä¸å®•æœº      æ°¸æ— BUG               //
////////////////////////////////////////////////////////////////////
</code></pre>
<h3 id="application">application</h3>
<ul>
<li>application.yaml</li>
</ul>
<pre><code class="language-yaml">spring:
  datasource:
    # è¿æ¥æ•°æ®åº“
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3305/mydb?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false
    username: root
    password: xxx

    # é…ç½®druid
    druid:
      initial-size: 1
      max-active: 20
      max-wait: 6000
      min-idle: 1
      filters: stat
      stat-view-servlet:
        enabled: true
        login-password: druid
        login-username: druid
        reset-enable: true
        url-pattern: /druid/*
      test-on-borrow: true

# æ—¥å¿—
logging:
  level:
    com.yaorange.ssm: DEBUG
    org.springframework.jdbc.datasource: DEBUG

# mybatis
mybatis:
  mapper-locations: classpath:com/xxx/mapper/xml/*Mapper.xml
  type-aliases-package: com.yaorange.entity

# åˆ†é¡µåˆç†åŒ–å‚æ•°
pagehelper:
  reasonable: true
</code></pre>
<h3 id="springboot-cors-congig">SpringBoot-CORS-Congig</h3>
<ul>
<li>MvcConfiguration.java</li>
</ul>
<pre><code class="language-java">@Configuration(proxyBeanMethods = false)
public class MvcConfiguration {

    /**
     * å¤„ç†CORS
     *
     * @return
     */
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping(&quot;/api/**&quot;)
                        .allowedOriginPatterns(&quot;http://localhost:*&quot;)
                        .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;)
                        .allowCredentials(true)//è®¾ç½®æ˜¯å¦å…è®¸å®¢æˆ·ç«¯è·¨åŸŸæºå¸¦éªŒè¯æ•°æ®ï¼Œå¦‚Cookieå€¼
                        .maxAge(3600);
            }
        };
    }

}
</code></pre>
<h2 id="redis">Redis</h2>
<h3 id="rediscache">RedisCache</h3>
<ul>
<li>RedisCache.java</li>
</ul>
<pre><code class="language-java">/**
 * Spring Redis å·¥å…·ç±»
 **/
@SuppressWarnings(value = {&quot;unchecked&quot;, &quot;rawtypes&quot;})
@Component
public class RedisCache {

    private final RedisTemplate redisTemplate;

    public RedisCache(RedisTemplate redisTemplate) {
        this.redisTemplate = redisTemplate;
    }

    /**
     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰
     *
     * @param key   ç¼“å­˜çš„é”®å€¼
     * @param value ç¼“å­˜çš„å€¼
     */
    public &lt;T&gt; void setCacheObject(final String key, final T value) {
        redisTemplate.opsForValue().set(key, value);
    }

    /**
     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰
     *
     * @param key      ç¼“å­˜çš„é”®å€¼
     * @param value    ç¼“å­˜çš„å€¼
     * @param timeout  æ—¶é—´
     * @param timeUnit æ—¶é—´é¢—ç²’åº¦
     */
    public &lt;T&gt; void setCacheObject(final String key, final T value, final Integer timeout, final TimeUnit timeUnit) {
        redisTemplate.opsForValue().set(key, value, timeout, timeUnit);
    }

    /**
     * è®¾ç½®æœ‰æ•ˆæ—¶é—´
     *
     * @param key     Redisé”®
     * @param timeout è¶…æ—¶æ—¶é—´
     * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥
     */
    public boolean expire(final String key, final long timeout) {
        return expire(key, timeout, TimeUnit.SECONDS);
    }

    /**
     * è®¾ç½®æœ‰æ•ˆæ—¶é—´
     *
     * @param key     Redisé”®
     * @param timeout è¶…æ—¶æ—¶é—´
     * @param unit    æ—¶é—´å•ä½
     * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥
     */
    public boolean expire(final String key, final long timeout, final TimeUnit unit) {
        return redisTemplate.expire(key, timeout, unit);
    }

    /**
     * è·å–æœ‰æ•ˆæ—¶é—´
     *
     * @param key Redisé”®
     * @return æœ‰æ•ˆæ—¶é—´
     */
    public long getExpire(final String key) {
        return redisTemplate.getExpire(key);
    }

    /**
     * åˆ¤æ–­ keyæ˜¯å¦å­˜åœ¨
     *
     * @param key é”®
     * @return true å­˜åœ¨ falseä¸å­˜åœ¨
     */
    public Boolean hasKey(String key) {
        return redisTemplate.hasKey(key);
    }

    /**
     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚
     *
     * @param key ç¼“å­˜é”®å€¼
     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®
     */
    public &lt;T&gt; T getCacheObject(final String key) {
        ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue();
        return operation.get(key);
    }

    /**
     * åˆ é™¤å•ä¸ªå¯¹è±¡
     *
     * @param key
     */
    public boolean deleteObject(final String key) {
        return redisTemplate.delete(key);
    }

    /**
     * åˆ é™¤é›†åˆå¯¹è±¡
     *
     * @param collection å¤šä¸ªå¯¹è±¡
     * @return
     */
    public long deleteObject(final Collection collection) {
        return redisTemplate.delete(collection);
    }

    /**
     * ç¼“å­˜Listæ•°æ®
     *
     * @param key      ç¼“å­˜çš„é”®å€¼
     * @param dataList å¾…ç¼“å­˜çš„Listæ•°æ®
     * @return ç¼“å­˜çš„å¯¹è±¡
     */
    public &lt;T&gt; long setCacheList(final String key, final List&lt;T&gt; dataList) {
        Long count = redisTemplate.opsForList().rightPushAll(key, dataList);
        return count == null ? 0 : count;
    }

    /**
     * è·å¾—ç¼“å­˜çš„listå¯¹è±¡
     *
     * @param key ç¼“å­˜çš„é”®å€¼
     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®
     */
    public &lt;T&gt; List&lt;T&gt; getCacheList(final String key) {
        return redisTemplate.opsForList().range(key, 0, -1);
    }

    /**
     * ç¼“å­˜Set
     *
     * @param key     ç¼“å­˜é”®å€¼
     * @param dataSet ç¼“å­˜çš„æ•°æ®
     * @return ç¼“å­˜æ•°æ®çš„å¯¹è±¡
     */
    public &lt;T&gt; BoundSetOperations&lt;String, T&gt; setCacheSet(final String key, final Set&lt;T&gt; dataSet) {
        BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key);
        Iterator&lt;T&gt; it = dataSet.iterator();
        while (it.hasNext()) {
            setOperation.add(it.next());
        }
        return setOperation;
    }

    /**
     * è·å¾—ç¼“å­˜çš„set
     *
     * @param key
     * @return
     */
    public &lt;T&gt; Set&lt;T&gt; getCacheSet(final String key) {
        return redisTemplate.opsForSet().members(key);
    }

    /**
     * ç¼“å­˜Map
     *
     * @param key
     * @param dataMap
     */
    public &lt;T&gt; void setCacheMap(final String key, final Map&lt;String, T&gt; dataMap) {
        if (dataMap != null) {
            redisTemplate.opsForHash().putAll(key, dataMap);
        }
    }

    /**
     * è·å¾—ç¼“å­˜çš„Map
     *
     * @param key
     * @return
     */
    public &lt;T&gt; Map&lt;String, T&gt; getCacheMap(final String key) {
        return redisTemplate.opsForHash().entries(key);
    }

    /**
     * å¾€Hashä¸­å­˜å…¥æ•°æ®
     *
     * @param key   Redisé”®
     * @param hKey  Hashé”®
     * @param value å€¼
     */
    public &lt;T&gt; void setCacheMapValue(final String key, final String hKey, final T value) {
        redisTemplate.opsForHash().put(key, hKey, value);
    }

    /**
     * è·å–Hashä¸­çš„æ•°æ®
     *
     * @param key  Redisé”®
     * @param hKey Hashé”®
     * @return Hashä¸­çš„å¯¹è±¡
     */
    public &lt;T&gt; T getCacheMapValue(final String key, final String hKey) {
        HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.opsForHash();
        return opsForHash.get(key, hKey);
    }

    /**
     * åˆ é™¤Hashä¸­çš„æ•°æ®
     *
     * @param key
     * @param hKey
     */
    public void delCacheMapValue(final String key, final String hKey) {
        HashOperations hashOperations = redisTemplate.opsForHash();
        hashOperations.delete(key, hKey);
    }

    /**
     * è·å–å¤šä¸ªHashä¸­çš„æ•°æ®
     *
     * @param key   Redisé”®
     * @param hKeys Hashé”®é›†åˆ
     * @return Hashå¯¹è±¡é›†åˆ
     */
    public &lt;T&gt; List&lt;T&gt; getMultiCacheMapValue(final String key, final Collection&lt;Object&gt; hKeys) {
        return redisTemplate.opsForHash().multiGet(key, hKeys);
    }

    /**
     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨
     *
     * @param pattern å­—ç¬¦ä¸²å‰ç¼€
     * @return å¯¹è±¡åˆ—è¡¨
     */
    public Collection&lt;String&gt; keys(final String pattern) {
        return redisTemplate.keys(pattern);
    }
}
</code></pre>
<h2 id="spring-security">Spring Security</h2>
<h3 id="pom">pom</h3>
<ul>
<li>Pom.xml</li>
</ul>
<pre><code class="language-xml">&lt;!-- Spring Security--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!--redisä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!--fastjsonä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
    &lt;version&gt;1.2.83&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--jwtä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
    &lt;version&gt;0.9.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="jwtutils">JwtUtils</h3>
<ul>
<li>JwtUtils.java</li>
</ul>
<pre><code class="language-java">/**
 * JWTå·¥å…·ç±»
 */
public class JwtUtils {

    //æœ‰æ•ˆæœŸä¸º
    //public static final Long JWT_TTL = 60 * 60 * 1000L;// 60 * 60 * 1000  ä¸€ä¸ªå°æ—¶
    private static final Long JWT_TTL = 60 * 60 * 24000L;// 60 * 60 * 24000  äºŒåå››ä¸ªå°æ—¶

    //è®¾ç½®ç§˜é’¥æ˜æ–‡
    private static final char[] JWT_SECRET_KEY = &quot;sangeng&quot;.toCharArray();

    public static String getUUID() {
        String token = UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;);
        return token;
    }

    /**
     * ç”Ÿæˆjtw
     *
     * @param subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰
     * @return
     */
    public static String createJWT(String subject) {
        JwtBuilder builder = getJwtBuilder(subject, null, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´
        return builder.compact();
    }

    /**
     * ç”Ÿæˆjtw
     *
     * @param subject   tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰
     * @param ttlMillis tokenè¶…æ—¶æ—¶é—´
     * @return
     */
    public static String createJWT(String subject, Long ttlMillis) {
        JwtBuilder builder = getJwtBuilder(subject, ttlMillis, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´
        return builder.compact();
    }

    private static JwtBuilder getJwtBuilder(String subject, Long ttlMillis, String uuid) {
        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;
        SecretKey secretKey = generalKey();
        long nowMillis = System.currentTimeMillis();
        Date now = new Date(nowMillis);
        if (ttlMillis == null) {
            ttlMillis = JwtUtils.JWT_TTL;
        }
        long expMillis = nowMillis + ttlMillis;
        Date expDate = new Date(expMillis);
        return Jwts.builder()
                .setId(uuid)              //å”¯ä¸€çš„ID
                .setSubject(subject)   // ä¸»é¢˜  å¯ä»¥æ˜¯JSONæ•°æ®
                .setIssuer(&quot;admin&quot;)     // ç­¾å‘è€…
                .setIssuedAt(now)      // ç­¾å‘æ—¶é—´
                .signWith(signatureAlgorithm, secretKey) //ä½¿ç”¨HS256å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾å, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç§˜é’¥
                .setExpiration(expDate);
    }

    /**
     * åˆ›å»ºtoken
     *
     * @param id
     * @param subject
     * @param ttlMillis
     * @return
     */
    public static String createJWT(String id, String subject, Long ttlMillis) {
        JwtBuilder builder = getJwtBuilder(subject, ttlMillis, id);// è®¾ç½®è¿‡æœŸæ—¶é—´
        return builder.compact();
    }

    /**
     * ç”ŸæˆåŠ å¯†åçš„ç§˜é’¥ secretKey
     *
     * @return
     */
    public static SecretKey generalKey() {
        byte[] encodedKey = Base64.getDecoder().decode(new String(JWT_SECRET_KEY));
        SecretKey key = new SecretKeySpec(encodedKey, 0, encodedKey.length, &quot;AES&quot;);
        return key;
    }

    /**
     * è§£æ
     *
     * @param jwt
     * @return
     * @throws Exception
     */
    public static Claims parseJWT(String jwt) throws Exception {
        SecretKey secretKey = generalKey();
        return Jwts.parser()
                .setSigningKey(secretKey)
                .parseClaimsJws(jwt)
                .getBody();
    }

    public static void main(String[] args) throws Exception {
        String token = JwtUtils.createJWT(&quot;cook&quot;);
        Claims claims = parseJWT(token);
        System.out.println(token);//eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI3YTI5ZTQ4OThjMmI0YjMwOTczNTc4YmZjMmQwMWE2NSIsInN1YiI6ImNvb2siLCJpc3MiOiJhZG1pbiIsImlhdCI6MTY2MTE4NzM5MywiZXhwIjoxNjYxMjczNzkzfQ.dUO663dn5SIndbPgwIedXmY2YazG4WqD4rYzgGrtHXM
        System.out.println(claims);//{jti=7a29e4898c2b4b30973578bfc2d01a65, sub=cook, iss=admin, iat=1661187393, exp=1661273793}
    }

}
</code></pre>
<h3 id="fastjsonredisserializer">FastJsonRedisSerializer</h3>
<ul>
<li>FastJsonRedisSerializer.java</li>
</ul>
<pre><code class="language-java">/**
 * Redisä½¿ç”¨FastJsonåºåˆ—åŒ–
 */
public class FastJsonRedisSerializer&lt;T&gt; implements RedisSerializer&lt;T&gt; {

    public static final Charset DEFAULT_CHARSET = Charset.forName(&quot;UTF-8&quot;);

    private Class&lt;T&gt; clazz;

    static {
        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);
    }

    public FastJsonRedisSerializer(Class&lt;T&gt; clazz) {
        super();
        this.clazz = clazz;
    }

    @Override
    public byte[] serialize(T t) throws SerializationException {
        if (t == null) {
            return new byte[0];
        }
        return JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);
    }

    @Override
    public T deserialize(byte[] bytes) throws SerializationException {
        if (bytes == null || bytes.length &lt;= 0) {
            return null;
        }
        String str = new String(bytes, DEFAULT_CHARSET);

        return JSON.parseObject(str, clazz);
    }
    
    protected JavaType getJavaType(Class&lt;?&gt; clazz) {
        return TypeFactory.defaultInstance().constructType(clazz);
    }
}
</code></pre>
<h3 id="webutils-2">WebUtils</h3>
<ul>
<li>WebUtils.java</li>
</ul>
<pre><code class="language-java">public class WebUtils {
    /**
     * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯
     *
     * @param response æ¸²æŸ“å¯¹è±¡
     * @param string   å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸²
     * @return null
     */
    public static String renderString(HttpServletResponse response, String string) {
        try {
            response.setStatus(200);
            response.setContentType(&quot;application/json&quot;);
            response.setCharacterEncoding(&quot;utf-8&quot;);
            response.getWriter().print(string);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
}
</code></pre>
<h3 id="redisconfig">RedisConfig</h3>
<ul>
<li>RedisConfig.java</li>
</ul>
<pre><code class="language-java">@Configuration
public class RedisConfig {

    @Bean
    @SuppressWarnings(value = {&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) {
        RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;();
        template.setConnectionFactory(connectionFactory);

        FastJsonRedisSerializer serializer = new FastJsonRedisSerializer(Object.class);

        // ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(serializer);

        // Hashçš„keyä¹Ÿé‡‡ç”¨StringRedisSerializerçš„åºåˆ—åŒ–æ–¹å¼
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(serializer);

        template.afterPropertiesSet();

        // å¼€å¯AutoTypeï¼Œå¤„ç†å¼‚å¸¸ï¼Œcom.alibaba.fastjson.JSONException: autoType is not support. org.springframework.security.core.authority.SimpleGrantedAuthority
        // å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå°èŒƒå›´æŒ‡å®šç™½åå•
        ParserConfig.getGlobalInstance().addAccept(&quot;org.springframework.security.core.authority.&quot;);
        TypeUtils.addMapping(&quot;org.springframework.security.core.authority.SimpleGrantedAuthority&quot;,
                SimpleGrantedAuthority.class);

        return template;
    }
}
</code></pre>
<h3 id="userdetailsbean">UserDetailsBean</h3>
<p>UserDetailsBean.java</p>
<pre><code class="language-java">/**
 * ç™»å½•ç”¨æˆ· UserDetails
 */
public class UserDetailsBean implements UserDetails {

    /**
     * å°è£…ç”¨æˆ·ä¿¡æ¯
     */
    private User user;

    /**
     * å°è£…ç”¨æˆ·æƒé™ä¿¡æ¯
     */
    private List&lt;String&gt; authorityList;

    private List&lt;SimpleGrantedAuthority&gt; authorities;

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        // å†™æ³•ä¸€ï¼š
//        List&lt;SimpleGrantedAuthority&gt; authorities = authorities.stream().map(s -&gt; new SimpleGrantedAuthority(s)).collect(Collectors.toList());
        // å†™æ³•äºŒï¼š
        authorities = authorityList.stream().map(SimpleGrantedAuthority::new).collect(Collectors.toList());
        // å†™æ³•ä¸‰ï¼š
//        Collection&lt;SimpleGrantedAuthority&gt; authorities = null;
//        for (String s : authorities) {
//            authorities.add(new SimpleGrantedAuthority(s));
//        }
        return authorities;
    }

    @Override
    public String getPassword() {
        return user.getPassword();
    }

    @Override
    public String getUsername() {
        return user.getUserName();
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return user.getStatus().equals(&quot;0&quot;);
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    public List&lt;String&gt; getAuthorityList() {
        return authorityList;
    }

    public void setAuthorityList(List&lt;String&gt; authorityList) {
        this.authorityList = authorityList;
    }

    public void setAuthorities(List&lt;SimpleGrantedAuthority&gt; authorities) {
        this.authorities = authorities;
    }

    public UserDetailsBean() {
    }

    public UserDetailsBean(User user, List&lt;String&gt; authorityList) {
        this.user = user;
        this.authorityList = authorityList;
    }

}
</code></pre>
<h3 id="userdetailsserviceimpl">UserDetailsServiceImpl</h3>
<p>UserDetailsServiceImpl.java</p>
<pre><code class="language-java">@Service
@RequiredArgsConstructor
public class UserDetailsServiceImpl implements UserDetailsService {

    private final UserMapper userMapper;

    /**
     * ä»æ•°æ®åº“ä¸­æŸ¥å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œ
     * ä¾› AuthenticationProvider è¿›è¡Œå¯†ç æ¯”å¯¹
     *
     * @param username ç”± AuthenticationProvider æä¾›ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ä¼ å…¥çš„username
     * @return
     * @throws UsernameNotFoundException
     */
    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        // 1ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
        LambdaQueryWrapper&lt;User&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();
        queryWrapper.eq(User::getUserName, username);
        User user = userMapper.selectOne(queryWrapper);
        // 2ã€å¦‚æœæŸ¥è¯¢ä¸åˆ°æ•°æ®å°±é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ç»™å‡ºæç¤º
        if (null == user) {
            throw new UsernameNotFoundException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;);
        }
        // 3ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æƒé™ä¿¡æ¯ï¼Œå°†å…¶æ·»åŠ åˆ° UserDetailsBean ä¸­çš„ authorities
        List&lt;String&gt; list = userMapper.selectPermsByUserId(user.getId());
        // 4ã€å°†æŸ¥å‡ºçš„ç”¨æˆ·ä¿¡æ¯ï¼Œæƒé™ä¿¡æ¯ï¼Œå°è£…æˆUserDetailsï¼ˆUserDetailsBeanï¼‰å¯¹è±¡è¿”å›
        return new UserDetailsBean(user, list);
    }
}
</code></pre>
<h3 id="jwtauthenticationtokenfilter">JwtAuthenticationTokenFilter</h3>
<ul>
<li>JwtAuthenticationTokenFilter.java</li>
</ul>
<pre><code class="language-java">@Component
@RequiredArgsConstructor
public class JwtAuthenticationTokenFilter extends OncePerRequestFilter {

    private final RedisCache redisCache;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
        //è·å–token
        String token = request.getHeader(&quot;token&quot;);
        //åˆ¤æ–­tokenæ˜¯å¦éç©º
        if (StringUtils.isEmpty(token)) {
            //ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ”¾è¡Œï¼Œè¯·æ±‚ä¼šå»ä¸‹ä¸€ä¸ªç™»å½•æ¥å£
            filterChain.doFilter(request, response);
            return;
        }
        //ä¸ä¸ºç©ºï¼Œåˆ™è§£ætokenè·å–userid
        String userId;
        try {
            Claims jwt = JwtUtils.parseJWT(token);
            userId = jwt.getSubject();
        } catch (Exception e) {
            //è§£æå¤±è´¥ï¼Œæç¤ºtokenéæ³•
            // æ–¹æ³•ä¸€ï¼š
            // æ³¨æ„ï¼Œæ­¤æ—¶éœ€è¦è‡ªå®šä¹‰è®¤è¯å¼‚å¸¸å¤„ç†ï¼Œå¦åˆ™åªä¼šå“åº”403çš„ç©ºç™½é”™è¯¯ï¼›
            // åŒæ—¶ï¼Œæˆ‘å‘ç°è¿™é‡Œæ— è®ºæŠ›å‡ºå“ªä¸ªAuthenticationExceptionçš„å¼‚å¸¸ï¼Œæ— èŠæ€ä¹ˆä¼ é€’æ¶ˆæ¯ï¼Œ
            // åœ¨è‡ªå®šä¹‰è®¤è¯å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸æ¶ˆæ¯éƒ½ä¼šè¢«è¦†ç›–æˆ&quot;Full authentication is required to access this resource&quot;
            // æ‰€ä»¥ï¼Œè¿™é‡Œè¿˜æ˜¯é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•å¤„ç†å¼‚å¸¸ã€‚
//            throw new AuthenticationServiceException(&quot;Tokenéæ³•&quot;,new Throwable(&quot;Tokenéæ³•&quot;));
            //æ–¹æ³•äºŒï¼š
            request.getRequestDispatcher(&quot;/jwtFilterException/&quot; + &quot;Tokenéæ³•&quot;).forward(request, response);
            filterChain.doFilter(request, response);
            return;
        }
        //è§£ææˆåŠŸï¼Œé€šè¿‡useridä»Redisç¼“å­˜ä¸­è·å– UserDetailsBean
        UserDetailsBean userDetailsBean = redisCache.getCacheObject(&quot;login:&quot; + userId);
        //è·å–ä¸äº†ï¼Œæç¤ºä¼šè¯å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•
        if (null == userDetailsBean) {
            //è§£æå¤±è´¥ï¼Œæç¤ºtokenéæ³•
            request.getRequestDispatcher(&quot;/jwtFilterException/&quot; + &quot;ä¼šè¯å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•&quot;).forward(request, response);
            filterChain.doFilter(request, response);
            return;
        }
        //è·å–çš„äº†ï¼Œå°† UserDetailsBean å°è£…æˆ authentication å¯¹è±¡ï¼Œæ˜¾å¼åœ°ä¸ºç”¨æˆ·å»æ³¨å†Œèº«ä»½è®¤è¯
        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetailsBean, null, userDetailsBean.getAuthorities());
        SecurityContextHolder.getContext().setAuthentication(authentication);
        //æ”¾è¡Œ
        filterChain.doFilter(request, response);
    }

}
</code></pre>
<h3 id="jwtfilterexceptioncontroller">JwtFilterExceptionController</h3>
<p>JwtFilterExceptionController.java</p>
<pre><code class="language-java">@RestController
public class JwtFilterExceptionController {

    @RequestMapping(&quot;/jwtFilterException/{message}&quot;)
    public Result jwtFilterException(@PathVariable(&quot;message&quot;) String message) {
        return Result.error(message);
    }

}
</code></pre>
<h3 id="accessdeniedhandlerimpl">AccessDeniedHandlerImpl</h3>
<p>AccessDeniedHandlerImpl.java</p>
<pre><code class="language-java">@Component
public class AccessDeniedHandlerImpl implements AccessDeniedHandler {

    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException {
        Result&lt;Object&gt; result = Result.error(HttpStatus.FORBIDDEN.value(), accessDeniedException.getMessage());
        String json = JSON.toJSONString(result);
        WebUtils.renderString(response, json);
    }

}
</code></pre>
<h3 id="authenticationentrypointimpl">AuthenticationEntryPointImpl</h3>
<p>AuthenticationEntryPointImpl.java</p>
<pre><code class="language-java">@Component
public class AuthenticationEntryPointImpl implements AuthenticationEntryPoint {

    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException e) throws IOException, ServletException {
        Result&lt;Object&gt; result = Result.error(HttpStatus.UNAUTHORIZED.value(), e.getMessage());
        String json = JSON.toJSONString(result);
        WebUtils.renderString(response, json);
    }
    
}
</code></pre>
<h3 id="securityconfig">SecurityConfig</h3>
<ul>
<li>SecurityConfig.java</li>
</ul>
<pre><code class="language-java">@Configuration
@RequiredArgsConstructor
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    private final JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;

    private final AuthenticationEntryPoint authenticationEntryPoint;

    private final AccessDeniedHandler accessDeniedHandler;

    /**
     * æ›¿æ¢é»˜è®¤å¯†ç ç¼–ç å™¨
     * ä½¿ç”¨BCryptPasswordEncoder
     *
     * @return
     */
    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                // å…³é—­csrf
                .csrf().disable()
                // ä¸é€šè¿‡Sessionè·å–SecurityContext
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®
                .authorizeRequests()
                .antMatchers(&quot;/user/login&quot;).anonymous()
                // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯
                .anyRequest().authenticated();

        // æŠŠ JWT è¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­
        http
                .addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);
        
        // é…ç½®è‡ªå®šä¹‰çš„è®¤è¯å’Œæˆæƒå¼‚å¸¸å¤„ç†ç±»
        http
                .exceptionHandling()
                .authenticationEntryPoint(authenticationEntryPoint)
                .accessDeniedHandler(accessDeniedHandler);
        // å…è®¸è·¨åŸŸ
        http.cors();
    }

    /**
     * åœ¨å®¹å™¨ä¸­æ³¨å…¥AuthenticationManager
     * ä¾›ç™»å½•æ¥å£çš„Serviceè°ƒç”¨
     *
     * @return
     * @throws Exception
     */
    @Bean
    @Override
    protected AuthenticationManager authenticationManager() throws Exception {
        return super.authenticationManager();
    }

}
</code></pre>
<h1 id="vue">Vue</h1>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Securityç¬”è®°]]></title>
        <id>https://kuangyang828.github.io/spring-security-bi-ji/</id>
        <link href="https://kuangyang828.github.io/spring-security-bi-ji/">
        </link>
        <updated>2022-08-19T01:23:14.000Z</updated>
        <content type="html"><![CDATA[<h1 id="springsecurityä»å…¥é—¨åˆ°ç²¾é€š">SpringSecurityä»å…¥é—¨åˆ°ç²¾é€š</h1>
<h2 id="0ç®€ä»‹">0.ç®€ä»‹</h2>
<p><strong>Spring Security</strong> æ˜¯ Spring å®¶æ—ä¸­çš„ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶<strong>Shiro</strong>ï¼Œå®ƒæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç¤¾åŒºèµ„æºä¹Ÿæ¯”Shiroä¸°å¯Œã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ä¸­å¤§å‹çš„é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨<strong>SpringSecurity</strong> æ¥åšå®‰å…¨æ¡†æ¶ã€‚å°é¡¹ç›®æœ‰Shiroçš„æ¯”è¾ƒå¤šï¼Œå› ä¸ºç›¸æ¯”ä¸SpringSecurityï¼ŒShiroçš„ä¸Šæ‰‹æ›´åŠ çš„ç®€å•ã€‚</p>
<p>ä¸€èˆ¬Webåº”ç”¨çš„éœ€è¦è¿›è¡Œ<strong>è®¤è¯</strong>å’Œ<strong>æˆæƒ</strong>ã€‚</p>
<p>â‘ <strong>è®¤è¯ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·</strong></p>
<p>â‘¡<strong>æˆæƒï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œ</strong></p>
<p>è€Œè®¤è¯å’Œæˆæƒä¹Ÿæ˜¯SpringSecurityä½œä¸ºå®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<h2 id="1å¿«é€Ÿå…¥é—¨">1.å¿«é€Ÿå…¥é—¨</h2>
<h3 id="11-å‡†å¤‡å·¥ä½œ">1.1 å‡†å¤‡å·¥ä½œ</h3>
<p>æˆ‘ä»¬å…ˆè¦æ­å»ºä¸€ä¸ªç®€å•çš„SpringBootå·¥ç¨‹</p>
<h4 id="1-æ·»åŠ ä¾èµ–">â‘  æ·»åŠ ä¾èµ–</h4>
<pre><code class="language-xml">&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;2.5.0&lt;/version&gt;
&lt;/parent&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
        &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<h4 id="2-åˆ›å»ºå¯åŠ¨ç±»">â‘¡ åˆ›å»ºå¯åŠ¨ç±»</h4>
<pre><code class="language-java">@SpringBootApplication
public class SecurityApplication {

    public static void main(String[] args) {
        SpringApplication.run(SecurityApplication.class,args);
    }
}

</code></pre>
<h4 id="3-åˆ›å»ºcontroller">â‘¢ åˆ›å»ºController</h4>
<pre><code class="language-java">import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {

    @RequestMapping(&quot;/hello&quot;)
    public String hello(){
        return &quot;hello&quot;;
    }
}
</code></pre>
<h3 id="12-å¼•å…¥springsecurity">1.2 å¼•å…¥SpringSecurity</h3>
<p>åœ¨SpringBooté¡¹ç›®ä¸­ä½¿ç”¨SpringSecurityæˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¾èµ–å³å¯å®ç°å…¥é—¨æ¡ˆä¾‹ã€‚</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<ul>
<li>
<p>å¼•å…¥ä¾èµ–åæˆ‘ä»¬åœ¨å°è¯•å»è®¿é—®ä¹‹å‰çš„æ¥å£å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ªSpringSecurityçš„é»˜è®¤ç™»é™†é¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·åæ˜¯user,å¯†ç ä¼šè¾“å‡ºåœ¨æ§åˆ¶å°ã€‚</p>
</li>
<li>
<p>å¿…é¡»ç™»é™†ä¹‹åæ‰èƒ½å¯¹æ¥å£è¿›è¡Œè®¿é—®ã€‚</p>
</li>
</ul>
<h2 id="2è®¤è¯">2.è®¤è¯</h2>
<h3 id="21-ç™»é™†æ ¡éªŒæµç¨‹">2.1 ç™»é™†æ ¡éªŒæµç¨‹</h3>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220817165509.png" alt="" loading="lazy"></figure>
<h3 id="22-åŸç†åˆæ¢">2.2 åŸç†åˆæ¢</h3>
<p>æƒ³è¦çŸ¥é“å¦‚ä½•å®ç°è‡ªå·±çš„ç™»é™†æµç¨‹å°±å¿…é¡»è¦å…ˆçŸ¥é“å…¥é—¨æ¡ˆä¾‹ä¸­SpringSecurityçš„æµç¨‹ã€‚</p>
<h4 id="221-springsecurityå®Œæ•´æµç¨‹">2.2.1 SpringSecurityå®Œæ•´æµç¨‹</h4>
<p>SpringSecurityçš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ª<strong>è¿‡æ»¤å™¨é“¾</strong>ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å…¥é—¨æ¡ˆä¾‹ä¸­çš„è¿‡æ»¤å™¨ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220817165658.png" alt="" loading="lazy"></figure>
<p>å›¾ä¸­åªå±•ç¤ºäº†æ ¸å¿ƒè¿‡æ»¤å™¨ï¼Œå…¶å®ƒçš„éæ ¸å¿ƒè¿‡æ»¤å™¨å¹¶æ²¡æœ‰åœ¨å›¾ä¸­å±•ç¤ºã€‚</p>
<ul>
<li>
<p><strong>UsernamePasswordAuthenticationFilter</strong>:è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚</p>
</li>
<li>
<p>**ExceptionTranslationFilterï¼š**å¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½•AccessDeniedExceptionå’ŒAuthenticationException ã€‚</p>
</li>
<li>
<p>**FilterSecurityInterceptorï¼š**è´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨ã€‚</p>
</li>
</ul>
<p>â€‹</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡DebugæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­SpringSecurityè¿‡æ»¤å™¨é“¾ä¸­æœ‰å“ªäº›è¿‡æ»¤å™¨åŠå®ƒä»¬çš„é¡ºåºã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220817165723.png" alt="" loading="lazy"></figure>
<h4 id="222-è®¤è¯æµç¨‹è¯¦è§£">2.2.2 è®¤è¯æµç¨‹è¯¦è§£</h4>
<figure data-type="image" tabindex="4"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220817165917.png" alt="" loading="lazy"></figure>
<p>æ¦‚å¿µé€ŸæŸ¥:</p>
<p><strong>Authenticationæ¥å£</strong>: å®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚</p>
<p><strong>AuthenticationManageræ¥å£</strong>ï¼šå®šä¹‰äº†è®¤è¯Authenticationçš„æ–¹æ³•</p>
<p><strong>UserDetailsServiceæ¥å£</strong>ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
<p><strong>UserDetailsæ¥å£</strong>ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡UserDetailsServiceæ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆUserDetailså¯¹è±¡è¿”å›ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ°Authenticationå¯¹è±¡ä¸­ã€‚</p>
<h3 id="23-è§£å†³é—®é¢˜">2.3 è§£å†³é—®é¢˜</h3>
<h4 id="231-æ€è·¯åˆ†æ">2.3.1 æ€è·¯åˆ†æ</h4>
<p>ç™»å½•</p>
<pre><code>â‘  è‡ªå®šä¹‰ UserDetailsService çš„å®ç°ç±» UserDetailsServiceImpl

			åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“ï¼Œæ¥åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®

â‘¡ è‡ªå®šä¹‰ç™»å½•æ¥å£  

			è°ƒç”¨ ProviderManager çš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwt

			æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­
</code></pre>
<p>æ ¡éªŒï¼š</p>
<pre><code class="language-txt">â‘  å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨

			è·å–token

			è§£ætokenè·å–å…¶ä¸­çš„userid

			ä»Redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯

			å­˜å…¥SecurityContextHolder
</code></pre>
<h4 id="232-å‡†å¤‡å·¥ä½œ">2.3.2 å‡†å¤‡å·¥ä½œ</h4>
<p>â‘  æ·»åŠ ä¾èµ–</p>
<pre><code class="language-xml">&lt;!--redisä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!--fastjsonä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
     &lt;version&gt;1.2.83&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--jwtä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
    &lt;version&gt;0.9.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>â‘¡ æ·»åŠ Redisç›¸å…³é…ç½®</p>
<pre><code class="language-java">import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.serializer.SerializerFeature;
import com.fasterxml.jackson.databind.JavaType;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.type.TypeFactory;
import org.springframework.data.redis.serializer.RedisSerializer;
import org.springframework.data.redis.serializer.SerializationException;
import com.alibaba.fastjson.parser.ParserConfig;
import org.springframework.util.Assert;
import java.nio.charset.Charset;

/**
 * Redisä½¿ç”¨FastJsonåºåˆ—åŒ–
 * 
 * @author sg
 */
public class FastJsonRedisSerializer&lt;T&gt; implements RedisSerializer&lt;T&gt;
{

    public static final Charset DEFAULT_CHARSET = Charset.forName(&quot;UTF-8&quot;);

    private Class&lt;T&gt; clazz;

    static
    {
        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);
    }

    public FastJsonRedisSerializer(Class&lt;T&gt; clazz)
    {
        super();
        this.clazz = clazz;
    }

    @Override
    public byte[] serialize(T t) throws SerializationException
    {
        if (t == null)
        {
            return new byte[0];
        }
        return JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);
    }

    @Override
    public T deserialize(byte[] bytes) throws SerializationException
    {
        if (bytes == null || bytes.length &lt;= 0)
        {
            return null;
        }
        String str = new String(bytes, DEFAULT_CHARSET);

        return JSON.parseObject(str, clazz);
    }


    protected JavaType getJavaType(Class&lt;?&gt; clazz)
    {
        return TypeFactory.defaultInstance().constructType(clazz);
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
public class RedisConfig {

    @Bean
    @SuppressWarnings(value = {&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) {
        RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;();
        template.setConnectionFactory(connectionFactory);

        FastJsonRedisSerializer serializer = new FastJsonRedisSerializer(Object.class);

        // ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(serializer);

        // Hashçš„keyä¹Ÿé‡‡ç”¨StringRedisSerializerçš„åºåˆ—åŒ–æ–¹å¼
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(serializer);

        template.afterPropertiesSet();

        // å¼€å¯AutoTypeï¼Œå¤„ç†å¼‚å¸¸ï¼Œcom.alibaba.fastjson.JSONException: autoType is not support. org.springframework.security.core.authority.SimpleGrantedAuthority
        // å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå°èŒƒå›´æŒ‡å®šç™½åå•
        ParserConfig.getGlobalInstance().addAccept(&quot;org.springframework.security.core.authority.&quot;);
        TypeUtils.addMapping(&quot;org.springframework.security.core.authority.SimpleGrantedAuthority&quot;,
                SimpleGrantedAuthority.class);

        return template;
    }
}
</code></pre>
<p>â‘¢ å“åº”ç±»</p>
<pre><code class="language-java">import com.fasterxml.jackson.annotation.JsonInclude;

/**
 * @Author ä¸‰æ›´  Bç«™ï¼š https://space.bilibili.com/663528522
 */
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ResponseResult&lt;T&gt; {
    /**
     * çŠ¶æ€ç 
     */
    private Integer code;
    /**
     * æç¤ºä¿¡æ¯ï¼Œå¦‚æœæœ‰é”™è¯¯æ—¶ï¼Œå‰ç«¯å¯ä»¥è·å–è¯¥å­—æ®µè¿›è¡Œæç¤º
     */
    private String msg;
    /**
     * æŸ¥è¯¢åˆ°çš„ç»“æœæ•°æ®ï¼Œ
     */
    private T data;

    public ResponseResult(Integer code, String msg) {
        this.code = code;
        this.msg = msg;
    }

    public ResponseResult(Integer code, T data) {
        this.code = code;
        this.data = data;
    }

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

    public String getMsg() {
        return msg;
    }

    public void setMsg(String msg) {
        this.msg = msg;
    }

    public T getData() {
        return data;
    }

    public void setData(T data) {
        this.data = data;
    }

    public ResponseResult(Integer code, String msg, T data) {
        this.code = code;
        this.msg = msg;
        this.data = data;
    }
}
</code></pre>
<p>â‘£ JWT å·¥å…·ç±»</p>
<pre><code class="language-java">/**
 * JWTå·¥å…·ç±»
 */
public class JwtUtils {

    //æœ‰æ•ˆæœŸä¸º
    //public static final Long JWT_TTL = 60 * 60 * 1000L;// 60 * 60 * 1000  ä¸€ä¸ªå°æ—¶
    private static final Long JWT_TTL = 60 * 60 * 24000L;// 60 * 60 * 24000  äºŒåå››ä¸ªå°æ—¶

    //è®¾ç½®ç§˜é’¥æ˜æ–‡
    private static final char[] JWT_SECRET_KEY = &quot;sangeng&quot;.toCharArray();

    public static String getUUID() {
        String token = UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;);
        return token;
    }

    /**
     * ç”Ÿæˆjtw
     *
     * @param subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰
     * @return
     */
    public static String createJWT(String subject) {
        JwtBuilder builder = getJwtBuilder(subject, null, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´
        return builder.compact();
    }

    /**
     * ç”Ÿæˆjtw
     *
     * @param subject   tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰
     * @param ttlMillis tokenè¶…æ—¶æ—¶é—´
     * @return
     */
    public static String createJWT(String subject, Long ttlMillis) {
        JwtBuilder builder = getJwtBuilder(subject, ttlMillis, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´
        return builder.compact();
    }

    private static JwtBuilder getJwtBuilder(String subject, Long ttlMillis, String uuid) {
        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;
        SecretKey secretKey = generalKey();
        long nowMillis = System.currentTimeMillis();
        Date now = new Date(nowMillis);
        if (ttlMillis == null) {
            ttlMillis = JwtUtils.JWT_TTL;
        }
        long expMillis = nowMillis + ttlMillis;
        Date expDate = new Date(expMillis);
        return Jwts.builder()
                .setId(uuid)              //å”¯ä¸€çš„ID
                .setSubject(subject)   // ä¸»é¢˜  å¯ä»¥æ˜¯JSONæ•°æ®
                .setIssuer(&quot;admin&quot;)     // ç­¾å‘è€…
                .setIssuedAt(now)      // ç­¾å‘æ—¶é—´
                .signWith(signatureAlgorithm, secretKey) //ä½¿ç”¨HS256å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾å, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç§˜é’¥
                .setExpiration(expDate);
    }

    /**
     * åˆ›å»ºtoken
     *
     * @param id
     * @param subject
     * @param ttlMillis
     * @return
     */
    public static String createJWT(String id, String subject, Long ttlMillis) {
        JwtBuilder builder = getJwtBuilder(subject, ttlMillis, id);// è®¾ç½®è¿‡æœŸæ—¶é—´
        return builder.compact();
    }

    /**
     * ç”ŸæˆåŠ å¯†åçš„ç§˜é’¥ secretKey
     *
     * @return
     */
    public static SecretKey generalKey() {
        byte[] encodedKey = Base64.getDecoder().decode(new String(JWT_SECRET_KEY));
        SecretKey key = new SecretKeySpec(encodedKey, 0, encodedKey.length, &quot;AES&quot;);
        return key;
    }

    /**
     * è§£æ
     *
     * @param jwt
     * @return
     * @throws Exception
     */
    public static Claims parseJWT(String jwt) throws Exception {
        SecretKey secretKey = generalKey();
        return Jwts.parser()
                .setSigningKey(secretKey)
                .parseClaimsJws(jwt)
                .getBody();
    }

    public static void main(String[] args) throws Exception {
        String token = JwtUtils.createJWT(&quot;cook&quot;);
        Claims claims = parseJWT(token);
        System.out.println(token);//eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI3YTI5ZTQ4OThjMmI0YjMwOTczNTc4YmZjMmQwMWE2NSIsInN1YiI6ImNvb2siLCJpc3MiOiJhZG1pbiIsImlhdCI6MTY2MTE4NzM5MywiZXhwIjoxNjYxMjczNzkzfQ.dUO663dn5SIndbPgwIedXmY2YazG4WqD4rYzgGrtHXM
        System.out.println(claims);//{jti=7a29e4898c2b4b30973578bfc2d01a65, sub=cook, iss=admin, iat=1661187393, exp=1661273793}
    }

}
</code></pre>
<pre><code class="language-java">import java.util.*;
import java.util.concurrent.TimeUnit;

@SuppressWarnings(value = { &quot;unchecked&quot;, &quot;rawtypes&quot; })
@Component
public class RedisCache
{
    @Autowired
    public RedisTemplate redisTemplate;

    /**
     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰
     *
     * @param key ç¼“å­˜çš„é”®å€¼
     * @param value ç¼“å­˜çš„å€¼
     */
    public &lt;T&gt; void setCacheObject(final String key, final T value)
    {
        redisTemplate.opsForValue().set(key, value);
    }

    /**
     * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰
     *
     * @param key ç¼“å­˜çš„é”®å€¼
     * @param value ç¼“å­˜çš„å€¼
     * @param timeout æ—¶é—´
     * @param timeUnit æ—¶é—´é¢—ç²’åº¦
     */
    public &lt;T&gt; void setCacheObject(final String key, final T value, final Integer timeout, final TimeUnit timeUnit)
    {
        redisTemplate.opsForValue().set(key, value, timeout, timeUnit);
    }

    /**
     * è®¾ç½®æœ‰æ•ˆæ—¶é—´
     *
     * @param key Redisé”®
     * @param timeout è¶…æ—¶æ—¶é—´
     * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥
     */
    public boolean expire(final String key, final long timeout)
    {
        return expire(key, timeout, TimeUnit.SECONDS);
    }

    /**
     * è®¾ç½®æœ‰æ•ˆæ—¶é—´
     *
     * @param key Redisé”®
     * @param timeout è¶…æ—¶æ—¶é—´
     * @param unit æ—¶é—´å•ä½
     * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥
     */
    public boolean expire(final String key, final long timeout, final TimeUnit unit)
    {
        return redisTemplate.expire(key, timeout, unit);
    }

    /**
     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚
     *
     * @param key ç¼“å­˜é”®å€¼
     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®
     */
    public &lt;T&gt; T getCacheObject(final String key)
    {
        ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue();
        return operation.get(key);
    }

    /**
     * åˆ é™¤å•ä¸ªå¯¹è±¡
     *
     * @param key
     */
    public boolean deleteObject(final String key)
    {
        return redisTemplate.delete(key);
    }

    /**
     * åˆ é™¤é›†åˆå¯¹è±¡
     *
     * @param collection å¤šä¸ªå¯¹è±¡
     * @return
     */
    public long deleteObject(final Collection collection)
    {
        return redisTemplate.delete(collection);
    }

    /**
     * ç¼“å­˜Listæ•°æ®
     *
     * @param key ç¼“å­˜çš„é”®å€¼
     * @param dataList å¾…ç¼“å­˜çš„Listæ•°æ®
     * @return ç¼“å­˜çš„å¯¹è±¡
     */
    public &lt;T&gt; long setCacheList(final String key, final List&lt;T&gt; dataList)
    {
        Long count = redisTemplate.opsForList().rightPushAll(key, dataList);
        return count == null ? 0 : count;
    }

    /**
     * è·å¾—ç¼“å­˜çš„listå¯¹è±¡
     *
     * @param key ç¼“å­˜çš„é”®å€¼
     * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ®
     */
    public &lt;T&gt; List&lt;T&gt; getCacheList(final String key)
    {
        return redisTemplate.opsForList().range(key, 0, -1);
    }

    /**
     * ç¼“å­˜Set
     *
     * @param key ç¼“å­˜é”®å€¼
     * @param dataSet ç¼“å­˜çš„æ•°æ®
     * @return ç¼“å­˜æ•°æ®çš„å¯¹è±¡
     */
    public &lt;T&gt; BoundSetOperations&lt;String, T&gt; setCacheSet(final String key, final Set&lt;T&gt; dataSet)
    {
        BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key);
        Iterator&lt;T&gt; it = dataSet.iterator();
        while (it.hasNext())
        {
            setOperation.add(it.next());
        }
        return setOperation;
    }

    /**
     * è·å¾—ç¼“å­˜çš„set
     *
     * @param key
     * @return
     */
    public &lt;T&gt; Set&lt;T&gt; getCacheSet(final String key)
    {
        return redisTemplate.opsForSet().members(key);
    }

    /**
     * ç¼“å­˜Map
     *
     * @param key
     * @param dataMap
     */
    public &lt;T&gt; void setCacheMap(final String key, final Map&lt;String, T&gt; dataMap)
    {
        if (dataMap != null) {
            redisTemplate.opsForHash().putAll(key, dataMap);
        }
    }

    /**
     * è·å¾—ç¼“å­˜çš„Map
     *
     * @param key
     * @return
     */
    public &lt;T&gt; Map&lt;String, T&gt; getCacheMap(final String key)
    {
        return redisTemplate.opsForHash().entries(key);
    }

    /**
     * å¾€Hashä¸­å­˜å…¥æ•°æ®
     *
     * @param key Redisé”®
     * @param hKey Hashé”®
     * @param value å€¼
     */
    public &lt;T&gt; void setCacheMapValue(final String key, final String hKey, final T value)
    {
        redisTemplate.opsForHash().put(key, hKey, value);
    }

    /**
     * è·å–Hashä¸­çš„æ•°æ®
     *
     * @param key Redisé”®
     * @param hKey Hashé”®
     * @return Hashä¸­çš„å¯¹è±¡
     */
    public &lt;T&gt; T getCacheMapValue(final String key, final String hKey)
    {
        HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.opsForHash();
        return opsForHash.get(key, hKey);
    }

    /**
     * åˆ é™¤Hashä¸­çš„æ•°æ®
     * 
     * @param key
     * @param hkey
     */
    public void delCacheMapValue(final String key, final String hkey)
    {
        HashOperations hashOperations = redisTemplate.opsForHash();
        hashOperations.delete(key, hkey);
    }

    /**
     * è·å–å¤šä¸ªHashä¸­çš„æ•°æ®
     *
     * @param key Redisé”®
     * @param hKeys Hashé”®é›†åˆ
     * @return Hashå¯¹è±¡é›†åˆ
     */
    public &lt;T&gt; List&lt;T&gt; getMultiCacheMapValue(final String key, final Collection&lt;Object&gt; hKeys)
    {
        return redisTemplate.opsForHash().multiGet(key, hKeys);
    }

    /**
     * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨
     *
     * @param pattern å­—ç¬¦ä¸²å‰ç¼€
     * @return å¯¹è±¡åˆ—è¡¨
     */
    public Collection&lt;String&gt; keys(final String pattern)
    {
        return redisTemplate.keys(pattern);
    }
}
</code></pre>
<pre><code class="language-java">import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class WebUtils
{
    /**
     * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯
     * 
     * @param response æ¸²æŸ“å¯¹è±¡
     * @param string å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸²
     * @return null
     */
    public static String renderString(HttpServletResponse response, String string) {
        try
        {
            response.setStatus(200);
            response.setContentType(&quot;application/json&quot;);
            response.setCharacterEncoding(&quot;utf-8&quot;);
            response.getWriter().print(string);
        }
        catch (IOException e)
        {
            e.printStackTrace();
        }
        return null;
    }
}
</code></pre>
<p>â‘¤å®ä½“ç±»</p>
<pre><code class="language-java">import java.io.Serializable;
import java.util.Date;


/**
 * ç”¨æˆ·è¡¨(User)å®ä½“ç±»
 *
 * @author ä¸‰æ›´
 */
@Data
@AllArgsConstructor
@NoArgsConstructor
public class User implements Serializable {
    private static final long serialVersionUID = -40356785423868312L;
    
    /**
    * ä¸»é”®
    */
    private Long id;
    /**
    * ç”¨æˆ·å
    */
    private String userName;
    /**
    * æ˜µç§°
    */
    private String nickName;
    /**
    * å¯†ç 
    */
    private String password;
    /**
    * è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰
    */
    private String status;
    /**
    * é‚®ç®±
    */
    private String email;
    /**
    * æ‰‹æœºå·
    */
    private String phonenumber;
    /**
    * ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰
    */
    private String sex;
    /**
    * å¤´åƒ
    */
    private String avatar;
    /**
    * ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰
    */
    private String userType;
    /**
    * åˆ›å»ºäººçš„ç”¨æˆ·id
    */
    private Long createBy;
    /**
    * åˆ›å»ºæ—¶é—´
    */
    private Date createTime;
    /**
    * æ›´æ–°äºº
    */
    private Long updateBy;
    /**
    * æ›´æ–°æ—¶é—´
    */
    private Date updateTime;
    /**
    * åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰
    */
    private Integer delFlag;
}
</code></pre>
<h4 id="233-å®ç°">2.3.3 å®ç°</h4>
<h5 id="2331-æ•°æ®åº“æ ¡éªŒç”¨æˆ·">2.3.3.1 æ•°æ®åº“æ ¡éªŒç”¨æˆ·</h5>
<ul>
<li>ä»ä¹‹å‰çš„åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªUserDetailsServiceImpl,</li>
<li>è®©SpringSecurityä½¿ç”¨æˆ‘ä»¬çš„UserDetailsServiceImplã€‚</li>
<li>æˆ‘ä»¬è‡ªå·±çš„UserDetailsServiceImplå¯ä»¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç ã€‚</li>
</ul>
<h6 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h6>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·è¡¨ï¼Œ å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š</p>
<pre><code class="language-mysql">CREATE TABLE `sys_user` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `user_name` VARCHAR(64) NOT NULL DEFAULT 'NULL' COMMENT 'ç”¨æˆ·å',
  `nick_name` VARCHAR(64) NOT NULL DEFAULT 'NULL' COMMENT 'æ˜µç§°',
  `password` VARCHAR(64) NOT NULL DEFAULT 'NULL' COMMENT 'å¯†ç ',
  `status` CHAR(1) DEFAULT '0' COMMENT 'è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  `email` VARCHAR(64) DEFAULT NULL COMMENT 'é‚®ç®±',
  `phonenumber` VARCHAR(32) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `sex` CHAR(1) DEFAULT NULL COMMENT 'ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰',
  `avatar` VARCHAR(128) DEFAULT NULL COMMENT 'å¤´åƒ',
  `user_type` CHAR(1) NOT NULL DEFAULT '1' COMMENT 'ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰',
  `create_by` BIGINT(20) DEFAULT NULL COMMENT 'åˆ›å»ºäººçš„ç”¨æˆ·id',
  `create_time` DATETIME DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` BIGINT(20) DEFAULT NULL COMMENT 'æ›´æ–°äºº',
  `update_time` DATETIME DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `del_flag` INT(11) DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰',
  PRIMARY KEY (`id`)
) ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨'
</code></pre>
<p>å¼•å…¥MybatisPulså’Œmysqlé©±åŠ¨çš„ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;3.5.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>é…ç½®æ•°æ®åº“ä¿¡æ¯</p>
<pre><code class="language-yml">spring:
  datasource:
    url: jdbc:mysql://localhost:3306/sg_security?characterEncoding=utf-8&amp;serverTimezone=UTC
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
</code></pre>
<p>å®šä¹‰Mapperæ¥å£</p>
<pre><code class="language-java">public interface UserMapper extends BaseMapper&lt;User&gt; {
}
</code></pre>
<p>ä¿®æ”¹Userå®ä½“ç±»</p>
<pre><code class="language-java">ç±»åä¸ŠåŠ @TableName(value = &quot;sys_user&quot;) ,delFlagå­—æ®µä¸ŠåŠ  @TableLogic
</code></pre>
<p>é…ç½®Mapperæ‰«æ</p>
<pre><code class="language-java">@SpringBootApplication
@MapperScan(&quot;com.sangeng.mapper&quot;)
public class SimpleSecurityApplication {
    public static void main(String[] args) {
        ConfigurableApplicationContext run = SpringApplication.run(SimpleSecurityApplication.class);
        System.out.println(run);
    }
}
</code></pre>
<p>æ·»åŠ junitä¾èµ–</p>
<pre><code class="language-java">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>æµ‹è¯• MyBatis-Plus æ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨</p>
<pre><code class="language-java">/**
 * @Author ä¸‰æ›´  Bç«™ï¼š https://space.bilibili.com/663528522
 */
@SpringBootTest
public class MapperTest {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testUserMapper(){
        List&lt;User&gt; users = userMapper.selectList(null);
        System.out.println(users);
    }
}
</code></pre>
<h6 id="æ ¸å¿ƒä»£ç å®ç°">æ ¸å¿ƒä»£ç å®ç°</h6>
<h6 id="1-åˆ›å»ºuserdetailsserviceçš„å®ç°ç±»">â‘  åˆ›å»ºUserDetailsServiceçš„å®ç°ç±»</h6>
<ul>
<li>é‡å†™å…¶ä¸­çš„æ–¹æ³•ã€‚æ¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</li>
</ul>
<p>1ï¼‰UserDetailsServiceImpl</p>
<pre><code class="language-java">@Service
@RequiredArgsConstructor
public class UserDetailsServiceImpl implements UserDetailsService {

    private final UserMapper userMapper;

    /**
     * ä»æ•°æ®åº“ä¸­æŸ¥å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œ
     * ä¾› AuthenticationProvider è¿›è¡Œå¯†ç æ¯”å¯¹
     *
     * @param username ç”± AuthenticationProvider æä¾›ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ä¼ å…¥çš„username
     * @return
     * @throws UsernameNotFoundException
     */
    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        // 1ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
        LambdaQueryWrapper&lt;User&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();
        queryWrapper.eq(User::getUserName, username);
        User user = userMapper.selectOne(queryWrapper);
        // 2ã€å¦‚æœæŸ¥è¯¢ä¸åˆ°æ•°æ®å°±é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ç»™å‡ºæç¤º
        if (null == user) {
            throw new UsernameNotFoundException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;);
        }
        //TODO 3ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æƒé™ä¿¡æ¯ï¼Œå°†å…¶æ·»åŠ åˆ° UserDetailsBean ä¸­çš„ authorities

        // 4ã€å°†æŸ¥å‡ºçš„ç”¨æˆ·ä¿¡æ¯ï¼Œæƒé™ä¿¡æ¯ï¼Œå°è£…æˆUserDetailsï¼ˆUserDetailsBeanï¼‰å¯¹è±¡è¿”å›
        return new UserDetailsBean(user);
    }
}
</code></pre>
<p>2ï¼‰UserDetailsBean</p>
<p>å› ä¸ºUserDetailsServiceæ–¹æ³•çš„è¿”å›å€¼æ˜¯UserDetailsç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°è¯¥æ¥å£ï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯å°è£…åœ¨å…¶ä¸­ã€‚</p>
<pre><code class="language-java">/**
 * ç™»å½•ç”¨æˆ· UserDetails
 */
public class UserDetailsBean implements UserDetails {

    /**
     * å°è£…ç”¨æˆ·ä¿¡æ¯
     */
    private User user;

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        return null;
    }

    @Override
    public String getPassword() {
        return user.getPassword();
    }

    @Override
    public String getUsername() {
        return user.getUserName();
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return user.getStatus().equals(&quot;0&quot;);
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    public UserDetailsBean() {
    }

    public UserDetailsBean(User user) {
        this.user = user;
    }
}
</code></pre>
<h6 id="2-é…ç½®å¯†ç ç¼–ç å™¨">â‘¡ é…ç½®å¯†ç ç¼–ç å™¨</h6>
<p><code>AuthenticationProvider</code>ï¼Œåœ¨æ ¹æ®è¿”å›çš„UserDetailsè¿›è¡Œå¯†ç æ¯”å¯¹æ—¶ï¼š</p>
<ul>
<li>
<p>é»˜è®¤ä½¿ç”¨çš„PasswordEncoderè¦æ±‚æ•°æ®åº“ä¸­çš„å¯†ç æ ¼å¼ä¸ºï¼š{type}password ã€‚å®ƒä¼šæ ¹æ® type å»åˆ¤æ–­å¯†ç çš„åŠ å¯†æ–¹å¼ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚æ‰€ä»¥å°±éœ€è¦æ›¿æ¢é»˜è®¤çš„ PasswordEncoderã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨SpringSecurityæ¨èçš„çš„<mark>BCryptPasswordEncoder</mark>ï¼Œ</p>
</li>
<li>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªSpringSecurityçš„é…ç½®ç±»ï¼Œnew ä¸€ä¸ª BCryptPasswordEncoderï¼Œç„¶åä½¿ç”¨ @Bean æ³¨è§£å°†å…¶æ³¨å…¥ Spring  å®¹å™¨ï¼Œæ›¿æ¢é»˜è®¤çš„å¯†ç ç¼–ç å™¨ã€‚</p>
</li>
</ul>
<pre><code class="language-java">@Configuration
public class SecurityConfig {

    /**
     * æ›¿æ¢é»˜è®¤å¯†ç ç¼–ç å™¨
     * ä½¿ç”¨BCryptPasswordEncoder
     * @return
     */
    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder(){
        return new BCryptPasswordEncoder();
    }

}
</code></pre>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>å¦‚æœä½ æƒ³è®©ç”¨æˆ·çš„å¯†ç æ˜¯<code>æ˜æ–‡å­˜å‚¨</code>ï¼Œ</p>
<p>åˆ™ä¸éœ€è¦æ›¿æ¢é»˜è®¤çš„å¯†ç ç¼–ç å™¨ï¼Œ</p>
<p>åªéœ€åœ¨å¯†ç å‰åŠ <code>{noop}</code>ï¼Œè¿™é‡Œçš„ noop å°±æ˜¯æŒ‡å®šåŠ å¯†ç±»å‹ä¸ºæ˜æ–‡</p>
<p><code>å½“ç„¶ï¼Œåœ¨çœŸçš„é¡¹ç›®ä¸­è°ä¼šæŠŠå¯†ç æ˜æ–‡å­˜å‚¨å‘¢ï¼Ÿ</code></p>
<p>ä¾‹å¦‚</p>
<figure data-type="image" tabindex="5"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220817203822.png" alt="" loading="lazy"></figure>
<p>è¿™æ ·ç™»é™†çš„æ—¶å€™å°±å¯ä»¥ç”¨sgä½œä¸ºç”¨æˆ·åï¼Œ1234ä½œä¸ºå¯†ç æ¥ç™»é™†äº†ã€‚</p>
</blockquote>
<h6 id="3-æµ‹è¯•">â‘¢ æµ‹è¯•</h6>
<ul>
<li>ä½¿ç”¨æµè§ˆå™¨ï¼Œé€šè¿‡é»˜è®¤çš„è®¤è¯é¡µé¢æµ‹è¯•</li>
</ul>
<h5 id="2333-è‡ªå®šä¹‰ç™»é™†æ¥å£">2.3.3.3 è‡ªå®šä¹‰ç™»é™†æ¥å£</h5>
<ul>
<li>
<p>æ¥ä¸‹æˆ‘ä»¬éœ€è¦<mark>è‡ªå®šä¹‰ç™»é™†æ¥å£</mark>ï¼Œç„¶åè®©SpringSecurityå¯¹è¿™ä¸ªæ¥å£æ”¾è¡Œ,è®©ç”¨æˆ·è®¿é—®è¿™ä¸ªæ¥å£çš„æ—¶å€™ä¸ç”¨ç™»å½•ä¹Ÿèƒ½è®¿é—®ã€‚</p>
</li>
<li>
<p>åœ¨æ¥å£ä¸­è°ƒç”¨<mark>AuthenticationManager</mark>çš„==authenticate()==æ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œæ‰€ä»¥è¿˜éœ€è¦é…ç½®ç±»ä¸­æŠŠAuthenticationManageræ³¨å…¥å®¹å™¨ã€‚</p>
</li>
<li>
<p>è®¤è¯æˆåŠŸçš„è¯è¦ç”Ÿæˆä¸€ä¸ªjwtï¼Œæ”¾å…¥å“åº”ä¸­è¿”å›ã€‚å¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·ä¸‹å›è¯·æ±‚æ—¶èƒ½é€šè¿‡jwtè¯†åˆ«å‡ºå…·ä½“çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥Redisï¼Œå¯ä»¥æŠŠç”¨æˆ·idä½œä¸ºkeyã€‚</p>
</li>
</ul>
<h6 id="1-åˆ›å»ºç™»å½•æ¥å£çš„-controller">â‘  åˆ›å»ºç™»å½•æ¥å£çš„ Controller</h6>
<ul>
<li>LoginController</li>
</ul>
<pre><code class="language-java">@RestController
public class LoginController {

    @Autowired
    private LoginServcie loginServcie;

    @PostMapping(&quot;/user/login&quot;)
    public ResponseResult login(@RequestBody User user){
        return loginServcie.login(user);
    }
  
}
</code></pre>
<h6 id="2-ç»™ç™»å½•æ¥å£æ”¾è¡ŒåŒæ—¶ä¸º-spring-å®¹å™¨æ³¨å…¥-authenticationmanager">â‘¡ ç»™ç™»å½•æ¥å£æ”¾è¡Œï¼ŒåŒæ—¶ä¸º Spring å®¹å™¨æ³¨å…¥ AuthenticationManager</h6>
<p><mark>æ³¨æ„</mark> ï¼šæ­¤æ—¶é…ç½®ç±»è¦ç»§æ‰¿WebSecurityConfigurerAdapter</p>
<pre><code class="language-java">@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                // å…³é—­csrf
                .csrf().disable()
                // ä¸é€šè¿‡Sessionè·å–SecurityContext
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®
                .authorizeRequests()
                .antMatchers(&quot;/user/login&quot;).anonymous()
                // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯
                .anyRequest().authenticated();
    }

    /**
     * åœ¨å®¹å™¨ä¸­æ³¨å…¥AuthenticationManager
     * ä¾›ç™»å½•æ¥å£çš„Serviceè°ƒç”¨
     *
     * @return
     * @throws Exception
     */
    @Bean
    @Override
    protected AuthenticationManager authenticationManager() throws Exception {
        return super.authenticationManager();
    }

}
</code></pre>
<h6 id="3-åˆ›å»ºç™»å½•æ¥å£çš„-service">â‘¢ åˆ›å»ºç™»å½•æ¥å£çš„ Service</h6>
<ul>
<li>LoginService</li>
<li>LoginServiceImpl</li>
</ul>
<pre><code class="language-java">public interface LoginServcie {
  
    Result login(User user);

}
</code></pre>
<pre><code class="language-java">@Service
@RequiredArgsConstructor
public class LoginServcieImpl implements LoginServcie {

    private final AuthenticationManager authenticationManager;

    private final RedisCache redisCache;

    @Override
    public Result login(User user) {
        //éç©ºåˆ¤æ–­
        if (null == user || null == user.getUserName() || null == user.getPassword()) {
            return Result.error(&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©º&quot;);
        }
        //è°ƒç”¨AuthenticationManagerçš„authenticate()æ–¹æ³•ï¼Œåˆ¤æ–­å¯†ç å¯¹ä¸å¯¹
        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(user.getUserName(), user.getPassword());
        Authentication authenticate = null;
        try {
            authenticate = authenticationManager.authenticate(authentication);
        } catch (BadCredentialsException e) {
            return Result.error(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;);
        } catch (LockedException e) {
            return Result.error(&quot;è´¦å·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;);
        }
        //è‹¥å¯†ç æ­£ç¡®ï¼Œåˆ™ç”¨ userid ç”Ÿæˆtoken
        UserDetailsBean userDetailsBean = (UserDetailsBean) authenticate.getPrincipal();
        String userId = userDetailsBean.getUser().getId().toString();
        String token = JwtUtils.createJWT(userId);
        //å°†ç”¨æˆ·ä¿¡æ¯ UserDetails æ”¾å…¥ Redis ç¼“å­˜ä¸­ï¼Œç”¨æˆ·idä½œä¸ºkey
        redisCache.setCacheObject(&quot;login:&quot; + userId, userDetailsBean);
        //è¿”å›tokenç»™å‰ç«¯
        HashMap&lt;String, String&gt; tokenMap = new HashMap&lt;&gt;();
        tokenMap.put(&quot;token&quot;, token);
        return Result.OK(&quot;ç™»å½•æˆåŠŸ&quot;, tokenMap);
    }

}
</code></pre>
<h6 id="4-æµ‹è¯•ç™»å½•æ¥å£">â‘£ æµ‹è¯•ç™»å½•æ¥å£</h6>
<ul>
<li>ä½¿ç”¨Postanæµ‹è¯•</li>
</ul>
<h5 id="2334-è®¤è¯è¿‡æ»¤å™¨">2.3.3.4 è®¤è¯è¿‡æ»¤å™¨</h5>
<ul>
<li>
<p>ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå¯¹å…¶ä»–æ‰€æœ‰æ¥å£çš„è¯·æ±‚éƒ½ä¼šæºå¸¦ç›¸åº”çš„ token ï¼Œåç»­æ“ä½œéƒ½æ˜¯é€šè¿‡ token é‰´æƒ</p>
</li>
<li>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª JWT è¿‡æ»¤å™¨ï¼Œå¦‚æœ token æœ‰æ•ˆï¼Œåˆ™<mark>æ˜¾å¼</mark>åœ°ä¸ºç”¨æˆ·å»<mark>æ³¨å†Œèº«ä»½è®¤è¯</mark>ï¼š</p>
</li>
<li>
<p><mark>SecurityContextHolder.getContext().setAuthentication(anAuthentication);</mark></p>
</li>
<li>
<p>è¿™ä¸ªè¿‡æ»¤å™¨å…·ä½“æµç¨‹ä¸ºï¼š</p>
<ul>
<li>
<p>è·å–è¯·æ±‚å¤´ä¸­çš„tokenï¼Œå¯¹tokenè¿›è¡Œè§£æå–å‡ºå…¶ä¸­çš„useridã€‚</p>
</li>
<li>
<p>ä½¿ç”¨useridå»redisä¸­è·å–å¯¹åº”çš„UserDetailsBeanå¯¹è±¡ã€‚</p>
</li>
<li>
<p>ç„¶åå°è£…æˆ authentication å¯¹è±¡å­˜å…¥ SecurityContextHolder æ˜¾å¼æ³¨å†Œèº«ä»½è®¤è¯</p>
</li>
</ul>
</li>
</ul>
<h6 id="1-åˆ›å»º-jwt-è¿‡æ»¤å™¨">â‘  åˆ›å»º JWT è¿‡æ»¤å™¨</h6>
<p>1ï¼‰JwtAuthenticationTokenFilter</p>
<pre><code class="language-java">@Component
@RequiredArgsConstructor
public class JwtAuthenticationTokenFilter extends OncePerRequestFilter {

    private final RedisCache redisCache;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
        //è·å–token
        String token = request.getHeader(&quot;token&quot;);
        //åˆ¤æ–­tokenæ˜¯å¦éç©º
        if (StringUtils.isEmpty(token)) {
            //ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ”¾è¡Œï¼Œè¯·æ±‚ä¼šå»ä¸‹ä¸€ä¸ªç™»å½•æ¥å£
            filterChain.doFilter(request, response);
            return;
        }
        //ä¸ä¸ºç©ºï¼Œåˆ™è§£ætokenè·å–userid
        String userId;
        try {
            Claims jwt = JwtUtils.parseJWT(token);
            userId = jwt.getSubject();
        } catch (Exception e) {
            //è§£æå¤±è´¥ï¼Œæç¤ºtokenéæ³•
            // æ–¹æ³•ä¸€ï¼š
            // æ³¨æ„ï¼Œæ­¤æ—¶éœ€è¦è‡ªå®šä¹‰è®¤è¯å¼‚å¸¸å¤„ç†ï¼Œå¦åˆ™åªä¼šå“åº”403çš„ç©ºç™½é”™è¯¯ï¼›
            // åŒæ—¶ï¼Œæˆ‘å‘ç°è¿™é‡Œæ— è®ºæŠ›å‡ºå“ªä¸ªAuthenticationExceptionçš„å¼‚å¸¸ï¼Œæ— èŠæ€ä¹ˆä¼ é€’æ¶ˆæ¯ï¼Œ
            // åœ¨è‡ªå®šä¹‰è®¤è¯å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸æ¶ˆæ¯éƒ½ä¼šè¢«è¦†ç›–æˆ&quot;Full authentication is required to access this resource&quot;
            // æ‰€ä»¥ï¼Œè¿™é‡Œè¿˜æ˜¯é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•å¤„ç†å¼‚å¸¸ã€‚
//            throw new AuthenticationServiceException(&quot;Tokenéæ³•&quot;,new Throwable(&quot;Tokenéæ³•&quot;));
            //æ–¹æ³•äºŒï¼š
            request.getRequestDispatcher(&quot;/jwtFilterException/&quot; + &quot;Tokenéæ³•&quot;).forward(request, response);
            filterChain.doFilter(request, response);
            return;
        }
        //è§£ææˆåŠŸï¼Œé€šè¿‡useridä»Redisç¼“å­˜ä¸­è·å– UserDetailsBean
        UserDetailsBean userDetailsBean = redisCache.getCacheObject(&quot;login:&quot; + userId);
        //è·å–ä¸äº†ï¼Œæç¤ºä¼šè¯å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•
        if (null == userDetailsBean) {
            //è§£æå¤±è´¥ï¼Œæç¤ºtokenéæ³•
            request.getRequestDispatcher(&quot;/jwtFilterException/&quot; + &quot;ä¼šè¯å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•&quot;).forward(request, response);
            filterChain.doFilter(request, response);
            return;
        }
        //è·å–çš„äº†ï¼Œå°† UserDetailsBean å°è£…æˆ authentication å¯¹è±¡ï¼Œæ˜¾å¼åœ°ä¸ºç”¨æˆ·å»æ³¨å†Œèº«ä»½è®¤è¯
        // TODO: å°†æƒé™ä¿¡æ¯å°è£…è¿› authentication å¯¹è±¡
        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetailsBean, null, userDetailsBean.getAuthorities());
        SecurityContextHolder.getContext().setAuthentication(authentication);
        //æ”¾è¡Œ
        filterChain.doFilter(request, response);
    }

}
</code></pre>
<p>2ï¼‰JwtFilterExceptionController</p>
<pre><code class="language-java">@RestController
public class JwtFilterExceptionController {

    @RequestMapping(&quot;/jwtFilterException/{message}&quot;)
    public Result jwtFilterException(@PathVariable(&quot;message&quot;) String message) {
        return Result.error(message);
    }
    
}
</code></pre>
<h6 id="2-æ³¨å†Œè¿‡æ»¤å™¨">â‘¡ æ³¨å†Œè¿‡æ»¤å™¨</h6>
<pre><code class="language-java">@Configuration
@RequiredArgsConstructor
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    private final JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;

    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                // å…³é—­csrf
                .csrf().disable()
                // ä¸é€šè¿‡Sessionè·å–SecurityContext
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®
                .authorizeRequests()
                .antMatchers(&quot;/user/login&quot;).anonymous()
                // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯
                .anyRequest().authenticated();

        // æŠŠ JWT è¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­
        http
                .addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);
    }

    /**
     * åœ¨å®¹å™¨ä¸­æ³¨å…¥AuthenticationManager
     * ä¾›ç™»å½•æ¥å£çš„Serviceè°ƒç”¨
     *
     * @return
     * @throws Exception
     */
    @Bean
    @Override
    protected AuthenticationManager authenticationManager() throws Exception {
        return super.authenticationManager();
    }
    
}
</code></pre>
<h6 id="3-æµ‹è¯•-2">â‘¢ æµ‹è¯•</h6>
<ul>
<li>ä½¿ç”¨Postmanæµ‹è¯•</li>
</ul>
<h5 id="2335-é€€å‡ºç™»å½•">2.3.3.5 é€€å‡ºç™»å½•</h5>
<ul>
<li>æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªé€€å‡ºç™»å½•æ¥å£</li>
<li>é€šè¿‡ SecurityContextHolder è·å–å½“å‰ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼Œ</li>
<li>ç„¶åé€šè¿‡è®¤è¯ä¿¡æ¯è·å– userid</li>
<li>å†é€šè¿‡ userid åˆ é™¤redisä¸­å¯¹åº”çš„æ•°æ®å³å¯</li>
</ul>
<pre><code class="language-java">@Override
public Result logout() {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
    UserDetailsBean userDetailsBean = (UserDetailsBean) authentication.getPrincipal();
    Long userId = userDetailsBean.getUser().getId();
    redisCache.deleteObject(&quot;login:&quot; + userId);
    return Result.OK(&quot;é€€å‡ºç™»å½•æˆåŠŸ&quot;);
}
</code></pre>
<h2 id="3æˆæƒ">3.æˆæƒ</h2>
<h3 id="30-æƒé™ç³»ç»Ÿçš„ä½œç”¨">3.0 æƒé™ç³»ç»Ÿçš„ä½œç”¨</h3>
<p>ä¾‹å¦‚ä¸€ä¸ªå­¦æ ¡å›¾ä¹¦é¦†çš„ç®¡ç†ç³»ç»Ÿï¼Œå¦‚æœæ˜¯æ™®é€šå­¦ç”Ÿç™»å½•å°±èƒ½çœ‹åˆ°å€Ÿä¹¦è¿˜ä¹¦ç›¸å…³çš„åŠŸèƒ½ï¼Œä¸å¯èƒ½è®©ä»–çœ‹åˆ°å¹¶ä¸”å»ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå›¾ä¹¦é¦†ç®¡ç†å‘˜çš„è´¦å·ç™»å½•äº†ï¼Œåº”è¯¥å°±èƒ½çœ‹åˆ°å¹¶ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚</p>
<p>æ€»ç»“èµ·æ¥å°±æ˜¯<strong>ä¸åŒçš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŠŸèƒ½</strong>ã€‚è¿™å°±æ˜¯æƒé™ç³»ç»Ÿè¦å»å®ç°çš„æ•ˆæœã€‚</p>
<p>æˆ‘ä»¬ä¸èƒ½åªä¾èµ–å‰ç«¯å»åˆ¤æ–­ç”¨æˆ·çš„æƒé™æ¥é€‰æ‹©æ˜¾ç¤ºå“ªäº›èœå•å“ªäº›æŒ‰é’®ã€‚å› ä¸ºå¦‚æœåªæ˜¯è¿™æ ·ï¼Œå¦‚æœæœ‰äººçŸ¥é“äº†å¯¹åº”åŠŸèƒ½çš„æ¥å£åœ°å€å°±å¯ä»¥ä¸é€šè¿‡å‰ç«¯ï¼Œç›´æ¥å»å‘é€è¯·æ±‚æ¥å®ç°ç›¸å…³åŠŸèƒ½æ“ä½œã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨åå°è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™ï¼Œå¿…é¡»å…·æœ‰æ‰€éœ€æƒé™æ‰èƒ½è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<h3 id="31-æˆæƒåŸºæœ¬æµç¨‹">3.1 æˆæƒåŸºæœ¬æµç¨‹</h3>
<ul>
<li>
<p>åœ¨SpringSecurityä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„FilterSecurityInterceptoræ¥è¿›è¡Œæƒé™æ ¡éªŒã€‚</p>
</li>
<li>
<p>åœ¨FilterSecurityInterceptorä¸­ä¼šä»SecurityContextHolderè·å–å½“å‰ç”¨æˆ·çš„Authenticationï¼Œç„¶åè·å–å…¶ä¸­çš„æƒé™ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>ç„¶ååˆ¤æ–­å½“å‰ç”¨æˆ·çš„æƒé™ä¿¡æ¯æ˜¯å¦ä¸æ¥å£è®¾ç½®çš„æ‰€éœ€æƒé™åŒ¹é…ã€‚</p>
</li>
<li>
<p>åŒ¹é…åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆªã€‚</p>
<ul>
<li>
<p>æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªéœ€è¦æŠŠå½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯ä¹Ÿå­˜å…¥Authenticationã€‚</p>
</li>
<li>
<p>ç„¶åè®¾ç½®æˆ‘ä»¬çš„æ¥å£ç­‰èµ„æºæ‰€éœ€è¦çš„æƒé™å³å¯ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="32-æˆæƒå®ç°">3.2 æˆæƒå®ç°</h3>
<h4 id="321-åŸºäºæ³¨è§£è®¾ç½®è®¿é—®èµ„æºçš„æƒé™">3.2.1 åŸºäºæ³¨è§£è®¾ç½®è®¿é—®èµ„æºçš„æƒé™</h4>
<h5 id="1-å¼€å¯åŸºäºæ³¨è§£çš„é…ç½®">â‘  å¼€å¯åŸºäºæ³¨è§£çš„é…ç½®</h5>
<pre><code class="language-java">@EnableGlobalMethodSecurity(prePostEnabled = true)
</code></pre>
<h5 id="2-ä½¿ç”¨-preauthorize-è®¾ç½®æƒé™">â‘¡ ä½¿ç”¨ @PreAuthorize è®¾ç½®æƒé™</h5>
<pre><code class="language-java">@RestController
public class HelloController {

    @PreAuthorize(&quot;hasAuthority('ROLE_TEST')&quot;)
    @RequestMapping(&quot;/hello&quot;)
    public String hello(){
        return &quot;hello&quot;;
    }

}
</code></pre>
<h5 id="3-æµ‹è¯•-3">â‘¢ æµ‹è¯•</h5>
<ul>
<li>æˆ‘ä»¬å¯ä»¥å…ˆç”¨ Postman è¿›è¡Œç®€å•çš„æµ‹è¯•</li>
<li>ç»“æœå½“ç„¶æ˜¯ 403 æ— æƒé™</li>
</ul>
<h4 id="322-å°è£…æƒé™ä¿¡æ¯">3.2.2 å°è£…æƒé™ä¿¡æ¯</h4>
<h5 id="1-ä¿®æ”¹userdetailsbean">â‘  ä¿®æ”¹UserDetailsBean</h5>
<pre><code class="language-java">/**
 * ç™»å½•ç”¨æˆ· UserDetails
 */
public class UserDetailsBean implements UserDetails {

    /**
     * å°è£…ç”¨æˆ·ä¿¡æ¯
     */
    private User user;

    /**
     * å°è£…ç”¨æˆ·æƒé™ä¿¡æ¯
     */
    private List&lt;String&gt; authorityList;
    
    private List&lt;SimpleGrantedAuthority&gt; authorities;

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        // å†™æ³•ä¸€ï¼š
//        List&lt;SimpleGrantedAuthority&gt; authorities = authorities.stream().map(s -&gt; new SimpleGrantedAuthority(s)).collect(Collectors.toList());
        // å†™æ³•äºŒï¼š
        authorities = authorityList.stream().map(SimpleGrantedAuthority::new).collect(Collectors.toList());
        // å†™æ³•ä¸‰ï¼š
//        Collection&lt;SimpleGrantedAuthority&gt; authorities = null;
//        for (String s : authorities) {
//            authorities.add(new SimpleGrantedAuthority(s));
//        }
        return authorities;
    }

    @Override
    public String getPassword() {
        return user.getPassword();
    }

    @Override
    public String getUsername() {
        return user.getUserName();
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return user.getStatus().equals(&quot;0&quot;);
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    public List&lt;String&gt; getAuthorityList() {
        return authorityList;
    }

    public void setAuthorityList(List&lt;String&gt; authorityList) {
        this.authorityList = authorityList;
    }

    public void setAuthorities(List&lt;SimpleGrantedAuthority&gt; authorities) {
        this.authorities = authorities;
    }

    public UserDetailsBean() {
    }

    public UserDetailsBean(User user, List&lt;String&gt; authorityList) {
        this.user = user;
        this.authorityList = authorityList;
    }

}
</code></pre>
<h5 id="2-ä¿®æ”¹userdetailsserviceimpl">â‘¡ ä¿®æ”¹UserDetailsServiceImpl</h5>
<ul>
<li>TODO</li>
</ul>
<pre><code class="language-java">@Service
@RequiredArgsConstructor
public class UserDetailsServiceImpl implements UserDetailsService {

    private final UserMapper userMapper;

    /**
     * ä»æ•°æ®åº“ä¸­æŸ¥å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œ
     * ä¾› AuthenticationProvider è¿›è¡Œå¯†ç æ¯”å¯¹
     *
     * @param username ç”± AuthenticationProvider æä¾›ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ä¼ å…¥çš„username
     * @return
     * @throws UsernameNotFoundException
     */
    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        // 1ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
        LambdaQueryWrapper&lt;User&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();
        queryWrapper.eq(User::getUserName, username);
        User user = userMapper.selectOne(queryWrapper);
        // 2ã€å¦‚æœæŸ¥è¯¢ä¸åˆ°æ•°æ®å°±é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ç»™å‡ºæç¤º
        if (null == user) {
            throw new UsernameNotFoundException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;);
        }
        //TODO 3ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æƒé™ä¿¡æ¯ï¼Œå°†å…¶æ·»åŠ åˆ° UserDetailsBean ä¸­çš„ authorities
        List&lt;String&gt; list = Arrays.asList(&quot;ROLE_USER&quot;, &quot;ROLE_ADMIN&quot;);
        // 4ã€å°†æŸ¥å‡ºçš„ç”¨æˆ·ä¿¡æ¯ï¼Œæƒé™ä¿¡æ¯ï¼Œå°è£…æˆUserDetailsï¼ˆUserDetailsBeanï¼‰å¯¹è±¡è¿”å›
        return new UserDetailsBean(user,list);
    }
}
</code></pre>
<h5 id="3-ä¿®æ”¹jwtauthenticationtokenfilter">â‘¢ ä¿®æ”¹JwtAuthenticationTokenFilter</h5>
<ul>
<li>TODO</li>
</ul>
<pre><code class="language-java">@Component
@RequiredArgsConstructor
public class JwtAuthenticationTokenFilter extends OncePerRequestFilter {

    private final RedisCache redisCache;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
        //è·å–token
        String token = request.getHeader(&quot;token&quot;);
        //åˆ¤æ–­tokenæ˜¯å¦éç©º
        if (StringUtils.isEmpty(token)) {
            //ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ”¾è¡Œï¼Œè¯·æ±‚ä¼šå»ä¸‹ä¸€ä¸ªç™»å½•æ¥å£
            filterChain.doFilter(request, response);
            return;
        }
        //ä¸ä¸ºç©ºï¼Œåˆ™è§£ætokenè·å–userid
        String userId;
        try {
            Claims jwt = JwtUtils.parseJWT(token);
            userId = jwt.getSubject();
        } catch (Exception e) {
            //è§£æå¤±è´¥ï¼Œæç¤ºtokenéæ³•
            request.getRequestDispatcher(&quot;/jwtFilterException/&quot; + &quot;Tokenéæ³•&quot;).forward(request, response);
            filterChain.doFilter(request, response);
            return;
        }
        //è§£ææˆåŠŸï¼Œé€šè¿‡useridä»Redisç¼“å­˜ä¸­è·å– UserDetailsBean
        UserDetailsBean userDetailsBean = redisCache.getCacheObject(&quot;login:&quot; + userId);
        //è·å–ä¸äº†ï¼Œæç¤ºä¼šè¯å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•
        if (null == userDetailsBean) {
            //è§£æå¤±è´¥ï¼Œæç¤ºtokenéæ³•
            request.getRequestDispatcher(&quot;/jwtFilterException/&quot; + &quot;ä¼šè¯å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•&quot;).forward(request, response);
            filterChain.doFilter(request, response);
            return;
        }
        //è·å–çš„äº†ï¼Œå°† UserDetailsBean å°è£…æˆ authentication å¯¹è±¡ï¼Œæ˜¾å¼åœ°ä¸ºç”¨æˆ·å»æ³¨å†Œèº«ä»½è®¤è¯
        // TODO: å°†æƒé™ä¿¡æ¯å°è£…è¿› authentication å¯¹è±¡
        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetailsBean, null, userDetailsBean.getAuthorities());
        SecurityContextHolder.getContext().setAuthentication(authentication);
        //æ”¾è¡Œ
        filterChain.doFilter(request, response);
    }

}
</code></pre>
<h5 id="4-æµ‹è¯•">â‘£ æµ‹è¯•</h5>
<ul>
<li>ä½¿ç”¨ Postman è¿›è¡Œæµ‹è¯•</li>
</ul>
<h4 id="323-ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯">3.2.3 ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯</h4>
<h5 id="3231-rbacæƒé™æ¨¡å‹">3.2.3.1 RBACæƒé™æ¨¡å‹</h5>
<p>RBACæƒé™æ¨¡å‹ï¼ˆRole-Based Access Controlï¼‰</p>
<p>å³ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚è¿™æ˜¯ç›®å‰æœ€å¸¸è¢«å¼€å‘è€…ä½¿ç”¨ä¹Ÿæ˜¯ç›¸å¯¹æ˜“ç”¨ã€é€šç”¨æƒé™æ¨¡å‹ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220818201512.png" alt="" loading="lazy"></figure>
<h5 id="3232-å‡†å¤‡å·¥ä½œ">3.2.3.2 å‡†å¤‡å·¥ä½œ</h5>
<pre><code class="language-sql">CREATE DATABASE /*!32312 IF NOT EXISTS*/`sg_security` /*!40100 DEFAULT CHARACTER SET utf8mb4 */;

USE `sg_security`;

/*Table structure for table `sys_menu` */

DROP TABLE IF EXISTS `sys_menu`;

CREATE TABLE `sys_menu` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `menu_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT 'èœå•å',
  `path` varchar(200) DEFAULT NULL COMMENT 'è·¯ç”±åœ°å€',
  `component` varchar(255) DEFAULT NULL COMMENT 'ç»„ä»¶è·¯å¾„',
  `visible` char(1) DEFAULT '0' COMMENT 'èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰',
  `status` char(1) DEFAULT '0' COMMENT 'èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  `perms` varchar(100) DEFAULT NULL COMMENT 'æƒé™æ ‡è¯†',
  `icon` varchar(100) DEFAULT '#' COMMENT 'èœå•å›¾æ ‡',
  `create_by` bigint(20) DEFAULT NULL,
  `create_time` datetime DEFAULT NULL,
  `update_by` bigint(20) DEFAULT NULL,
  `update_time` datetime DEFAULT NULL,
  `del_flag` int(11) DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰',
  `remark` varchar(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='èœå•è¡¨';

/*Table structure for table `sys_role` */

DROP TABLE IF EXISTS `sys_role`;

CREATE TABLE `sys_role` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `name` varchar(128) DEFAULT NULL,
  `role_key` varchar(100) DEFAULT NULL COMMENT 'è§’è‰²æƒé™å­—ç¬¦ä¸²',
  `status` char(1) DEFAULT '0' COMMENT 'è§’è‰²çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  `del_flag` int(1) DEFAULT '0' COMMENT 'del_flag',
  `create_by` bigint(200) DEFAULT NULL,
  `create_time` datetime DEFAULT NULL,
  `update_by` bigint(200) DEFAULT NULL,
  `update_time` datetime DEFAULT NULL,
  `remark` varchar(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²è¡¨';

/*Table structure for table `sys_role_menu` */

DROP TABLE IF EXISTS `sys_role_menu`;

CREATE TABLE `sys_role_menu` (
  `role_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT 'è§’è‰²ID',
  `menu_id` bigint(200) NOT NULL DEFAULT '0' COMMENT 'èœå•id',
  PRIMARY KEY (`role_id`,`menu_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;

/*Table structure for table `sys_user` */

DROP TABLE IF EXISTS `sys_user`;

CREATE TABLE `sys_user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `user_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT 'ç”¨æˆ·å',
  `nick_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT 'æ˜µç§°',
  `password` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT 'å¯†ç ',
  `status` char(1) DEFAULT '0' COMMENT 'è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  `email` varchar(64) DEFAULT NULL COMMENT 'é‚®ç®±',
  `phonenumber` varchar(32) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `sex` char(1) DEFAULT NULL COMMENT 'ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰',
  `avatar` varchar(128) DEFAULT NULL COMMENT 'å¤´åƒ',
  `user_type` char(1) NOT NULL DEFAULT '1' COMMENT 'ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰',
  `create_by` bigint(20) DEFAULT NULL COMMENT 'åˆ›å»ºäººçš„ç”¨æˆ·id',
  `create_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` bigint(20) DEFAULT NULL COMMENT 'æ›´æ–°äºº',
  `update_time` datetime DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `del_flag` int(11) DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';

/*Table structure for table `sys_user_role` */

DROP TABLE IF EXISTS `sys_user_role`;

CREATE TABLE `sys_user_role` (
  `user_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·id',
  `role_id` bigint(200) NOT NULL DEFAULT '0' COMMENT 'è§’è‰²id',
  PRIMARY KEY (`user_id`,`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

</code></pre>
<pre><code class="language-mysql">SELECT 
	DISTINCT m.`perms`
FROM
	sys_user_role ur
	LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id`
	LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`
	LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`
WHERE
	user_id = 2
	AND r.`status` = 0
	AND m.`status` = 0
</code></pre>
<pre><code class="language-java">package com.sangeng.domain;

import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import com.fasterxml.jackson.annotation.JsonInclude;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.io.Serializable;
import java.util.Date;

/**
 * èœå•è¡¨(Menu)å®ä½“ç±»
 *
 * @author makejava
 * @since 2021-11-24 15:30:08
 */
@TableName(value=&quot;sys_menu&quot;)
@Data
@AllArgsConstructor
@NoArgsConstructor
@JsonInclude(JsonInclude.Include.NON_NULL)
public class Menu implements Serializable {
    private static final long serialVersionUID = -54979041104113736L;
    
    private Long id;
    /**
    * èœå•å
    */
    private String menuName;
    /**
    * è·¯ç”±åœ°å€
    */
    private String path;
    /**
    * ç»„ä»¶è·¯å¾„
    */
    private String component;
    /**
    * èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰
    */
    private String visible;
    /**
    * èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰
    */
    private String status;
    /**
    * æƒé™æ ‡è¯†
    */
    private String perms;
    /**
    * èœå•å›¾æ ‡
    */
    private String icon;
    
    private Long createBy;
    
    private Date createTime;
    
    private Long updateBy;
    
    private Date updateTime;
    /**
    * æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰
    */
    @TableLogic
    private Integer delFlag;
    /**
    * å¤‡æ³¨
    */
    private String remark;
}
</code></pre>
<h5 id="3233-ä»£ç å®ç°">3.2.3.3 ä»£ç å®ç°</h5>
<ul>
<li>æˆ‘ä»¬åªéœ€è¦æ ¹æ®ç”¨æˆ· id å»æŸ¥è¯¢åˆ°å…¶æ‰€å¯¹åº”çš„æƒé™ä¿¡æ¯å³å¯ã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸ª mapper ï¼Œå…¶ä¸­æä¾›ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ® userid æŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚</p>
<pre><code class="language-java">import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.sangeng.domain.Menu;

import java.util.List;

/**
 * @Author ä¸‰æ›´  Bç«™ï¼š https://space.bilibili.com/663528522
 */
public interface MenuMapper extends BaseMapper&lt;Menu&gt; {
    List&lt;String&gt; selectPermsByUserId(@Param(&quot;id&quot;) Long id);
}
</code></pre>
<ul>
<li>å¤šè¡¨è”æŸ¥ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºå¯¹åº”çš„ mapper æ˜ å°„æ–‡ä»¶ï¼Œå®šä¹‰å¯¹åº”çš„sqlè¯­å¥</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;
&lt;mapper namespace=&quot;com.sangeng.mapper.MenuMapper&quot;&gt;

    &lt;select id=&quot;selectPermsByUserId&quot; resultType=&quot;java.lang.String&quot;&gt;
        SELECT
            DISTINCT m.`perms`
        FROM
            sys_user_role ur
            LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id`
            LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`
            LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`
        WHERE
            user_id = #{id}
            AND r.`status` = 0
            AND m.`status` = 0
    &lt;/select&gt;
  
&lt;/mapper&gt;
</code></pre>
<ul>
<li>åœ¨ application.yml ä¸­é…ç½® mapper æ˜ å°„æ–‡ä»¶çš„ä½ç½®</li>
</ul>
<pre><code class="language-yaml">spring:
  datasource:
    url: jdbc:mysql://localhost:3306/sg_security?characterEncoding=utf-8&amp;serverTimezone=UTC
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
  redis:
    host: localhost
    port: 6379
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml 

</code></pre>
<ul>
<li>ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ UserDetailsServiceImpl ä¸­å»è°ƒç”¨è¯¥ mapper çš„æ–¹æ³•</li>
<li>å°†æŸ¥è¯¢çš„æƒé™ä¿¡æ¯å°è£…åˆ° UserDetailsBean å¯¹è±¡ä¸­å³å¯ã€‚</li>
</ul>
<pre><code class="language-java">@Service
@RequiredArgsConstructor
public class UserDetailsServiceImpl implements UserDetailsService {

    private final UserMapper userMapper;

    /**
     * ä»æ•°æ®åº“ä¸­æŸ¥å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œ
     * ä¾› AuthenticationProvider è¿›è¡Œå¯†ç æ¯”å¯¹
     *
     * @param username ç”± AuthenticationProvider æä¾›ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ä¼ å…¥çš„username
     * @return
     * @throws UsernameNotFoundException
     */
    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        // 1ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
        LambdaQueryWrapper&lt;User&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();
        queryWrapper.eq(User::getUserName, username);
        User user = userMapper.selectOne(queryWrapper);
        // 2ã€å¦‚æœæŸ¥è¯¢ä¸åˆ°æ•°æ®å°±é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ç»™å‡ºæç¤º
        if (null == user) {
            throw new UsernameNotFoundException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;);
        }
        // 3ã€æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æƒé™ä¿¡æ¯ï¼Œå°†å…¶æ·»åŠ åˆ° UserDetailsBean ä¸­çš„ authorities
        List&lt;String&gt; list = userMapper.selectPermsByUserId(user.getId());
        // 4ã€å°†æŸ¥å‡ºçš„ç”¨æˆ·ä¿¡æ¯ï¼Œæƒé™ä¿¡æ¯ï¼Œå°è£…æˆUserDetailsï¼ˆUserDetailsBeanï¼‰å¯¹è±¡è¿”å›
        return new UserDetailsBean(user,list);
    }
}
</code></pre>
<h2 id="4-è‡ªå®šä¹‰å¤±è´¥å¤„ç†">4ã€è‡ªå®šä¹‰å¤±è´¥å¤„ç†</h2>
<ul>
<li>
<p>æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨è®¤è¯å¤±è´¥æˆ–è€…æ˜¯æˆæƒå¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å’Œæˆ‘ä»¬çš„æ¥å£ä¸€æ ·è¿”å›ç›¸åŒç»“æ„çš„jsonï¼Œè¿™æ ·å¯ä»¥è®©å‰ç«¯èƒ½å¯¹å“åº”è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ã€‚è¦å®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦çŸ¥é“SpringSecurityçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</p>
</li>
<li>
<p>åœ¨SpringSecurityä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨<mark>è®¤è¯</mark>æˆ–è€…<mark>æˆæƒ</mark>çš„è¿‡ç¨‹ä¸­å‡ºç°äº†<mark>å¼‚å¸¸</mark>ä¼šè¢«<mark>ExceptionTranslationFilter</mark>æ•è·åˆ°ã€‚åœ¨ExceptionTranslationFilterä¸­ä¼šå»åˆ¤æ–­æ˜¯è®¤è¯å¤±è´¥è¿˜æ˜¯æˆæƒå¤±è´¥å‡ºç°çš„å¼‚å¸¸ã€‚</p>
</li>
<li>
<p>å¦‚æœæ˜¯<mark>è®¤è¯</mark>è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAuthenticationExceptionç„¶åè°ƒç”¨<mark>AuthenticationEntryPoint</mark>å¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p>
</li>
<li>
<p>å¦‚æœæ˜¯<mark>æˆæƒ</mark>è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAccessDeniedExceptionç„¶åè°ƒç”¨<mark>AccessDeniedHandler</mark>å¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p>
</li>
<li>
<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰AuthenticationEntryPointå’ŒAccessDeniedHandlerç„¶åé…ç½®ç»™SpringSecurityå³å¯ã€‚</p>
</li>
</ul>
<h3 id="1-è‡ªå®šä¹‰å®ç°ç±»">â‘  è‡ªå®šä¹‰å®ç°ç±»</h3>
<p>1ï¼‰è‡ªå®šä¹‰æˆæƒå¼‚å¸¸å¤„ç†</p>
<pre><code class="language-java">@Component
public class AccessDeniedHandlerImpl implements AccessDeniedHandler {

    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException {
        Result&lt;Object&gt; result = Result.error(HttpStatus.FORBIDDEN.value(), accessDeniedException.getMessage());
        String json = JSON.toJSONString(result);
        WebUtils.renderString(response,json);
    }

}
</code></pre>
<p>2ï¼‰è‡ªå®šä¹‰è®¤è¯å¼‚å¸¸å¤„ç†</p>
<pre><code class="language-java">/**
 * @Author ä¸‰æ›´  Bç«™ï¼š https://space.bilibili.com/663528522
 */
@Component
public class AuthenticationEntryPointImpl implements AuthenticationEntryPoint {
    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {
        ResponseResult result = new ResponseResult(HttpStatus.UNAUTHORIZED.value(), &quot;è®¤è¯å¤±è´¥è¯·é‡æ–°ç™»å½•&quot;);
        String json = JSON.toJSONString(result);
        WebUtils.renderString(response,json);
    }
}
</code></pre>
<h3 id="2-é…ç½®ç»™-springsecurity">â‘¡ é…ç½®ç»™ SpringSecurity</h3>
<ul>
<li>å…ˆæ³¨å…¥å¯¹åº”çš„å¤„ç†å™¨</li>
</ul>
<pre><code class="language-java">@Autowired
private AuthenticationEntryPoint authenticationEntryPoint;

@Autowired
private AccessDeniedHandler accessDeniedHandler;
</code></pre>
<ul>
<li>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨HttpSecurityå¯¹è±¡çš„æ–¹æ³•å»é…ç½®ã€‚</li>
</ul>
<pre><code class="language-java">// é…ç½®è‡ªå®šä¹‰çš„è®¤è¯å’Œæˆæƒå¼‚å¸¸å¤„ç†ç±»
http.exceptionHandling().authenticationEntryPoint(authenticationEntryPoint).
        accessDeniedHandler(accessDeniedHandler);
</code></pre>
<h2 id="5-è·¨åŸŸ">5ã€è·¨åŸŸ</h2>
<ul>
<li>
<p>æµè§ˆå™¨å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼Œä½¿ç”¨ XMLHttpRequestå¯¹è±¡å‘èµ· HTTPè¯·æ±‚æ—¶å¿…é¡»éµå®ˆåŒæºç­–ç•¥ï¼Œå¦åˆ™å°±æ˜¯è·¨åŸŸçš„HTTPè¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è¢«ç¦æ­¢çš„ã€‚</p>
</li>
<li>
<p>åŒæºç­–ç•¥è¦æ±‚æºç›¸åŒæ‰èƒ½æ­£å¸¸è¿›è¡Œé€šä¿¡ï¼Œå³<mark>åè®®</mark>ã€<mark>åŸŸå</mark>ã€<mark>ç«¯å£å·</mark>éƒ½å®Œå…¨ä¸€è‡´ã€‚</p>
</li>
<li>
<p>å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå‰ç«¯é¡¹ç›®å’Œåç«¯é¡¹ç›®ä¸€èˆ¬éƒ½ä¸æ˜¯åŒæºçš„ï¼Œæ‰€ä»¥è‚¯å®šä¼šå­˜åœ¨è·¨åŸŸè¯·æ±‚çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p>æ‰€ä»¥æˆ‘ä»¬å°±è¦å¤„ç†ä¸€ä¸‹ï¼Œè®©å‰ç«¯èƒ½è¿›è¡Œè·¨åŸŸè¯·æ±‚ã€‚</p>
</li>
</ul>
<h3 id="1-é¦–å…ˆå¼€å¯-springmvc-çš„è·¨åŸŸè®¿é—®">â‘  é¦–å…ˆå¼€å¯ SpringMVC çš„è·¨åŸŸè®¿é—®</h3>
<pre><code class="language-java">@Configuration(proxyBeanMethods = false)
public class MvcConfiguration {

    /**
     * å¤„ç†CORS
     *
     * @return
     */
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping(&quot;/**&quot;)
                        .allowedOriginPatterns(&quot;http://localhost:*&quot;)
                        .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;)
                        .allowCredentials(true)//è®¾ç½®æ˜¯å¦å…è®¸å®¢æˆ·ç«¯è·¨åŸŸæºå¸¦éªŒè¯æ•°æ®ï¼Œå¦‚Cookieå€¼
                        .maxAge(3600);
            }
        };
    }

}
</code></pre>
<p>æˆ–</p>
<pre><code class="language-java">@Configuration
public class CorsConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
      // è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„
        registry.addMapping(&quot;/**&quot;)
                // è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå
                .allowedOriginPatterns(&quot;*&quot;)
                // æ˜¯å¦å…è®¸cookie
                .allowCredentials(true)
                // è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹å¼
                .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;DELETE&quot;, &quot;PUT&quot;)
                // è®¾ç½®å…è®¸çš„headerå±æ€§
                .allowedHeaders(&quot;*&quot;)
                // è·¨åŸŸå…è®¸æ—¶é—´
                .maxAge(3600);
    }
}
</code></pre>
<h3 id="2-å¼€å¯-springsecurity-çš„è·¨åŸŸè®¿é—®">â‘¡ å¼€å¯ SpringSecurity çš„è·¨åŸŸè®¿é—®</h3>
<p>ç”±äºæˆ‘ä»¬çš„èµ„æºéƒ½ä¼šæ”¶åˆ°SpringSecurityçš„ä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³è¦è·¨åŸŸè®¿é—®è¿˜è¦è®©SpringSecurityè¿è¡Œè·¨åŸŸè®¿é—®ã€‚</p>
<pre><code class="language-java">// å…è®¸è·¨åŸŸ
http.cors();
</code></pre>
<h2 id="6-é—ç•™å°é—®é¢˜">6ã€é—ç•™å°é—®é¢˜</h2>
<h3 id="61-å…¶å®ƒæƒé™æ ¡éªŒæ–¹æ³•">6.1 å…¶å®ƒæƒé™æ ¡éªŒæ–¹æ³•</h3>
<p>æˆ‘ä»¬å‰é¢éƒ½æ˜¯ä½¿ç”¨@PreAuthorizeæ³¨è§£ï¼Œç„¶ååœ¨åœ¨å…¶ä¸­ä½¿ç”¨çš„æ˜¯hasAuthorityæ–¹æ³•è¿›è¡Œæ ¡éªŒã€‚SpringSecurityè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å…¶å®ƒæ–¹æ³•ä¾‹å¦‚ï¼šhasAnyAuthorityï¼ŒhasRoleï¼ŒhasAnyRoleç­‰ã€‚</p>
<hr>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆä¸æ€¥ç€å»ä»‹ç»è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå»ç†è§£hasAuthorityçš„åŸç†ï¼Œç„¶åå†å»å­¦ä¹ å…¶ä»–æ–¹æ³•ä½ å°±æ›´å®¹æ˜“ç†è§£ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒåŒºåˆ«ã€‚å¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å®šä¹‰æ ¡éªŒæ–¹æ³•ï¼Œå®ç°æˆ‘ä»¬è‡ªå·±çš„æ ¡éªŒé€»è¾‘ã€‚</p>
<p>hasAuthorityæ–¹æ³•å®é™…æ˜¯æ‰§è¡Œåˆ°äº†SecurityExpressionRootçš„hasAuthorityï¼Œå¤§å®¶åªè¦æ–­ç‚¹è°ƒè¯•æ—¢å¯çŸ¥é“å®ƒå†…éƒ¨çš„æ ¡éªŒåŸç†ã€‚</p>
<p>å®ƒå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨authenticationçš„getAuthoritiesæ–¹æ³•è·å–ç”¨æˆ·çš„æƒé™åˆ—è¡¨ã€‚ç„¶ååˆ¤æ–­æˆ‘ä»¬å­˜å…¥çš„æ–¹æ³•å‚æ•°æ•°æ®åœ¨æƒé™åˆ—è¡¨ä¸­ã€‚</p>
<hr>
<ul>
<li><mark>hasAnyAuthority</mark>æ–¹æ³•å¯ä»¥ä¼ å…¥å¤šä¸ªæƒé™ï¼Œåªæœ‰ç”¨æˆ·æœ‰å…¶ä¸­ä»»æ„ä¸€ä¸ªæƒé™éƒ½å¯ä»¥è®¿é—®å¯¹åº”èµ„æºã€‚</li>
</ul>
<pre><code class="language-java">    @PreAuthorize(&quot;hasAnyAuthority('admin','test','system:dept:list')&quot;)
    public String hello(){
        return &quot;hello&quot;;
    }
</code></pre>
<ul>
<li><mark>hasRole</mark>è¦æ±‚æœ‰å¯¹åº”çš„è§’è‰²æ‰å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å®ƒå†…éƒ¨ä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š <mark>ROLE_</mark> åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰<strong>ROLE_</strong> è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚</li>
</ul>
<pre><code class="language-java">    @PreAuthorize(&quot;hasRole('system:dept:list')&quot;)
    public String hello(){
        return &quot;hello&quot;;
    }
</code></pre>
<ul>
<li><mark>hasAnyRole</mark> æœ‰<mark>Any</mark>ä»»æ„çš„è§’è‰²å°±å¯ä»¥è®¿é—®ã€‚å®ƒå†…éƒ¨ä¹Ÿä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š<mark>ROLE_</mark> åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰ <strong>ROLE_</strong> è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚</li>
</ul>
<pre><code class="language-java">    @PreAuthorize(&quot;hasAnyRole('admin','system:dept:list')&quot;)
    public String hello(){
        return &quot;hello&quot;;
    }
</code></pre>
<h3 id="62-è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•">6.2 è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•</h3>
<ul>
<li>æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æƒé™æ ¡éªŒæ–¹æ³•ï¼Œåœ¨ @PreAuthorize æ³¨è§£ä¸­ä½¿ç”¨æˆ‘ä»¬çš„æ–¹æ³•ã€‚</li>
</ul>
<pre><code class="language-java">@Component(&quot;ex&quot;)
public class SGExpressionRoot {

    public boolean hasAuthority(String authority){
        //è·å–å½“å‰ç”¨æˆ·çš„æƒé™
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        LoginUser loginUser = (LoginUser) authentication.getPrincipal();
        List&lt;String&gt; authorities = loginUser.getAuthorities();
        //åˆ¤æ–­ç”¨æˆ·æƒé™é›†åˆä¸­æ˜¯å¦å­˜åœ¨authority
        return authorities.contains(authority);
    }
}
</code></pre>
<ul>
<li>åœ¨ SPEL è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨ @ex ç›¸å½“äºè·å–å®¹å™¨ä¸­ bean çš„åå­—æœªexçš„å¯¹è±¡ã€‚ç„¶åå†è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ hasAuthority æ–¹æ³•</li>
</ul>
<pre><code class="language-java">@RequestMapping(&quot;/hello&quot;)
@PreAuthorize(&quot;@ex.hasAuthority('system:dept:list')&quot;)
public String hello(){
    return &quot;hello&quot;;
}
</code></pre>
<h3 id="63-åŸºäºé…ç½®çš„æƒé™æ§åˆ¶">6.3 åŸºäºé…ç½®çš„æƒé™æ§åˆ¶</h3>
<ul>
<li>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ä½¿ç”¨é…ç½®çš„æ–¹å¼å¯¹èµ„æºè¿›è¡Œæƒé™æ§åˆ¶ã€‚</li>
</ul>
<pre><code class="language-java">@Override
protected void configure(HttpSecurity http) throws Exception {
    http
            //å…³é—­csrf
            .csrf().disable()
            //ä¸é€šè¿‡Sessionè·å–SecurityContext
            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and()
            .authorizeRequests()
            // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®
            .antMatchers(&quot;/user/login&quot;).anonymous()
            .antMatchers(&quot;/testCors&quot;).hasAuthority(&quot;system:dept:list222&quot;)
            // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯
            .anyRequest().authenticated();

    //æ·»åŠ è¿‡æ»¤å™¨
    http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);

    //é…ç½®å¼‚å¸¸å¤„ç†å™¨
    http.exceptionHandling()
            //é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨
            .authenticationEntryPoint(authenticationEntryPoint)
            .accessDeniedHandler(accessDeniedHandler);

    //å…è®¸è·¨åŸŸ
    http.cors();
}
</code></pre>
<h3 id="64-csrf">6.4 CSRF</h3>
<pre><code>CSRFæ˜¯æŒ‡è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼‰ï¼Œæ˜¯webå¸¸è§çš„æ”»å‡»ä¹‹ä¸€ã€‚

https://blog.csdn.net/freeking101/article/details/86537087

SpringSecurityå»é˜²æ­¢CSRFæ”»å‡»çš„æ–¹å¼å°±æ˜¯é€šè¿‡csrf_tokenã€‚åç«¯ä¼šç”Ÿæˆä¸€ä¸ªcsrf_tokenï¼Œå‰ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™éœ€è¦æºå¸¦è¿™ä¸ªcsrf_token,åç«¯ä¼šæœ‰è¿‡æ»¤å™¨è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰æºå¸¦æˆ–è€…æ˜¯ä¼ªé€ çš„å°±ä¸å…è®¸è®¿é—®ã€‚

æˆ‘ä»¬å¯ä»¥å‘ç°CSRFæ”»å‡»ä¾é çš„æ˜¯cookieä¸­æ‰€æºå¸¦çš„è®¤è¯ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­æˆ‘ä»¬çš„è®¤è¯ä¿¡æ¯å…¶å®æ˜¯tokenï¼Œè€Œtokenå¹¶ä¸æ˜¯å­˜å‚¨ä¸­cookieä¸­ï¼Œå¹¶ä¸”éœ€è¦å‰ç«¯ä»£ç å»æŠŠtokenè®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­æ‰å¯ä»¥ï¼Œæ‰€ä»¥CSRFæ”»å‡»ä¹Ÿå°±ä¸ç”¨æ‹…å¿ƒäº†ã€‚
</code></pre>
<h3 id="65-è®¤è¯æˆåŠŸå¤„ç†å™¨">6.5 è®¤è¯æˆåŠŸå¤„ç†å™¨</h3>
<ul>
<li>
<p>å®é™…ä¸Šåœ¨UsernamePasswordAuthenticationFilterè¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœç™»å½•æˆåŠŸäº†æ˜¯ä¼šè°ƒç”¨AuthenticationSuccessHandlerçš„æ–¹æ³•è¿›è¡Œè®¤è¯æˆåŠŸåçš„å¤„ç†çš„ã€‚AuthenticationSuccessHandlerå°±æ˜¯ç™»å½•æˆåŠŸå¤„ç†å™¨ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰æˆåŠŸå¤„ç†å™¨è¿›è¡ŒæˆåŠŸåçš„ç›¸åº”å¤„ç†ã€‚</p>
</li>
</ul>
<pre><code class="language-java">@Component
public class SGSuccessHandler implements AuthenticationSuccessHandler {

    @Override
    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {
        System.out.println(&quot;è®¤è¯æˆåŠŸäº†&quot;);
    }
}

</code></pre>
<pre><code class="language-java">@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private AuthenticationSuccessHandler successHandler;

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin().successHandler(successHandler);

        http.authorizeRequests().anyRequest().authenticated();
    }
}
</code></pre>
<h3 id="66-è®¤è¯å¤±è´¥å¤„ç†å™¨">6.6 è®¤è¯å¤±è´¥å¤„ç†å™¨</h3>
<ul>
<li>
<p>å®é™…ä¸Šåœ¨UsernamePasswordAuthenticationFilterè¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœè®¤è¯å¤±è´¥äº†æ˜¯ä¼šè°ƒç”¨AuthenticationFailureHandlerçš„æ–¹æ³•è¿›è¡Œè®¤è¯å¤±è´¥åçš„å¤„ç†çš„ã€‚AuthenticationFailureHandlerå°±æ˜¯ç™»å½•å¤±è´¥å¤„ç†å™¨ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰å¤±è´¥å¤„ç†å™¨è¿›è¡Œå¤±è´¥åçš„ç›¸åº”å¤„ç†ã€‚</p>
</li>
</ul>
<pre><code class="language-java">@Component
public class SGFailureHandler implements AuthenticationFailureHandler {
    @Override
    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException {
        System.out.println(&quot;è®¤è¯å¤±è´¥äº†&quot;);
    }
}
</code></pre>
<pre><code class="language-java">@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private AuthenticationSuccessHandler successHandler;

    @Autowired
    private AuthenticationFailureHandler failureHandler;

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()
                //é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨
                .successHandler(successHandler)
                //é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨
                .failureHandler(failureHandler);

        http.authorizeRequests().anyRequest().authenticated();
    }
}

</code></pre>
<h3 id="67-ç™»å‡ºæˆåŠŸå¤„ç†å™¨">6.7 ç™»å‡ºæˆåŠŸå¤„ç†å™¨</h3>
<pre><code class="language-java">@Component
public class SGLogoutSuccessHandler implements LogoutSuccessHandler {
    @Override
    public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {
        System.out.println(&quot;æ³¨é”€æˆåŠŸ&quot;);
    }
}

</code></pre>
<pre><code class="language-java">@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private AuthenticationSuccessHandler successHandler;

    @Autowired
    private AuthenticationFailureHandler failureHandler;

    @Autowired
    private LogoutSuccessHandler logoutSuccessHandler;

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()
                //é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨
                .successHandler(successHandler)
                //é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨
                .failureHandler(failureHandler);

        http.logout()
                //é…ç½®æ³¨é”€æˆåŠŸå¤„ç†å™¨
                .logoutSuccessHandler(logoutSuccessHandler);

        http.authorizeRequests().anyRequest().authenticated();
    }
}
</code></pre>
<h3 id="68-å…¶ä»–è®¤è¯æ–¹æ¡ˆç•…æƒ³">6.8 å…¶ä»–è®¤è¯æ–¹æ¡ˆç•…æƒ³</h3>
<ul>
<li>......</li>
</ul>
<h1 id="oauth-2">OAuth 2</h1>
<h2 id="å¼€å§‹">å¼€å§‹</h2>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[POIä¸EasyExcelç¬”è®°]]></title>
        <id>https://kuangyang828.github.io/poi-yu-easyexcel-bi-ji/</id>
        <link href="https://kuangyang828.github.io/poi-yu-easyexcel-bi-ji/">
        </link>
        <updated>2022-08-13T07:23:05.000Z</updated>
        <content type="html"><![CDATA[<h1 id="poiä¸easyexcel">POIä¸EasyExcel</h1>
<h2 id="poi">POI</h2>
<p>Apache POIä¸ºJavaç¨‹åºæä¾›APIï¼Œæ¥æ”¯æŒMicrosoft Officeæ ¼å¼æ¡£æ¡ˆè¯»å’Œå†™çš„åŠŸèƒ½ã€‚</p>
<p><code>HSSF</code> ï¼ æä¾›è¯»å†™ Microsoft Excel <code>XLS</code>æ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ã€‚<code>Excel2003</code></p>
<p><code>XSSF</code> ï¼ æä¾›è¯»å†™Microsoft Excel OOXML <code>XLSX</code>æ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ã€‚<code>Excel2007+</code></p>
<p><mark>S</mark>XSSF ï¼ XSSFçš„åŠ å¼ºç‰ˆï¼Œé‡‡ç”¨ç¼“å­˜æœºåˆ¶ï¼Œå¯ä»¥å†™éå¸¸å¤§çš„æ•°æ®é‡ï¼Œå¦‚ 100ä¸‡ æ¡ç”šè‡³æ›´å¤šï¼Œå†™æ•°æ®é€Ÿåº¦å¿«ï¼Œå ç”¨æ›´å°‘çš„å†…å­˜</p>
<p>HWPF ï¼ æä¾›è¯»å†™[Microsoft Word[DOC]æ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ã€‚</p>
<p>HSLF ï¼ æä¾›è¯»å†™Microsoft PowerPointæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ã€‚</p>
<p>HDGF ï¼ æä¾›è¯»å†™Microsoft Visioæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ã€‚</p>
<p>HPBF ï¼ æä¾›è¯»å†™Microsoft Publisheræ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ã€‚</p>
<p>HSMF ï¼ æä¾›è¯»å†™Microsoft Outlookæ ¼å¼æ¡£æ¡ˆçš„åŠŸèƒ½ã€‚</p>
<ul>
<li>å…¶ä¸­Excel2003æ–‡ä»¶æœ€å¤šå­˜å‚¨65536è¡Œæ•°æ®ï¼ŒExcel2007+åˆ™æ²¡æœ‰é™åˆ¶</li>
</ul>
<h2 id="easyexcel">EasyExcel</h2>
<ul>
<li>EasyExcelæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„å¿«é€Ÿã€ç®€æ´ã€<mark>è§£å†³å¤§æ–‡ä»¶å†…å­˜æº¢å‡º</mark>çš„javaå¤„ç†Excelå·¥å…·</li>
<li>https://github.com/alibaba/easyexcel</li>
<li>POIå­˜åœ¨å†…å­˜æ³„éœ²çš„ä¸»è¦åŸå› æ˜¯ï¼Œåœ¨æ“ä½œè¿‡ç¨‹ä¸­å®ƒæ˜¯å°†æ‰€æœ‰æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œå†ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜ã€‚å½“ç„¶ä¹Ÿæœ‰ä¼˜ç‚¹ï¼Œé€Ÿåº¦å¿«ã€‚</li>
<li>EasyExcelæ˜¯ä¸€è¡Œä¸€è¡Œçš„è¯»å†™ï¼Œç”¨è¿™æ ·çš„æ–¹å¼è§£å†³äº†å†…å­˜å ç”¨é«˜ç”šè‡³æº¢å‡ºçš„é—®é¢˜ã€‚</li>
</ul>
<h1 id="poi-excelå†™">POI-Excelå†™</h1>
<p>1ã€åˆ›å»ºMavené¡¹ç›®</p>
<p>2ã€æ·»åŠ ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependencies&gt;
    &lt;!--xls(03)--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
        &lt;artifactId&gt;poi&lt;/artifactId&gt;
        &lt;version&gt;3.9&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--xlsx(07)--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
        &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
        &lt;version&gt;3.9&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--æ—¥æœŸæ ¼å¼åŒ–å·¥å…·--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;joda-time&lt;/groupId&gt;
        &lt;artifactId&gt;joda-time&lt;/artifactId&gt;
        &lt;version&gt;2.10.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--junit--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>3ã€ç¼–å†™æµ‹è¯•ç±»</p>
<pre><code class="language-java">public class ExcelWrite {
 
    private String PATH=&quot;F:\\ideaProject\\study\\&quot;;
 
    @Test
    public void write03() throws IOException {
        // 1ã€åˆ›å»ºå·¥ä½œè–„
        Workbook workbook = new HSSFWorkbook();
        //2ã€åˆ›å»ºå·¥ä½œè¡¨
        Sheet sheet = workbook.createSheet(&quot;test1&quot;);
 
        //3ã€åˆ›å»ºè¡Œ(0:ç¬¬ä¸€è¡Œ)
        Row row1 = sheet.createRow(0);
        //4ã€åˆ›å»ºå•å…ƒæ ¼(0:ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªæ ¼å­)
        Cell cell00 = row1.createCell(0);
        cell00.setCellValue(&quot;æµ‹è¯•æ•°æ®&quot;);
        //ç¬¬ä¸€è¡Œçš„ç¬¬äºŒä¸ªæ ¼å­
        Cell cell01 = row1.createCell(1);
        cell01.setCellValue(&quot;testData&quot;);
 
        //ç¬¬äºŒè¡Œ
        Row row2 = sheet.createRow(1);
        //ç¬¬äºŒè¡Œçš„ç¬¬ä¸€ä¸ªæ ¼å­
        Cell cell10 = row2.createCell(0);
        cell10.setCellValue(&quot;æ—¶é—´&quot;);
        //ç¬¬äºŒè¡Œçš„ç¬¬äºŒä¸ªæ ¼å­
        Cell cell11 = row2.createCell(1);
        cell11.setCellValue(new DateTime().toString(&quot;yyyy-MM-dd HH:mm:ss&quot;));
 
        //ç”ŸæˆExcelï¼ˆIOæµï¼‰
        //03ç‰ˆæœ¬çš„Excelæ˜¯ä½¿ç”¨ .xls ç»“å°¾ï¼ï¼ï¼
        FileOutputStream fileOutputStream = new FileOutputStream(PATH + &quot;POI03æµ‹è¯•.xls&quot;);
 
        workbook.write(fileOutputStream);
 
        //å…³é—­æµ
        fileOutputStream.close();
 
        System.out.println(&quot;03Excelè¾“å‡ºå®Œæ¯•&quot;);
    }
 
    @Test
    public void write07() throws IOException {
        // 1ã€åˆ›å»ºå·¥ä½œè–„
        Workbook workbook = new XSSFWorkbook();
        //2ã€åˆ›å»ºå·¥ä½œè¡¨
        Sheet sheet = workbook.createSheet(&quot;test1&quot;);
 
        //3ã€åˆ›å»ºè¡Œ(0:ç¬¬ä¸€è¡Œ)
        Row row1 = sheet.createRow(0);
        //4ã€åˆ›å»ºå•å…ƒæ ¼(0:ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªæ ¼å­)
        Cell cell00 = row1.createCell(0);
        cell00.setCellValue(&quot;æµ‹è¯•æ•°æ®&quot;);
        //ç¬¬ä¸€è¡Œçš„ç¬¬äºŒä¸ªæ ¼å­
        Cell cell01 = row1.createCell(1);
        cell01.setCellValue(&quot;testData&quot;);
 
        //ç¬¬äºŒè¡Œ
        Row row2 = sheet.createRow(1);
        //ç¬¬äºŒè¡Œçš„ç¬¬ä¸€ä¸ªæ ¼å­
        Cell cell10 = row2.createCell(0);
        cell10.setCellValue(&quot;æ—¶é—´&quot;);
        //ç¬¬äºŒè¡Œçš„ç¬¬äºŒä¸ªæ ¼å­
        Cell cell11 = row2.createCell(1);
        cell11.setCellValue(new DateTime().toString(&quot;yyyy-MM-dd HH:mm:ss&quot;));
 
        //ç”ŸæˆExcelï¼ˆIOæµï¼‰
        //03ç‰ˆæœ¬çš„Excelæ˜¯ä½¿ç”¨ .xlsx ç»“å°¾ï¼ï¼ï¼
        FileOutputStream fileOutputStream = new FileOutputStream(PATH + &quot;POI07æµ‹è¯•.xlsx&quot;);
 
        workbook.write(fileOutputStream);
 
        //å…³é—­æµ
        fileOutputStream.close();
 
        System.out.println(&quot;07Excelè¾“å‡ºå®Œæ¯•&quot;);
    }
}
</code></pre>
<p>æ³¨æ„ï¼ŒExcelæ–‡ä»¶åç¼€ä¸å¯¹åº”çš„å¯¹è±¡</p>
<table>
<thead>
<tr>
<th>Excelç‰ˆæœ¬</th>
<th>æ–‡ä»¶åç¼€</th>
<th>å¯¹åº”çš„å¯¹è±¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>2003</td>
<td>xls</td>
<td>HSSF</td>
</tr>
<tr>
<td>2007</td>
<td>xlsx</td>
<td>XSSF / SXSSF</td>
</tr>
</tbody>
</table>
<h2 id="hssf">HSSF</h2>
<pre><code class="language-java">@Test
public void write03BigData() throws IOException {
    long begin = System.currentTimeMillis();
 
    //åˆ›å»ºç°¿
    Workbook workbook = new HSSFWorkbook();
    //åˆ›å»ºè¡¨
    Sheet sheet = workbook.createSheet();
    //å†™æ•°æ®
    for (int rowNum = 0; rowNum &lt; 65536; rowNum++) {
        Row row = sheet.createRow(rowNum);
        for (int cellNum = 0; cellNum &lt; 10; cellNum++) {
            Cell cell = row.createCell(cellNum);
            cell.setCellValue(cellNum);
        }
    }
    System.out.println(&quot;over&quot;);
    FileOutputStream fileOutputStream = new FileOutputStream(PATH + &quot;TestWrite03BigData.xls&quot;);
    workbook.write(fileOutputStream);
    fileOutputStream.close();
 
    long end = System.currentTimeMillis();
 
    System.out.println((double) (end-begin)/1000);
}
</code></pre>
<ul>
<li>ä¼˜ç‚¹ï¼šå†™å…¥è¿‡ç¨‹ä¸­å…ˆå†™å…¥å†…å­˜ï¼Œä¸æ“ä½œç£ç›˜ï¼Œæœ€åä¸€æ¬¡æ€§å†™å…¥ç£ç›˜ï¼Œé€Ÿåº¦å¿«</li>
<li>ç¼ºç‚¹ï¼šæœ€å¤šåªèƒ½å¤„ç† <mark>65536</mark> è¡Œï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</li>
<li><mark>java.lang.IllegalArgumentException: Invalid row number (65536) outside allowable range (0..65535)</mark></li>
</ul>
<h2 id="xssf">XSSF</h2>
<pre><code class="language-xml">@Test
public void write07BigData() throws IOException {
    long begin = System.currentTimeMillis();
 
    //åˆ›å»ºç°¿
    Workbook workbook = new XSSFWorkbook();
    //åˆ›å»ºè¡¨
    Sheet sheet = workbook.createSheet();
    //å†™æ•°æ®
    for (int rowNum = 0; rowNum &lt; 100000; rowNum++) {
        Row row = sheet.createRow(rowNum);
        for (int cellNum = 0; cellNum &lt; 10; cellNum++) {
            Cell cell = row.createCell(cellNum);
            cell.setCellValue(cellNum);
        }
    }
    System.out.println(&quot;over&quot;);
    FileOutputStream fileOutputStream = new FileOutputStream(PATH + &quot;TestWrite07BigData.xlsx&quot;);
    workbook.write(fileOutputStream);
    fileOutputStream.close();
 
    long end = System.currentTimeMillis();
 
    System.out.println((double) (end-begin)/1000);
}
</code></pre>
<ul>
<li>ä¼˜ç‚¹ï¼šå› ä¸ºXSSFæ˜¯å¯¹åº”Excel2007ç‰ˆæœ¬ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å†™è¾ƒå¤§çš„æ•°æ®é‡ï¼Œå¦‚ 20ä¸‡æ¡</li>
<li>ç¼ºç‚¹ï¼šå› ä¸ºPOIçš„<code>ä¸€æ¬¡æ€§</code>æœºåˆ¶ï¼Œå†™æ•°æ®æ—¶é€Ÿåº¦éå¸¸æ…¢ï¼Œéå¸¸è€—å†…å­˜ï¼Œä¹Ÿä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºï¼Œå¦‚ 100ä¸‡æ¡</li>
</ul>
<h2 id="sxssf">SXSSF</h2>
<pre><code class="language-java">@Test
public void write07BigDataS() throws IOException {
    long begin = System.currentTimeMillis();
 
    //åˆ›å»ºç°¿
    Workbook workbook = new SXSSFWorkbook();
    //åˆ›å»ºè¡¨
    Sheet sheet = workbook.createSheet();
    //å†™æ•°æ®
    for (int rowNum = 0; rowNum &lt; 100000; rowNum++) {
        Row row = sheet.createRow(rowNum);
        for (int cellNum = 0; cellNum &lt; 10; cellNum++) {
            Cell cell = row.createCell(cellNum);
            cell.setCellValue(cellNum);
        }
    }
    System.out.println(&quot;over&quot;);
    FileOutputStream fileOutputStream = new FileOutputStream(PATH + &quot;TestWrite07BigDataS.xlsx&quot;);
    workbook.write(fileOutputStream);
    fileOutputStream.close();
  
    //åˆ é™¤ä¸´æ—¶æ–‡ä»¶
    ((SXSSFWorkbook) workbook).dispose();
 
    long end = System.currentTimeMillis();
    System.out.println((double) (end-begin)/1000);
}
</code></pre>
<ul>
<li>ä¼˜ç‚¹ï¼šé‡‡ç”¨ç¼“å­˜æœºåˆ¶ï¼Œå¯ä»¥å†™éå¸¸å¤§çš„æ•°æ®é‡ï¼Œå¦‚ 100ä¸‡ æ¡ç”šè‡³æ›´å¤šï¼Œå†™æ•°æ®é€Ÿåº¦å¿«ï¼Œå ç”¨æ›´å°‘çš„å†…å­˜</li>
<li>å¯ä»¥ä½¿ç”¨<mark>dispose</mark>( )æ–¹æ³•åˆ é™¤ä¸´æ—¶æ–‡ä»¶</li>
<li>é»˜è®¤ç”± 100 æ¡è®°å½•è¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœè¶…è¿‡è¿™æ•°é‡ï¼Œåˆ™æœ€å‰é¢çš„æ•°æ®è¢«å†™å…¥ä¸´æ—¶æ–‡ä»¶</li>
<li>å¦‚æœæƒ³è‡ªå®šä¹‰<mark>å†…å­˜ä¸­æ•°æ®çš„æ•°é‡</mark>ï¼Œå¯ä»¥ä½¿ç”¨<mark>æœ‰å‚æ„é€ å™¨</mark>ã€‚new SXSSFWorkbook(amount)</li>
</ul>
<blockquote>
<p>SXSSFWorkbook å®˜æ–¹è§£é‡Šï¼š</p>
<ul>
<li>
<p>å®ç°â€œBigGridDemoâ€ç­–ç•¥çš„æµå¼XSSFWorkbookç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p>è¿™å…è®¸å†™å…¥éå¸¸å¤§çš„æ–‡ä»¶è€Œä¸ä¼šè€—å°½å†…å­˜ï¼Œå› ä¸ºä»»ä½•æ—¶å€™åªæœ‰å¯é…ç½®çš„è¡Œéƒ¨åˆ†è¢«ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚</p>
</li>
</ul>
<p>Butï¼Œ</p>
<ul>
<li>è¯·æ³¨æ„ï¼Œä»ç„¶å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ï¼Œ</li>
<li>è¿™äº›å†…å­˜åŸºäºæ­£åœ¨ä½¿ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åˆå¹¶åŒºåŸŸï¼Œæ³¨é‡Š...ä»ç„¶åªå­˜å‚¨åœ¨å†…å­˜ä¸­</li>
<li>å› æ­¤å¦‚æœå¹¿æ³›ä½¿ç”¨ï¼Œå¯èƒ½éœ€è¦å¤§é‡å†…å­˜ã€‚</li>
</ul>
</blockquote>
<h1 id="poi-excelè¯»">POI-Excelè¯»</h1>
<h2 id="hssf-2">HSSF</h2>
<pre><code class="language-java">@Test
public void testRead03() throws IOException {
    //è·å–æ–‡ä»¶æµ
    FileInputStream fileInputStream = new FileInputStream(PATH + &quot;POIPOI03æµ‹è¯•.xls&quot;);
 
    //1ã€è·å–å·¥ä½œç°¿
    Workbook workbook = new HSSFWorkbook(fileInputStream);
    //2ã€å¾—åˆ°è¡¨
    Sheet sheet = workbook.getSheetAt(0);
    //3ã€å¾—åˆ°è¡Œ
    Row row = sheet.getRow(0);
    //4ã€å¾—åˆ°åˆ—
    Cell cell = row.getCell(0);
 
    //è¯»å–å€¼æ—¶ä¸€å®šè¦æ³¨æ„ç±»å‹
    System.out.println(cell.getStringCellValue());
 
    fileInputStream.close();
}
</code></pre>
<p>==æ³¨æ„ï¼š==è¯»å–å€¼æ—¶ä¸€å®šè¦æ³¨æ„ç±»å‹ï¼Œç±»å‹é€‰æ‹©ä¸åŒ¹é…ä¼šæŠ¥é”™</p>
<h2 id="xssf-2">XSSF</h2>
<pre><code class="language-java">@Test
public void testRead07() throws IOException {
    //è·å–æ–‡ä»¶æµ
    FileInputStream fileInputStream = new FileInputStream(PATH + &quot;POIPOI07æµ‹è¯•.xlsx&quot;);
 
    //1ã€è·å–å·¥ä½œç°¿
    Workbook workbook = new XSSFWorkbook(fileInputStream);
    //2ã€å¾—åˆ°è¡¨
    Sheet sheet = workbook.getSheetAt(0);
    //3ã€å¾—åˆ°è¡Œ
    Row row = sheet.getRow(0);
    //4ã€å¾—åˆ°åˆ—
    Cell cell = row.getCell(0);
 
    //è¯»å–å€¼æ—¶ä¸€å®šè¦æ³¨æ„ç±»å‹
    System.out.println(cell.getStringCellValue());
 
    fileInputStream.close();
}
</code></pre>
<h2 id="è¯»å–ä¸åŒçš„æ•°æ®ç±»å‹">è¯»å–ä¸åŒçš„æ•°æ®ç±»å‹</h2>
<pre><code class="language-java">@Test
public void testCellType() throws Exception {
    //è·å–æ–‡ä»¶
    FileInputStream fileInputStream = new FileInputStream(PATH + &quot;ä¼šå‘˜æ¶ˆè´¹å•†å“æ˜ç»†è¡¨.xls&quot;);
 
    //è·å–å·¥ä½œè–„
    Workbook workbook = new HSSFWorkbook(fileInputStream);
    //å¾—åˆ°è¡¨
    Sheet sheet = workbook.getSheetAt(0);
 
    //è·å–æ ‡é¢˜å†…å®¹
    Row rowTitle = sheet.getRow(0);
    if (rowTitle != null){
        //è·å–ä¸€è¡Œä¸­æœ‰å¤šå°‘ä¸ªå•å…ƒæ ¼
        int cellCount = rowTitle.getPhysicalNumberOfCells();
        for (int cellNum = 0; cellNum &lt; cellCount; cellNum++) {
            //è·å–å•å…ƒ
            Cell cell = rowTitle.getCell(cellNum);
            if (cell != null){
                //è·å–ç±»å‹
                int cellType = cell.getCellType();
                String cellValue = cell.getStringCellValue();
                System.out.print(cellValue + &quot; | &quot;);
            }
        }
        System.out.println();
    }
 
    //è·å–è¡¨ä¸­çš„å†…å®¹
    int rowCount = sheet.getPhysicalNumberOfRows();
    for (int rowNum = 1; rowNum &lt; rowCount; rowNum++) {
        Row rowData = sheet.getRow(rowNum);
        if (rowData != null){
            //è¯»å–åˆ—
            int cellCout = rowTitle.getPhysicalNumberOfCells();
            for (int cellNum = 0; cellNum &lt; cellCout; cellNum++) {
                System.out.print(&quot;ã€&quot; + (rowNum+1) + &quot;-&quot; + (cellNum+1) + &quot;ã€‘&quot;);
              
                Cell cell = rowData.getCell(cellNum);
                //åŒ¹é…åˆ—çš„æ•°æ®ç±»å‹
                if (cell != null){
                    int cellType = cell.getCellType();
                    String cellValue = &quot;&quot;;
 
                    switch (cellType){
                        case HSSFCell.CELL_TYPE_STRING://å­—ç¬¦ä¸²
                            System.out.print(&quot;ã€STRINGã€‘&quot;);
                            cellValue = cell.getStringCellValue();
                            break;
                        case HSSFCell.CELL_TYPE_BOOLEAN://å¸ƒå°”å€¼
                            System.out.print(&quot;ã€BOOLEANã€‘&quot;);
                            cellValue = String.valueOf(cell.getBooleanCellValue());
                            break;
                        case HSSFCell.CELL_TYPE_NUMERIC://æ•°å­—ç±»å‹
                            System.out.print(&quot;ã€NUMERICã€‘&quot;);
 
                            if (HSSFDateUtil.isCellDateFormatted(cell)){//æ—¥æœŸ
                                System.out.print(&quot;ã€æ—¥æœŸã€‘&quot;);
                                Date date = cell.getDateCellValue();
                                cellValue = new DateTime().toString(&quot;yyyy-MM-dd&quot;);
                            }else{
                                // ä¸æ˜¯æ—¥æœŸæ ¼å¼ï¼Œåˆ™é˜²æ­¢å½“æ•°å­—è¿‡é•¿æ—¶ä»¥ç§‘å­¦è®¡æ•°æ³•æ˜¾ç¤º
                                System.out.print(&quot;ã€è½¬æ¢æˆå­—ç¬¦ä¸²ã€‘&quot;);
                                cell.setCellType(HSSFCell.CELL_TYPE_STRING);
                                cellValue = cell.toString();
                            }
                            break;
                        case HSSFCell.CELL_TYPE_BLANK://ç©º
                            System.out.print(&quot;ã€BLANKã€‘&quot;);
                            break;
                        case Cell.CELL_TYPE_ERROR:
                            System.out.print(&quot;ã€æ•°æ®ç±»å‹é”™è¯¯ã€‘&quot;);
                            break;
                    }
                    System.out.println(cellValue);
                }
            }
        }
    }
    fileInputStream.close();
}
</code></pre>
<h2 id="è¯»è®¡ç®—å…¬å¼">è¯»è®¡ç®—å…¬å¼</h2>
<pre><code class="language-java">@Test
public void testFormula() throws Exception {
    FileInputStream fileInputStream = new FileInputStream(PATH + &quot;è®¡ç®—å…¬å¼.xls&quot;);
    Workbook workbook = new HSSFWorkbook(fileInputStream);
    Sheet sheetAt = workbook.getSheetAt(0);
 
    //è·å–è®¡ç®—å…¬å¼æ‰€åœ¨çš„è¡Œ
    Row row = sheetAt.getRow(4);
    //è®¡ç®—å…¬å¼çš„ç¬¬å‡ ä¸ªå•å…ƒæ ¼
    Cell cell = row.getCell(0);
 
    //æ‹¿åˆ°è®¡ç®—å…¬å¼
    FormulaEvaluator formulaEvaluator = new HSSFFormulaEvaluator((HSSFWorkbook) workbook);
 
    //è¾“å‡ºå•å…ƒæ ¼å†…å®¹
    int cellType = cell.getCellType();
    switch (cellType){
        case Cell.CELL_TYPE_FORMULA://å…¬å¼
            //è·å–å•å…ƒæ ¼çš„è®¡ç®—å…¬å¼
            String formula = cell.getCellFormula();
            System.out.println(formula);
 
            //è®¡ç®—
            CellValue evaluate = formulaEvaluator.evaluate(cell);
            String cellValue = evaluate.formatAsString();
            System.out.println(cellValue);
            break;
    }
}
</code></pre>
<h1 id="easyexcelæ“ä½œ">EasyExcelæ“ä½œ</h1>
<ul>
<li>EasyExcelæ“ä½œå‚ç…§å®˜æ–¹å¿«é€Ÿå¼€å§‹å³å¯</li>
<li>https://github.com/alibaba/easyexcel</li>
</ul>
<h2 id="å†™å…¥">å†™å…¥</h2>
<ul>
<li>æŒ‰å›ºå®šç±»æ ¼å¼è¿›è¡Œå†™å…¥</li>
</ul>
<h2 id="è¯»å–">è¯»å–</h2>
<ul>
<li>æ ¹æ®ç›‘å¬å™¨è®¾ç½®çš„è§„åˆ™è¿›è¡Œè¯»å–</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue3å¿«é€Ÿä¸Šæ‰‹ç¬”è®°]]></title>
        <id>https://kuangyang828.github.io/vue3-kuai-su-shang-shou-bi-ji/</id>
        <link href="https://kuangyang828.github.io/vue3-kuai-su-shang-shou-bi-ji/">
        </link>
        <updated>2022-08-11T08:54:15.000Z</updated>
        <content type="html"><![CDATA[<h1 id="vue3å¿«é€Ÿä¸Šæ‰‹">Vue3å¿«é€Ÿä¸Šæ‰‹</h1>
<img src="https://user-images.githubusercontent.com/499550/93624428-53932780-f9ae-11ea-8d16-af949e16a09f.png" style="width:200px" />
<h2 id="1vue3ç®€ä»‹">1.Vue3ç®€ä»‹</h2>
<ul>
<li>2020å¹´9æœˆ18æ—¥ï¼ŒVue.jså‘å¸ƒ3.0ç‰ˆæœ¬ï¼Œä»£å·ï¼šOne Pieceï¼ˆæµ·è´¼ç‹ï¼‰</li>
<li>è€—æ—¶2å¹´å¤šã€<a href="https://github.com/vuejs/vue-next/graphs/commit-activity">2600+æ¬¡æäº¤</a>ã€<a href="https://github.com/vuejs/rfcs/tree/master/active-rfcs">30+ä¸ªRFC</a>ã€<a href="https://github.com/vuejs/vue-next/pulls?q=is%3Apr+is%3Amerged+-author%3Aapp%2Fdependabot-preview+">600+æ¬¡PR</a>ã€<a href="https://github.com/vuejs/vue-next/graphs/contributors">99ä½è´¡çŒ®è€…</a></li>
<li>githubä¸Šçš„tagsåœ°å€ï¼šhttps://github.com/vuejs/vue-next/releases/tag/v3.0.0</li>
</ul>
<h2 id="2vue3å¸¦æ¥äº†ä»€ä¹ˆ">2.Vue3å¸¦æ¥äº†ä»€ä¹ˆ</h2>
<h3 id="1æ€§èƒ½çš„æå‡">1.æ€§èƒ½çš„æå‡</h3>
<ul>
<li>
<p>æ‰“åŒ…å¤§å°å‡å°‘41%</p>
</li>
<li>
<p>åˆæ¬¡æ¸²æŸ“å¿«55%, æ›´æ–°æ¸²æŸ“å¿«133%</p>
</li>
<li>
<p>å†…å­˜å‡å°‘54%</p>
<p>......</p>
</li>
</ul>
<h3 id="2æºç çš„å‡çº§">2.æºç çš„å‡çº§</h3>
<ul>
<li>
<p>ä½¿ç”¨Proxyä»£æ›¿definePropertyå®ç°å“åº”å¼</p>
</li>
<li>
<p>é‡å†™è™šæ‹ŸDOMçš„å®ç°å’ŒTree-Shaking</p>
<p>......</p>
</li>
</ul>
<h3 id="3æ‹¥æŠ±typescript">3.æ‹¥æŠ±TypeScript</h3>
<ul>
<li>Vue3å¯ä»¥æ›´å¥½çš„æ”¯æŒTypeScript</li>
</ul>
<h3 id="4æ–°çš„ç‰¹æ€§">4.æ–°çš„ç‰¹æ€§</h3>
<ol>
<li>
<p>Composition APIï¼ˆç»„åˆAPIï¼‰</p>
<ul>
<li>setupé…ç½®</li>
<li>refä¸reactive</li>
<li>watchä¸watchEffect</li>
<li>provideä¸inject</li>
<li>......</li>
</ul>
</li>
<li>
<p>æ–°çš„å†…ç½®ç»„ä»¶</p>
<ul>
<li>Fragment</li>
<li>Teleport</li>
<li>Suspense</li>
</ul>
</li>
<li>
<p>å…¶ä»–æ”¹å˜</p>
<ul>
<li>æ–°çš„ç”Ÿå‘½å‘¨æœŸé’©å­</li>
<li>data é€‰é¡¹åº”å§‹ç»ˆè¢«å£°æ˜ä¸ºä¸€ä¸ªå‡½æ•°</li>
<li>ç§»é™¤keyCodeæ”¯æŒä½œä¸º v-on çš„ä¿®é¥°ç¬¦</li>
<li>......</li>
</ul>
</li>
</ol>
<h1 id="ä¸€-åˆ›å»ºvue30å·¥ç¨‹">ä¸€ã€åˆ›å»ºVue3.0å·¥ç¨‹</h1>
<h2 id="1ä½¿ç”¨-vue-cli-åˆ›å»º">1.ä½¿ç”¨ vue-cli åˆ›å»º</h2>
<p>å®˜æ–¹æ–‡æ¡£ï¼šhttps://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</p>
<pre><code class="language-bash">## æŸ¥çœ‹@vue/cliç‰ˆæœ¬ï¼Œç¡®ä¿@vue/cliç‰ˆæœ¬åœ¨4.5.0ä»¥ä¸Š
vue --version
## å®‰è£…æˆ–è€…å‡çº§ä½ çš„@vue/cli
npm install -g @vue/cli
## åˆ›å»º
vue create vue_test
## å¯åŠ¨
cd vue_test
npm run serve
</code></pre>
<h2 id="2ä½¿ç”¨-vite-åˆ›å»º">2.ä½¿ç”¨ vite åˆ›å»º</h2>
<p>å®˜æ–¹æ–‡æ¡£ï¼šhttps://v3.cn.vuejs.org/guide/installation.html#vite</p>
<p>viteå®˜ç½‘ï¼šhttps://vitejs.cn</p>
<ul>
<li>ä»€ä¹ˆæ˜¯viteï¼Ÿâ€”â€” æ–°ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·ã€‚</li>
<li>ä¼˜åŠ¿å¦‚ä¸‹ï¼š
<ul>
<li>å¼€å‘ç¯å¢ƒä¸­ï¼Œæ— éœ€æ‰“åŒ…æ“ä½œï¼Œå¯å¿«é€Ÿçš„å†·å¯åŠ¨ã€‚</li>
<li>è½»é‡å¿«é€Ÿçš„çƒ­é‡è½½ï¼ˆHMRï¼‰ã€‚</li>
<li>çœŸæ­£çš„æŒ‰éœ€ç¼–è¯‘ï¼Œä¸å†ç­‰å¾…æ•´ä¸ªåº”ç”¨ç¼–è¯‘å®Œæˆã€‚</li>
</ul>
</li>
<li>ä¼ ç»Ÿæ„å»º ä¸ viteæ„å»ºå¯¹æ¯”å›¾</li>
</ul>
<p><img src="https://cn.vitejs.dev/assets/bundler.37740380.png" style="width:500px;height:280px;float:left" /><img src="https://cn.vitejs.dev/assets/esm.3070012d.png" style="width:480px;height:280px" /></p>
<pre><code class="language-bash">## åˆ›å»ºå·¥ç¨‹
npm init vite-app &lt;project-name&gt;
## è¿›å…¥å·¥ç¨‹ç›®å½•
cd &lt;project-name&gt;
## å®‰è£…ä¾èµ–
npm install
## è¿è¡Œ
npm run dev
</code></pre>
<h1 id="äºŒ-å¸¸ç”¨-composition-api">äºŒã€å¸¸ç”¨ Composition API</h1>
<p>å®˜æ–¹æ–‡æ¡£: https://v3.cn.vuejs.org/guide/composition-api-introduction.html</p>
<h2 id="1æ‹‰å¼€åºå¹•çš„setup">1.æ‹‰å¼€åºå¹•çš„setup</h2>
<ol>
<li>ç†è§£ï¼šVue3.0ä¸­ä¸€ä¸ªæ–°çš„é…ç½®é¡¹ï¼Œå€¼ä¸ºä¸€ä¸ªå‡½æ•°ã€‚</li>
<li>setupæ˜¯æ‰€æœ‰<strong style="color:#DD5145">Composition APIï¼ˆç»„åˆAPIï¼‰</strong><i style="color:gray;font-weight:bold">â€œ è¡¨æ¼”çš„èˆå° â€</i>ã€‚</li>
<li>ç»„ä»¶ä¸­æ‰€ç”¨åˆ°çš„ï¼šæ•°æ®ã€æ–¹æ³•ç­‰ç­‰ï¼Œå‡è¦é…ç½®åœ¨setupä¸­ã€‚</li>
<li>setupå‡½æ•°çš„ä¸¤ç§è¿”å›å€¼ï¼š
<ol>
<li>è‹¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å¯¹è±¡ä¸­çš„å±æ€§ã€æ–¹æ³•, åœ¨æ¨¡æ¿ä¸­å‡å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ï¼ˆé‡ç‚¹å…³æ³¨ï¼ï¼‰</li>
<li><span style="color:#aad">è‹¥è¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼šåˆ™å¯ä»¥è‡ªå®šä¹‰æ¸²æŸ“å†…å®¹ã€‚ï¼ˆäº†è§£ï¼‰</span></li>
</ol>
</li>
<li>æ³¨æ„ç‚¹ï¼š
<ol>
<li>å°½é‡ä¸è¦ä¸Vue2.xé…ç½®æ··ç”¨
<ul>
<li>Vue2.xé…ç½®ï¼ˆdataã€methosã€computed...ï¼‰ä¸­<strong style="color:#DD5145">å¯ä»¥è®¿é—®åˆ°</strong>setupä¸­çš„å±æ€§ã€æ–¹æ³•ã€‚</li>
<li>ä½†åœ¨setupä¸­<strong style="color:#DD5145">ä¸èƒ½è®¿é—®åˆ°</strong>Vue2.xé…ç½®ï¼ˆdataã€methosã€computed...ï¼‰ã€‚</li>
<li>å¦‚æœæœ‰é‡å, setupä¼˜å…ˆã€‚</li>
</ul>
</li>
<li>setupä¸èƒ½æ˜¯ä¸€ä¸ªasyncå‡½æ•°ï¼Œå› ä¸ºè¿”å›å€¼ä¸å†æ˜¯returnçš„å¯¹è±¡, è€Œæ˜¯promise, æ¨¡æ¿çœ‹ä¸åˆ°returnå¯¹è±¡ä¸­çš„å±æ€§ã€‚ï¼ˆåæœŸä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªPromiseå®ä¾‹ï¼Œä½†éœ€è¦Suspenseå’Œå¼‚æ­¥ç»„ä»¶çš„é…åˆï¼‰</li>
</ol>
</li>
</ol>
<h2 id="2refå‡½æ•°">2.refå‡½æ•°</h2>
<ul>
<li>ä½œç”¨: å®šä¹‰ä¸€ä¸ªå“åº”å¼çš„æ•°æ®</li>
<li>è¯­æ³•: <code>const xxx = ref(initValue)</code>
<ul>
<li>åˆ›å»ºä¸€ä¸ªåŒ…å«å“åº”å¼æ•°æ®çš„<strong style="color:#DD5145">å¼•ç”¨å¯¹è±¡ï¼ˆreferenceå¯¹è±¡ï¼Œç®€ç§°refå¯¹è±¡ï¼‰</strong>ã€‚</li>
<li>JSä¸­æ“ä½œæ•°æ®ï¼š <code>xxx.value</code></li>
<li>æ¨¡æ¿ä¸­è¯»å–æ•°æ®: ä¸éœ€è¦.valueï¼Œç›´æ¥ï¼š<code>&lt;div&gt;{{xxx}}&lt;/div&gt;</code></li>
</ul>
</li>
<li>å¤‡æ³¨ï¼š
<ul>
<li>æ¥æ”¶çš„æ•°æ®å¯ä»¥æ˜¯ï¼šåŸºæœ¬ç±»å‹ã€ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ç±»å‹ã€‚</li>
<li>åŸºæœ¬ç±»å‹çš„æ•°æ®ï¼šå“åº”å¼ä¾ç„¶æ˜¯é <code>Object.defineProperty()</code>çš„<code>get</code>ä¸<code>set</code>å®Œæˆçš„ã€‚</li>
<li>å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼šå†…éƒ¨ <i style="color:gray;font-weight:bold">â€œ æ±‚åŠ© â€</i> äº†Vue3.0ä¸­çš„ä¸€ä¸ªæ–°å‡½æ•°â€”â€” <code>reactive</code>å‡½æ•°ã€‚</li>
</ul>
</li>
</ul>
<h2 id="3reactiveå‡½æ•°">3.reactiveå‡½æ•°</h2>
<ul>
<li>ä½œç”¨: å®šä¹‰ä¸€ä¸ª<strong style="color:#DD5145">å¯¹è±¡ç±»å‹</strong>çš„å“åº”å¼æ•°æ®ï¼ˆåŸºæœ¬ç±»å‹ä¸è¦ç”¨å®ƒï¼Œè¦ç”¨<code>ref</code>å‡½æ•°ï¼‰</li>
<li>è¯­æ³•ï¼š<code>const ä»£ç†å¯¹è±¡= reactive(æºå¯¹è±¡)</code>æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–æ•°ç»„ï¼‰ï¼Œè¿”å›ä¸€ä¸ª<strong style="color:#DD5145">ä»£ç†å¯¹è±¡ï¼ˆProxyçš„å®ä¾‹å¯¹è±¡ï¼Œç®€ç§°proxyå¯¹è±¡ï¼‰</strong></li>
<li>reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®æ˜¯â€œæ·±å±‚æ¬¡çš„â€ã€‚</li>
<li>å†…éƒ¨åŸºäº ES6 çš„ Proxy å®ç°ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡æ“ä½œæºå¯¹è±¡å†…éƒ¨æ•°æ®è¿›è¡Œæ“ä½œã€‚</li>
</ul>
<h2 id="4vue30ä¸­çš„å“åº”å¼åŸç†">4.Vue3.0ä¸­çš„å“åº”å¼åŸç†</h2>
<h3 id="vue2xçš„å“åº”å¼">vue2.xçš„å“åº”å¼</h3>
<ul>
<li>
<p>å®ç°åŸç†ï¼š</p>
<ul>
<li>
<p>å¯¹è±¡ç±»å‹ï¼šé€šè¿‡<code>Object.defineProperty()</code>å¯¹å±æ€§çš„è¯»å–ã€ä¿®æ”¹è¿›è¡Œæ‹¦æˆªï¼ˆæ•°æ®åŠ«æŒï¼‰ã€‚</p>
</li>
<li>
<p>æ•°ç»„ç±»å‹ï¼šé€šè¿‡é‡å†™æ›´æ–°æ•°ç»„çš„ä¸€ç³»åˆ—æ–¹æ³•æ¥å®ç°æ‹¦æˆªã€‚ï¼ˆå¯¹æ•°ç»„çš„å˜æ›´æ–¹æ³•è¿›è¡Œäº†åŒ…è£¹ï¼‰ã€‚</p>
<pre><code class="language-js">Object.defineProperty(data, 'count', {
    get () {}, 
    set () {}
})
</code></pre>
</li>
</ul>
</li>
<li>
<p>å­˜åœ¨é—®é¢˜ï¼š</p>
<ul>
<li>æ–°å¢å±æ€§ã€åˆ é™¤å±æ€§, ç•Œé¢ä¸ä¼šæ›´æ–°ã€‚</li>
<li>ç›´æ¥é€šè¿‡ä¸‹æ ‡ä¿®æ”¹æ•°ç»„, ç•Œé¢ä¸ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</li>
</ul>
</li>
</ul>
<h3 id="vue30çš„å“åº”å¼">Vue3.0çš„å“åº”å¼</h3>
<ul>
<li>å®ç°åŸç†:
<ul>
<li>é€šè¿‡Proxyï¼ˆä»£ç†ï¼‰:  æ‹¦æˆªå¯¹è±¡ä¸­ä»»æ„å±æ€§çš„å˜åŒ–, åŒ…æ‹¬ï¼šå±æ€§å€¼çš„è¯»å†™ã€å±æ€§çš„æ·»åŠ ã€å±æ€§çš„åˆ é™¤ç­‰ã€‚</li>
<li>é€šè¿‡Reflectï¼ˆåå°„ï¼‰:  å¯¹æºå¯¹è±¡çš„å±æ€§è¿›è¡Œæ“ä½œã€‚</li>
<li>MDNæ–‡æ¡£ä¸­æè¿°çš„Proxyä¸Reflectï¼š
<ul>
<li>
<p>Proxyï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</p>
</li>
<li>
<p>Reflectï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</p>
<pre><code class="language-js">new Proxy(data, {
	// æ‹¦æˆªè¯»å–å±æ€§å€¼
    get (target, prop) {
    	return Reflect.get(target, prop)
    },
    // æ‹¦æˆªè®¾ç½®å±æ€§å€¼æˆ–æ·»åŠ æ–°å±æ€§
    set (target, prop, value) {
    	return Reflect.set(target, prop, value)
    },
    // æ‹¦æˆªåˆ é™¤å±æ€§
    deleteProperty (target, prop) {
    	return Reflect.deleteProperty(target, prop)
    }
})

proxy.name = 'tom'   
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="5reactiveå¯¹æ¯”ref">5.reactiveå¯¹æ¯”ref</h2>
<ul>
<li>ä»å®šä¹‰æ•°æ®è§’åº¦å¯¹æ¯”ï¼š
<ul>
<li>refç”¨æ¥å®šä¹‰ï¼š<strong style="color:#DD5145">åŸºæœ¬ç±»å‹æ•°æ®</strong>ã€‚</li>
<li>reactiveç”¨æ¥å®šä¹‰ï¼š<strong style="color:#DD5145">å¯¹è±¡ï¼ˆæˆ–æ•°ç»„ï¼‰ç±»å‹æ•°æ®</strong>ã€‚</li>
<li>å¤‡æ³¨ï¼šrefä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰<strong style="color:#DD5145">å¯¹è±¡ï¼ˆæˆ–æ•°ç»„ï¼‰ç±»å‹æ•°æ®</strong>, å®ƒå†…éƒ¨ä¼šè‡ªåŠ¨é€šè¿‡<code>reactive</code>è½¬ä¸º<strong style="color:#DD5145">ä»£ç†å¯¹è±¡</strong>ã€‚</li>
</ul>
</li>
<li>ä»åŸç†è§’åº¦å¯¹æ¯”ï¼š
<ul>
<li>refé€šè¿‡<code>Object.defineProperty()</code>çš„<code>get</code>ä¸<code>set</code>æ¥å®ç°å“åº”å¼ï¼ˆæ•°æ®åŠ«æŒï¼‰ã€‚</li>
<li>reactiveé€šè¿‡ä½¿ç”¨<strong style="color:#DD5145">Proxy</strong>æ¥å®ç°å“åº”å¼ï¼ˆæ•°æ®åŠ«æŒï¼‰, å¹¶é€šè¿‡<strong style="color:#DD5145">Reflect</strong>æ“ä½œ<strong style="color:orange">æºå¯¹è±¡</strong>å†…éƒ¨çš„æ•°æ®ã€‚</li>
</ul>
</li>
<li>ä»ä½¿ç”¨è§’åº¦å¯¹æ¯”ï¼š
<ul>
<li>refå®šä¹‰çš„æ•°æ®ï¼šæ“ä½œæ•°æ®<strong style="color:#DD5145">éœ€è¦</strong><code>.value</code>ï¼Œè¯»å–æ•°æ®æ—¶æ¨¡æ¿ä¸­ç›´æ¥è¯»å–<strong style="color:#DD5145">ä¸éœ€è¦</strong><code>.value</code>ã€‚</li>
<li>reactiveå®šä¹‰çš„æ•°æ®ï¼šæ“ä½œæ•°æ®ä¸è¯»å–æ•°æ®ï¼š<strong style="color:#DD5145">å‡ä¸éœ€è¦</strong><code>.value</code>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="6setupçš„ä¸¤ä¸ªæ³¨æ„ç‚¹">6.setupçš„ä¸¤ä¸ªæ³¨æ„ç‚¹</h2>
<ul>
<li>
<p>setupæ‰§è¡Œçš„æ—¶æœº</p>
<ul>
<li>åœ¨beforeCreateä¹‹å‰æ‰§è¡Œä¸€æ¬¡ï¼Œthisæ˜¯undefinedã€‚</li>
</ul>
</li>
<li>
<p>setupçš„å‚æ•°</p>
<ul>
<li>propsï¼šå€¼ä¸ºå¯¹è±¡ï¼ŒåŒ…å«ï¼šç»„ä»¶å¤–éƒ¨ä¼ é€’è¿‡æ¥ï¼Œä¸”ç»„ä»¶å†…éƒ¨å£°æ˜æ¥æ”¶äº†çš„å±æ€§ã€‚</li>
<li>contextï¼šä¸Šä¸‹æ–‡å¯¹è±¡
<ul>
<li>attrs: å€¼ä¸ºå¯¹è±¡ï¼ŒåŒ…å«ï¼šç»„ä»¶å¤–éƒ¨ä¼ é€’è¿‡æ¥ï¼Œä½†æ²¡æœ‰åœ¨propsé…ç½®ä¸­å£°æ˜çš„å±æ€§, ç›¸å½“äº <code>this.$attrs</code>ã€‚</li>
<li>slots: æ”¶åˆ°çš„æ’æ§½å†…å®¹, ç›¸å½“äº <code>this.$slots</code>ã€‚</li>
<li>emit: åˆ†å‘è‡ªå®šä¹‰äº‹ä»¶çš„å‡½æ•°, ç›¸å½“äº <code>this.$emit</code>ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="7è®¡ç®—å±æ€§ä¸ç›‘è§†">7.è®¡ç®—å±æ€§ä¸ç›‘è§†</h2>
<h3 id="1computedå‡½æ•°">1.computedå‡½æ•°</h3>
<ul>
<li>
<p>ä¸Vue2.xä¸­computedé…ç½®åŠŸèƒ½ä¸€è‡´</p>
</li>
<li>
<p>å†™æ³•</p>
<pre><code class="language-js">import {computed} from 'vue'

setup(){
    ...
	//è®¡ç®—å±æ€§â€”â€”ç®€å†™
    let fullName = computed(()=&gt;{
        return person.firstName + '-' + person.lastName
    })
    //è®¡ç®—å±æ€§â€”â€”å®Œæ•´
    let fullName = computed({
        get(){
            return person.firstName + '-' + person.lastName
        },
        set(value){
            const nameArr = value.split('-')
            person.firstName = nameArr[0]
            person.lastName = nameArr[1]
        }
    })
}
</code></pre>
</li>
</ul>
<h3 id="2watchå‡½æ•°">2.watchå‡½æ•°</h3>
<ul>
<li>
<p>ä¸Vue2.xä¸­watché…ç½®åŠŸèƒ½ä¸€è‡´</p>
</li>
<li>
<p>ä¸¤ä¸ªå°â€œå‘â€ï¼š</p>
<ul>
<li>ç›‘è§†reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®æ—¶ï¼šoldValueæ— æ³•æ­£ç¡®è·å–ã€å¼ºåˆ¶å¼€å¯äº†æ·±åº¦ç›‘è§†ï¼ˆdeepé…ç½®å¤±æ•ˆï¼‰ã€‚</li>
<li>ç›‘è§†reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®ä¸­æŸä¸ªå±æ€§æ—¶ï¼šdeepé…ç½®æœ‰æ•ˆã€‚</li>
</ul>
<pre><code class="language-js">//æƒ…å†µä¸€ï¼šç›‘è§†refå®šä¹‰çš„å“åº”å¼æ•°æ®
watch(sum,(newValue,oldValue)=&gt;{
	console.log('sumå˜åŒ–äº†',newValue,oldValue)
},{immediate:true})

//æƒ…å†µäºŒï¼šç›‘è§†å¤šä¸ªrefå®šä¹‰çš„å“åº”å¼æ•°æ®
watch([sum,msg],(newValue,oldValue)=&gt;{
	console.log('sumæˆ–msgå˜åŒ–äº†',newValue,oldValue)
}) 

/* æƒ…å†µä¸‰ï¼šç›‘è§†reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®
			è‹¥watchç›‘è§†çš„æ˜¯reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®ï¼Œåˆ™æ— æ³•æ­£ç¡®è·å¾—oldValueï¼ï¼
			è‹¥watchç›‘è§†çš„æ˜¯reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®ï¼Œåˆ™å¼ºåˆ¶å¼€å¯äº†æ·±åº¦ç›‘è§† 
*/
watch(person,(newValue,oldValue)=&gt;{
	console.log('personå˜åŒ–äº†',newValue,oldValue)
},{immediate:true,deep:false}) //æ­¤å¤„çš„deepé…ç½®ä¸å†å¥æ•ˆ

//æƒ…å†µå››ï¼šç›‘è§†reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®ä¸­çš„æŸä¸ªå±æ€§
watch(()=&gt;person.job,(newValue,oldValue)=&gt;{
	console.log('personçš„jobå˜åŒ–äº†',newValue,oldValue)
},{immediate:true,deep:true}) 

//æƒ…å†µäº”ï¼šç›‘è§†reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®ä¸­çš„æŸäº›å±æ€§
watch([()=&gt;person.job,()=&gt;person.name],(newValue,oldValue)=&gt;{
	console.log('personçš„jobå˜åŒ–äº†',newValue,oldValue)
},{immediate:true,deep:true})

//ç‰¹æ®Šæƒ…å†µ
watch(()=&gt;person.job,(newValue,oldValue)=&gt;{
    console.log('personçš„jobå˜åŒ–äº†',newValue,oldValue)
},{deep:true}) //æ­¤å¤„ç”±äºç›‘è§†çš„æ˜¯reactiveç´ å®šä¹‰çš„å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§ï¼Œæ‰€ä»¥deepé…ç½®æœ‰æ•ˆ
</code></pre>
</li>
</ul>
<h3 id="3watcheffectå‡½æ•°">3.watchEffectå‡½æ•°</h3>
<ul>
<li>
<p>watchçš„å¥—è·¯æ˜¯ï¼šæ—¢è¦æŒ‡æ˜ç›‘è§†çš„å±æ€§ï¼Œä¹Ÿè¦æŒ‡æ˜ç›‘è§†çš„å›è°ƒã€‚</p>
</li>
<li>
<p>watchEffectçš„å¥—è·¯æ˜¯ï¼šä¸ç”¨æŒ‡æ˜ç›‘è§†å“ªä¸ªå±æ€§ï¼Œç›‘è§†çš„å›è°ƒä¸­ç”¨åˆ°å“ªä¸ªå±æ€§ï¼Œé‚£å°±ç›‘è§†å“ªä¸ªå±æ€§ã€‚</p>
</li>
<li>
<p>watchEffectæœ‰ç‚¹åƒcomputedï¼š</p>
<ul>
<li>ä½†computedæ³¨é‡çš„è®¡ç®—å‡ºæ¥çš„å€¼ï¼ˆå›è°ƒå‡½æ•°çš„è¿”å›å€¼ï¼‰ï¼Œæ‰€ä»¥å¿…é¡»è¦å†™è¿”å›å€¼ã€‚</li>
<li>è€ŒwatchEffectæ›´æ³¨é‡çš„æ˜¯è¿‡ç¨‹ï¼ˆå›è°ƒå‡½æ•°çš„å‡½æ•°ä½“ï¼‰ï¼Œæ‰€ä»¥ä¸ç”¨å†™è¿”å›å€¼ã€‚</li>
</ul>
<pre><code class="language-js">//watchEffectæ‰€æŒ‡å®šçš„å›è°ƒä¸­ç”¨åˆ°çš„æ•°æ®åªè¦å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ç›´æ¥é‡æ–°æ‰§è¡Œå›è°ƒã€‚
watchEffect(()=&gt;{
    const x1 = sum.value
    const x2 = person.age
    console.log('watchEffecté…ç½®çš„å›è°ƒæ‰§è¡Œäº†')
})
</code></pre>
</li>
</ul>
<h2 id="8ç”Ÿå‘½å‘¨æœŸ">8.ç”Ÿå‘½å‘¨æœŸ</h2>
<h3 id="vue2xçš„ç”Ÿå‘½å‘¨æœŸ">Vue2.xçš„ç”Ÿå‘½å‘¨æœŸ</h3>
<img src="https://v2.cn.vuejs.org/images/lifecycle.png" alt="img" style="zoom: 50%;" />
<h3 id="vue30çš„ç”Ÿå‘½å‘¨æœŸ">Vue3.0çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<img src="https://cn.vuejs.org/assets/lifecycle.16e4c08e.png" alt="img" style="zoom:50%;" />
<ul>
<li>Vue3.0ä¸­å¯ä»¥ç»§ç»­ä½¿ç”¨Vue2.xä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä½†æœ‰æœ‰ä¸¤ä¸ªè¢«æ›´åï¼š
<ul>
<li><code>beforeDestroy</code>æ”¹åä¸º <code>beforeUnmount</code></li>
<li><code>destroyed</code>æ”¹åä¸º <code>unmounted</code></li>
</ul>
</li>
<li>Vue3.0ä¹Ÿæä¾›äº† Composition API å½¢å¼çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¸Vue2.xä¸­é’©å­å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š
<ul>
<li><code>beforeCreate</code>===&gt;<code>setup()</code></li>
<li><code>created</code>===&gt;<code>setup()</code></li>
<li><code>beforeMount</code> ===&gt;<code>onBeforeMount</code></li>
<li><code>mounted</code>===&gt;<code>onMounted</code></li>
<li><code>beforeUpdate</code>===&gt;<code>onBeforeUpdate</code></li>
<li><code>updated</code> ===&gt;<code>onUpdated</code></li>
<li><code>beforeUnmount</code>Â ==&gt;<code>onBeforeUnmount</code></li>
<li><code>unmounted</code> ===&gt;<code>onUnmounted</code></li>
</ul>
</li>
</ul>
<h2 id="9è‡ªå®šä¹‰hookå‡½æ•°">9.è‡ªå®šä¹‰hookå‡½æ•°</h2>
<ul>
<li>
<p>ä»€ä¹ˆæ˜¯hookï¼Ÿâ€”â€” æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠsetupå‡½æ•°ä¸­ä½¿ç”¨çš„Composition APIè¿›è¡Œäº†å°è£…ã€‚</p>
</li>
<li>
<p>ç±»ä¼¼äºvue2.xä¸­çš„mixinã€‚</p>
</li>
<li>
<p>è‡ªå®šä¹‰hookçš„ä¼˜åŠ¿: å¤ç”¨ä»£ç , è®©setupä¸­çš„é€»è¾‘æ›´æ¸…æ¥šæ˜“æ‡‚ã€‚</p>
</li>
</ul>
<h2 id="10toref">10.toRef</h2>
<ul>
<li>
<p>ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ª ref å¯¹è±¡ï¼Œå…¶valueå€¼æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§ã€‚</p>
</li>
<li>
<p>è¯­æ³•ï¼š<code>const name = toRef(person,'name')</code></p>
</li>
<li>
<p>åº”ç”¨:   è¦å°†å“åº”å¼å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§å•ç‹¬æä¾›ç»™å¤–éƒ¨ä½¿ç”¨æ—¶ã€‚</p>
</li>
<li>
<p>æ‰©å±•ï¼š<code>toRefs</code> ä¸<code>toRef</code>åŠŸèƒ½ä¸€è‡´ï¼Œä½†å¯ä»¥æ‰¹é‡åˆ›å»ºå¤šä¸ª ref å¯¹è±¡ï¼Œè¯­æ³•ï¼š<code>toRefs(person)</code></p>
</li>
</ul>
<h1 id="ä¸‰-å…¶å®ƒ-composition-api">ä¸‰ã€å…¶å®ƒ Composition API</h1>
<h2 id="1shallowreactive-ä¸-shallowref">1.shallowReactive ä¸ shallowRef</h2>
<ul>
<li>
<p>shallowReactiveï¼šåªå¤„ç†å¯¹è±¡æœ€å¤–å±‚å±æ€§çš„å“åº”å¼ï¼ˆæµ…å“åº”å¼ï¼‰ã€‚</p>
</li>
<li>
<p>shallowRefï¼šåªå¤„ç†åŸºæœ¬æ•°æ®ç±»å‹çš„å“åº”å¼, ä¸è¿›è¡Œå¯¹è±¡çš„å“åº”å¼å¤„ç†ã€‚</p>
</li>
<li>
<p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨?</p>
<ul>
<li>å¦‚æœæœ‰ä¸€ä¸ªå¯¹è±¡æ•°æ®ï¼Œç»“æ„æ¯”è¾ƒæ·±, ä½†å˜åŒ–æ—¶åªæ˜¯å¤–å±‚å±æ€§å˜åŒ– ===&gt; shallowReactiveã€‚</li>
<li>å¦‚æœæœ‰ä¸€ä¸ªå¯¹è±¡æ•°æ®ï¼Œåç»­åŠŸèƒ½ä¸ä¼šä¿®æ”¹è¯¥å¯¹è±¡ä¸­çš„å±æ€§ï¼Œè€Œæ˜¯ç”Ÿæ–°çš„å¯¹è±¡æ¥æ›¿æ¢ ===&gt; shallowRefã€‚</li>
</ul>
</li>
</ul>
<h2 id="2readonly-ä¸-shallowreadonly">2.readonly ä¸ shallowReadonly</h2>
<ul>
<li>readonly: è®©ä¸€ä¸ªå“åº”å¼æ•°æ®å˜ä¸ºåªè¯»çš„ï¼ˆæ·±åªè¯»ï¼‰ã€‚</li>
<li>shallowReadonlyï¼šè®©ä¸€ä¸ªå“åº”å¼æ•°æ®å˜ä¸ºåªè¯»çš„ï¼ˆæµ…åªè¯»ï¼‰ã€‚</li>
<li>åº”ç”¨åœºæ™¯: ä¸å¸Œæœ›æ•°æ®è¢«ä¿®æ”¹æ—¶ã€‚</li>
</ul>
<h2 id="3toraw-ä¸-markraw">3.toRaw ä¸ markRaw</h2>
<ul>
<li>toRawï¼š
<ul>
<li>ä½œç”¨ï¼šå°†ä¸€ä¸ªç”±<code>reactive</code>ç”Ÿæˆçš„<strong style="color:orange">å“åº”å¼å¯¹è±¡</strong>è½¬ä¸º<strong style="color:orange">æ™®é€šå¯¹è±¡</strong>ã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šç”¨äºè¯»å–å“åº”å¼å¯¹è±¡å¯¹åº”çš„æ™®é€šå¯¹è±¡ï¼Œå¯¹è¿™ä¸ªæ™®é€šå¯¹è±¡çš„æ‰€æœ‰æ“ä½œï¼Œä¸ä¼šå¼•èµ·é¡µé¢æ›´æ–°ã€‚</li>
</ul>
</li>
<li>markRawï¼š
<ul>
<li>ä½œç”¨ï¼šæ ‡è®°ä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å…¶æ°¸è¿œä¸ä¼šå†æˆä¸ºå“åº”å¼å¯¹è±¡ã€‚</li>
<li>åº”ç”¨åœºæ™¯:
<ol>
<li>æœ‰äº›å€¼ä¸åº”è¢«è®¾ç½®ä¸ºå“åº”å¼çš„ï¼Œä¾‹å¦‚å¤æ‚çš„ç¬¬ä¸‰æ–¹ç±»åº“ç­‰ã€‚</li>
<li>å½“æ¸²æŸ“å…·æœ‰ä¸å¯å˜æ•°æ®æºçš„å¤§åˆ—è¡¨æ—¶ï¼Œè·³è¿‡å“åº”å¼è½¬æ¢å¯ä»¥æé«˜æ€§èƒ½ã€‚</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="4customref">4.customRef</h2>
<ul>
<li>
<p>ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ refï¼Œå¹¶å¯¹å…¶ä¾èµ–é¡¹è·Ÿè¸ªå’Œæ›´æ–°è§¦å‘è¿›è¡Œæ˜¾å¼æ§åˆ¶ã€‚</p>
</li>
<li>
<p>å®ç°é˜²æŠ–æ•ˆæœï¼š</p>
<pre><code class="language-vue">&lt;template&gt;
	&lt;input type=&quot;text&quot; v-model=&quot;keyword&quot;&gt;
	&lt;h3&gt;{{keyword}}&lt;/h3&gt;
&lt;/template&gt;

&lt;script&gt;
	import {ref,customRef} from 'vue'
	export default {
		name:'Demo',
		setup(){
			// let keyword = ref('hello') //ä½¿ç”¨Vueå‡†å¤‡å¥½çš„å†…ç½®ref
			//è‡ªå®šä¹‰ä¸€ä¸ªmyRef
			function myRef(value,delay){
				let timer
				//é€šè¿‡customRefå»å®ç°è‡ªå®šä¹‰
				return customRef((track,trigger)=&gt;{
					return{
						get(){
							track() //å‘Šè¯‰Vueè¿™ä¸ªvalueå€¼æ˜¯éœ€è¦è¢«â€œè¿½è¸ªâ€çš„
							return value
						},
						set(newValue){
							clearTimeout(timer)
							timer = setTimeout(()=&gt;{
								value = newValue
								trigger() //å‘Šè¯‰Vueå»æ›´æ–°ç•Œé¢
							},delay)
						}
					}
				})
			}
			let keyword = myRef('hello',500) //ä½¿ç”¨ç¨‹åºå‘˜è‡ªå®šä¹‰çš„ref
			return {
				keyword
			}
		}
	}
&lt;/script&gt;
</code></pre>
</li>
</ul>
<h2 id="5provide-ä¸-inject">5.provide ä¸ inject</h2>
<img src="https://v3.cn.vuejs.org/images/components_provide.png" style="zoom:50%;"/>
<ul>
<li>
<p>ä½œç”¨ï¼šå®ç°<strong style="color:#DD5145">ç¥–ä¸åä»£ç»„ä»¶é—´</strong>é€šä¿¡</p>
</li>
<li>
<p>å¥—è·¯ï¼šçˆ¶ç»„ä»¶æœ‰ä¸€ä¸ª <code>provide</code> é€‰é¡¹æ¥æä¾›æ•°æ®ï¼Œåä»£ç»„ä»¶æœ‰ä¸€ä¸ª <code>inject</code> é€‰é¡¹æ¥å¼€å§‹ä½¿ç”¨è¿™äº›æ•°æ®</p>
</li>
<li>
<p>å…·ä½“å†™æ³•ï¼š</p>
<ol>
<li>
<p>ç¥–ç»„ä»¶ä¸­ï¼š</p>
<pre><code class="language-js">setup(){
	......
    let car = reactive({name:'å¥”é©°',price:'40ä¸‡'})
    provide('car',car)
    ......
}
</code></pre>
</li>
<li>
<p>åä»£ç»„ä»¶ä¸­ï¼š</p>
<pre><code class="language-js">setup(props,context){
	......
    const car = inject('car')
    return {car}
	......
}
</code></pre>
</li>
</ol>
</li>
</ul>
<h2 id="6å“åº”å¼æ•°æ®çš„åˆ¤æ–­">6.å“åº”å¼æ•°æ®çš„åˆ¤æ–­</h2>
<ul>
<li>isRef: æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºä¸€ä¸ª ref å¯¹è±¡</li>
<li>isReactive: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± <code>reactive</code> åˆ›å»ºçš„å“åº”å¼ä»£ç†</li>
<li>isReadonly: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± <code>readonly</code> åˆ›å»ºçš„åªè¯»ä»£ç†</li>
<li>isProxy: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± <code>reactive</code> æˆ–è€… <code>readonly</code> æ–¹æ³•åˆ›å»ºçš„ä»£ç†</li>
</ul>
<h1 id="å››-composition-api-çš„ä¼˜åŠ¿">å››ã€Composition API çš„ä¼˜åŠ¿</h1>
<h2 id="1options-api-å­˜åœ¨çš„é—®é¢˜">1.Options API å­˜åœ¨çš„é—®é¢˜</h2>
<p>ä½¿ç”¨ä¼ ç»ŸOptionsAPIä¸­ï¼Œæ–°å¢æˆ–è€…ä¿®æ”¹ä¸€ä¸ªéœ€æ±‚ï¼Œå°±éœ€è¦åˆ†åˆ«åœ¨dataï¼Œmethodsï¼Œcomputedé‡Œä¿®æ”¹ ã€‚</p>
 <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image" style="zoom:50%;"/>
 <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image" style="zoom:50%;"/> 
<h2 id="2composition-api-çš„ä¼˜åŠ¿">2.Composition API çš„ä¼˜åŠ¿</h2>
<p>æˆ‘ä»¬å¯ä»¥æ›´åŠ ä¼˜é›…çš„ç»„ç»‡æˆ‘ä»¬çš„ä»£ç ï¼Œå‡½æ•°ã€‚è®©ç›¸å…³åŠŸèƒ½çš„ä»£ç æ›´åŠ æœ‰åºçš„ç»„ç»‡åœ¨ä¸€èµ·ã€‚</p>
 <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image" style="zoom:50%;"/>
 <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image" style="zoom:50%;"/> 
<h1 id="äº”-æ–°çš„ç»„ä»¶">äº”ã€æ–°çš„ç»„ä»¶</h1>
<h2 id="1fragment">1.Fragment</h2>
<ul>
<li>åœ¨Vue2ä¸­: ç»„ä»¶å¿…é¡»æœ‰ä¸€ä¸ªæ ¹æ ‡ç­¾</li>
<li>åœ¨Vue3ä¸­: ç»„ä»¶å¯ä»¥æ²¡æœ‰æ ¹æ ‡ç­¾, å†…éƒ¨ä¼šå°†å¤šä¸ªæ ‡ç­¾åŒ…å«åœ¨ä¸€ä¸ªFragmentè™šæ‹Ÿå…ƒç´ ä¸­</li>
<li>å¥½å¤„: å‡å°‘æ ‡ç­¾å±‚çº§, å‡å°å†…å­˜å ç”¨</li>
</ul>
<h2 id="2teleport">2.Teleport</h2>
<ul>
<li>
<p>ä»€ä¹ˆæ˜¯Teleportï¼Ÿâ€”â€” <code>Teleport</code> æ˜¯ä¸€ç§èƒ½å¤Ÿå°†æˆ‘ä»¬çš„<strong style="color:#DD5145">ç»„ä»¶htmlç»“æ„</strong>ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®çš„æŠ€æœ¯ã€‚</p>
<pre><code class="language-vue">&lt;teleport to=&quot;ç§»åŠ¨ä½ç½®&quot;&gt;
	&lt;div v-if=&quot;isShow&quot; class=&quot;mask&quot;&gt;
		&lt;div class=&quot;dialog&quot;&gt;
			&lt;h3&gt;æˆ‘æ˜¯ä¸€ä¸ªå¼¹çª—&lt;/h3&gt;
			&lt;button @click=&quot;isShow = false&quot;&gt;å…³é—­å¼¹çª—&lt;/button&gt;
		&lt;/div&gt;
	&lt;/div&gt;
&lt;/teleport&gt;
</code></pre>
</li>
</ul>
<h2 id="3suspense">3.Suspense</h2>
<ul>
<li>
<p>ç­‰å¾…å¼‚æ­¥ç»„ä»¶æ—¶æ¸²æŸ“ä¸€äº›é¢å¤–å†…å®¹ï¼Œè®©åº”ç”¨æœ‰æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</p>
</li>
<li>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>å¼‚æ­¥å¼•å…¥ç»„ä»¶</p>
<pre><code class="language-js">import {defineAsyncComponent} from 'vue'
const Child = defineAsyncComponent(()=&gt;import('./components/Child.vue'))
</code></pre>
</li>
<li>
<p>ä½¿ç”¨<code>Suspense</code>åŒ…è£¹ç»„ä»¶ï¼Œå¹¶é…ç½®å¥½<code>default</code> ä¸ <code>fallback</code></p>
<pre><code class="language-vue">&lt;template&gt;
	&lt;div class=&quot;app&quot;&gt;
		&lt;h3&gt;æˆ‘æ˜¯Appç»„ä»¶&lt;/h3&gt;
		&lt;Suspense&gt;
			&lt;template v-slot:default&gt;
				&lt;Child/&gt;
			&lt;/template&gt;
			&lt;template v-slot:fallback&gt;
				&lt;h3&gt;åŠ è½½ä¸­.....&lt;/h3&gt;
			&lt;/template&gt;
		&lt;/Suspense&gt;
	&lt;/div&gt;
&lt;/template&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<h1 id="å…­-å…¶ä»–">å…­ã€å…¶ä»–</h1>
<h2 id="1å…¨å±€apiçš„è½¬ç§»">1.å…¨å±€APIçš„è½¬ç§»</h2>
<ul>
<li>
<p>Vue 2.x æœ‰è®¸å¤šå…¨å±€ API å’Œé…ç½®ã€‚</p>
<ul>
<li>
<p>ä¾‹å¦‚ï¼šæ³¨å†Œå…¨å±€ç»„ä»¶ã€æ³¨å†Œå…¨å±€æŒ‡ä»¤ç­‰ã€‚</p>
<pre><code class="language-js">//æ³¨å†Œå…¨å±€ç»„ä»¶
Vue.component('MyButton', {
  data: () =&gt; ({
    count: 0
  }),
  template: '&lt;button @click=&quot;count++&quot;&gt;Clicked {{ count }} times.&lt;/button&gt;'
})

//æ³¨å†Œå…¨å±€æŒ‡ä»¤
Vue.directive('focus', {
  inserted: el =&gt; el.focus()
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>Vue3.0ä¸­å¯¹è¿™äº›APIåšå‡ºäº†è°ƒæ•´ï¼š</p>
<ul>
<li>
<p>å°†å…¨å±€çš„APIï¼Œå³ï¼š<code>Vue.xxx</code>è°ƒæ•´åˆ°åº”ç”¨å®ä¾‹ï¼ˆ<code>app</code>ï¼‰ä¸Š</p>
<table>
<thead>
<tr>
<th>2.x å…¨å±€ APIï¼ˆ<code>Vue</code>ï¼‰</th>
<th>3.x å®ä¾‹ API (<code>app</code>)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Vue.config.xxxx</td>
<td>app.config.xxxx</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td><strong style="color:#DD5145">ç§»é™¤</strong></td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
</ul>
<h2 id="2å…¶ä»–æ”¹å˜">2.å…¶ä»–æ”¹å˜</h2>
<ul>
<li>
<p>dataé€‰é¡¹åº”å§‹ç»ˆè¢«å£°æ˜ä¸ºä¸€ä¸ªå‡½æ•°ã€‚</p>
</li>
<li>
<p>è¿‡åº¦ç±»åçš„æ›´æ”¹ï¼š</p>
<ul>
<li>
<p>Vue2.xå†™æ³•</p>
<pre><code class="language-css">.v-enter,
.v-leave-to {
  opacity: 0;
}
.v-leave,
.v-enter-to {
  opacity: 1;
}
</code></pre>
</li>
<li>
<p>Vue3.xå†™æ³•</p>
<pre><code class="language-css">.v-enter-from,
.v-leave-to {
  opacity: 0;
}

.v-leave-from,
.v-enter-to {
  opacity: 1;
}
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong style="color:#DD5145">ç§»é™¤</strong>keyCodeä½œä¸º v-on çš„ä¿®é¥°ç¬¦ï¼ŒåŒæ—¶ä¹Ÿä¸å†æ”¯æŒ<code>config.keyCodes</code></p>
</li>
<li>
<p><strong style="color:#DD5145">ç§»é™¤</strong><code>v-on.native</code>ä¿®é¥°ç¬¦</p>
<ul>
<li>
<p>çˆ¶ç»„ä»¶ä¸­ç»‘å®šäº‹ä»¶</p>
<pre><code class="language-vue">&lt;my-component
  v-on:close=&quot;handleComponentEvent&quot;
  v-on:click=&quot;handleNativeClickEvent&quot;
/&gt;
</code></pre>
</li>
<li>
<p>å­ç»„ä»¶ä¸­å£°æ˜è‡ªå®šä¹‰äº‹ä»¶</p>
<pre><code class="language-vue">&lt;script&gt;
  export default {
    emits: ['close']
  }
&lt;/script&gt;
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong style="color:#DD5145">ç§»é™¤</strong>è¿‡æ»¤å™¨ï¼ˆfilterï¼‰</p>
<blockquote>
<p>è¿‡æ»¤å™¨è™½ç„¶è¿™çœ‹èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†å®ƒéœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰è¯­æ³•ï¼Œæ‰“ç ´å¤§æ‹¬å·å†…è¡¨è¾¾å¼æ˜¯ â€œåªæ˜¯ JavaScriptâ€ çš„å‡è®¾ï¼Œè¿™ä¸ä»…æœ‰å­¦ä¹ æˆæœ¬ï¼Œè€Œä¸”æœ‰å®ç°æˆæœ¬ï¼å»ºè®®ç”¨æ–¹æ³•è°ƒç”¨æˆ–è®¡ç®—å±æ€§å»æ›¿æ¢è¿‡æ»¤å™¨ã€‚</p>
</blockquote>
</li>
<li>
<p>......</p>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SSMæ•´åˆ]]></title>
        <id>https://kuangyang828.github.io/ssm-zheng-he/</id>
        <link href="https://kuangyang828.github.io/ssm-zheng-he/">
        </link>
        <updated>2022-07-26T06:44:33.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>è§†é¢‘è¯¾ç¨‹é“¾æ¥ï¼š<br>
<a href="https://youtube.com/playlist?list=PLmOn9nNkQxJFbsU4Qz8CdRiVM4Qs3ci75">ğŸ”—YouTubeï¼ˆä¸‹è½½èµ„æ–™æ›´æ–¹ä¾¿ï¼‰</a><br>
<a href="https://www.bilibili.com/video/BV1Ya411S7aT">ğŸ”—bilibili</a></p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220727103525.png" alt="" loading="lazy"></figure>
<h1 id="ssmæ•´åˆ">SSMæ•´åˆ</h1>
<h1 id="1-contextloaderlistener">1ã€ContextLoaderListener</h1>
<p>Springæä¾›äº†ç›‘å¬å™¨ContextLoaderListenerï¼Œå®ç°ServletContextListeneræ¥å£ï¼Œå¯ç›‘å¬ ServletContext çš„çŠ¶æ€ï¼Œåœ¨webæœåŠ¡å™¨çš„å¯åŠ¨ï¼Œè¯»å–Springçš„é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºSpringçš„IOCå®¹å™¨ã€‚web åº”ç”¨ä¸­å¿…é¡»åœ¨web.xmlä¸­é…ç½®</p>
<pre><code class="language-xml">&lt;!--
    é…ç½®Springçš„ç›‘å¬å™¨ï¼Œåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶åŠ è½½Springçš„é…ç½®æ–‡ä»¶
    Springé…ç½®æ–‡ä»¶é»˜è®¤ä½ç½®å’Œåç§°ï¼š/WEB-INF/applicationContext.xml
    å¯é€šè¿‡ä¸Šä¸‹æ–‡å‚æ•°è‡ªå®šä¹‰Springé…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§°
 --&gt;
&lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;

&lt;!-- è®¾ç½®Springçš„é…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§° --&gt;
&lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:Spring.xml&lt;/param-value&gt;
&lt;/context-param&gt;
</code></pre>
<h1 id="2-å‡†å¤‡å·¥ä½œ">2ã€å‡†å¤‡å·¥ä½œ</h1>
<h2 id="1åˆ›å»ºmaven-module">â‘ åˆ›å»ºMaven Module</h2>
<h2 id="2å¯¼å…¥ä¾èµ–">â‘¡å¯¼å…¥ä¾èµ–</h2>
<pre><code class="language-xml">&lt;packaging&gt;war&lt;/packaging&gt;

&lt;properties&gt;
    &lt;spring.version&gt;5.3.1&lt;/spring.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--springmvc--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
        &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- Mybatisæ ¸å¿ƒ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
        &lt;version&gt;3.5.7&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--mybatiså’Œspringçš„æ•´åˆåŒ…--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
        &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
        &lt;version&gt;2.0.6&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- druidè¿æ¥æ±  --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
        &lt;artifactId&gt;druid&lt;/artifactId&gt;
        &lt;version&gt;1.0.9&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- junitæµ‹è¯• --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;!-- MySQLé©±åŠ¨ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;5.1.38&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- log4jæ—¥å¿— --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;log4j&lt;/groupId&gt;
        &lt;artifactId&gt;log4j&lt;/artifactId&gt;
        &lt;version&gt;1.2.17&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
        &lt;artifactId&gt;pagehelper&lt;/artifactId&gt;
        &lt;version&gt;5.2.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- æ—¥å¿— --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
        &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
        &lt;version&gt;1.2.3&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- ServletAPI --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
        &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
        &lt;version&gt;3.1.0&lt;/version&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
        &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
        &lt;version&gt;2.12.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
        &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
        &lt;version&gt;1.3.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- Spring5å’ŒThymeleafæ•´åˆåŒ… --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.thymeleaf&lt;/groupId&gt;
        &lt;artifactId&gt;thymeleaf-spring5&lt;/artifactId&gt;
        &lt;version&gt;3.0.12.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<h2 id="3åˆ›å»ºè¡¨">â‘¢åˆ›å»ºè¡¨</h2>
<pre><code class="language-sql">CREATE TABLE `t_emp`(
    `emp_id`   int(11) NOT NULL AUTO_INCREMENT,
    `emp_name` varchar(20) DEFAULT NULL,
    `age`      int(11) DEFAULT NULL,
    `sex`      char(1)     DEFAULT NULL,
    `email`    varchar(50) DEFAULT NULL,
    PRIMARY KEY (`emp_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
</code></pre>
<h1 id="3-é…ç½®webxml">3ã€é…ç½®web.xml</h1>
<pre><code class="language-xml">&lt;!--é…ç½®springMVCçš„ç¼–ç è¿‡æ»¤å™¨--&gt;
&lt;filter&gt;
    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;!--å¦‚æœåªè®¾ç½®encodingå‚æ•°åˆ™ç¼–ç è¿‡æ»¤å™¨åªå¯¹è¯·æ±‚requestç”Ÿæ•ˆ--&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;encoding&lt;/param-name&gt;
        &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!--è®¾ç½®forceResponseEncodingå‚æ•°ä¸ºtrueï¼Œç¼–ç è¿‡æ»¤å™¨æ‰å¯¹å“åº”resposeç”Ÿæ•ˆ--&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;forceResponseEncoding&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;!-- é…ç½®å¤„ç†è¯·æ±‚æ–¹å¼PUTå’ŒDELETEçš„è¿‡æ»¤å™¨ --&gt;
&lt;filter&gt;
    &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;!-- é…ç½®SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ --&gt;
&lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;!-- è®¾ç½®SpringMVCçš„é…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§° --&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:SpringMVC.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!-- å°†DispatcherServlet çš„åˆå§‹åŒ–æ—¶é—´æå‰åˆ°æœåŠ¡å™¨å¯åŠ¨æ—¶ --&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;

&lt;!-- é…ç½®Springçš„ç›‘å¬å™¨ --&gt;
&lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;

&lt;!-- è®¾ç½®Springçš„é…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§° --&gt;
&lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:Spring.xml&lt;/param-value&gt;
&lt;/context-param&gt;
</code></pre>
<h1 id="4-åˆ›å»ºspringmvcçš„é…ç½®æ–‡ä»¶å¹¶é…ç½®">4ã€åˆ›å»ºSpringMVCçš„é…ç½®æ–‡ä»¶å¹¶é…ç½®</h1>
<pre><code class="language-xml">&lt;!--æ‰«ææ§åˆ¶å±‚ç»„ä»¶--&gt;
&lt;context:component-scan base-package=&quot;com.atguigu.controller&quot;&gt;&lt;/context:component-scan&gt;

&lt;!--é…ç½®è§†å›¾è§£æå™¨--&gt;
&lt;bean id=&quot;viewResolver&quot; class=&quot;org.thymeleaf.spring5.view.ThymeleafViewResolver&quot;&gt;
    &lt;property name=&quot;order&quot; value=&quot;1&quot;/&gt;
    &lt;property name=&quot;characterEncoding&quot; value=&quot;UTF-8&quot;/&gt;
    &lt;property name=&quot;templateEngine&quot;&gt;
        &lt;bean class=&quot;org.thymeleaf.spring5.SpringTemplateEngine&quot;&gt;
            &lt;property name=&quot;templateResolver&quot;&gt;
                &lt;bean class=&quot;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver&quot;&gt;
                    &lt;!-- è§†å›¾å‰ç¼€ --&gt;
                    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/templates/&quot;/&gt;
                    &lt;!-- è§†å›¾åç¼€ --&gt;
                    &lt;property name=&quot;suffix&quot; value=&quot;.html&quot;/&gt;
                    &lt;property name=&quot;templateMode&quot; value=&quot;HTML5&quot;/&gt;
                    &lt;property name=&quot;characterEncoding&quot; value=&quot;UTF-8&quot;/&gt;
                &lt;/bean&gt;
            &lt;/property&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;!-- é…ç½®é»˜è®¤çš„servletå¤„ç†é™æ€èµ„æº --&gt;
&lt;mvc:default-servlet-handler/&gt;

&lt;!-- å¼€å¯MVCçš„æ³¨è§£é©±åŠ¨ --&gt;
&lt;mvc:annotation-driven/&gt;

&lt;!-- é…ç½®è®¿é—®é¦–é¡µçš„è§†å›¾æ§åˆ¶å™¨ --&gt;
&lt;mvc:view-controller path=&quot;/&quot; view-name=&quot;index&quot;&gt;&lt;/mvc:view-controller&gt;

&lt;!-- å¤„ç†CORS --&gt;
&lt;mvc:cors&gt;
    &lt;!--
        allowed-origins: &lt;origin&gt; | *
        å…¶ä¸­ï¼Œorigin å‚æ•°çš„å€¼æŒ‡å®šå…è®¸è®¿é—®è¯¥èµ„æºçš„å¤–åŸŸ origin åŸŸåã€‚
        å¯¹äºä¸éœ€è¦æºå¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯ä»¥æŒ‡å®šè¯¥å­—æ®µçš„å€¼ä¸ºé€šé…ç¬¦*ï¼Œè¡¨ç¤ºå…è®¸æ¥è‡ªæ‰€æœ‰åŸŸçš„è¯·æ±‚ã€‚
    --&gt;
    &lt;!--&lt;mvc:mapping path=&quot;/**&quot; allowed-origins=&quot;http:/z/example.com/&quot; allowed-methods=&quot;GET,POST&quot; max-age=&quot;3600&quot;/&gt;--&gt;
    &lt;!--
        allowed-origin-patterns
        æ›¿ä»£llowed-originsï¼Œæ­¤å±æ€§å…è®¸æ›´çµæ´»çš„æ¨¡å¼ï¼Œä¾‹å¦‚ *.domain1.com
    --&gt;
    &lt;mvc:mapping path=&quot;/**&quot; allowed-origin-patterns=&quot;http://localhost:*&quot; allowed-methods=&quot;GET,POST&quot; max-age=&quot;3600&quot;/&gt;
&lt;/mvc:cors&gt;
</code></pre>
<h1 id="5-æ­å»ºmybatisç¯å¢ƒ">5ã€æ­å»ºMyBatisç¯å¢ƒ</h1>
<h2 id="1åˆ›å»ºå±æ€§æ–‡ä»¶jdbcproperties">â‘ åˆ›å»ºå±æ€§æ–‡ä»¶jdbc.properties</h2>
<pre><code class="language-properties">jdbc.driver=com.mysql.jdbc.Driver
#jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://127.0.0.1:3305/mydb?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false
# jdbc.url=jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC
jdbc.username=root
jdbc.password=
</code></pre>
<h2 id="2åˆ›å»ºmybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶mybatis-configxml">â‘¡åˆ›å»ºMyBatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶mybatis-config.xml</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;settings&gt;
        &lt;!--å°†è¡¨ä¸­å­—æ®µçš„ä¸‹åˆ’çº¿è‡ªåŠ¨è½¬æ¢ä¸ºé©¼å³°--&gt;
        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;
        &lt;!--å¼€å¯å»¶è¿ŸåŠ è½½--&gt;
        &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;
    &lt;/settings&gt;
    &lt;!--è®¾ç½®ç±»å‹åˆ«å--&gt;
    &lt;typeAliases&gt;
        &lt;package name=&quot;com.atguigu.pojo&quot;/&gt;
    &lt;/typeAliases&gt;

    &lt;plugins&gt;
        &lt;!--è®¾ç½®åˆ†é¡µæ’ä»¶--&gt;
        &lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt;
            &lt;!--reasonableï¼šåˆ†é¡µåˆç†åŒ–å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºfalse,ç›´æ¥æ ¹æ®å‚æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚
              å½“è¯¥å‚æ•°è®¾ç½®ä¸º true æ—¶ï¼ŒpageNum&lt;=0 æ—¶ä¼šæŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œ pageNum&gt;pagesï¼ˆè¶…è¿‡æ€»æ•°æ—¶ï¼‰ï¼Œä¼šæŸ¥è¯¢æœ€åä¸€é¡µã€‚--&gt;
            &lt;property name=&quot;reasonable&quot; value=&quot;true&quot;/&gt;
            &lt;property name=&quot;pageSizeZero&quot; value=&quot;true&quot;/&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;

    &lt;!--å¼•å…¥æ˜ å°„æ–‡ä»¶--&gt;
    &lt;mappers&gt;
        &lt;!--        &lt;mapper resource=&quot;mybatisdemo/mappers/UserMapper.xml&quot;/&gt;--&gt;
        &lt;!--
        ä»¥åŒ…ä¸ºå•ä½ï¼Œå°†åŒ…ä¸‹æ‰€æœ‰çš„æ˜ å°„æ–‡ä»¶å¼•å…¥æ ¸å¿ƒé…ç½®æ–‡ä»¶
        æ³¨æ„ï¼š
			1. æ­¤æ–¹å¼å¿…é¡»ä¿è¯mapperæ¥å£å’Œmapperæ˜ å°„æ–‡ä»¶å¿…é¡»åœ¨ç›¸åŒçš„åŒ…ä¸‹
			2. mapperæ¥å£è¦å’Œmapperæ˜ å°„æ–‡ä»¶çš„åå­—ä¸€è‡´
			&lt;package name=&quot;com.example.mybatis.mapper&quot;/&gt;
        --&gt;
        &lt;package name=&quot;com.atguigu.mapper&quot;/&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>
<h2 id="3åˆ›å»ºmapperæ¥å£å’Œæ˜ å°„æ–‡ä»¶">â‘¢åˆ›å»ºMapperæ¥å£å’Œæ˜ å°„æ–‡ä»¶</h2>
<pre><code class="language-java">public interface EmployeeMapper {
    List&lt;Employee&gt; getEmployeeList();
}
</code></pre>
<pre><code class="language-XML">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.atguigu.ssm.mapper.EmployeeMapper&quot;&gt;
    
    &lt;select id=&quot;getEmployeeList&quot; resultType=&quot;Employee&quot;&gt;
        select *
        from t_emp
    &lt;/select&gt;
    
&lt;/mapper&gt;
</code></pre>
<blockquote>
<ul>
<li>
<p>å…³äºmapperæ˜ å°„æ–‡ä»¶çš„ä½ç½®ä¸€èˆ¬æœ‰ä¸¤ç§å†™æ³•ï¼š</p>
<ul>
<li>
<p>a. MyBatisæ˜ å°„æ–‡ä»¶å­˜æ”¾çš„ä½ç½®æ˜¯src/main/resources/mappersç›®å½•ä¸‹</p>
</li>
<li>
<p>b. å°†MyBatisæ˜ å°„æ–‡ä»¶å­˜æ”¾åˆ°src/main/javaåŒä¸€ç›®å½•ä¸‹ï¼Œ</p>
<ul>
<li>
<p>æ­¤æ—¶éœ€è¦åœ¨pom.xmlä¸­æ‰‹åŠ¨æŒ‡å®šæ˜ å°„æ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼Œå› ä¸ºè¿™æ ·Mavenæ‰ä¼šç¼–è¯‘è¿™äº›xml</p>
<pre><code class="language-xml">&lt;build&gt;
    &lt;resources&gt;
        &lt;resource&gt;
            &lt;directory&gt;src/main/java&lt;/directory&gt;
            &lt;includes&gt;
                &lt;include&gt;**/*.xml&lt;/include&gt;
            &lt;/includes&gt;
        &lt;/resource&gt;
    &lt;/resources&gt;
&lt;/build&gt;
</code></pre>
</li>
<li>
<p>åœ¨mybatisä¸­é…ç½®æ˜ å°„æ–‡ä»¶çš„å­˜æ”¾ä½ç½®</p>
<pre><code class="language-xml">&lt;bean id=&quot;sqlSessionFactoryBean&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
    &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;druidDataSource&quot;&gt;&lt;/property&gt;
    &lt;!--
     è®¾ç½®æ˜ å°„æ–‡ä»¶çš„è·¯å¾„
     åªæœ‰æ˜ å°„æ–‡ä»¶çš„åŒ…å’Œmapperæ¥å£çš„åŒ…ä¸ä¸€è‡´æ—¶éœ€è¦è®¾ç½®
     --&gt;
    &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:com/xxxxx/mapper/xml/*.xml&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="4åˆ›å»ºæ—¥å¿—æ–‡ä»¶log4jxml">â‘£åˆ›å»ºæ—¥å¿—æ–‡ä»¶log4j.xml</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE log4j:configuration SYSTEM &quot;log4j.dtd&quot;&gt;
&lt;log4j:configuration xmlns:log4j=&quot;http://jakarta.apache.org/log4j/&quot;&gt;
    &lt;appender name=&quot;STDOUT&quot; class=&quot;org.apache.log4j.ConsoleAppender&quot;&gt;
        &lt;param name=&quot;Encoding&quot; value=&quot;UTF-8&quot;/&gt;
        &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
            &lt;param name=&quot;ConversionPattern&quot; value=&quot;%-5p %d{MM-dd HH:mm:ss,SSS} %m (%F:%L) \n&quot;/&gt;
        &lt;/layout&gt;
    &lt;/appender&gt;
    &lt;logger name=&quot;java.sql&quot;&gt;
        &lt;level value=&quot;debug&quot;/&gt;
    &lt;/logger&gt;
    &lt;logger name=&quot;org.apache.ibatis&quot;&gt;
        &lt;level value=&quot;info&quot;/&gt;
    &lt;/logger&gt;
    &lt;root&gt;
        &lt;level value=&quot;debug&quot;/&gt;
        &lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
    &lt;/root&gt;
&lt;/log4j:configuration&gt;
</code></pre>
<h1 id="6-åˆ›å»ºspringçš„é…ç½®æ–‡ä»¶å¹¶é…ç½®">6ã€åˆ›å»ºSpringçš„é…ç½®æ–‡ä»¶å¹¶é…ç½®</h1>
<pre><code class="language-xml">&lt;!--æ‰«æç»„ä»¶ï¼ˆé™¤æ§åˆ¶å±‚ï¼‰--&gt;
&lt;content:component-scan base-package=&quot;com.atguigu&quot;&gt;
    &lt;content:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;
&lt;/content:component-scan&gt;

&lt;!-- å¼•å…¥jdbc.properties --&gt;
&lt;content:property-placeholder location=&quot;classpath:jdbc.properties&quot;&gt;&lt;/content:property-placeholder&gt;

&lt;!-- é…ç½®Druidæ•°æ®æº --&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;!-- é…ç½®ç”¨äºåˆ›å»ºSqlSessionFactoryçš„å·¥å‚beanï¼Œå¯ä»¥ç›´æ¥åœ¨Springçš„IOCä¸­è·å–SqlSessionFactory --&gt;
&lt;bean class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
    &lt;!-- è®¾ç½®MyBatisæ ¸å¿ƒé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼ˆå¯ä»¥ä¸è®¾ç½®ï¼‰ --&gt;
    &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot;&gt;
    &lt;/property&gt;
    &lt;!-- è®¾ç½®æ•°æ®æº --&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;!--
     è®¾ç½®æ˜ å°„æ–‡ä»¶çš„è·¯å¾„
     åªæœ‰æ˜ å°„æ–‡ä»¶çš„åŒ…å’Œmapperæ¥å£çš„åŒ…ä¸ä¸€è‡´æ—¶éœ€è¦è®¾ç½®
     --&gt;
    &lt;!--
    &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:mapper/*.xml&quot;&gt;
    &lt;/property&gt;
    --&gt;
&lt;/bean&gt;

&lt;!--
    é…ç½®mapperæ¥å£çš„æ‰«æ
    å¯ä»¥å°†æŒ‡å®šåŒ…ä¸‹æ‰€æœ‰çš„mapperæ¥å£é€šè¿‡SqlSessionFactoryåˆ›å»ºåŠ¨æ€ä»£ç†å®ç°ç±»å¯¹è±¡
    å¹¶å°†è¿™äº›å¯¹è±¡ä½œä¸ºbeanäº¤ç»™IOCå®¹å™¨ç®¡ç†
--&gt;
&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
    &lt;property name=&quot;basePackage&quot; value=&quot;com.atguigu.mapper&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;!--é…ç½®äº‹åŠ¡ç®¡ç†å™¨--&gt;
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;!--
å¼€å¯äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨
é€šè¿‡æ³¨è§£@Transactionalæ‰€æ ‡è¯†çš„æ–¹æ³•æˆ–æ ‡è¯†çš„ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«äº‹åŠ¡ç®¡ç†å™¨ç®¡ç†äº‹åŠ¡
--&gt;
&lt;!--
 transaction-managerå±æ€§çš„é»˜è®¤å€¼æ˜¯transactionManagerï¼Œ
 å¦‚æœäº‹åŠ¡ç®¡ç†å™¨beançš„idæ­£å¥½å°±æ˜¯è¿™ä¸ªé»˜è®¤å€¼ï¼Œåˆ™å¯ä»¥çœç•¥è¿™ä¸ªå±æ€§
--&gt;
&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;
</code></pre>
<h1 id="7-æµ‹è¯•åŠŸèƒ½">7ã€æµ‹è¯•åŠŸèƒ½</h1>
<h2 id="1åˆ›å»ºç»„ä»¶">â‘ åˆ›å»ºç»„ä»¶</h2>
<p>å®ä½“ç±»Employee</p>
<pre><code class="language-java">public class Employee {

    private Integer empId;
    private String empName;
    private Integer age;
    private String sex;
    private String email;

    public Employee() {
    }

    public Employee(Integer empId, String empName, Integer age, String sex, String email) {
        this.empId = empId;
        this.empName = empName;
        this.age = age;
        this.sex = sex;
        this.email = email;
    }

    public Integer getEmpId() {
        return empId;
    }

    public void setEmpId(Integer empId) {
        this.empId = empId;
    }

    public String getEmpName() {
        return empName;
    }

    public void setEmpName(String empName) {
        this.empName = empName;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    @Override
    public String toString() {
        return &quot;Employee{&quot; +
                &quot;empId=&quot; + empId +
                &quot;, empName='&quot; + empName + '\'' +
                &quot;, age=&quot; + age +
                &quot;, sex='&quot; + sex + '\'' +
                &quot;, email='&quot; + email + '\'' +
                '}';
    }
}
</code></pre>
<p>åˆ›å»ºæ§åˆ¶å±‚ç»„ä»¶EmployeeController</p>
<pre><code class="language-java">@Controller
public class EmployeeController {
    @Autowired
    private EmployeeService employeeService;

    @RequestMapping(value = &quot;/employee/page/{pageNum}&quot;, method =
            RequestMethod.GET)
    public String getEmployeeList(Model model, @PathVariable(&quot;pageNum&quot;) Integer
            pageNum) {
        PageInfo&lt;Employee&gt; page = employeeService.getEmployeeList(pageNum);
        model.addAttribute(&quot;page&quot;, page);
        return &quot;employee_list&quot;;
    }
}
</code></pre>
<p>åˆ›å»ºæ¥å£EmployeeService</p>
<pre><code class="language-java">public interface EmployeeService {
    PageInfo&lt;Employee&gt; getEmployeeList(Integer pageNum);
}
</code></pre>
<p>åˆ›å»ºå®ç°ç±»EmployeeServiceImpl</p>
<pre><code class="language-java">@Service
public class EmployeeServiceImpl implements EmployeeService {
    @Autowired
    private EmployeeMapper employeeMapper;

    @Override
    public PageInfo&lt;Employee&gt; getEmployeeList(Integer pageNum) {
        PageHelper.startPage(pageNum, 4);
        List&lt;Employee&gt; list = employeeMapper.getEmployeeList();
        PageInfo&lt;Employee&gt; page = new PageInfo&lt;&gt;(list, 5);
        return page;
    }
}
</code></pre>
<h2 id="2åˆ›å»ºé¡µé¢">â‘¡åˆ›å»ºé¡µé¢</h2>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Employee Info&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; th:href=&quot;@{/static/css/index_work.css}&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;table&gt;
    &lt;tr&gt;
        &lt;th colspan=&quot;6&quot;&gt;Employee Info&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;th&gt;emp_id&lt;/th&gt;
        &lt;th&gt;emp_name&lt;/th&gt;
        &lt;th&gt;age&lt;/th&gt;
        &lt;th&gt;sex&lt;/th&gt;
        &lt;th&gt;email&lt;/th&gt;
        &lt;th&gt;options&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr th:each=&quot;employee : ${page.list}&quot;&gt;
        &lt;td th:text=&quot;${employee.empId}&quot;&gt;&lt;/td&gt;
        &lt;td th:text=&quot;${employee.empName}&quot;&gt;&lt;/td&gt;
        &lt;td th:text=&quot;${employee.age}&quot;&gt;&lt;/td&gt;
        &lt;td th:text=&quot;${employee.sex}&quot;&gt;&lt;/td&gt;
        &lt;td th:text=&quot;${employee.email}&quot;&gt;&lt;/td&gt;
        &lt;td&gt;
            &lt;a href=&quot;&quot;&gt;delete&lt;/a&gt;
            &lt;a href=&quot;&quot;&gt;update&lt;/a&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td colspan=&quot;6&quot;&gt;
             &lt;span th:if=&quot;${page.hasPreviousPage}&quot;&gt;
                    &lt;a th:href=&quot;@{/employee/page/1}&quot;&gt;é¦–é¡µ&lt;/a&gt;
                    &lt;a th:href=&quot;@{'/employee/page/'+${page.prePage}}&quot;&gt;ä¸Šä¸€é¡µ&lt;/a&gt;
             &lt;/span&gt;
            &lt;span th:each=&quot;num : ${page.navigatepageNums}&quot;&gt;
                    &lt;a th:if=&quot;${page.pageNum==num}&quot;
                       th:href=&quot;@{'/employee/page/'+${num}}&quot; th:text=&quot;'['+${num}+']'&quot; style=&quot;color:
                    red;&quot;&gt;&lt;/a&gt;
                    &lt;a th:if=&quot;${page.pageNum!=num}&quot;
                       th:href=&quot;@{'/employee/page/'+${num}}&quot; th:text=&quot;${num} &quot;&gt;&lt;/a&gt;
            &lt;/span&gt;
            &lt;span th:if=&quot;${page.hasNextPage}&quot;&gt;
                    &lt;a th:href=&quot;@{'/employee/page/'+${page.nextPage}}&quot;&gt;ä¸‹ä¸€é¡µ&lt;/a&gt;
                    &lt;a th:href=&quot;@{'/employee/page/'+${page.pages}}&quot;&gt;æœ«é¡µ&lt;/a&gt;
            &lt;/span&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="3è®¿é—®æµ‹è¯•åˆ†é¡µåŠŸèƒ½">â‘¢è®¿é—®æµ‹è¯•åˆ†é¡µåŠŸèƒ½</h2>
<p>localhost:8080/employee/page/1</p>
<h1 id="8-åŠ å…¥druidç›‘æ§">8ã€åŠ å…¥Druidç›‘æ§</h1>
<h2 id="1åˆ›å»ºå±æ€§æ–‡ä»¶druidproperties">â‘ åˆ›å»ºå±æ€§æ–‡ä»¶druid.properties</h2>
<pre><code class="language-properties">#è¿æ¥æ± å»ºç«‹æ—¶åˆ›å»ºçš„åˆå§‹åŒ–è¿æ¥æ•°
pool.init=1
#è¿æ¥æ± ä¸­æœ€å°ç©ºé—²è¿æ¥æ•°
pool.minIdle=3
#è¿æ¥æ± ä¸­æœ€å¤§çš„æ´»è·ƒè¿æ¥æ•°
pool.maxActive=20
#å®šä¹‰æœ€é•¿ç­‰å¾…æ—¶é—´
pool.maxWait=60000
</code></pre>
<h2 id="2åœ¨springé…ç½®æ–‡ä»¶ä¸­ä¸ºdruidæ•°æ®æºæ·»åŠ ç›¸åº”çš„å±æ€§">â‘¡åœ¨Springé…ç½®æ–‡ä»¶ä¸­ä¸ºDruidæ•°æ®æºæ·»åŠ ç›¸åº”çš„å±æ€§</h2>
<pre><code class="language-xml">&lt;!-- å¼•å…¥jdbc.propertieså’Œdruid.properties --&gt;
&lt;content:property-placeholder location=&quot;classpath:jdbc.properties,classpath:druid.properties&quot;&gt;&lt;/content:property-placeholder&gt;

&lt;!-- é…ç½®Druidæ•°æ®æº --&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;&gt;&lt;/property&gt;
    &lt;!--æ•°æ®æºæ§åˆ¶å±æ€§--&gt;
    &lt;!-- é…ç½®åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§ --&gt;
    &lt;property name=&quot;initialSize&quot; value=&quot;${pool.init}&quot;/&gt;
    &lt;property name=&quot;minIdle&quot; value=&quot;${pool.minIdle}&quot;/&gt;
    &lt;property name=&quot;maxActive&quot; value=&quot;${pool.maxActive}&quot;/&gt;
    &lt;!-- é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´ --&gt;
    &lt;property name=&quot;maxWait&quot; value=&quot;${pool.maxWait}&quot;/&gt;
    &lt;!-- é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filters --&gt;
    &lt;property name=&quot;filters&quot; value=&quot;stat&quot;/&gt;
    &lt;!-- é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’ --&gt;
    &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;2000&quot;/&gt;
    &lt;!--å…¶ä»–é…ç½®--&gt;
    &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot;/&gt;
    &lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot;/&gt;
    &lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot;/&gt;
    &lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot;/&gt;
    &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot;/&gt;
    &lt;property name=&quot;maxOpenPreparedStatements&quot; value=&quot;20&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<h2 id="3åœ¨webxmlä¸­é…ç½®ç›‘æ§é¡µé¢">â‘¢åœ¨web.xmlä¸­é…ç½®ç›‘æ§é¡µé¢</h2>
<pre><code class="language-xml">&lt;!-- druidç›‘æ§é…ç½®--&gt;
&lt;!-- å‚è€ƒæ–‡æ¡£ï¼šhttps://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatViewServlet%E9%85%8D%E7%BD%AE --&gt;
&lt;servlet&gt;
    &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.alibaba.druid.support.http.StatViewServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;!-- å…è®¸æ¸…ç©ºç»Ÿè®¡æ•°æ® --&gt;
        &lt;param-name&gt;resetEnable&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!--é…ç½®è®¿é—®ç›‘æ§é¡µé¢ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç ï¼ˆå¯é€‰ï¼‰ï¼Œå®é™…å¼€å‘ä¸­éƒ½ä¼šé…ç½®--&gt;
    &lt;init-param&gt;
        &lt;!-- ç”¨æˆ·å --&gt;
        &lt;param-name&gt;loginUsername&lt;/param-name&gt;
        &lt;param-value&gt;druid&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;!-- å¯†ç  --&gt;
        &lt;param-name&gt;loginPassword&lt;/param-name&gt;
        &lt;param-value&gt;druid&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;
    &lt;!-- è®¿é—®ç›‘æ§é¡µé¢çš„æ˜ å°„è¯·æ±‚ï¼Œå®é™…è®¿é—®ä¸€èˆ¬éƒ½åœ¨æµè§ˆå™¨è¾“å…¥http://xxx/druid/index --&gt;
    &lt;url-pattern&gt;/druid/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Macè®¾ç½®JAVA_HOMEç¯å¢ƒå˜é‡]]></title>
        <id>https://kuangyang828.github.io/mac-she-zhi-java_home-huan-jing-bian-liang/</id>
        <link href="https://kuangyang828.github.io/mac-she-zhi-java_home-huan-jing-bian-liang/">
        </link>
        <updated>2022-07-25T05:38:40.000Z</updated>
        <content type="html"><![CDATA[<h2 id="è·å–javaçš„å®‰è£…è·¯å¾„">è·å–JAVAçš„å®‰è£…è·¯å¾„</h2>
<ul>
<li>è¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨æ¥æ˜¾ç¤ºç”µè„‘ä¸­å®‰è£…çš„æ‰€æœ‰Java JDK</li>
</ul>
<pre><code>/usr/libexec/java_home -V
</code></pre>
<h2 id="æ·»åŠ java_homeåˆ°profile">æ·»åŠ JAVA_HOMEåˆ°profile</h2>
<pre><code>vi ~/.bash_profile
</code></pre>
<p>æ·»åŠ å¦‚ä¸‹ç¯å¢ƒé…ç½®</p>
<pre><code># java
JAVA_HOME=&quot;/Library/Java/JavaVirtualMachines/jdk1.8.0_111.jdk/Contents/Home&quot;
export JAVA_HOME
PATH=$PATH:$JAVA_HOME/bin
export PATH
</code></pre>
<h2 id="è®©é…ç½®ç”Ÿæ•ˆ">è®©é…ç½®ç”Ÿæ•ˆ</h2>
<pre><code>source ~/.bash_profile
</code></pre>
<h2 id="æµ‹è¯•">æµ‹è¯•</h2>
<pre><code>echo $JAVA_HOME
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Springç¬”è®°]]></title>
        <id>https://kuangyang828.github.io/spring-bi-ji/</id>
        <link href="https://kuangyang828.github.io/spring-bi-ji/">
        </link>
        <updated>2022-07-21T14:50:51.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>è§†é¢‘è¯¾ç¨‹é“¾æ¥ï¼š<br>
<a href="https://www.bilibili.com/video/BV1Ya411S7aT?p=63">ğŸ”—bilibiliï¼ˆæ–°ç‰ˆï¼‰</a><br>
<a href="https://www.bilibili.com/video/BV1Vf4y127N5">ğŸ”—bilibiliï¼ˆæ—§ç‰ˆï¼‰</a></p>
</blockquote>
<h1 id="1-springç®€ä»‹">1ã€Springç®€ä»‹</h1>
<h2 id="11-springæ¦‚è¿°">1.1ã€Springæ¦‚è¿°</h2>
<p>å®˜ç½‘åœ°å€ï¼šhttps://spring.io/</p>
<blockquote>
<p>Spring æ˜¯<code>æœ€å—æ¬¢è¿</code>çš„ä¼ä¸šçº§ Java åº”ç”¨ç¨‹åºå¼€å‘æ¡†æ¶ï¼Œæ•°ä»¥ç™¾ä¸‡çš„æ¥è‡ªä¸–ç•Œå„åœ°çš„å¼€å‘äººå‘˜ä½¿ç”¨ Spring æ¡†æ¶æ¥åˆ›å»ºæ€§èƒ½å¥½ã€æ˜“äºæµ‹è¯•ã€å¯é‡ç”¨çš„ä»£ç ã€‚</p>
<p>Spring æ¡†æ¶æ˜¯ä¸€ä¸ª<code>å¼€æº</code>çš„ Java å¹³å°ï¼Œå®ƒæœ€åˆæ˜¯ç”± Rod Johnson ç¼–å†™çš„ï¼Œå¹¶ä¸”äº 2003 å¹´ 6 æœˆé¦– æ¬¡åœ¨ Apache 2.0 è®¸å¯ä¸‹å‘å¸ƒã€‚</p>
<p>Spring æ˜¯<code>è½»é‡çº§</code>çš„æ¡†æ¶ï¼Œå…¶åŸºç¡€ç‰ˆæœ¬åªæœ‰ 2 MB å·¦å³çš„å¤§å°ã€‚</p>
<p>Spring æ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§æ˜¯å¯ä»¥ç”¨äºå¼€å‘ä»»ä½• Java åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯åœ¨ Java EE å¹³å°ä¸Šæ„å»º web åº”ç”¨ç¨‹åºæ˜¯éœ€è¦æ‰©å±•çš„ã€‚ Spring æ¡†æ¶çš„ç›®æ ‡æ˜¯ä½¿ J2EE å¼€å‘å˜å¾—æ›´å®¹æ˜“ä½¿ç”¨ï¼Œé€šè¿‡å¯ç”¨åŸºäº POJO ç¼–ç¨‹æ¨¡å‹æ¥ä¿ƒè¿›è‰¯å¥½çš„ç¼–ç¨‹å®è·µã€‚</p>
</blockquote>
<h2 id="12-springå®¶æ—">1.2ã€Springå®¶æ—</h2>
<p>é¡¹ç›®åˆ—è¡¨ï¼šhttps://spring.io/projects</p>
<h2 id="13-spring-framework">1.3ã€Spring Framework</h2>
<p>Spring åŸºç¡€æ¡†æ¶ï¼Œå¯ä»¥è§†ä¸º Spring åŸºç¡€è®¾æ–½ï¼ŒåŸºæœ¬ä¸Šä»»ä½•å…¶ä»– Spring é¡¹ç›®éƒ½æ˜¯ä»¥ Spring Framework ä¸ºåŸºç¡€çš„ã€‚</p>
<h3 id="131-spring-frameworkç‰¹æ€§">1.3.1ã€Spring Frameworkç‰¹æ€§</h3>
<ul>
<li>éä¾µå…¥å¼ï¼šä½¿ç”¨ Spring Framework å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼ŒSpring å¯¹åº”ç”¨ç¨‹åºæœ¬èº«çš„ç»“æ„å½±å“éå¸¸å°ã€‚å¯¹é¢†åŸŸæ¨¡å‹å¯ä»¥åšåˆ°é›¶æ±¡æŸ“ï¼›å¯¹åŠŸèƒ½æ€§ç»„ä»¶ä¹Ÿåªéœ€è¦ä½¿ç”¨å‡ ä¸ªç®€å•çš„æ³¨è§£è¿›è¡Œæ ‡è®°ï¼Œå®Œå…¨ä¸ä¼šç ´ååŸæœ‰ç»“æ„ï¼Œåè€Œèƒ½å°†ç»„ä»¶ç»“æ„è¿›ä¸€æ­¥ç®€åŒ–ã€‚è¿™å°±ä½¿å¾—åŸºäº Spring Framework å¼€å‘åº”ç”¨ç¨‹åºæ—¶ç»“æ„æ¸…æ™°ã€ç®€æ´ä¼˜é›…ã€‚</li>
<li>æ§åˆ¶åè½¬ï¼šIOCâ€”â€”Inversion of Controlï¼Œç¿»è½¬èµ„æºè·å–æ–¹å‘ã€‚æŠŠè‡ªå·±åˆ›å»ºèµ„æºã€å‘ç¯å¢ƒç´¢å–èµ„æºå˜æˆç¯å¢ƒå°†èµ„æºå‡†å¤‡å¥½ï¼Œæˆ‘ä»¬äº«å—èµ„æºæ³¨å…¥ã€‚</li>
<li>é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼šAOPâ€”â€”Aspect Oriented Programmingï¼Œåœ¨ä¸ä¿®æ”¹æºä»£ç çš„åŸºç¡€ä¸Šå¢å¼ºä»£ç åŠŸèƒ½ã€‚</li>
<li>å®¹å™¨ï¼šSpring IOC æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå› ä¸ºå®ƒåŒ…å«å¹¶ä¸”ç®¡ç†ç»„ä»¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ç»„ä»¶äº«å—åˆ°äº†å®¹å™¨åŒ–çš„ç®¡ç†ï¼Œæ›¿ç¨‹åºå‘˜å±è”½äº†ç»„ä»¶åˆ›å»ºè¿‡ç¨‹ä¸­çš„å¤§é‡ç»†èŠ‚ï¼Œæå¤§çš„é™ä½äº†ä½¿ç”¨é—¨æ§›ï¼Œå¤§å¹…åº¦æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</li>
<li>ç»„ä»¶åŒ–ï¼šSpring å®ç°äº†ä½¿ç”¨ç®€å•çš„ç»„ä»¶é…ç½®ç»„åˆæˆä¸€ä¸ªå¤æ‚çš„åº”ç”¨ã€‚åœ¨ Spring ä¸­å¯ä»¥ä½¿ç”¨ XML å’Œ Java æ³¨è§£ç»„åˆè¿™äº›å¯¹è±¡ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åŸºäºä¸€ä¸ªä¸ªåŠŸèƒ½æ˜ç¡®ã€è¾¹ç•Œæ¸…æ™°çš„ç»„ä»¶æœ‰æ¡ä¸ç´Šçš„æ­å»ºè¶…å¤§å‹å¤æ‚åº”ç”¨ç³»ç»Ÿã€‚</li>
<li>å£°æ˜å¼ï¼šå¾ˆå¤šä»¥å‰éœ€è¦ç¼–å†™ä»£ç æ‰èƒ½å®ç°çš„åŠŸèƒ½ï¼Œç°åœ¨åªéœ€è¦å£°æ˜éœ€æ±‚å³å¯ç”±æ¡†æ¶ä»£ä¸ºå®ç°ã€‚</li>
<li>ä¸€ç«™å¼ï¼šåœ¨ IOC å’Œ AOP çš„åŸºç¡€ä¸Šå¯ä»¥æ•´åˆå„ç§ä¼ä¸šåº”ç”¨çš„å¼€æºæ¡†æ¶å’Œä¼˜ç§€çš„ç¬¬ä¸‰æ–¹ç±»åº“ã€‚è€Œä¸” Spring æ——ä¸‹çš„é¡¹ç›®å·²ç»è¦†ç›–äº†å¹¿æ³›é¢†åŸŸï¼Œå¾ˆå¤šæ–¹é¢çš„åŠŸèƒ½æ€§éœ€æ±‚å¯ä»¥åœ¨ Spring Framework çš„åŸºç¡€ä¸Šå…¨éƒ¨ä½¿ç”¨ Spring æ¥å®ç°ã€‚</li>
</ul>
<h3 id="132-spring-frameworkäº”å¤§åŠŸèƒ½æ¨¡å—">1.3.2ã€Spring Frameworkäº”å¤§åŠŸèƒ½æ¨¡å—</h3>
<table>
<thead>
<tr>
<th>åŠŸèƒ½æ¨¡å—</th>
<th>åŠŸèƒ½ä»‹ç»</th>
</tr>
</thead>
<tbody>
<tr>
<td>Core Container</td>
<td>æ ¸å¿ƒå®¹å™¨ï¼Œåœ¨Springç¯å¢ƒä¸‹ä½¿ç”¨ä»»ä½•åŠŸèƒ½éƒ½å¿…é¡»åŸºäºIOCå®¹å™¨ã€‚</td>
</tr>
<tr>
<td>AOP&amp;Aspects</td>
<td>é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</td>
</tr>
<tr>
<td>Testing</td>
<td>æä¾›äº†å¯¹ junit æˆ– TestNG æµ‹è¯•æ¡†æ¶çš„æ•´åˆã€‚</td>
</tr>
<tr>
<td>Data Access/Integration</td>
<td>æä¾›äº†å¯¹æ•°æ®è®¿é—®/é›†æˆçš„åŠŸèƒ½ã€‚</td>
</tr>
<tr>
<td>Spring MVC</td>
<td>æä¾›äº†é¢å‘Webåº”ç”¨ç¨‹åºçš„é›†æˆåŠŸèƒ½</td>
</tr>
</tbody>
</table>
<h1 id="2-ioc">2ã€IOC</h1>
<h2 id="21-iocå®¹å™¨">2.1ã€IOCå®¹å™¨</h2>
<h3 id="211-iocæ€æƒ³">2.1.1ã€IOCæ€æƒ³</h3>
<p>IOCï¼šInversion of Controlï¼Œç¿»è¯‘è¿‡æ¥æ˜¯<strong>åè½¬æ§åˆ¶</strong>ã€‚</p>
<h4 id="1è·å–èµ„æºçš„ä¼ ç»Ÿæ–¹å¼">â‘ è·å–èµ„æºçš„ä¼ ç»Ÿæ–¹å¼</h4>
<p>è‡ªå·±åšé¥­ï¼šä¹°èœã€æ´—èœã€æ‹©èœã€æ”¹åˆ€ã€ç‚’èœï¼Œå…¨è¿‡ç¨‹å‚ä¸ï¼Œè´¹æ—¶è´¹åŠ›ï¼Œå¿…é¡»æ¸…æ¥šäº†è§£èµ„æºåˆ›å»ºæ•´ä¸ªè¿‡ç¨‹ä¸­çš„å…¨éƒ¨ç»†èŠ‚ä¸”ç†Ÿç»ƒæŒæ¡ã€‚</p>
<p>åœ¨åº”ç”¨ç¨‹åºä¸­çš„ç»„ä»¶éœ€è¦è·å–èµ„æºæ—¶ï¼Œä¼ ç»Ÿçš„æ–¹å¼æ˜¯ç»„ä»¶<strong>ä¸»åŠ¨</strong>çš„ä»å®¹å™¨ä¸­è·å–æ‰€éœ€è¦çš„èµ„æºï¼Œåœ¨è¿™æ ·çš„æ¨¡å¼ä¸‹å¼€å‘äººå‘˜å¾€å¾€éœ€è¦çŸ¥é“åœ¨å…·ä½“å®¹å™¨ä¸­ç‰¹å®šèµ„æºçš„è·å–æ–¹å¼ï¼Œå¢åŠ äº†å­¦ä¹ æˆæœ¬ï¼ŒåŒæ—¶é™ä½äº†å¼€å‘æ•ˆç‡ã€‚</p>
<h4 id="2åè½¬æ§åˆ¶æ–¹å¼è·å–èµ„æº">â‘¡åè½¬æ§åˆ¶æ–¹å¼è·å–èµ„æº</h4>
<p>ç‚¹å¤–å–ï¼šä¸‹å•ã€ç­‰ã€åƒï¼Œçœæ—¶çœåŠ›ï¼Œä¸å¿…å…³å¿ƒèµ„æºåˆ›å»ºè¿‡ç¨‹çš„æ‰€æœ‰ç»†èŠ‚ã€‚</p>
<p>åè½¬æ§åˆ¶çš„æ€æƒ³å®Œå…¨é¢ è¦†äº†åº”ç”¨ç¨‹åºç»„ä»¶è·å–èµ„æºçš„ä¼ ç»Ÿæ–¹å¼ï¼šåè½¬äº†èµ„æºçš„è·å–æ–¹å‘â€”â€”â€”æ”¹ç”±å®¹å™¨ä¸»åŠ¨çš„å°†èµ„æºæ¨é€ç»™éœ€è¦çš„ç»„ä»¶ï¼Œå¼€å‘äººå‘˜ä¸éœ€è¦çŸ¥é“å®¹å™¨æ˜¯å¦‚ä½•åˆ›å»ºèµ„æºå¯¹è±¡çš„ï¼Œåªéœ€è¦æä¾›æ¥æ”¶èµ„æºçš„æ–¹å¼å³å¯ï¼Œæå¤§çš„é™ä½äº†å­¦ä¹ æˆæœ¬ï¼Œæé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚è¿™ç§è¡Œä¸ºä¹Ÿç§°ä¸ºæŸ¥æ‰¾çš„<strong>è¢«åŠ¨</strong>å½¢å¼ã€‚</p>
<h4 id="3di">â‘¢DI</h4>
<p>DIï¼šDependency Injectionï¼Œç¿»è¯‘è¿‡æ¥æ˜¯<strong>ä¾èµ–æ³¨å…¥</strong>ã€‚</p>
<p>DI æ˜¯ IOC çš„å¦ä¸€ç§è¡¨è¿°æ–¹å¼ï¼ˆå®ç°æ–¹å¼ï¼‰ï¼šå³ç»„ä»¶ä»¥ä¸€äº›é¢„å…ˆå®šä¹‰å¥½çš„æ–¹å¼ï¼ˆä¾‹å¦‚ï¼šsetter æ–¹æ³•ï¼‰æ¥å—æ¥è‡ªäºå®¹å™¨çš„èµ„æºæ³¨å…¥ã€‚ç›¸å¯¹äºIOCè€Œè¨€ï¼Œè¿™ç§è¡¨è¿°æ›´ç›´æ¥ã€‚</p>
<p>æ‰€ä»¥ç»“è®ºæ˜¯ï¼šIOC å°±æ˜¯ä¸€ç§åè½¬æ§åˆ¶çš„æ€æƒ³ï¼Œ è€Œ DI æ˜¯å¯¹ IOC çš„ä¸€ç§==<strong>å…·ä½“å®ç°</strong>==ã€‚</p>
<h3 id="212-iocå®¹å™¨åœ¨springä¸­çš„å®ç°">2.1.2ã€IOCå®¹å™¨åœ¨Springä¸­çš„å®ç°</h3>
<p>Spring çš„ IOC å®¹å™¨å°±æ˜¯ IOC æ€æƒ³çš„ä¸€ä¸ªè½åœ°çš„äº§å“å®ç°ã€‚IOC å®¹å™¨ä¸­ç®¡ç†çš„ç»„ä»¶ä¹Ÿå«åš beanã€‚åœ¨åˆ›å»º bean ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åˆ›å»º IOC å®¹å™¨ã€‚Spring æä¾›äº† IOC å®¹å™¨çš„ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<h4 id="1beanfactory">â‘ BeanFactory</h4>
<ul>
<li>è¿™æ˜¯ IOC å®¹å™¨çš„åŸºæœ¬å®ç°ï¼Œæ˜¯ Spring å†…éƒ¨ä½¿ç”¨çš„æ¥å£ã€‚é¢å‘ Spring æœ¬èº«ï¼Œä¸æä¾›ç»™å¼€å‘äººå‘˜ä½¿ç”¨ã€‚</li>
</ul>
<h4 id="2applicationcontext">â‘¡ApplicationContext</h4>
<ul>
<li>BeanFactory çš„å­æ¥å£ï¼Œæä¾›äº†æ›´å¤šé«˜çº§ç‰¹æ€§ã€‚é¢å‘ Spring çš„ä½¿ç”¨è€…ï¼Œå‡ ä¹æ‰€æœ‰åœºåˆéƒ½ä½¿ç”¨ ApplicationContext è€Œä¸æ˜¯åº•å±‚çš„ BeanFactoryã€‚</li>
</ul>
<blockquote>
<p>ä»¥ååœ¨ Spring ç¯å¢ƒä¸‹çœ‹åˆ°ä¸€ä¸ªç±»æˆ–æ¥å£çš„åç§°ä¸­åŒ…å« ApplicationContextï¼Œé‚£åŸºæœ¬å°±å¯ä»¥æ–­å®šï¼Œè¿™ä¸ªç±»æˆ–æ¥å£ä¸ IOC å®¹å™¨æœ‰å…³ã€‚</p>
</blockquote>
<h4 id="3applicationcontextçš„ä¸»è¦å®ç°ç±»">â‘¢ApplicationContextçš„ä¸»è¦å®ç°ç±»</h4>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721104046.png" alt="" loading="lazy"></figure>
<table>
<thead>
<tr>
<th>ç±»å‹å</th>
<th>ç®€ä»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ClassPathXmlApplicationContext</td>
<td>é€šè¿‡è¯»å–ç±»è·¯å¾„ä¸‹çš„ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡</td>
</tr>
<tr>
<td>FileSystemXmlApplicationContext</td>
<td>é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è¯»å– XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡</td>
</tr>
<tr>
<td>ConfigurableApplicationContext</td>
<td>ApplicationContext çš„å­æ¥å£ï¼ŒåŒ…å«ä¸€äº›æ‰©å±•æ–¹æ³• refresh() å’Œ close() ï¼Œè®© ApplicationContext å…·æœ‰å¯åŠ¨ã€å…³é—­å’Œåˆ·æ–°ä¸Šä¸‹æ–‡ï¼ˆå®¹å™¨ï¼‰çš„èƒ½åŠ›ã€‚</td>
</tr>
<tr>
<td>WebApplicationContext</td>
<td>ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡ï¼ŒåŸºäº Web ç¯å¢ƒåˆ›å»º IOC å®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•å…¥å­˜å…¥ ServletContext åŸŸä¸­ã€‚</td>
</tr>
</tbody>
</table>
<h2 id="22-åŸºäºxmlç®¡ç†bean">2.2ã€åŸºäºXMLç®¡ç†bean</h2>
<h3 id="221-å®éªŒä¸€åˆ›å»ºbean">2.2.1ã€å®éªŒä¸€ï¼šåˆ›å»ºbean</h3>
<h4 id="1åˆ›å»ºmaven-module">â‘ åˆ›å»ºMaven Module</h4>
<h4 id="2å¼•å…¥ä¾èµ–">â‘¡å¼•å…¥ä¾èµ–</h4>
<pre><code class="language-xml">&lt;dependencies&gt;
    &lt;!-- åŸºäºMavenä¾èµ–ä¼ é€’æ€§ï¼Œå¯¼å…¥spring-contextä¾èµ–å³å¯å¯¼å…¥å½“å‰æ‰€éœ€æ‰€æœ‰jaråŒ… --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- junitæµ‹è¯• --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721105410.png" alt="" loading="lazy"></figure>
<h4 id="3åˆ›å»ºç±»helloworld">â‘¢åˆ›å»ºç±»HelloWorld</h4>
<pre><code class="language-java">package com.atguigu.spring.pojo;

public class HelloWorld {
    public void sayHello() {
        System.out.println(&quot;Hello Spring&quot;);
    }
}
</code></pre>
<h4 id="4åˆ›å»ºspringçš„é…ç½®æ–‡ä»¶">â‘£åˆ›å»ºSpringçš„é…ç½®æ–‡ä»¶</h4>
<p>applicationContext.xml</p>
<figure data-type="image" tabindex="3"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721110013.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="4"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721110038.png" alt="" loading="lazy"></figure>
<h4 id="5åœ¨springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®bean">â‘¤åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®bean</h4>
<pre><code class="language-xml">&lt;!--
		é…ç½®HelloWorldæ‰€å¯¹åº”çš„beanï¼Œå³å°†HelloWorldçš„å¯¹è±¡äº¤ç»™Springçš„IOCå®¹å™¨ç®¡ç†
		é€šè¿‡beanæ ‡ç­¾é…ç½®IOCå®¹å™¨æ‰€ç®¡ç†çš„bean
		å±æ€§ï¼š
				idï¼šè®¾ç½®beançš„å”¯ä¸€æ ‡è¯†
				classï¼šè®¾ç½®beanæ‰€å¯¹åº”ç±»å‹çš„å…¨ç±»å
--&gt;
&lt;bean id=&quot;helloworld&quot; class=&quot;com.atguigu.spring.bean.HelloWorld&quot;&gt;&lt;/bean&gt;
</code></pre>
<h4 id="6åˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•">â‘¥åˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testHelloWorld() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
    HelloWorld helloWorld = ioc.getBean(HelloWorld.class);
    helloWorld.sayHello();
}
</code></pre>
<h4 id="7æ€è·¯">â‘¦æ€è·¯</h4>
<figure data-type="image" tabindex="5"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721112410.png" alt="" loading="lazy"></figure>
<h4 id="8æ³¨æ„">â‘§æ³¨æ„</h4>
<p>Spring åº•å±‚é»˜è®¤é€šè¿‡åå°„æŠ€æœ¯è°ƒç”¨ç»„ä»¶ç±»çš„æ— å‚æ„é€ å™¨æ¥åˆ›å»ºç»„ä»¶å¯¹è±¡ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚å¦‚æœåœ¨éœ€è¦æ— å‚æ„é€ å™¨æ—¶ï¼Œæ²¡æœ‰æ— å‚æ„é€ å™¨ï¼Œåˆ™ä¼šæŠ›å‡ºä¸‹é¢çš„å¼‚å¸¸ï¼š</p>
<blockquote>
<p>org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'helloworld' defined in class path resource [applicationContext.xml]: Instantiation of bean failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.atguigu.spring.bean.HelloWorld]: No default constructor found; nested exception is java.lang.NoSuchMethodException: com.atguigu.spring.bean.HelloWorld. ()</p>
</blockquote>
<h3 id="222-å®éªŒäºŒè·å–bean">2.2.2ã€å®éªŒäºŒï¼šè·å–bean</h3>
<h4 id="1æ–¹å¼ä¸€æ ¹æ®idè·å–">â‘ æ–¹å¼ä¸€ï¼šæ ¹æ®idè·å–</h4>
<p>ç”±äº id å±æ€§æŒ‡å®šäº† bean çš„å”¯ä¸€æ ‡è¯†ï¼Œæ‰€ä»¥æ ¹æ® bean æ ‡ç­¾çš„ id å±æ€§å¯ä»¥ç²¾ç¡®è·å–åˆ°ä¸€ä¸ªç»„ä»¶å¯¹è±¡ã€‚ä¸Šä¸ªå®éªŒä¸­æˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚</p>
<h4 id="2æ–¹å¼äºŒæ ¹æ®ç±»å‹è·å–">â‘¡æ–¹å¼äºŒï¼šæ ¹æ®ç±»å‹è·å–</h4>
<pre><code class="language-java">@Test
public void testHelloWorld() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
    HelloWorld bean = ioc.getBean(HelloWorld.class);
    bean.sayHello();
}
</code></pre>
<h4 id="3æ–¹å¼ä¸‰æ ¹æ®idå’Œç±»å‹">â‘¢æ–¹å¼ä¸‰ï¼šæ ¹æ®idå’Œç±»å‹</h4>
<pre><code class="language-java">@Test
public void testHelloWorld() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
    HelloWorld bean = ioc.getBean(&quot;helloworld&quot;, HelloWorld.class);
    bean.sayHello();
}
</code></pre>
<h4 id="4æ³¨æ„">â‘£æ³¨æ„</h4>
<ul>
<li>
<p>å½“æ ¹æ®ç±»å‹è·å–beanæ—¶ï¼Œè¦æ±‚IOCå®¹å™¨ä¸­æŒ‡å®šç±»å‹çš„beanæœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª</p>
</li>
<li>
<p>å½“IOCå®¹å™¨ä¸­ä¸€å…±é…ç½®äº†ä¸¤ä¸ªï¼š</p>
<pre><code class="language-xml">&lt;bean id=&quot;helloworldOne&quot; class=&quot;com.atguigu.spring.bean.HelloWorld&quot;&gt;&lt;/bean&gt;
&lt;bean id=&quot;helloworldTwo&quot; class=&quot;com.atguigu.spring.bean.HelloWorld&quot;&gt;&lt;/bean&gt;
</code></pre>
</li>
<li>
<p>æ ¹æ®ç±»å‹è·å–æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
<blockquote>
<p>org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'com.atguigu.spring.bean.HelloWorld' available: expected single matching bean but found 2: helloworldOne,helloworldTwo</p>
</blockquote>
</li>
</ul>
<h4 id="5æ‰©å±•">â‘¤æ‰©å±•</h4>
<p>å¦‚æœç»„ä»¶ç±»å®ç°äº†æ¥å£ï¼Œæ ¹æ®æ¥å£ç±»å‹å¯ä»¥è·å–ç»„ä»¶ç±» bean å—ï¼Ÿ</p>
<blockquote>
<p>å¯ä»¥ï¼Œå‰ææ˜¯beanå”¯ä¸€</p>
</blockquote>
<p>å¦‚æœä¸€ä¸ªæ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œè¿™äº›å®ç°ç±»éƒ½é…ç½®äº† beanï¼Œæ ¹æ®æ¥å£ç±»å‹å¯ä»¥è·å–å®ç°ç±» bean å—ï¼Ÿ</p>
<blockquote>
<p>ä¸è¡Œï¼Œå› ä¸ºbeanä¸å”¯ä¸€</p>
</blockquote>
<p>å¦‚æœä¸€ä¸ªçˆ¶ç±»åªæœ‰ä¸€ä¸ªå­ç±»ï¼Œæ ¹æ®çˆ¶ç±»ç±»å‹å¯ä»¥è·å–å­ç±» bean å—ï¼Ÿ</p>
<blockquote>
<p>å¯ä»¥ï¼Œå‰ææ˜¯beanå”¯ä¸€</p>
</blockquote>
<p>å¦‚æœä¸€ä¸ªçˆ¶ç±»æœ‰å¤šä¸ªå­ç±»ï¼Œæ ¹æ®çˆ¶ç±»ç±»å‹å¯ä»¥å­ç±»è·å– bean å—ï¼Ÿ</p>
<blockquote>
<p>ä¸è¡Œï¼Œå› ä¸ºbeanä¸å”¯ä¸€</p>
</blockquote>
<h4 id="6ç»“è®º">â‘¥ç»“è®º</h4>
<p>æ ¹æ®ç±»å‹æ¥è·å–beanæ—¶ï¼Œåœ¨æ»¡è¶³beanå”¯ä¸€æ€§çš„å‰æä¸‹ï¼Œå…¶å®åªæ˜¯çœ‹ï¼šã€å¯¹è±¡ <strong>instanceof</strong> æŒ‡å®šçš„ç±»å‹ã€çš„è¿”å›ç»“æœï¼Œåªè¦è¿”å›çš„æ˜¯trueå°±å¯ä»¥è®¤å®šä¸ºå’Œç±»å‹åŒ¹é…ï¼Œèƒ½å¤Ÿè·å–åˆ°ã€‚</p>
<h3 id="223-å®éªŒä¸‰ä¾èµ–æ³¨å…¥ä¹‹setteræ³¨å…¥">2.2.3ã€å®éªŒä¸‰ï¼šä¾èµ–æ³¨å…¥ä¹‹setteræ³¨å…¥</h3>
<h4 id="1åˆ›å»ºå­¦ç”Ÿç±»student">â‘ åˆ›å»ºå­¦ç”Ÿç±»Student</h4>
<pre><code class="language-java">public class Student {
    
    private Integer id;
    private String name;
    private Integer age;
    private String sex;

    public Student() {
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    @Override
    public String toString() {
        return &quot;Student{&quot; +
                &quot;id=&quot; + id +
                &quot;, name='&quot; + name + '\'' +
                &quot;, age=&quot; + age +
                &quot;, sex='&quot; + sex + '\'' +
                '}';
    }

}
</code></pre>
<h4 id="2é…ç½®beanæ—¶ä¸ºå±æ€§èµ‹å€¼">â‘¡é…ç½®beanæ—¶ä¸ºå±æ€§èµ‹å€¼</h4>
<p>spring-di.xml</p>
<pre><code class="language-xml"> &lt;bean id=&quot;studentOne&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
     &lt;!-- propertyæ ‡ç­¾ï¼šé€šè¿‡ç»„ä»¶ç±»çš„setXxx()æ–¹æ³•ç»™ç»„ä»¶å¯¹è±¡è®¾ç½®å±æ€§ --&gt;
     &lt;!-- nameå±æ€§ï¼šæŒ‡å®šå±æ€§åï¼ˆè¿™ä¸ªå±æ€§åæ˜¯getXxx()ã€setXxx()æ–¹æ³•å®šä¹‰çš„ï¼Œå’Œæˆå‘˜å˜é‡æ— å…³ï¼‰
     --&gt;
     &lt;!-- valueå±æ€§ï¼šæŒ‡å®šå±æ€§å€¼ --&gt;
     &lt;property name=&quot;id&quot; value=&quot;1001&quot;&gt;&lt;/property&gt;
     &lt;property name=&quot;name&quot; value=&quot;å¼ ä¸‰&quot;&gt;&lt;/property&gt;
     &lt;property name=&quot;age&quot; value=&quot;23&quot;&gt;&lt;/property&gt;
     &lt;property name=&quot;sex&quot; value=&quot;ç”·&quot;&gt;&lt;/property&gt;
 &lt;/bean&gt;
</code></pre>
<h4 id="3æµ‹è¯•">â‘¢æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testDIBySet() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;spring-di.xml&quot;);
    Student studentOne = ioc.getBean(&quot;studentOne&quot;, Student.class);
    System.out.println(studentOne);
}
</code></pre>
<h3 id="224-å®éªŒå››ä¾èµ–æ³¨å…¥ä¹‹æ„é€ å™¨æ³¨å…¥">2.2.4ã€å®éªŒå››ï¼šä¾èµ–æ³¨å…¥ä¹‹æ„é€ å™¨æ³¨å…¥</h3>
<h4 id="1åœ¨studentç±»ä¸­æ·»åŠ æœ‰å‚æ„é€ ">â‘ åœ¨Studentç±»ä¸­æ·»åŠ æœ‰å‚æ„é€ </h4>
<pre><code class="language-java">public Student(Integer id, String name, Integer age, String sex) {
    this.id = id;
    this.name = name;
    this.age = age;
    this.sex = sex;
}
</code></pre>
<h4 id="2é…ç½®bean">â‘¡é…ç½®bean</h4>
<pre><code class="language-xml">&lt;bean id=&quot;studentTwo&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;constructor-arg value=&quot;1002&quot;&gt;&lt;/constructor-arg&gt;
    &lt;constructor-arg value=&quot;æå››&quot;&gt;&lt;/constructor-arg&gt;
    &lt;constructor-arg value=&quot;33&quot;&gt;&lt;/constructor-arg&gt;
    &lt;constructor-arg value=&quot;å¥³&quot;&gt;&lt;/constructor-arg&gt;
&lt;/bean&gt;
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p>constructor-argæ ‡ç­¾è¿˜æœ‰ä¸¤ä¸ªå±æ€§å¯ä»¥è¿›ä¸€æ­¥æè¿°æ„é€ å™¨å‚æ•°ï¼š</p>
<ul>
<li>indexå±æ€§ï¼šæŒ‡å®šå‚æ•°æ‰€åœ¨ä½ç½®çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰</li>
<li>nameå±æ€§ï¼šæŒ‡å®šå‚æ•°å</li>
</ul>
</blockquote>
<h4 id="3æµ‹è¯•-2">â‘¢æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testDIBySet() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;spring-di.xml&quot;);
    Student studentOne = ioc.getBean(&quot;studentTwo&quot;, Student.class);
    System.out.println(studentOne);
}
</code></pre>
<h3 id="225-å®éªŒäº”ç‰¹æ®Šå€¼å¤„ç†">2.2.5ã€å®éªŒäº”ï¼šç‰¹æ®Šå€¼å¤„ç†</h3>
<h4 id="1å­—é¢é‡èµ‹å€¼">â‘ å­—é¢é‡èµ‹å€¼</h4>
<blockquote>
<p>ä»€ä¹ˆæ˜¯å­—é¢é‡ï¼Ÿ (åŸºæœ¬ç±»å‹å˜é‡)</p>
<p>int a = 10;</p>
<p>å£°æ˜ä¸€ä¸ªå˜é‡aï¼Œåˆå§‹åŒ–ä¸º10ï¼Œæ­¤æ—¶aå°±ä¸ä»£è¡¨å­—æ¯aäº†ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªå˜é‡çš„åå­—ã€‚å½“æˆ‘ä»¬å¼•ç”¨açš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ‹¿åˆ°çš„å€¼æ˜¯10ã€‚ï¼ˆè¿™é‡Œ10å°±æ˜¯å­—é¢é‡ï¼‰</p>
<p>è€Œå¦‚æœaæ˜¯å¸¦å¼•å·çš„ï¼š'a'ï¼Œé‚£ä¹ˆå®ƒç°åœ¨ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå°±æ˜¯ä»£è¡¨aè¿™ä¸ªå­—æ¯æœ¬èº«ï¼Œè¿™å°±æ˜¯å­—é¢é‡ã€‚æ‰€ä»¥å­—é¢é‡æ²¡æœ‰å¼•ç”³å«ä¹‰ï¼Œå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªæ•°æ®æœ¬èº«ã€‚</p>
</blockquote>
<pre><code class="language-xml">&lt;!-- ä½¿ç”¨valueå±æ€§ç»™beançš„å±æ€§èµ‹å€¼æ—¶ï¼ŒSpringä¼šæŠŠvalueå±æ€§çš„å€¼çœ‹åšå­—é¢é‡ --&gt;
&lt;property name=&quot;name&quot; value=&quot;å¼ ä¸‰&quot;/&gt;
</code></pre>
<h4 id="2nullå€¼">â‘¡nullå€¼</h4>
<pre><code class="language-xml"> &lt;property name=&quot;name&quot;&gt;
     &lt;null/&gt;
 &lt;/property&gt;
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<pre><code class="language-xml">&lt;property name=&quot;name&quot; value=&quot;null&quot;&gt;&lt;/property&gt;
</code></pre>
<p>ä»¥ä¸Šå†™æ³•ï¼Œä¸ºnameæ‰€èµ‹çš„å€¼æ˜¯å­—ç¬¦ä¸²null</p>
</blockquote>
<h4 id="3xmlå®ä½“">â‘¢xmlå®ä½“</h4>
<pre><code class="language-xml">&lt;!-- å°äºå·åœ¨XMLæ–‡æ¡£ä¸­ç”¨æ¥å®šä¹‰æ ‡ç­¾çš„å¼€å§‹ï¼Œä¸èƒ½éšä¾¿ä½¿ç”¨ --&gt;
&lt;!-- è§£å†³æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨XMLå®ä½“æ¥ä»£æ›¿ --&gt;
&lt;property name=&quot;expression&quot; value=&quot;a &amp;lt; b&quot;/&gt;
</code></pre>
<h4 id="4cdataèŠ‚">â‘£CDATAèŠ‚</h4>
<pre><code class="language-xml">&lt;property name=&quot;expression&quot;&gt;
		&lt;!-- è§£å†³æ–¹æ¡ˆäºŒï¼šä½¿ç”¨CDATAèŠ‚ --&gt;
		&lt;!-- CDATAä¸­çš„Cä»£è¡¨Characterï¼Œæ˜¯æ–‡æœ¬ã€å­—ç¬¦çš„å«ä¹‰ï¼ŒCDATAå°±è¡¨ç¤ºçº¯æ–‡æœ¬æ•°æ® --&gt;
		&lt;!-- XMLè§£æå™¨çœ‹åˆ°CDATAèŠ‚å°±çŸ¥é“è¿™é‡Œæ˜¯çº¯æ–‡æœ¬ï¼Œå°±ä¸ä¼šå½“ä½œXMLæ ‡ç­¾æˆ–å±æ€§æ¥è§£æ --&gt;
		&lt;!-- æ‰€ä»¥CDATAèŠ‚ä¸­å†™ä»€ä¹ˆç¬¦å·éƒ½éšæ„ --&gt;
&lt;value&gt;&lt;![CDATA[a &lt; b]]&gt;&lt;/value&gt;
&lt;/property&gt;
</code></pre>
<h3 id="226-å®éªŒå…­ä¸ºç±»ç±»å‹å±æ€§èµ‹å€¼">2.2.6ã€å®éªŒå…­ï¼šä¸ºç±»ç±»å‹å±æ€§èµ‹å€¼</h3>
<h4 id="1åˆ›å»ºç­çº§ç±»clazz">â‘ åˆ›å»ºç­çº§ç±»Clazz</h4>
<pre><code class="language-java">public class Clazz {
    private Integer clazzId;
    private String clazzName;

    public Integer getClazzId() {
        return clazzId;
    }

    public void setClazzId(Integer clazzId) {
        this.clazzId = clazzId;
    }

    public String getClazzName() {
        return clazzName;
    }

    public void setClazzName(String clazzName) {
        this.clazzName = clazzName;
    }

    @Override
    public String toString() {
        return &quot;Clazz{&quot; +
                &quot;clazzId=&quot; + clazzId +
                &quot;, clazzName='&quot; + clazzName + '\'' +
                '}';
    }

    public Clazz() {
    }

    public Clazz(Integer clazzId, String clazzName) {
        this.clazzId = clazzId;
        this.clazzName = clazzName;
    }
}
</code></pre>
<h4 id="2ä¿®æ”¹studentç±»">â‘¡ä¿®æ”¹Studentç±»</h4>
<p>åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">private Clazz clazz;
public Clazz getClazz() {
    return clazz;
}
public void setClazz(Clazz clazz) {
    this.clazz = clazz;
}
</code></pre>
<h4 id="3æ–¹å¼ä¸€å¼•ç”¨å¤–éƒ¨å·²å£°æ˜çš„bean">â‘¢æ–¹å¼ä¸€ï¼šå¼•ç”¨å¤–éƒ¨å·²å£°æ˜çš„bean</h4>
<p>é…ç½®Clazzç±»å‹çš„beanï¼š</p>
<pre><code class="language-xml">&lt;bean id=&quot;clazzOne&quot; class=&quot;com.atguigu.spring.bean.Clazz&quot;&gt;
    &lt;property name=&quot;clazzId&quot; value=&quot;1111&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;clazzName&quot; value=&quot;è´¢æºæ»šæ»šç­&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<p>ä¸ºStudentä¸­çš„clazzå±æ€§èµ‹å€¼ï¼š</p>
<pre><code class="language-xml">&lt;bean id=&quot;studentFour&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;1004&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;name&quot; value=&quot;èµµå…­&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;age&quot; value=&quot;26&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;sex&quot; value=&quot;å¥³&quot;&gt;&lt;/property&gt;
    &lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;
    &lt;property name=&quot;clazz&quot; ref=&quot;clazzOne&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<p>é”™è¯¯æ¼”ç¤ºï¼š</p>
<pre><code class="language-xml">&lt;bean id=&quot;studentFour&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;1004&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;name&quot; value=&quot;èµµå…­&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;age&quot; value=&quot;26&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;sex&quot; value=&quot;å¥³&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;clazz&quot; value=&quot;clazzOne&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<blockquote>
<p>å¦‚æœé”™æŠŠrefå±æ€§å†™æˆäº†valueå±æ€§ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š Caused by: java.lang.IllegalStateException: Cannot convert value of type 'java.lang.String' to required type 'com.atguigu.spring.bean.Clazz' for property 'clazz': no matching editors or conversion strategy found æ„æ€æ˜¯ä¸èƒ½æŠŠStringç±»å‹è½¬æ¢æˆæˆ‘ä»¬è¦çš„Clazzç±»å‹ï¼Œè¯´æ˜æˆ‘ä»¬ä½¿ç”¨valueå±æ€§æ—¶ï¼ŒSpringåªæŠŠè¿™ä¸ªå±æ€§çœ‹åšä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼Œä¸ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªbeançš„idï¼Œæ›´ä¸ä¼šæ ¹æ®å®ƒå»æ‰¾åˆ°beanæ¥èµ‹å€¼</p>
</blockquote>
<h4 id="4æ–¹å¼äºŒå†…éƒ¨bean">â‘£æ–¹å¼äºŒï¼šå†…éƒ¨bean</h4>
<pre><code class="language-xml">&lt;bean id=&quot;studentFour&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;1004&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;name&quot; value=&quot;èµµå…­&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;age&quot; value=&quot;26&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;sex&quot; value=&quot;å¥³&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;clazz&quot;&gt;
        &lt;!-- åœ¨ä¸€ä¸ªbeanä¸­å†å£°æ˜ä¸€ä¸ªbeanå°±æ˜¯å†…éƒ¨bean --&gt;
        &lt;!-- å†…éƒ¨beanåªèƒ½ç”¨äºç»™å±æ€§èµ‹å€¼ï¼Œä¸èƒ½åœ¨å¤–éƒ¨é€šè¿‡IOCå®¹å™¨è·å–ï¼Œå› æ­¤å¯ä»¥çœç•¥idå±æ€§ --&gt;
        &lt;bean id=&quot;clazzInner&quot; class=&quot;com.atguigu.spring.bean.Clazz&quot;&gt;
            &lt;property name=&quot;clazzId&quot; value=&quot;2222&quot;&gt;&lt;/property&gt;
            &lt;property name=&quot;clazzName&quot; value=&quot;è¿œå¤§å‰ç¨‹ç­&quot;&gt;&lt;/property&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<h4 id="3æ–¹å¼ä¸‰çº§è”å±æ€§èµ‹å€¼">â‘¢æ–¹å¼ä¸‰ï¼šçº§è”å±æ€§èµ‹å€¼</h4>
<pre><code class="language-xml">&lt;bean id=&quot;studentFour&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;1004&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;name&quot; value=&quot;èµµå…­&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;age&quot; value=&quot;26&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;sex&quot; value=&quot;å¥³&quot;&gt;&lt;/property&gt;
    &lt;!-- çº§è”çš„æ–¹å¼ï¼Œè¦ä¿è¯æå‰ä¸ºclazzå±æ€§èµ‹å€¼æˆ–è€…å®ä¾‹åŒ– --&gt;
    &lt;!-- æ‰€ä»¥è¿™ç§æ–¹å¼ç›¸å½“äºä¿®æ”¹ï¼Œä¸€èˆ¬ä¸ç”¨çº§è”èµ‹å€¼ --&gt;
    &lt;property name=&quot;clazz&quot; ref=&quot;clazzOne&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;clazz.clazzId&quot; value=&quot;3333&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;clazz.clazzName&quot; value=&quot;æœ€å¼ºç‹è€…ç­&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<h3 id="227-å®éªŒä¸ƒä¸ºæ•°ç»„ç±»å‹å±æ€§èµ‹å€¼">2.2.7ã€å®éªŒä¸ƒï¼šä¸ºæ•°ç»„ç±»å‹å±æ€§èµ‹å€¼</h3>
<h4 id="1ä¿®æ”¹studentç±»">â‘ ä¿®æ”¹Studentç±»</h4>
<p>åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">private String[] hobbies;
public String[] getHobbies() {
    return hobbies;
}
public void setHobbies(String[] hobbies) {
    this.hobbies = hobbies;

</code></pre>
<h4 id="2é…ç½®bean-2">â‘¡é…ç½®bean</h4>
<pre><code class="language-xml">&lt;bean id=&quot;studentFour&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;1004&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;name&quot; value=&quot;èµµå…­&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;age&quot; value=&quot;26&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;sex&quot; value=&quot;å¥³&quot;&gt;&lt;/property&gt;
    &lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;
    &lt;property name=&quot;clazz&quot; ref=&quot;clazzOne&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;hobbies&quot;&gt;
        &lt;array&gt;
            &lt;value&gt;æŠ½çƒŸ&lt;/value&gt;
            &lt;value&gt;å–é…’&lt;/value&gt;
            &lt;value&gt;çƒ«å¤´&lt;/value&gt;
        &lt;/array&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<h3 id="228-å®éªŒå…«ä¸ºé›†åˆç±»å‹å±æ€§èµ‹å€¼">2.2.8ã€å®éªŒå…«ï¼šä¸ºé›†åˆç±»å‹å±æ€§èµ‹å€¼</h3>
<h4 id="1ä¸ºlisté›†åˆç±»å‹å±æ€§èµ‹å€¼">â‘ ä¸ºListé›†åˆç±»å‹å±æ€§èµ‹å€¼</h4>
<p>åœ¨Clazzç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">private List&lt;Student&gt; students;
public List&lt;Student&gt; getStudents() {
    return students;
}
public void setStudents(List&lt;Student&gt; students) {
    this.students = students;
}
</code></pre>
<p>é…ç½®beanï¼š</p>
<pre><code class="language-xml">&lt;bean id=&quot;clazzTwo&quot; class=&quot;com.atguigu.spring.bean.Clazz&quot;&gt;
    &lt;property name=&quot;clazzId&quot; value=&quot;4444&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;clazzName&quot; value=&quot;Javaee0222&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;students&quot;&gt;
        &lt;list&gt;
            &lt;ref bean=&quot;studentOne&quot;&gt;&lt;/ref&gt;
            &lt;ref bean=&quot;studentTwo&quot;&gt;&lt;/ref&gt;
            &lt;ref bean=&quot;studentThree&quot;&gt;&lt;/ref&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<blockquote>
<p>è‹¥ä¸ºSeté›†åˆç±»å‹å±æ€§èµ‹å€¼ï¼Œåªéœ€è¦å°†å…¶ä¸­çš„listæ ‡ç­¾æ”¹ä¸ºsetæ ‡ç­¾å³å¯</p>
</blockquote>
<h4 id="2ä¸ºmapé›†åˆç±»å‹å±æ€§èµ‹å€¼">â‘¡ä¸ºMapé›†åˆç±»å‹å±æ€§èµ‹å€¼</h4>
<p>åˆ›å»ºæ•™å¸ˆç±»Teacherï¼š</p>
<pre><code class="language-java">public class Teacher {
    private Integer teacherId;

    private String teacherName;

    public Teacher() {
    }

    public Teacher(Integer teacherId, String teacherName) {
        this.teacherId = teacherId;
        this.teacherName = teacherName;
    }

    public Integer getTeacherId() {
        return teacherId;
    }

    public void setTeacherId(Integer teacherId) {
        this.teacherId = teacherId;
    }

    public String getTeacherName() {
        return teacherName;
    }

    public void setTeacherName(String teacherName) {
        this.teacherName = teacherName;
    }

    @Override
    public String toString() {
        return &quot;Teacher{&quot; +
                &quot;teacherId=&quot; + teacherId +
                &quot;, teacherName='&quot; + teacherName + '\'' +
                '}';
    }
}
</code></pre>
<p>åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">private Map&lt;String, Teacher&gt; teacherMap;
public Map&lt;String, Teacher&gt; getTeacherMap() {
    return teacherMap;
}
public void setTeacherMap(Map&lt;String, Teacher&gt; teacherMap) {
    this.teacherMap = teacherMap;
}
</code></pre>
<p>é…ç½®beanï¼š</p>
<pre><code class="language-xml">&lt;bean id=&quot;teacherOne&quot; class=&quot;com.atguigu.spring.bean.Teacher&quot;&gt;
    &lt;property name=&quot;teacherId&quot; value=&quot;10010&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;teacherName&quot; value=&quot;å¤§å®&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
&lt;bean id=&quot;teacherTwo&quot; class=&quot;com.atguigu.spring.bean.Teacher&quot;&gt;
    &lt;property name=&quot;teacherId&quot; value=&quot;10086&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;teacherName&quot; value=&quot;äºŒå®&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
&lt;bean id=&quot;studentFour&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;1004&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;name&quot; value=&quot;èµµå…­&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;age&quot; value=&quot;26&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;sex&quot; value=&quot;å¥³&quot;&gt;&lt;/property&gt;
    &lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;
    &lt;property name=&quot;clazz&quot; ref=&quot;clazzOne&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;hobbies&quot;&gt;
        &lt;array&gt;
            &lt;value&gt;æŠ½çƒŸ&lt;/value&gt;
            &lt;value&gt;å–é…’&lt;/value&gt;
            &lt;value&gt;çƒ«å¤´&lt;/value&gt;
        &lt;/array&gt;
    &lt;/property&gt;
    &lt;property name=&quot;teacherMap&quot;&gt;
        &lt;map&gt;
            &lt;entry&gt;
                &lt;key&gt;
                    &lt;value&gt;10010&lt;/value&gt;
                &lt;/key&gt;
                &lt;ref bean=&quot;teacherOne&quot;&gt;&lt;/ref&gt;
            &lt;/entry&gt;
            &lt;entry&gt;
                &lt;key&gt;
                    &lt;value&gt;10086&lt;/value&gt;
                &lt;/key&gt;
                &lt;ref bean=&quot;teacherTwo&quot;&gt;&lt;/ref&gt;
            &lt;/entry&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean
</code></pre>
<h4 id="3å¼•ç”¨é›†åˆç±»å‹çš„bean">â‘¢å¼•ç”¨é›†åˆç±»å‹çš„bean</h4>
<pre><code class="language-xml">&lt;!--listé›†åˆç±»å‹çš„bean--&gt;
&lt;util:list id=&quot;students&quot;&gt;
    &lt;ref bean=&quot;studentOne&quot;&gt;&lt;/ref&gt;
    &lt;ref bean=&quot;studentTwo&quot;&gt;&lt;/ref&gt;
    &lt;ref bean=&quot;studentThree&quot;&gt;&lt;/ref&gt;
&lt;/util:list&gt;
&lt;!--mapé›†åˆç±»å‹çš„bean--&gt;
&lt;util:map id=&quot;teacherMap&quot;&gt;
    &lt;entry&gt;
        &lt;key&gt;
            &lt;value&gt;10010&lt;/value&gt;
        &lt;/key&gt;
        &lt;ref bean=&quot;teacherOne&quot;&gt;&lt;/ref&gt;
    &lt;/entry&gt;
    &lt;entry&gt;
        &lt;key&gt;
            &lt;value&gt;10086&lt;/value&gt;
        &lt;/key&gt;
        &lt;ref bean=&quot;teacherTwo&quot;&gt;&lt;/ref&gt;
    &lt;/entry&gt;
&lt;/util:map&gt;
&lt;bean id=&quot;clazzTwo&quot; class=&quot;com.atguigu.spring.bean.Clazz&quot;&gt;
    &lt;property name=&quot;clazzId&quot; value=&quot;4444&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;clazzName&quot; value=&quot;Javaee0222&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;students&quot; ref=&quot;students&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
&lt;bean id=&quot;studentFour&quot; class=&quot;com.atguigu.spring.bean.Student&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;1004&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;name&quot; value=&quot;èµµå…­&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;age&quot; value=&quot;26&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;sex&quot; value=&quot;å¥³&quot;&gt;&lt;/property&gt;
    &lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;
    &lt;property name=&quot;clazz&quot; ref=&quot;clazzOne&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;hobbies&quot;&gt;
        &lt;array&gt;
            &lt;value&gt;æŠ½çƒŸ&lt;/value&gt;
            &lt;value&gt;å–é…’&lt;/value&gt;
            &lt;value&gt;çƒ«å¤´&lt;/value&gt;
        &lt;/array&gt;
    &lt;/property&gt;
    &lt;property name=&quot;teacherMap&quot; ref=&quot;teacherMap&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<blockquote>
<p>ä½¿ç”¨util:listã€util:mapæ ‡ç­¾å¿…é¡»å¼•å…¥ç›¸åº”çš„å‘½åç©ºé—´ï¼Œå¯ä»¥é€šè¿‡ideaçš„æç¤ºåŠŸèƒ½é€‰æ‹©</p>
</blockquote>
<h3 id="229-å®éªŒä¹ä¾èµ–æ³¨å…¥ä¹‹på‘½åç©ºé—´">2.2.9ã€å®éªŒä¹ï¼šä¾èµ–æ³¨å…¥ä¹‹på‘½åç©ºé—´</h3>
<p>å¼•å…¥på‘½åç©ºé—´åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºbeançš„å„ä¸ªå±æ€§èµ‹å€¼</p>
<pre><code class="language-xml">&lt;bean id=&quot;studentSix&quot; class=&quot;com.atguigu.spring.bean.Student&quot;
		p:id=&quot;1006&quot; p:name=&quot;å°æ˜&quot; p:clazz-ref=&quot;clazzOne&quot; p:teacherMapref=&quot;teacherMap&quot;&gt;
&lt;/bean&gt;
</code></pre>
<h3 id="2210-å®éªŒåå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶">2.2.10ã€å®éªŒåï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶</h3>
<h4 id="1åŠ å…¥ä¾èµ–">â‘ åŠ å…¥ä¾èµ–</h4>
<pre><code class="language-xml">&lt;!-- MySQLé©±åŠ¨ --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;8.0.16&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- æ•°æ®æº --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;version&gt;1.0.31&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4 id="2åˆ›å»ºå¤–éƒ¨å±æ€§æ–‡ä»¶">â‘¡åˆ›å»ºå¤–éƒ¨å±æ€§æ–‡ä»¶</h4>
<figure data-type="image" tabindex="6"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721151535.png" alt="" loading="lazy"></figure>
<pre><code class="language-properties">jdbc.driver=com.mysql.jdbc.Driver
#jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://127.0.0.1:3305/ssm?characterEncoding=utf8&amp;useUnicode=true
jdbc.username=root
jdbc.password=
</code></pre>
<h4 id="3å¼•å…¥å±æ€§æ–‡ä»¶">â‘¢å¼•å…¥å±æ€§æ–‡ä»¶</h4>
<pre><code class="language-xml">&lt;!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ --&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;
</code></pre>
<h4 id="4é…ç½®bean">â‘£é…ç½®bean</h4>
<pre><code class="language-xml">&lt;!-- é…ç½®æ•°æ®æº --&gt;
&lt;bean id=&quot;druidDataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driver}&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<h4 id="5æµ‹è¯•">â‘¤æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testDataSource() throws SQLException {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;springdatasource.xml&quot;);
    DataSource dataSource = ioc.getBean(DataSource.class);
    Connection connection = dataSource.getConnection();
    System.out.println(connection);
}
</code></pre>
<h3 id="2211-å®éªŒåä¸€beançš„ä½œç”¨åŸŸ">2.2.11ã€å®éªŒåä¸€ï¼šbeançš„ä½œç”¨åŸŸ</h3>
<h4 id="1æ¦‚å¿µ">â‘ æ¦‚å¿µ</h4>
<ul>
<li>åœ¨Springä¸­å¯ä»¥é€šè¿‡é…ç½®beanæ ‡ç­¾çš„scopeå±æ€§æ¥æŒ‡å®šbeançš„ä½œç”¨åŸŸèŒƒå›´ï¼Œå„å–å€¼å«ä¹‰å‚åŠ ä¸‹è¡¨ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>å–å€¼</th>
<th>å«ä¹‰</th>
<th>åˆ›å»ºå¯¹è±¡çš„æ—¶æœº</th>
</tr>
</thead>
<tbody>
<tr>
<td>singletonï¼ˆé»˜è®¤ï¼‰</td>
<td>åœ¨IOCå®¹å™¨ä¸­ï¼Œè¿™ä¸ªbeançš„å¯¹è±¡å§‹ç»ˆä¸ºå•å®ä¾‹</td>
<td>IOCå®¹å™¨åˆå§‹åŒ–æ—¶</td>
</tr>
<tr>
<td>prototype</td>
<td>è¿™ä¸ªbeanåœ¨IOCå®¹å™¨ä¸­æœ‰å¤šä¸ªå®ä¾‹</td>
<td>è·å–beanæ—¶</td>
</tr>
</tbody>
</table>
<ul>
<li>å¦‚æœæ˜¯åœ¨WebApplicationContextç¯å¢ƒä¸‹è¿˜ä¼šæœ‰å¦å¤–ä¸‰ä¸ªä½œç”¨åŸŸï¼ˆä½†ä¸å¸¸ç”¨ï¼‰ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>å–å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>request</td>
<td>åœ¨ä¸€ä¸ªè¯·æ±‚èŒƒå›´å†…æœ‰æ•ˆ</td>
</tr>
<tr>
<td>session</td>
<td>åœ¨ä¸€ä¸ªä¼šè¯èŒƒå›´å†…æœ‰æ•ˆ</td>
</tr>
<tr>
<td>global-session</td>
<td>ä¸€èˆ¬ç”¨äºPortletåº”ç”¨ç¯å¢ƒ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Portletæ˜¯å¯ä»¥å¤ç”¨çš„Webæ¨¡å—,ç”¨äºç®¡ç†å’Œæ˜¾ç¤ºç”¨æˆ·ç•Œé¢ã€‚</p>
<p>å„ä½œç”¨åŸŸèŒƒå›´å¤§å°å¯¹æ¯”<br>
prototype &lt; request &lt; session &lt; global-session &lt; singleton</p>
</blockquote>
<h4 id="2åˆ›å»ºç±»user">â‘¡åˆ›å»ºç±»User</h4>
<pre><code class="language-java">public class User {
    
    private Integer id;
    private String username;
    private String password;
    private Integer age;

    public User() {
    }

    public User(Integer id, String username, String password, Integer age) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.age = age;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    @Override
    public String toString() {
        return &quot;User{&quot; +
                &quot;id=&quot; + id +
                &quot;, username='&quot; + username + '\'' +
                &quot;, password='&quot; + password + '\'' +
                &quot;, age=&quot; + age +
                '}';
    }
}
</code></pre>
<h4 id="3é…ç½®bean">â‘¢é…ç½®bean</h4>
<p>springscope.xml</p>
<pre><code class="language-xml">&lt;!-- scopeå±æ€§ï¼šå–å€¼singletonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œbeanåœ¨IOCå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒIOCå®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¯¹è±¡ --&gt;
&lt;!-- scopeå±æ€§ï¼šå–å€¼prototypeï¼Œbeanåœ¨IOCå®¹å™¨ä¸­å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼ŒgetBean()æ—¶åˆ›å»ºå¯¹è±¡ --&gt;
&lt;bean class=&quot;com.atguigu.bean.User&quot; scope=&quot;prototype&quot;&gt;&lt;/bean&gt;
</code></pre>
<h4 id="4æµ‹è¯•">â‘£æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testBeanScope() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;springscope.xml&quot;);
    User user1 = ioc.getBean(User.class);
    User user2 = ioc.getBean(User.class);
    System.out.println(user1 == user2);
}
</code></pre>
<h3 id="2212-å®éªŒåäºŒbeançš„ç”Ÿå‘½å‘¨æœŸ">2.2.12ã€å®éªŒåäºŒï¼šbeançš„ç”Ÿå‘½å‘¨æœŸ</h3>
<h4 id="1å…·ä½“çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹">â‘ å…·ä½“çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹</h4>
<ul>
<li>beanå¯¹è±¡åˆ›å»ºï¼ˆè°ƒç”¨æ— å‚æ„é€ å™¨ï¼‰</li>
<li>ç»™beanå¯¹è±¡è®¾ç½®å±æ€§</li>
<li>beanå¯¹è±¡åˆå§‹åŒ–ä¹‹å‰æ“ä½œï¼ˆç”±beançš„åç½®å¤„ç†å™¨è´Ÿè´£ï¼‰</li>
<li>beanå¯¹è±¡åˆå§‹åŒ–ï¼ˆéœ€åœ¨é…ç½®beanæ—¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼‰</li>
<li>beanå¯¹è±¡åˆå§‹åŒ–ä¹‹åæ“ä½œï¼ˆç”±beançš„åç½®å¤„ç†å™¨è´Ÿè´£ï¼‰</li>
<li>beanå¯¹è±¡å°±ç»ªå¯ä»¥ä½¿ç”¨</li>
<li>beanå¯¹è±¡é”€æ¯ï¼ˆéœ€åœ¨é…ç½®beanæ—¶æŒ‡å®šé”€æ¯æ–¹æ³•ï¼‰</li>
<li>IOCå®¹å™¨å…³é—­</li>
</ul>
<h4 id="2ä¿®æ”¹ç±»user">â‘¡ä¿®æ”¹ç±»User</h4>
<pre><code class="language-java">public class User {
    private Integer id;
    private String username;
    private String password;
    private Integer age;

    public User() {
        System.out.println(&quot;ç”Ÿå‘½å‘¨æœŸï¼š1ã€åˆ›å»ºå¯¹è±¡&quot;);
    }

    public User(Integer id, String username, String password, Integer age) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.age = age;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        System.out.println(&quot;ç”Ÿå‘½å‘¨æœŸï¼š2ã€ä¾èµ–æ³¨å…¥&quot;);
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public void initMethod() {
        System.out.println(&quot;ç”Ÿå‘½å‘¨æœŸï¼š3ã€åˆå§‹åŒ–&quot;);
    }

    public void destroyMethod() {
        System.out.println(&quot;ç”Ÿå‘½å‘¨æœŸï¼š5ã€é”€æ¯&quot;);
    }

    @Override
    public String toString() {
        return &quot;User{&quot; +
                &quot;id=&quot; + id +
                &quot;, username='&quot; + username + '\'' +
                &quot;, password='&quot; + password + '\'' +
                &quot;, age=&quot; + age +
                '}';
    }
}
</code></pre>
<blockquote>
<p>æ³¨æ„å…¶ä¸­çš„initMethod()å’ŒdestroyMethod()ï¼Œå¯ä»¥é€šè¿‡é…ç½®beanæŒ‡å®šä¸ºåˆå§‹åŒ–å’Œé”€æ¯çš„æ–¹æ³•</p>
</blockquote>
<h4 id="3é…ç½®bean-2">â‘¢é…ç½®bean</h4>
<p>spring-lifecycle.xml</p>
<pre><code class="language-xml">&lt;!-- ä½¿ç”¨init-methodå±æ€§æŒ‡å®šåˆå§‹åŒ–æ–¹æ³• --&gt;
&lt;!-- ä½¿ç”¨destroy-methodå±æ€§æŒ‡å®šé”€æ¯æ–¹æ³• --&gt;
&lt;bean class=&quot;com.atguigu.bean.User&quot; scope=&quot;prototype&quot; init-method=&quot;initMethod&quot;
destroy-method=&quot;destroyMethod&quot;&gt;
		&lt;property name=&quot;id&quot; value=&quot;1001&quot;&gt;&lt;/property&gt;
		&lt;property name=&quot;username&quot; value=&quot;admin&quot;&gt;&lt;/property&gt;
		&lt;property name=&quot;password&quot; value=&quot;123456&quot;&gt;&lt;/property&gt;
		&lt;property name=&quot;age&quot; value=&quot;23&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<h4 id="4æµ‹è¯•-2">â‘£æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testLife() {
    ClassPathXmlApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;spring-lifecycle.xml&quot;);
    User bean = ioc.getBean(User.class);
    System.out.println(&quot;ç”Ÿå‘½å‘¨æœŸï¼š4ã€é€šè¿‡IOCå®¹å™¨è·å–beanå¹¶ä½¿ç”¨&quot;);
    ioc.close();
}
</code></pre>
<h4 id="5beançš„åç½®å¤„ç†å™¨">â‘¤beançš„åç½®å¤„ç†å™¨</h4>
<ul>
<li>beançš„åç½®å¤„ç†å™¨ä¼šåœ¨ç”Ÿå‘½å‘¨æœŸçš„åˆå§‹åŒ–å‰åæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œ</li>
<li>éœ€è¦å®ç°BeanPostProcessoræ¥å£ï¼Œä¸”é…ç½®åˆ°IOCå®¹å™¨ä¸­ï¼Œ</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbeanåç½®å¤„ç†å™¨ä¸æ˜¯å•ç‹¬é’ˆå¯¹æŸä¸€ä¸ªbeanç”Ÿæ•ˆï¼Œè€Œæ˜¯é’ˆå¯¹IOCå®¹å™¨ä¸­æ‰€æœ‰beanéƒ½ä¼šæ‰§è¡Œ</li>
</ul>
<p>åˆ›å»ºbeançš„åç½®å¤„ç†å™¨ï¼š</p>
<pre><code class="language-java">package com.atguigu.spring.process;

import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.BeanPostProcessor;

public class MyBeanProcessor implements BeanPostProcessor {
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName)
            throws BeansException {
        System.out.println(&quot;â˜†â˜†â˜†&quot; + beanName + &quot; = &quot; + bean);
        return bean;
    }

    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName)
            throws BeansException {
        System.out.println(&quot;â˜…â˜…â˜…&quot; + beanName + &quot; = &quot; + bean);
        return bean;
    }
}
</code></pre>
<p>åœ¨IOCå®¹å™¨ä¸­é…ç½®åç½®å¤„ç†å™¨ï¼š</p>
<pre><code class="language-xml">&lt;!-- beançš„åç½®å¤„ç†å™¨è¦æ”¾å…¥IOCå®¹å™¨æ‰èƒ½ç”Ÿæ•ˆ --&gt;
&lt;bean id=&quot;myBeanProcessor&quot; class=&quot;com.atguigu.spring.process.MyBeanProcessor&quot;/&gt;
</code></pre>
<h3 id="2213-å®éªŒåä¸‰factorybean">2.2.13ã€å®éªŒåä¸‰ï¼šFactoryBean</h3>
<h4 id="1ç®€ä»‹">â‘ ç®€ä»‹</h4>
<ul>
<li>
<p>FactoryBeanæ˜¯Springæä¾›çš„ä¸€ç§æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶çš„å¸¸ç”¨æœºåˆ¶ã€‚</p>
</li>
<li>
<p>å’Œæ™®é€šçš„beanä¸åŒï¼Œé…ç½®ä¸€ä¸ªFactoryBeanç±»å‹çš„beanï¼Œåœ¨è·å–beançš„æ—¶å€™å¾—åˆ°çš„å¹¶ä¸æ˜¯classå±æ€§ä¸­é…ç½®çš„è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯getObject()æ–¹æ³•çš„è¿”å›å€¼ã€‚</p>
</li>
<li>
<p>é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒSpringå¯ä»¥å¸®æˆ‘ä»¬æŠŠå¤æ‚ç»„ä»¶åˆ›å»ºçš„è¯¦ç»†è¿‡ç¨‹å’Œç¹çç»†èŠ‚éƒ½å±è”½èµ·æ¥ï¼ŒåªæŠŠæœ€ç®€æ´çš„ä½¿ç”¨ç•Œé¢å±•ç¤ºç»™æˆ‘ä»¬ã€‚</p>
</li>
<li>
<p>å°†æ¥æˆ‘ä»¬æ•´åˆMybatisæ—¶ï¼ŒSpringå°±æ˜¯é€šè¿‡FactoryBeanæœºåˆ¶æ¥å¸®æˆ‘ä»¬åˆ›å»ºSqlSessionFactoryå¯¹è±¡çš„ã€‚</p>
</li>
</ul>
<pre><code class="language-java">/*
 * Copyright 2002-2020 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.springframework.beans.factory;

import org.springframework.lang.Nullable;

/**
 * Interface to be implemented by objects used within a {@link BeanFactory} which
 * are themselves factories for individual objects. If a bean implements this
 * interface, it is used as a factory for an object to expose, not directly as a
 * bean instance that will be exposed itself.
 *
 * &lt;p&gt;&lt;b&gt;NB: A bean that implements this interface cannot be used as a normal bean.&lt;/b&gt;
 * A FactoryBean is defined in a bean style, but the object exposed for bean
 * references ({@link #getObject()}) is always the object that it creates.
 *
 * &lt;p&gt;FactoryBeans can support singletons and prototypes, and can either create
 * objects lazily on demand or eagerly on startup. The {@link SmartFactoryBean}
 * interface allows for exposing more fine-grained behavioral metadata.
 *
 * &lt;p&gt;This interface is heavily used within the framework itself, for example for
 * the AOP {@link org.springframework.aop.framework.ProxyFactoryBean} or the
 * {@link org.springframework.jndi.JndiObjectFactoryBean}. It can be used for
 * custom components as well; however, this is only common for infrastructure code.
 *
 * &lt;p&gt;&lt;b&gt;{@code FactoryBean} is a programmatic contract. Implementations are not
 * supposed to rely on annotation-driven injection or other reflective facilities.&lt;/b&gt;
 * {@link #getObjectType()} {@link #getObject()} invocations may arrive early in the
 * bootstrap process, even ahead of any post-processor setup. If you need access to
 * other beans, implement {@link BeanFactoryAware} and obtain them programmatically.
 *
 * &lt;p&gt;&lt;b&gt;The container is only responsible for managing the lifecycle of the FactoryBean
 * instance, not the lifecycle of the objects created by the FactoryBean.&lt;/b&gt; Therefore,
 * a destroy method on an exposed bean object (such as {@link java.io.Closeable#close()}
 * will &lt;i&gt;not&lt;/i&gt; be called automatically. Instead, a FactoryBean should implement
 * {@link DisposableBean} and delegate any such close call to the underlying object.
 *
 * &lt;p&gt;Finally, FactoryBean objects participate in the containing BeanFactory's
 * synchronization of bean creation. There is usually no need for internal
 * synchronization other than for purposes of lazy initialization within the
 * FactoryBean itself (or the like).
 *
 * @author Rod Johnson
 * @author Juergen Hoeller
 * @since 08.03.2003
 * @param &lt;T&gt; the bean type
 * @see org.springframework.beans.factory.BeanFactory
 * @see org.springframework.aop.framework.ProxyFactoryBean
 * @see org.springframework.jndi.JndiObjectFactoryBean
 */
public interface FactoryBean&lt;T&gt; {

	/**
	 * The name of an attribute that can be
	 * {@link org.springframework.core.AttributeAccessor#setAttribute set} on a
	 * {@link org.springframework.beans.factory.config.BeanDefinition} so that
	 * factory beans can signal their object type when it can't be deduced from
	 * the factory bean class.
	 * @since 5.2
	 */
	String OBJECT_TYPE_ATTRIBUTE = &quot;factoryBeanObjectType&quot;;


	/**
	 * Return an instance (possibly shared or independent) of the object
	 * managed by this factory.
	 * &lt;p&gt;As with a {@link BeanFactory}, this allows support for both the
	 * Singleton and Prototype design pattern.
	 * &lt;p&gt;If this FactoryBean is not fully initialized yet at the time of
	 * the call (for example because it is involved in a circular reference),
	 * throw a corresponding {@link FactoryBeanNotInitializedException}.
	 * &lt;p&gt;As of Spring 2.0, FactoryBeans are allowed to return {@code null}
	 * objects. The factory will consider this as normal value to be used; it
	 * will not throw a FactoryBeanNotInitializedException in this case anymore.
	 * FactoryBean implementations are encouraged to throw
	 * FactoryBeanNotInitializedException themselves now, as appropriate.
	 * @return an instance of the bean (can be {@code null})
	 * @throws Exception in case of creation errors
	 * @see FactoryBeanNotInitializedException
	 */
	@Nullable
	T getObject() throws Exception;

	/**
	 * Return the type of object that this FactoryBean creates,
	 * or {@code null} if not known in advance.
	 * &lt;p&gt;This allows one to check for specific types of beans without
	 * instantiating objects, for example on autowiring.
	 * &lt;p&gt;In the case of implementations that are creating a singleton object,
	 * this method should try to avoid singleton creation as far as possible;
	 * it should rather estimate the type in advance.
	 * For prototypes, returning a meaningful type here is advisable too.
	 * &lt;p&gt;This method can be called &lt;i&gt;before&lt;/i&gt; this FactoryBean has
	 * been fully initialized. It must not rely on state created during
	 * initialization; of course, it can still use such state if available.
	 * &lt;p&gt;&lt;b&gt;NOTE:&lt;/b&gt; Autowiring will simply ignore FactoryBeans that return
	 * {@code null} here. Therefore it is highly recommended to implement
	 * this method properly, using the current state of the FactoryBean.
	 * @return the type of object that this FactoryBean creates,
	 * or {@code null} if not known at the time of the call
	 * @see ListableBeanFactory#getBeansOfType
	 */
	@Nullable
	Class&lt;?&gt; getObjectType();

	/**
	 * Is the object managed by this factory a singleton? That is,
	 * will {@link #getObject()} always return the same object
	 * (a reference that can be cached)?
	 * &lt;p&gt;&lt;b&gt;NOTE:&lt;/b&gt; If a FactoryBean indicates to hold a singleton object,
	 * the object returned from {@code getObject()} might get cached
	 * by the owning BeanFactory. Hence, do not return {@code true}
	 * unless the FactoryBean always exposes the same reference.
	 * &lt;p&gt;The singleton status of the FactoryBean itself will generally
	 * be provided by the owning BeanFactory; usually, it has to be
	 * defined as singleton there.
	 * &lt;p&gt;&lt;b&gt;NOTE:&lt;/b&gt; This method returning {@code false} does not
	 * necessarily indicate that returned objects are independent instances.
	 * An implementation of the extended {@link SmartFactoryBean} interface
	 * may explicitly indicate independent instances through its
	 * {@link SmartFactoryBean#isPrototype()} method. Plain {@link FactoryBean}
	 * implementations which do not implement this extended interface are
	 * simply assumed to always return independent instances if the
	 * {@code isSingleton()} implementation returns {@code false}.
	 * &lt;p&gt;The default implementation returns {@code true}, since a
	 * {@code FactoryBean} typically manages a singleton instance.
	 * @return whether the exposed object is a singleton
	 * @see #getObject()
	 * @see SmartFactoryBean#isPrototype()
	 */
	default boolean isSingleton() {
		return true;
	}

}
</code></pre>
<h4 id="2åˆ›å»ºç±»userfactorybean">â‘¡åˆ›å»ºç±»UserFactoryBean</h4>
<pre><code class="language-java">public class UserFactoryBean implements FactoryBean&lt;User&gt; {
    @Override
    public User getObject() throws Exception {
        return new User();
    }

    @Override
    public Class&lt;?&gt; getObjectType() {
        return User.class;
    }
}
</code></pre>
<h4 id="3é…ç½®bean-3">â‘¢é…ç½®bean</h4>
<p>springfactorybean.xml</p>
<pre><code class="language-xml">&lt;bean id=&quot;user&quot; class=&quot;com.atguigu.bean.UserFactoryBean&quot;&gt;&lt;/bean&gt;
</code></pre>
<h4 id="4æµ‹è¯•-3">â‘£æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testUserFactoryBean() {
    //è·å–IOCå®¹å™¨
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;springfactorybean.xml&quot;);
    User user = (User) ioc.getBean(&quot;user&quot;);
    System.out.println(user);
}
</code></pre>
<h3 id="2214-å®éªŒåå››åŸºäºxmlçš„è‡ªåŠ¨è£…é…">2.2.14ã€å®éªŒåå››ï¼šåŸºäºxmlçš„è‡ªåŠ¨è£…é…</h3>
<blockquote>
<p>è‡ªåŠ¨è£…é…ï¼š</p>
<p>æ ¹æ®æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨IOCå®¹å™¨ä¸­åŒ¹é…æŸä¸€ä¸ªbeanï¼Œè‡ªåŠ¨ä¸ºæŒ‡å®šçš„beanä¸­æ‰€ä¾èµ–çš„ç±»ç±»å‹æˆ–æ¥å£ç±»å‹å±æ€§èµ‹å€¼</p>
</blockquote>
<h4 id="1åœºæ™¯æ¨¡æ‹Ÿ">â‘ åœºæ™¯æ¨¡æ‹Ÿ</h4>
<p>åˆ›å»ºç±»UserController</p>
<pre><code class="language-java">public class UserController {
    private UserService userService;

    public void setUserService(UserService userService) {
        this.userService = userService;
    }

    public void saveUser() {
        userService.saveUser();
    }
}
</code></pre>
<p>åˆ›å»ºæ¥å£UserService</p>
<pre><code class="language-java">public interface UserService {
    
    void saveUser();
    
}
</code></pre>
<p>åˆ›å»ºç±»UserServiceImplå®ç°æ¥å£UserService</p>
<pre><code class="language-java">public class UserServiceImpl implements UserService {
    private UserDao userDao;

    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    public void saveUser() {
        userDao.saveUser();
    }
}
</code></pre>
<p>åˆ›å»ºæ¥å£UserDao</p>
<pre><code class="language-java">public interface UserDao {

    void saveUser();
    
}
</code></pre>
<p>åˆ›å»ºç±»UserDaoImplå®ç°æ¥å£UserDao</p>
<pre><code class="language-java">public class UserDaoImpl implements UserDao {

    @Override
    public void saveUser() {
        System.out.println(&quot;ä¿å­˜æˆåŠŸ&quot;);
    }
    
}
</code></pre>
<h4 id="2é…ç½®bean-3">â‘¡é…ç½®bean</h4>
<p>autowirexml.xml</p>
<blockquote>
<p>ä½¿ç”¨beanæ ‡ç­¾çš„autowireå±æ€§è®¾ç½®è‡ªåŠ¨è£…é…æ•ˆæœ</p>
<p>è‡ªåŠ¨è£…é…æ–¹å¼ï¼šbyType</p>
<p>byTypeï¼šæ ¹æ®ç±»å‹åŒ¹é…IOCå®¹å™¨ä¸­çš„æŸä¸ªå…¼å®¹ç±»å‹çš„beanï¼Œä¸ºå±æ€§è‡ªåŠ¨èµ‹å€¼</p>
<p>è‹¥åœ¨IOCä¸­ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå…¼å®¹ç±»å‹çš„beanèƒ½å¤Ÿä¸ºå±æ€§èµ‹å€¼ï¼Œåˆ™è¯¥å±æ€§ä¸è£…é…ï¼Œå³å€¼ä¸ºé»˜è®¤å€¼ null</p>
<p>è‹¥åœ¨IOCä¸­ï¼Œæœ‰å¤šä¸ªå…¼å®¹ç±»å‹çš„beanèƒ½å¤Ÿä¸ºå±æ€§èµ‹å€¼ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ NoUniqueBeanDefinitionException</p>
</blockquote>
<pre><code class="language-xml">&lt;bean id=&quot;userController&quot;
class=&quot;com.atguigu.autowire.xml.controller.UserController&quot; autowire=&quot;byType&quot;&gt;
&lt;/bean&gt;

&lt;bean id=&quot;userService&quot;
class=&quot;com.atguigu.autowire.xml.service.impl.UserServiceImpl&quot; autowire=&quot;byType&quot;&gt;
&lt;/bean&gt;

&lt;bean id=&quot;userDao&quot; class=&quot;com.atguigu.autowire.xml.dao.impl.UserDaoImpl&quot;&gt;&lt;/bean&gt;
</code></pre>
<blockquote>
<p>è‡ªåŠ¨è£…é…æ–¹å¼ï¼šbyName</p>
<p>byNameï¼šå°†è‡ªåŠ¨è£…é…çš„å±æ€§çš„å±æ€§åï¼Œä½œä¸ºbeançš„idåœ¨IOCå®¹å™¨ä¸­åŒ¹é…ç›¸å¯¹åº”çš„beanè¿›è¡Œèµ‹å€¼</p>
</blockquote>
<pre><code class="language-xml">&lt;bean id=&quot;userController&quot;
class=&quot;com.atguigu.autowire.xml.controller.UserController&quot; autowire=&quot;byName&quot;&gt;
&lt;/bean&gt;

&lt;bean id=&quot;userService&quot;
class=&quot;com.atguigu.autowire.xml.service.impl.UserServiceImpl&quot; autowire=&quot;byName&quot;&gt;
&lt;/bean&gt;

&lt;bean id=&quot;userServiceImpl&quot;
class=&quot;com.atguigu.autowire.xml.service.impl.UserServiceImpl&quot; autowire=&quot;byName&quot;&gt;
&lt;/bean&gt;

&lt;bean id=&quot;userDao&quot; class=&quot;com.atguigu.autowire.xml.dao.impl.UserDaoImpl&quot;&gt;&lt;/bean&gt;

&lt;bean id=&quot;userDaoImpl&quot; class=&quot;com.atguigu.autowire.xml.dao.impl.UserDaoImpl&quot;&gt;
&lt;/bean&gt;
</code></pre>
<h4 id="3æµ‹è¯•-3">â‘¢æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testAutoWireByXML() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;autowirexml.xml&quot;);
    UserController userController = ioc.getBean(UserController.class);
    userController.saveUser();
}
</code></pre>
<h2 id="23-åŸºäºæ³¨è§£ç®¡ç†bean">2.3ã€åŸºäºæ³¨è§£ç®¡ç†bean</h2>
<h3 id="231-å®éªŒä¸€æ ‡è®°ä¸æ‰«æ">2.3.1ã€å®éªŒä¸€ï¼šæ ‡è®°ä¸æ‰«æ</h3>
<h4 id="1æ³¨è§£">â‘ æ³¨è§£</h4>
<ul>
<li>å’Œ XML é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œæ³¨è§£æœ¬èº«å¹¶ä¸èƒ½æ‰§è¡Œï¼Œæ³¨è§£æœ¬èº«ä»…ä»…åªæ˜¯åšä¸€ä¸ªæ ‡è®°ï¼Œå…·ä½“çš„åŠŸèƒ½æ˜¯æ¡†æ¶æ£€æµ‹åˆ°æ³¨è§£æ ‡è®°çš„ä½ç½®ï¼Œç„¶åé’ˆå¯¹è¿™ä¸ªä½ç½®æŒ‰ç…§æ³¨è§£æ ‡è®°çš„åŠŸèƒ½æ¥æ‰§è¡Œå…·ä½“æ“ä½œã€‚</li>
<li>æœ¬è´¨ä¸Šï¼šæ‰€æœ‰ä¸€åˆ‡çš„æ“ä½œéƒ½æ˜¯Javaä»£ç æ¥å®Œæˆçš„ï¼ŒXMLå’Œæ³¨è§£åªæ˜¯å‘Šè¯‰æ¡†æ¶ä¸­çš„Javaä»£ç å¦‚ä½•æ‰§è¡Œã€‚</li>
<li>ä¸¾ä¾‹ï¼šå…ƒæ—¦è”æ¬¢ä¼šè¦å¸ƒç½®æ•™å®¤ï¼Œè“è‰²çš„åœ°æ–¹è´´ä¸Šå…ƒæ—¦å¿«ä¹å››ä¸ªå­—ï¼Œçº¢è‰²çš„åœ°æ–¹è´´ä¸Šæ‹‰èŠ±ï¼Œé»„è‰²çš„åœ°æ–¹è´´ä¸Šæ°”çƒã€‚</li>
</ul>
<figure data-type="image" tabindex="7"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721171841.png" alt="" loading="lazy"></figure>
<ul>
<li>ç­é•¿åšäº†æ‰€æœ‰æ ‡è®°ï¼ŒåŒå­¦ä»¬æ¥å®Œæˆå…·ä½“å·¥ä½œã€‚å¢™ä¸Šçš„æ ‡è®°ç›¸å½“äºæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨çš„æ³¨è§£ï¼Œåé¢åŒå­¦ä»¬ åšçš„å·¥ä½œï¼Œç›¸å½“äºæ¡†æ¶çš„å…·ä½“æ“ä½œã€‚</li>
</ul>
<h4 id="2æ‰«æ">â‘¡æ‰«æ</h4>
<ul>
<li>Spring ä¸ºäº†çŸ¥é“ç¨‹åºå‘˜åœ¨å“ªäº›åœ°æ–¹æ ‡è®°äº†ä»€ä¹ˆæ³¨è§£ï¼Œå°±éœ€è¦é€šè¿‡æ‰«æçš„æ–¹å¼ï¼Œæ¥è¿›è¡Œæ£€æµ‹ã€‚ç„¶åæ ¹æ®æ³¨è§£è¿›è¡Œåç»­æ“ä½œã€‚</li>
</ul>
<h4 id="3æ–°å»ºmaven-module">â‘¢æ–°å»ºMaven Module</h4>
<pre><code class="language-xml">&lt;dependencies&gt;

    &lt;!-- åŸºäºMavenä¾èµ–ä¼ é€’æ€§ï¼Œå¯¼å…¥spring-contextä¾èµ–å³å¯å¯¼å…¥å½“å‰æ‰€éœ€æ‰€æœ‰jaråŒ… --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- junitæµ‹è¯• --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    
&lt;/dependencies&gt;
</code></pre>
<h4 id="4åˆ›å»ºspringé…ç½®æ–‡ä»¶">â‘£åˆ›å»ºSpringé…ç½®æ–‡ä»¶</h4>
<ul>
<li>applicationContext.xml</li>
</ul>
<figure data-type="image" tabindex="8"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721172818.png" alt="" loading="lazy"></figure>
<h4 id="5æ ‡è¯†ç»„ä»¶çš„å¸¸ç”¨æ³¨è§£">â‘¤æ ‡è¯†ç»„ä»¶çš„å¸¸ç”¨æ³¨è§£</h4>
<blockquote>
<p>@Componentï¼šå°†ç±»æ ‡è¯†ä¸ºæ™®é€šç»„ä»¶</p>
<p>@Controllerï¼šå°†ç±»æ ‡è¯†ä¸ºæ§åˆ¶å±‚ç»„ä»¶</p>
<p>@Serviceï¼šå°†ç±»æ ‡è¯†ä¸ºä¸šåŠ¡å±‚ç»„ä»¶</p>
<p>@Repositoryï¼šå°†ç±»æ ‡è¯†ä¸ºæŒä¹…å±‚ç»„ä»¶</p>
</blockquote>
<p>é—®ï¼šä»¥ä¸Šå››ä¸ªæ³¨è§£æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«ï¼Ÿ</p>
<figure data-type="image" tabindex="9"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721173246.png" alt="" loading="lazy"></figure>
<ul>
<li>é€šè¿‡æŸ¥çœ‹æºç æˆ‘ä»¬å¾—çŸ¥ï¼Œ@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯åœ¨@Componentæ³¨è§£çš„åŸºç¡€ä¸Šèµ·äº†ä¸‰ä¸ªæ–°çš„åå­—ã€‚</li>
<li>å¯¹äºSpringä½¿ç”¨IOCå®¹å™¨ç®¡ç†è¿™äº›ç»„ä»¶æ¥è¯´æ²¡æœ‰åŒºåˆ«ã€‚æ‰€ä»¥@Controllerã€@Serviceã€@Repositoryè¿™ä¸‰ä¸ªæ³¨è§£åªæ˜¯ç»™å¼€å‘äººå‘˜çœ‹çš„ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿä¾¿äºåˆ†è¾¨ç»„ä»¶çš„ä½œç”¨ã€‚</li>
<li>æ³¨æ„ï¼šè™½ç„¶å®ƒä»¬æœ¬è´¨ä¸Šä¸€æ ·ï¼Œä½†æ˜¯ä¸ºäº†ä»£ç çš„å¯è¯»æ€§ï¼Œä¸ºäº†ç¨‹åºç»“æ„ä¸¥è°¨æˆ‘ä»¬è‚¯å®šä¸èƒ½éšä¾¿èƒ¡ä¹±æ ‡è®°ã€‚</li>
</ul>
<h4 id="6åˆ›å»ºç»„ä»¶">â‘¥åˆ›å»ºç»„ä»¶</h4>
<p>åˆ›å»ºæ§åˆ¶å±‚ç»„ä»¶</p>
<pre><code class="language-java">@Controller
public class UserController {

}
</code></pre>
<p>åˆ›å»ºæ¥å£UserService</p>
<pre><code class="language-java">public interface UserService {

}
</code></pre>
<p>åˆ›å»ºä¸šåŠ¡å±‚ç»„ä»¶UserServiceImpl</p>
<pre><code class="language-java">@Service
public class UserServiceImpl implements UserService {
  
}
</code></pre>
<p>åˆ›å»ºæ¥å£UserDao</p>
<pre><code class="language-java">public interface UserDao {
  
}
</code></pre>
<p>åˆ›å»ºæŒä¹…å±‚ç»„ä»¶UserDaoImpl</p>
<pre><code class="language-java">@Repository
public class UserDaoImpl implements UserDao {

}
</code></pre>
<h4 id="7æ‰«æç»„ä»¶">â‘¦æ‰«æç»„ä»¶</h4>
<p>æƒ…å†µä¸€ï¼šæœ€åŸºæœ¬çš„æ‰«ææ–¹å¼</p>
<pre><code class="language-xml">&lt;context:component-scan base-package=&quot;com.atguigu&quot;&gt;
&lt;/context:component-scan&gt;
</code></pre>
<p>æƒ…å†µäºŒï¼šæŒ‡å®šè¦æ’é™¤çš„ç»„ä»¶</p>
<pre><code class="language-xml">&lt;context:component-scan base-package=&quot;com.atguigu&quot;&gt;
    &lt;!-- context:exclude-filteræ ‡ç­¾ï¼šæŒ‡å®šæ’é™¤è§„åˆ™ --&gt;
    &lt;!--
            typeï¼šè®¾ç½®æ’é™¤æˆ–åŒ…å«çš„ä¾æ®
            type=&quot;annotation&quot;ï¼Œæ ¹æ®æ³¨è§£æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„æ³¨è§£çš„å…¨ç±»å
            type=&quot;assignable&quot;ï¼Œæ ¹æ®ç±»å‹æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„ç±»å‹çš„å…¨ç±»å
    --&gt;
    &lt;context:exclude-filter type=&quot;annotation&quot;
                            expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;
    &lt;!--&lt;context:exclude-filter type=&quot;assignable&quot; expression=&quot;com.atguigu.controller.UserController&quot;/&gt;--&gt;
&lt;/context:component-scan&gt;
</code></pre>
<p>æƒ…å†µä¸‰ï¼šä»…æ‰«ææŒ‡å®šç»„ä»¶</p>
<pre><code class="language-xml">&lt;context:component-scan base-package=&quot;com.atguigu&quot; use-default-filters=&quot;false&quot;&gt;
    &lt;!-- context:include-filteræ ‡ç­¾ï¼šæŒ‡å®šåœ¨åŸæœ‰æ‰«æè§„åˆ™çš„åŸºç¡€ä¸Šè¿½åŠ çš„è§„åˆ™ --&gt;
    &lt;!-- use-default-filterså±æ€§ï¼šå–å€¼falseè¡¨ç¤ºå…³é—­é»˜è®¤æ‰«æè§„åˆ™ --&gt;
    &lt;!-- æ­¤æ—¶å¿…é¡»è®¾ç½®use-default-filters=&quot;false&quot;ï¼Œå› ä¸ºé»˜è®¤è§„åˆ™å³æ‰«ææŒ‡å®šåŒ…ä¸‹æ‰€æœ‰ç±» --&gt;
    &lt;!--
            typeï¼šè®¾ç½®æ’é™¤æˆ–åŒ…å«çš„ä¾æ®
            type=&quot;annotation&quot;ï¼Œæ ¹æ®æ³¨è§£æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„æ³¨è§£çš„å…¨ç±»å
            type=&quot;assignable&quot;ï¼Œæ ¹æ®ç±»å‹æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„ç±»å‹çš„å…¨ç±»å
    --&gt;
    &lt;context:include-filter type=&quot;annotation&quot;
                            expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;
    &lt;!--&lt;context:include-filter type=&quot;assignable&quot;
        expression=&quot;com.atguigu.controller.UserController&quot;/&gt;--&gt;
&lt;/context:component-scan&gt;
</code></pre>
<h4 id="8æµ‹è¯•">â‘§æµ‹è¯•</h4>
<pre><code class="language-java">@Test
public void testAutowireByAnnotation() {
    ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
    UserController userController = ioc.getBean(UserController.class);
    System.out.println(userController);
    UserService userService = ioc.getBean(UserService.class);
    System.out.println(userService);
    UserDao userDao = ioc.getBean(UserDao.class);
    System.out.println(userDao);
}
</code></pre>
<h4 id="9ç»„ä»¶æ‰€å¯¹åº”çš„beançš„id">â‘¨ç»„ä»¶æ‰€å¯¹åº”çš„beançš„id</h4>
<p>åœ¨æˆ‘ä»¬ä½¿ç”¨XMLæ–¹å¼ç®¡ç†beançš„æ—¶å€™ï¼Œæ¯ä¸ªbeanéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œä¾¿äºåœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚ç°åœ¨ä½¿ç”¨æ³¨è§£åï¼Œæ¯ä¸ªç»„ä»¶ä»ç„¶åº”è¯¥æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚</p>
<blockquote>
<p>é»˜è®¤æƒ…å†µ</p>
<p>ç±»åé¦–å­—æ¯å°å†™å°±æ˜¯beançš„idã€‚ä¾‹å¦‚ï¼šUserControllerç±»å¯¹åº”çš„beançš„idå°±æ˜¯userControllerã€‚</p>
<p>è‡ªå®šä¹‰beançš„id</p>
<p>å¯é€šè¿‡æ ‡è¯†ç»„ä»¶çš„æ³¨è§£çš„valueå±æ€§è®¾ç½®è‡ªå®šä¹‰çš„beançš„id</p>
<p>@Service(&quot;userService&quot;)//é»˜è®¤ä¸ºuserServiceImpl public class UserServiceImpl implements UserService {}</p>
</blockquote>
<h3 id="232-å®éªŒäºŒåŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…">2.3.2ã€å®éªŒäºŒï¼šåŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…</h3>
<h4 id="1åœºæ™¯æ¨¡æ‹Ÿ-2">â‘ åœºæ™¯æ¨¡æ‹Ÿ</h4>
<blockquote>
<p>å‚è€ƒåŸºäºxmlçš„è‡ªåŠ¨è£…é…</p>
<p>åœ¨UserControllerä¸­å£°æ˜UserServiceå¯¹è±¡</p>
<p>åœ¨UserServiceImplä¸­å£°æ˜UserDaoå¯¹è±¡</p>
</blockquote>
<h4 id="2-autowiredæ³¨è§£">â‘¡ @Autowiredæ³¨è§£</h4>
<p>åœ¨æˆå‘˜å˜é‡ä¸Šç›´æ¥æ ‡è®°@Autowiredæ³¨è§£å³å¯å®Œæˆè‡ªåŠ¨è£…é…ï¼Œä¸éœ€è¦æä¾›setXxx()æ–¹æ³•ã€‚ä»¥åæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­çš„æ­£å¼ç”¨æ³•å°±æ˜¯è¿™æ ·ã€‚</p>
<pre><code class="language-java">@Controller
public class UserController {
  
    @Autowired
    private UserService userService;
  
    public void saveUser() {
        userService.saveUser();
    }
  
}
</code></pre>
<pre><code class="language-java">public interface UserService {
    void saveUser();
}
</code></pre>
<pre><code class="language-java">@Service
public class UserServiceImpl implements UserService {
  
    @Autowired
    private UserDao userDao;
  
    @Override
    public void saveUser() {
        userDao.saveUser();
    }
  
}
</code></pre>
<pre><code class="language-java">public interface UserDao {
    void saveUser();
}
</code></pre>
<pre><code class="language-java">@Repository
public class UserDaoImpl implements UserDao {
    @Override
    public void saveUser() {
        System.out.println(&quot;ä¿å­˜æˆåŠŸ&quot;);
    }
}
</code></pre>
<h4 id="3-autowiredæ³¨è§£å…¶ä»–ç»†èŠ‚">â‘¢ @Autowiredæ³¨è§£å…¶ä»–ç»†èŠ‚</h4>
<blockquote>
<p>@Autowiredæ³¨è§£å¯ä»¥æ ‡è®°åœ¨<code>æ„é€ å™¨</code>å’Œ<code>setæ–¹æ³•</code>ä¸Š</p>
</blockquote>
<pre><code class="language-java">@Controller
public class UserController {
    private UserService userService;
    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }
    public void saveUser() {
        userService.saveUser();
    }
}
</code></pre>
<pre><code class="language-java">@Controller
public class UserController {
  
    private UserService userService;
  
    @Autowired
    public void setUserService(UserService userService) {
        this.userService = userService;
    }
  
    public void saveUser() {
        userService.saveUser();
    }
}
</code></pre>
<h4 id="4-autowiredå·¥ä½œæµç¨‹">â‘£ @Autowiredå·¥ä½œæµç¨‹</h4>
<figure data-type="image" tabindex="10"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721193212.png" alt="" loading="lazy"></figure>
<ul>
<li>é¦–å…ˆæ ¹æ®æ‰€éœ€è¦çš„ç»„ä»¶ç±»å‹åˆ°IOCå®¹å™¨ä¸­æŸ¥æ‰¾
<ul>
<li>èƒ½å¤Ÿæ‰¾åˆ°å”¯ä¸€çš„beanï¼šç›´æ¥æ‰§è¡Œè£…é…</li>
<li>å¦‚æœå®Œå…¨æ‰¾ä¸åˆ°åŒ¹é…è¿™ä¸ªç±»å‹çš„beanï¼šè£…é…å¤±è´¥</li>
<li>å’Œæ‰€éœ€ç±»å‹åŒ¹é…çš„beanä¸æ­¢ä¸€ä¸ª
<ul>
<li>æ²¡æœ‰@Qualifieræ³¨è§£ï¼šæ ¹æ®@Autowiredæ ‡è®°ä½ç½®æˆå‘˜å˜é‡çš„å˜é‡åä½œä¸ºbeançš„idè¿›è¡ŒåŒ¹é…
<ul>
<li>èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…</li>
<li>æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥</li>
</ul>
</li>
<li>ä½¿ç”¨@Qualifieræ³¨è§£ï¼šæ ¹æ®@Qualifieræ³¨è§£ä¸­æŒ‡å®šçš„åç§°ä½œä¸ºbeançš„idè¿›è¡ŒåŒ¹é…
<ul>
<li>èƒ½å¤Ÿæ‰¾åˆ°ï¼šæ‰§è¡Œè£…é…</li>
<li>æ‰¾ä¸åˆ°ï¼šè£…é…å¤±è´¥</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="language-java">@Controller
public class UserController {
  
    @Autowired
    @Qualifier(&quot;userServiceImpl&quot;)
    private UserService userService;
  
    public void saveUser() {
        userService.saveUser();
    }
}
</code></pre>
<blockquote>
<p><strong>ä½›ç³»è£…é…</strong></p>
<p>@Autowiredä¸­æœ‰å±æ€§requiredï¼Œé»˜è®¤å€¼ä¸ºtrueï¼Œå› æ­¤åœ¨è‡ªåŠ¨è£…é…æ— æ³•æ‰¾åˆ°ç›¸åº”çš„beanæ—¶ï¼Œä¼šè£…é…å¤±è´¥</p>
<p>å¯ä»¥å°†å±æ€§requiredçš„å€¼è®¾ç½®ä¸ºfalseï¼Œåˆ™è¡¨ç¤ºèƒ½è£…å°±è£…ï¼Œè£…ä¸ä¸Šå°±ä¸è£….</p>
<p>ä½†æ˜¯å®é™…å¼€å‘æ—¶ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰éœ€è¦è£…é…ç»„ä»¶çš„åœ°æ–¹éƒ½æ˜¯å¿…é¡»è£…é…çš„ï¼Œç”¨ä¸ä¸Šè¿™ä¸ªå±æ€§ã€‚</p>
<p>å¦‚æœç±»ä¸­åŒæ—¶å­˜åœ¨è£…é…å±æ€§çš„ setXxx() æ–¹æ³•ä¼šä½¿ required = false è®¾å®šå¤±æ•ˆã€‚</p>
</blockquote>
<blockquote>
<h3 id="æ³¨æ„">æ³¨æ„</h3>
<ul>
<li>åœ¨ä½¿ç”¨@Autowireçš„è¿‡ç¨‹ä¸­ä¼šå‘ç°IDEAæç¤º<code>ä¸å»ºè®®ä½¿ç”¨å­—æ®µæ³¨å…¥</code>ï¼Œæˆ‘ä»¬æŸ¥çœ‹æ£€æŸ¥æè¿°å¯ä»¥çœ‹åˆ°è¿™æ ·å®¹æ˜“æŠ›å‡º <code>NullPointerException</code>,æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†å­—æ®µä½¿ç”¨<code>final</code>ä¿®é¥°ï¼Œé€šè¿‡<code>æ„é€ å™¨</code>æ³¨å…¥.</li>
</ul>
<figure data-type="image" tabindex="11"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220727184152.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220727184929.png" alt="" loading="lazy"></figure>
<ul>
<li>
<p>æˆ‘ä»¬ç‚¹å‡»è‡ªåŠ¨ä¿®å¤</p>
<figure data-type="image" tabindex="13"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220727185722.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>åœ¨å®Œæˆä¿®å¤åæˆ‘ä»¬æ³¨æ„åˆ°æ²¡æœ‰äº†ä»»ä½•æ³¨è§£ï¼Œå¹¶ä¸”UserServiceèƒ½å¤Ÿæ­£å¸¸çš„æ³¨å…¥è¿›æ¥</p>
<p><code>UserController{userService=com.atguigu.service.impl.UserServiceImpl@4ac3c60d}</code></p>
</li>
<li>
<p>è¿™æ˜¯å› ä¸ºä» Spring Framework 4.3 å¼€å§‹ï¼Œ<code>@Autowired</code>å¦‚æœ<code>ç›®æ ‡ bean ä»…å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°</code>ï¼Œåˆ™<code>ä¸å†éœ€è¦</code>å¯¹æ­¤ç±»æ„é€ å‡½æ•°è¿›è¡Œ<code>æ³¨è§£å£°æ˜</code>ã€‚</p>
<ul>
<li>å³ä¸Šè¿°ä»£ç ç­‰ä»·äº</li>
</ul>
<pre><code class="language-java">@Controller
public class UserController {
  
    private final UserService userService;

    @Autowired //è¿™é‡ŒIDEAä¸ä¼šæŠ¥è­¦å‘Š
    public UserController(UserService userService) {
        this.userService = userService;
    }
  
}
</code></pre>
<ul>
<li>
<p>ä¹Ÿå³æ¯ä¸ªéœ€è¦æ³¨å…¥çš„å±æ€§éœ€è¦<code>final</code>ä¿®é¥°ä¸”è¦æœ‰ç›¸åº”çš„<code>å‚æ•°æ„é€ å™¨</code>ï¼Œè‡ªç„¶å½“å‰ç±»ä¹Ÿåªèƒ½æœ‰å‚æ•°æ„é€ å™¨ä¸èƒ½æœ‰ç©ºå‚æ„é€ å™¨ã€‚</p>
<p>å‡è®¾å½“å‰ç±»æœ‰ä¸¤ä¸ªéœ€è¦æ³¨å…¥çš„å±æ€§å­—æ®µï¼š</p>
<p>æ­£ç¡®çš„ä»£ç ï¼š</p>
<pre><code class="language-java">private final CommonComponent commonComponent;
private final UserService userService;

public UserController(UserService userService, CommonComponent commonComponent) {
    this.userService = userService;
    this.commonComponent = commonComponent;
}
</code></pre>
<p>é”™è¯¯çš„ä»£ç :</p>
<pre><code class="language-java">private final CommonComponent commonComponent;
private final UserService userService;


//é”™è¯¯å¼€å§‹
public UserController() {
  
}
//é”™è¯¯ç»“æŸ


/*
a. å› ä¸ºç©ºå‚æ„é€ å™¨ä¼šé€ æˆcommonComponentæˆ–userServiceå°šæœªåˆå§‹åŒ–ã€‚ï¼ˆfinalä¿®é¥°å±æ€§ï¼šå¯ä»¥è€ƒè™‘èµ‹å€¼çš„ä½ç½®ï¼šæ˜¾å¼åˆå§‹åŒ–ã€ä»£ç å—ä¸­åˆå§‹åŒ–ã€æ„é€ å™¨ä¸­åˆå§‹åŒ–ï¼‰
b. åŒç†ä¹Ÿä¸èƒ½æœ‰åªå«commonComponentæˆ–userServiceçš„å•å‚æ„é€ å™¨ã€‚
*/


public UserController(UserService userService, CommonComponent commonComponent) {
    this.userService = userService;
    this.commonComponent = commonComponent;
}
</code></pre>
</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="5æ€»ç»“">â‘¤æ€»ç»“</h4>
<p>åŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…</p>
<ul>
<li>
<p>æ–¹å¼ä¸€ï¼šä½¿ç”¨<code>æ„é€ å™¨æ³¨å…¥</code></p>
<ul>
<li>ä½¿ç”¨IDEAè‡ªåŠ¨ä¿®å¤åŠŸèƒ½å®Œæˆ</li>
</ul>
<pre><code class="language-java">@Controller
public class UserController {
  
    private final UserService userService;

    public UserController(UserService userService) {
        this.userService = userService;
    }
  
}
</code></pre>
</li>
<li>
<p>æ–¹å¼äºŒï¼šä½¿ç”¨<code>@Resource</code>æ›¿ä»£@Autowired</p>
<ul>
<li>@Resourceå’Œ@Autowiredå’Œéƒ½å¯ä»¥ç”¨äºæ¥å®ç°ä¾èµ–æ³¨å…¥ï¼Œä½†å‰è€…ä¸ºJDKï¼ˆJSR-250æ ‡å‡†ï¼‰è‡ªå¸¦çš„ï¼Œåè€…æ˜¯Springæä¾›çš„ã€‚</li>
<li>ä½¿ç”¨è¿™ç§æ–¹å¼IDEAä¸ä¼šæŠ±è­¦å‘Šï¼Œä½†è¿™ç§æ–¹å¼æœ¬è´¨ä»ç„¶æ˜¯Fieldæ³¨å…¥ã€‚</li>
<li>Fieldæ³¨å…¥çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œæ¯”å¦‚ä¸èƒ½åƒæ„é€ å™¨æ³¨å…¥é‚£æ ·æ³¨å…¥ä¸å¯å˜çš„å¯¹è±¡ï¼Œä¾èµ–å¯¹å¤–éƒ¨ä¸å¯è§ï¼ˆæ„é€ å™¨å’ŒSetterå¯è§ï¼Œè€Œprivateçš„å±æ€§ä¸å¯è§ï¼‰ï¼Œä¼šå¯¼è‡´ç»„ä»¶ä¸IoCå®¹å™¨ï¼ˆæ¯”å¦‚Springï¼‰ç´§å¯†è€¦åˆï¼Œå•å…ƒæµ‹è¯•ä¹Ÿéœ€è¦ä½¿ç”¨IoCå®¹å™¨ï¼Œä¾èµ–è¿‡å¤šæ—¶ç›¸å¯¹æ„é€ å™¨æ³¨å…¥ä¸èƒ½å¤Ÿæ˜æ˜¾çš„çœ‹å‡ºä¾èµ–è¿‡å¤šï¼ˆè¿åå•ä¸€èŒè´£åŸåˆ™ï¼‰ã€‚</li>
<li>æ—¢ç„¶Fieldæ³¨å…¥è¿™ä¹ˆå¤šç¼ºç‚¹ï¼Œä½†ä¸ºä»€ä¹ˆå¤§å®¶è¿˜æ˜¯ä¹ æƒ¯ä½¿ç”¨å‘¢ï¼Ÿä¸»è¦åŸå› ï¼šå¤ªæ–¹ä¾¿äº†ï¼Œæå¤§çš„ç¼©å‡äº†ä»£ç ã€‚è€Œä¸”å¤§å¤šæ•°ä¸šåŠ¡å¹¶ä¸éœ€è¦ç”¨æ„é€ å™¨å¼ºç»‘å®šï¼ŒåŒæ—¶æ¢IoCå®¹å™¨çš„å¯èƒ½æ€§ä¹Ÿæä½ã€‚æ‰€ä»¥ï¼Œè™½ç„¶SpringåŠIDEä¸€ç›´å¼ºè°ƒå’Œæé†’ï¼Œä½†è²Œä¼¼å¹¶æ²¡æœ‰é˜»æ­¢ç¨‹åºå‘˜çš„ä½¿ç”¨ã€‚</li>
<li>ä¸ºä»€ä¹ˆåªå¯¹@Autowiredè­¦å‘Šï¼Ÿ</li>
<li>æœ€ä¸»è¦çš„åŸå› å¯èƒ½æ˜¯ï¼š@Autowiredæ˜¯Springæä¾›çš„ï¼Œæ˜¯ç‰¹å®šIoCæä¾›çš„ç‰¹å®šæ³¨è§£ï¼Œä¸æ¡†æ¶å½¢æˆäº†å¼ºç»‘å®šï¼Œä¸€æ—¦æ¢ç”¨å…¶ä»–IoCæ¡†æ¶ï¼Œæ˜¯æ— æ³•æ”¯æŒæ³¨å…¥çš„ã€‚è€Œ@Resourceæ˜¯JSR-250æä¾›çš„ï¼ŒIoCå®¹å™¨åº”å½“å»å…¼å®¹å®ƒï¼Œå³ä½¿æ›´æ¢å®¹å™¨ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚</li>
</ul>
<pre><code class="language-java">@Resource
private UserService userService;
</code></pre>
</li>
<li>
<p>æ–¹å¼ä¸‰ï¼šä½¿ç”¨Lombokçš„<code>@RequiredArgsConstructor</code>é…åˆ<code>final field</code></p>
<pre><code class="language-java">@Controller
@RequiredArgsConstructor
public class UserController {
    
    private final UserService userService;

}
</code></pre>
</li>
</ul>
<h3 id="233-å®éªŒä¸‰å®Œå…¨æ³¨è§£å¼€å‘">2.3.3ã€å®éªŒä¸‰ï¼šå®Œå…¨æ³¨è§£å¼€å‘</h3>
<p>ä½“éªŒå®Œå…¨æ³¨è§£å¼€å‘ï¼Œæ˜¯ä¸ºäº†ç»™å°†æ¥å­¦ä¹  SpringBoot æ‰“åŸºç¡€ã€‚å› ä¸ºåœ¨ SpringBoot ä¸­ï¼Œå°±æ˜¯å®Œå…¨èˆå¼ƒ XML é…ç½®æ–‡ä»¶ï¼Œå…¨é¢ä½¿ç”¨æ³¨è§£æ¥å®Œæˆä¸»è¦çš„é…ç½®ã€‚</p>
<h4 id="1åˆ›å»ºé…ç½®ç±»">â‘ åˆ›å»ºé…ç½®ç±»</h4>
<p>ä½¿ç”¨ @Configuration æ³¨è§£å°†ä¸€ä¸ªæ™®é€šçš„ç±»æ ‡è®°ä¸º Spring çš„é…ç½®ç±»ã€‚</p>
<pre><code class="language-java">package com.atguigu.ioc.configuration;
    
import org.springframework.context.annotation.Configuration;
    
@Configuration
public class MyConfiguration {
  
}
</code></pre>
<h4 id="2æ ¹æ®é…ç½®ç±»åˆ›å»ºiocå®¹å™¨å¯¹è±¡">â‘¡æ ¹æ®é…ç½®ç±»åˆ›å»ºIOCå®¹å™¨å¯¹è±¡</h4>
<pre><code class="language-java">// ClassPathXmlApplicationContext æ ¹æ® XML é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡
private ApplicationContext ioc = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);

// AnnotationConfigApplicationContext æ ¹æ®é…ç½®ç±»åˆ›å»º IOC å®¹å™¨å¯¹è±¡
private ApplicationContext ioc = new AnnotationConfigApplicationContext(MyConfiguration.class);
</code></pre>
<h4 id="3åœ¨é…ç½®ç±»ä¸­é…ç½®bean">â‘¢åœ¨é…ç½®ç±»ä¸­é…ç½®bean</h4>
<p>ä½¿ç”¨@Beanæ³¨è§£</p>
<pre><code class="language-java">@Configuration
public class MyConfiguration {
  
    // @Bean æ³¨è§£ç›¸å½“äº XML é…ç½®æ–‡ä»¶ä¸­çš„ bean æ ‡ç­¾
    // @Bean æ³¨è§£æ ‡è®°çš„æ–¹æ³•çš„è¿”å›å€¼ä¼šè¢«æ”¾å…¥ IOC å®¹å™¨
    // é»˜è®¤ä»¥æ–¹æ³•åä½œä¸º bean çš„ id
    @Bean
    public CommonComponent getComponent() {
      
        CommonComponent commonComponent = new CommonComponent();
      
        commonComponent.setComponentName(&quot;created by annotation config&quot;);
      
        return commonComponent;
    }
}
</code></pre>
<h4 id="4åœ¨é…ç½®ç±»ä¸­é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ…">â‘£åœ¨é…ç½®ç±»ä¸­é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ…</h4>
<p>ä½¿ç”¨@ComponentScanæ³¨è§£</p>
<pre><code class="language-java">@Configuration
@ComponentScan(&quot;com.atguigu.ioc.component&quot;)
public class MyConfiguration {
    â€¦â€¦
}
</code></pre>
<h3 id="234-å®éªŒå››æ•´åˆjunit4">2.3.4ã€å®éªŒå››ï¼šæ•´åˆjunit4</h3>
<h4 id="1æ•´åˆçš„å¥½å¤„">â‘ æ•´åˆçš„å¥½å¤„</h4>
<ul>
<li>å¥½å¤„1ï¼šä¸éœ€è¦è‡ªå·±åˆ›å»ºIOCå®¹å™¨å¯¹è±¡äº†</li>
<li>å¥½å¤„2ï¼šä»»ä½•éœ€è¦çš„beanéƒ½å¯ä»¥åœ¨æµ‹è¯•ç±»ä¸­ç›´æ¥äº«å—è‡ªåŠ¨è£…é…</li>
</ul>
<h4 id="2æ“ä½œ">â‘¡æ“ä½œ</h4>
<p>åŠ å…¥ä¾èµ–</p>
<pre><code class="language-xml">&lt;!-- Springçš„æµ‹è¯•åŒ… --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
    &lt;version&gt;5.3.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>åˆ›å»ºæµ‹è¯•ç±»</p>
<pre><code class="language-java">// junitçš„@RunWithæ³¨è§£ï¼šæŒ‡å®šSpringä¸ºJunitæä¾›çš„è¿è¡Œå™¨
@RunWith(SpringJUnit4ClassRunner.class)

// Springçš„@ContextConfigurationæŒ‡å®šSpringé…ç½®æ–‡ä»¶çš„ä½ç½®
@ContextConfiguration(value = {&quot;classpath:applicationContext.xml&quot;})
public class JunitIntegrationSpring {
    
    @Autowired
    private SoldierController soldierController;
    
    @Test
    public void testIntegration() {
        System.out.println(&quot;soldierController = &quot; + soldierController);
    }
    
}
</code></pre>
<h1 id="3-aop">3ã€AOP</h1>
<h2 id="31-åœºæ™¯æ¨¡æ‹Ÿ">3.1ã€åœºæ™¯æ¨¡æ‹Ÿ</h2>
<h3 id="311-å£°æ˜æ¥å£">3.1.1ã€å£°æ˜æ¥å£</h3>
<p>å£°æ˜è®¡ç®—å™¨æ¥å£Calculatorï¼ŒåŒ…å«åŠ å‡ä¹˜é™¤çš„æŠ½è±¡æ–¹æ³•</p>
<pre><code class="language-java">public interface Calculator {
    
    int add(int i, int j);
  
    int sub(int i, int j);
  
    int mul(int i, int j);
  
    int div(int i, int j);
    
}
</code></pre>
<h3 id="312-åˆ›å»ºå®ç°ç±»">3.1.2ã€åˆ›å»ºå®ç°ç±»</h3>
<figure data-type="image" tabindex="14"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721205610.png" alt="" loading="lazy"></figure>
<pre><code class="language-java">public class CalculatorPureImpl implements Calculator {
    
    @Override
    public int add(int i, int j) {
        int result = i + j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
    @Override
    public int sub(int i, int j) {
        int result = i - j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
    @Override
    public int mul(int i, int j) {
        int result = i * j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
    @Override
    public int div(int i, int j) {
        int result = i / j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
}
</code></pre>
<h3 id="313-åˆ›å»ºå¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»">3.1.3ã€åˆ›å»ºå¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»</h3>
<figure data-type="image" tabindex="15"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721205850.png" alt="" loading="lazy"></figure>
<pre><code class="language-java">public class CalculatorLogImpl implements Calculator {
    
    @Override
    public int add(int i, int j) {
        System.out.println(&quot;[æ—¥å¿—] add æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot; + i + &quot;,&quot; + j);
        int result = i + j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        System.out.println(&quot;[æ—¥å¿—] add æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot; + result);
        return result;
    }
    @Override
    public int sub(int i, int j) {
        System.out.println(&quot;[æ—¥å¿—] sub æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot; + i + &quot;,&quot; + j);
        int result = i - j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        System.out.println(&quot;[æ—¥å¿—] sub æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot; + result);
        return result;
    }
    @Override
    public int mul(int i, int j) {
        System.out.println(&quot;[æ—¥å¿—] mul æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot; + i + &quot;,&quot; + j);
        int result = i * j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        System.out.println(&quot;[æ—¥å¿—] mul æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot; + result);
        return result;
    }
    @Override
    public int div(int i, int j) {
        System.out.println(&quot;[æ—¥å¿—] div æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot; + i + &quot;,&quot; + j);
        int result = i / j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        System.out.println(&quot;[æ—¥å¿—] div æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot; + result);
        return result;
    }
  
}
</code></pre>
<h3 id="314-æå‡ºé—®é¢˜">3.1.4ã€æå‡ºé—®é¢˜</h3>
<h4 id="1ç°æœ‰ä»£ç ç¼ºé™·">â‘ ç°æœ‰ä»£ç ç¼ºé™·</h4>
<p>é’ˆå¯¹å¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»ï¼Œæˆ‘ä»¬å‘ç°æœ‰å¦‚ä¸‹ç¼ºé™·ï¼š</p>
<ul>
<li>å¯¹æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æœ‰å¹²æ‰°ï¼Œå¯¼è‡´ç¨‹åºå‘˜åœ¨å¼€å‘æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ—¶åˆ†æ•£äº†ç²¾åŠ›</li>
<li>é™„åŠ åŠŸèƒ½åˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡åŠŸèƒ½æ–¹æ³•ä¸­ï¼Œä¸åˆ©äºç»Ÿä¸€ç»´æŠ¤</li>
</ul>
<h4 id="2è§£å†³æ€è·¯">â‘¡è§£å†³æ€è·¯</h4>
<p>è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ ¸å¿ƒå°±æ˜¯ï¼šè§£è€¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠé™„åŠ åŠŸèƒ½ä»ä¸šåŠ¡åŠŸèƒ½ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚</p>
<h4 id="3å›°éš¾">â‘¢å›°éš¾</h4>
<p>è§£å†³é—®é¢˜çš„å›°éš¾ï¼šè¦æŠ½å–çš„ä»£ç åœ¨æ–¹æ³•å†…éƒ¨ï¼Œé ä»¥å‰æŠŠå­ç±»ä¸­çš„é‡å¤ä»£ç æŠ½å–åˆ°çˆ¶ç±»çš„æ–¹å¼æ²¡æ³•è§£å†³ã€‚æ‰€ä»¥éœ€è¦å¼•å…¥æ–°çš„æŠ€æœ¯ã€‚</p>
<h2 id="32-ä»£ç†æ¨¡å¼">3.2ã€ä»£ç†æ¨¡å¼</h2>
<h3 id="321-æ¦‚å¿µ">3.2.1ã€æ¦‚å¿µ</h3>
<h4 id="1ä»‹ç»">â‘ ä»‹ç»</h4>
<p>äºŒåä¸‰ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå±äºç»“æ„å‹æ¨¡å¼ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªä»£ç†ç±»ï¼Œè®©æˆ‘ä»¬åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä¸å†æ˜¯ç›´æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†ç±»<strong>é—´æ¥</strong>è°ƒç”¨ã€‚è®©ä¸å±äºç›®æ ‡æ–¹æ³•æ ¸å¿ƒé€»è¾‘çš„ä»£ç ä»ç›®æ ‡æ–¹æ³•ä¸­å‰¥ç¦»å‡ºæ¥â€”â€”<strong>è§£è€¦</strong>ã€‚è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶å…ˆè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå‡å°‘å¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨å’Œæ‰“æ‰°ï¼ŒåŒæ—¶è®©é™„åŠ åŠŸèƒ½èƒ½å¤Ÿé›†ä¸­åœ¨ä¸€èµ·ä¹Ÿæœ‰åˆ©äºç»Ÿä¸€ç»´æŠ¤ã€‚</p>
<figure data-type="image" tabindex="16"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721210816.png" alt="" loading="lazy"></figure>
<p>ä½¿ç”¨ä»£ç†åï¼š</p>
<figure data-type="image" tabindex="17"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721210900.png" alt="" loading="lazy"></figure>
<h4 id="2ç”Ÿæ´»ä¸­çš„ä»£ç†">â‘¡ç”Ÿæ´»ä¸­çš„ä»£ç†</h4>
<ul>
<li>å¹¿å‘Šå•†æ‰¾å¤§æ˜æ˜Ÿæ‹å¹¿å‘Šéœ€è¦ç»è¿‡ç»çºªäºº</li>
<li>åˆä½œä¼™ä¼´æ‰¾å¤§è€æ¿è°ˆåˆä½œè¦çº¦è§é¢æ—¶é—´éœ€è¦ç»è¿‡ç§˜ä¹¦</li>
<li>æˆ¿äº§ä¸­ä»‹æ˜¯ä¹°å–åŒæ–¹çš„ä»£ç†</li>
</ul>
<h4 id="3ç›¸å…³æœ¯è¯­">â‘¢ç›¸å…³æœ¯è¯­</h4>
<ul>
<li>ä»£ç†ï¼šå°†éæ ¸å¿ƒé€»è¾‘å‰¥ç¦»å‡ºæ¥ä»¥åï¼Œå°è£…è¿™äº›éæ ¸å¿ƒé€»è¾‘çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚</li>
<li>ç›®æ ‡ï¼š<strong>è¢«ä»£ç†</strong>â€œå¥—ç”¨â€äº†éæ ¸å¿ƒé€»è¾‘ä»£ç çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚</li>
</ul>
<h3 id="322-é™æ€ä»£ç†">3.2.2ã€é™æ€ä»£ç†</h3>
<p>åˆ›å»ºé™æ€ä»£ç†ç±»ï¼š</p>
<pre><code class="language-java">public class CalculatorStaticProxy implements Calculator {
  
    // å°†è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡
    private Calculator target;
  
    public CalculatorStaticProxy(Calculator target) {
        this.target = target;
    }
  
    @Override
    public int add(int i, int j) {
      
        // é™„åŠ åŠŸèƒ½ç”±ä»£ç†ç±»ä¸­çš„ä»£ç†æ–¹æ³•æ¥å®ç°
        System.out.println(&quot;[æ—¥å¿—] add æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot; + i + &quot;,&quot; + j);
      
        // é€šè¿‡ç›®æ ‡å¯¹è±¡æ¥å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        int addResult = target.add(i, j);
      
        System.out.println(&quot;[æ—¥å¿—] add æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot; + addResult);
      
        return addResult;
    }
  
}
</code></pre>
<blockquote>
<p>é™æ€ä»£ç†ç¡®å®å®ç°äº†è§£è€¦ï¼Œä½†æ˜¯ç”±äºä»£ç éƒ½<strong>å†™æ­»äº†</strong>ï¼Œå®Œå…¨ä¸å…·å¤‡ä»»ä½•çš„çµæ´»æ€§ã€‚å°±æ‹¿æ—¥å¿—åŠŸèƒ½æ¥è¯´ï¼Œå°†æ¥å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦é™„åŠ æ—¥å¿—ï¼Œé‚£è¿˜å¾—å†å£°æ˜æ›´å¤šä¸ªé™æ€ä»£ç†ç±»ï¼Œé‚£å°±äº§ç”Ÿäº†å¤§é‡é‡å¤çš„ä»£ç ï¼Œæ—¥å¿—åŠŸèƒ½è¿˜æ˜¯åˆ†æ•£çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€ç®¡ç†ã€‚</p>
<p>æå‡ºè¿›ä¸€æ­¥çš„éœ€æ±‚ï¼šå°†æ—¥å¿—åŠŸèƒ½é›†ä¸­åˆ°ä¸€ä¸ªä»£ç†ç±»ä¸­ï¼Œå°†æ¥æœ‰ä»»ä½•æ—¥å¿—éœ€æ±‚ï¼Œéƒ½é€šè¿‡è¿™ä¸€ä¸ªä»£ç†ç±»æ¥å®ç°ã€‚è¿™å°±éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯äº†ã€‚</p>
</blockquote>
<h3 id="323-åŠ¨æ€ä»£ç†">3.2.3ã€åŠ¨æ€ä»£ç†</h3>
<figure data-type="image" tabindex="18"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721211704.png" alt="" loading="lazy"></figure>
<p>ç”Ÿäº§ä»£ç†å¯¹è±¡çš„å·¥å‚ç±»ï¼š</p>
<pre><code class="language-java">public class ProxyFactory {
    private Object target;

    public ProxyFactory(Object target) {
        this.target = target;
    }

    public Object getProxy() {

        /**
         * newProxyInstance()ï¼šåˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹
         * å…¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼š
         * 1ã€classLoaderï¼šåŠ è½½åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åŠ è½½å™¨
         * 2ã€interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£çš„classå¯¹è±¡æ‰€ç»„æˆçš„æ•°ç»„
         * 3ã€invocationHandlerï¼šè®¾ç½®ä»£ç†å¯¹è±¡å®ç°ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„è¿‡ç¨‹ï¼Œå³ä»£ç†ç±»ä¸­å¦‚ä½•é‡å†™æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•
         */

        ClassLoader classLoader = target.getClass().getClassLoader();
        Class&lt;?&gt;[] interfaces = target.getClass().getInterfaces();
        InvocationHandler invocationHandler = new InvocationHandler() {
            @Override
            public Object invoke(Object proxy, Method method, Object[] args)
                    throws Throwable {
                /**
                 * proxyï¼šä»£ç†å¯¹è±¡
                 * methodï¼šä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå³å…¶ä¸­éœ€è¦é‡å†™çš„æ–¹æ³•
                 * argsï¼šmethodæ‰€å¯¹åº”æ–¹æ³•çš„å‚æ•°
                 */
                Object result = null;
                try {
                    System.out.println(&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot; + method.getName() + &quot;ï¼Œå‚æ•°ï¼š&quot; + Arrays.toString(args));
                    result = method.invoke(target, args);
                    System.out.println(&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot; + method.getName() + &quot;ï¼Œç»“æœï¼š&quot; + result);
                } catch (Exception e) {
                    e.printStackTrace();
                    System.out.println(&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot; + method.getName() + &quot;ï¼Œå¼‚å¸¸ï¼š&quot; + e.getMessage());
                } finally {
                    System.out.println(&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot; + method.getName() + &quot;ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•&quot;);
                }
                return result;
            }
        };
        return Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);
    }
}
</code></pre>
<h3 id="324-æµ‹è¯•">3.2.4ã€æµ‹è¯•</h3>
<pre><code class="language-java">@Test
public void testDynamicProxy() {
    ProxyFactory factory = new ProxyFactory(new CalculatorLogImpl());
    Calculator proxy = (Calculator) factory.getProxy();
    proxy.div(1, 0);
    //proxy.div(1,1);
}
</code></pre>
<h2 id="33-aopæ¦‚å¿µåŠç›¸å…³æœ¯è¯­">3.3ã€AOPæ¦‚å¿µåŠç›¸å…³æœ¯è¯­</h2>
<h3 id="331-æ¦‚è¿°">3.3.1ã€æ¦‚è¿°</h3>
<ul>
<li>AOPï¼ˆAspect Oriented Programmingï¼‰æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œæ˜¯è½¯ä»¶è®¾è®¡é¢†åŸŸä¸­çš„é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è¡¥å……å’Œå®Œå–„ï¼Œå®ƒä»¥é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†æ–¹å¼å®ç°åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ç»™ç¨‹åºåŠ¨æ€ç»Ÿä¸€æ·»åŠ é¢å¤–åŠŸèƒ½çš„ä¸€ç§æŠ€æœ¯ã€‚</li>
<li>AOPçš„æ ¸å¿ƒå¥—è·¯</li>
</ul>
<figure data-type="image" tabindex="19"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721215952.png" alt="" loading="lazy"></figure>
<h3 id="332-ç›¸å…³æœ¯è¯­">3.3.2ã€ç›¸å…³æœ¯è¯­</h3>
<figure data-type="image" tabindex="20"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722120920.png" alt="" loading="lazy"></figure>
<h4 id="1æ¨ªåˆ‡å…³æ³¨ç‚¹è¿æ¥ç‚¹">â‘ æ¨ªåˆ‡å…³æ³¨ç‚¹(è¿æ¥ç‚¹)</h4>
<ul>
<li>ä»æ¯ä¸ªæ–¹æ³•ä¸­æŠ½å–å‡ºæ¥çš„åŒä¸€ç±»éæ ¸å¿ƒä¸šåŠ¡ã€‚åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹å¯¹ç›¸å…³æ–¹æ³•è¿›è¡Œå¤šä¸ªä¸åŒæ–¹é¢çš„å¢å¼ºã€‚</li>
<li>è¿™ä¸ªæ¦‚å¿µä¸æ˜¯è¯­æ³•å±‚é¢å¤©ç„¶å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ ¹æ®é™„åŠ åŠŸèƒ½çš„é€»è¾‘ä¸Šçš„éœ€è¦ï¼š<strong>æœ‰åä¸ªé™„åŠ åŠŸèƒ½ï¼Œå°±æœ‰åä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚</strong></li>
</ul>
<figure data-type="image" tabindex="21"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721220106.png" alt="" loading="lazy"></figure>
<h4 id="2é€šçŸ¥è®°ä½">â‘¡é€šçŸ¥ã€è®°ä½ã€‘</h4>
<p>æ¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ä¸Šè¦åšçš„äº‹æƒ…éƒ½éœ€è¦å†™ä¸€ä¸ªæ–¹æ³•ï¼ˆ<strong>å®é™…å¢å¼ºçš„é€»è¾‘éƒ¨åˆ†</strong>ï¼‰æ¥å®ç°ï¼Œè¿™æ ·çš„æ–¹æ³•å°±å«<strong>é€šçŸ¥æ–¹æ³•</strong>ã€‚</p>
<ul>
<li>å‰ç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å‰</strong>æ‰§è¡Œ</li>
<li>è¿”å›é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æˆåŠŸç»“æŸ</strong>åæ‰§è¡Œ</li>
<li>å¼‚å¸¸é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å¼‚å¸¸ç»“æŸ</strong>åæ‰§è¡Œ</li>
<li>åç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æœ€ç»ˆç»“æŸ</strong>åæ‰§è¡Œ</li>
<li>ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨try...catch...finallyç»“æ„å›´ç»•<strong>æ•´ä¸ª</strong>è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®</li>
</ul>
<figure data-type="image" tabindex="22"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721220834.png" alt="" loading="lazy"></figure>
<h4 id="3åˆ‡é¢è®°ä½">â‘¢åˆ‡é¢ã€è®°ä½ã€‘</h4>
<p>å°è£…é€šçŸ¥æ–¹æ³•çš„<strong>ç±»</strong>ã€‚</p>
<figure data-type="image" tabindex="23"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721221150.png" alt="" loading="lazy"></figure>
<h4 id="4ç›®æ ‡">â‘£ç›®æ ‡</h4>
<p>è¢«ä»£ç†çš„<strong>ç›®æ ‡å¯¹è±¡</strong>ã€‚</p>
<h4 id="5ä»£ç†">â‘¤ä»£ç†</h4>
<p>å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„<strong>ä»£ç†å¯¹è±¡</strong>ã€‚</p>
<h4 id="6è¿æ¥ç‚¹">â‘¥è¿æ¥ç‚¹</h4>
<ul>
<li><strong>ç±»é‡Œé¢å“ªäº›æ–¹æ³•å¯ä»¥è¢«å¢å¼ºï¼Œè¿™äº›æ–¹æ³•ç§°ä¸ºè¿æ¥ç‚¹</strong></li>
</ul>
<p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªçº¯é€»è¾‘æ¦‚å¿µï¼Œä¸æ˜¯è¯­æ³•å®šä¹‰çš„ã€‚</p>
<p>æŠŠæ–¹æ³•æ’æˆä¸€æ’ï¼Œæ¯ä¸€ä¸ªæ¨ªåˆ‡ä½ç½®çœ‹æˆxè½´æ–¹å‘ï¼ŒæŠŠæ–¹æ³•ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„é¡ºåºçœ‹æˆyè½´ï¼Œxè½´å’Œyè½´çš„äº¤å‰ç‚¹å°±æ˜¯è¿æ¥ç‚¹ã€‚</p>
<figure data-type="image" tabindex="24"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220721221557.png" alt="" loading="lazy"></figure>
<h4 id="7åˆ‡å…¥ç‚¹è®°ä½">â‘¦åˆ‡å…¥ç‚¹ã€è®°ä½ã€‘</h4>
<ul>
<li><strong>å®é™…è¢«å¢å¼ºçš„æ–¹æ³•ï¼Œç§°ä¸ºåˆ‡å…¥ç‚¹ã€‚</strong></li>
</ul>
<p>å®šä½è¿æ¥ç‚¹çš„æ–¹å¼ã€‚</p>
<p>æ¯ä¸ªç±»çš„æ–¹æ³•ä¸­éƒ½åŒ…å«å¤šä¸ªè¿æ¥ç‚¹ï¼Œæ‰€ä»¥è¿æ¥ç‚¹æ˜¯ç±»ä¸­å®¢è§‚å­˜åœ¨çš„äº‹ç‰©ï¼ˆä»é€»è¾‘ä¸Šæ¥è¯´ï¼‰ã€‚</p>
<p>å¦‚æœæŠŠè¿æ¥ç‚¹çœ‹ä½œæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œé‚£ä¹ˆåˆ‡å…¥ç‚¹å°±æ˜¯æŸ¥è¯¢è®°å½•çš„ SQL è¯­å¥ã€‚</p>
<p>Spring çš„ AOP æŠ€æœ¯å¯ä»¥é€šè¿‡åˆ‡å…¥ç‚¹å®šä½åˆ°ç‰¹å®šçš„è¿æ¥ç‚¹ã€‚</p>
<p>åˆ‡ç‚¹é€šè¿‡ org.springframework.aop.Pointcut æ¥å£è¿›è¡Œæè¿°ï¼Œå®ƒä½¿ç”¨ç±»å’Œæ–¹æ³•ä½œä¸ºè¿æ¥ç‚¹çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p>
<h4 id="8ç»‡å…¥">â‘§ç»‡å…¥</h4>
<ul>
<li>ç»‡å…¥æ˜¯åŠ¨ä½œï¼Œå°±æ˜¯æŠŠé€šçŸ¥åº”ç”¨åˆ°åˆ‡å…¥ç‚¹æ¥åˆ›å»ºä»£ç†å¯¹è±¡çš„<strong>è¿‡ç¨‹</strong>ã€‚</li>
</ul>
<h3 id="333-ä½œç”¨">3.3.3ã€ä½œç”¨</h3>
<ul>
<li>ç®€åŒ–ä»£ç ï¼šæŠŠæ–¹æ³•ä¸­å›ºå®šä½ç½®çš„é‡å¤çš„ä»£ç <strong>æŠ½å–</strong>å‡ºæ¥ï¼Œè®©è¢«æŠ½å–çš„æ–¹æ³•æ›´ä¸“æ³¨äºè‡ªå·±çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæé«˜å†…èšæ€§ã€‚</li>
<li>ä»£ç å¢å¼ºï¼šæŠŠç‰¹å®šçš„åŠŸèƒ½å°è£…åˆ°åˆ‡é¢ç±»ä¸­ï¼Œçœ‹å“ªé‡Œæœ‰éœ€è¦ï¼Œå°±å¾€ä¸Šå¥—ï¼Œè¢«<strong>å¥—ç”¨</strong>äº†åˆ‡é¢é€»è¾‘çš„æ–¹æ³•å°±è¢«åˆ‡é¢ç»™å¢å¼ºäº†ã€‚</li>
</ul>
<h2 id="34-åŸºäºæ³¨è§£çš„aop">3.4ã€åŸºäºæ³¨è§£çš„AOP</h2>
<h3 id="341-æŠ€æœ¯è¯´æ˜">3.4.1ã€æŠ€æœ¯è¯´æ˜</h3>
<img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722142959.png"/>
<ul>
<li>åŠ¨æ€ä»£ç†ï¼ˆInvocationHandlerï¼‰ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚å› ä¸ºè¿™ä¸ªæŠ€æœ¯è¦æ±‚<strong>ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°åŒæ ·çš„æ¥å£</strong>ï¼ˆå…„å¼Ÿä¸¤ä¸ªæ‹œæŠŠå­æ¨¡å¼ï¼‰ã€‚</li>
<li>cglibï¼šé€šè¿‡<strong>ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»</strong>ï¼ˆè®¤å¹²çˆ¹æ¨¡å¼ï¼‰å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚</li>
<li>AspectJï¼šæœ¬è´¨ä¸Šæ˜¯é™æ€ä»£ç†ï¼Œ<strong>å°†ä»£ç†é€»è¾‘â€œç»‡å…¥â€è¢«ä»£ç†çš„ç›®æ ‡ç±»ç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶</strong>ï¼Œæ‰€ä»¥æœ€ç»ˆæ•ˆæœæ˜¯åŠ¨æ€çš„ã€‚weaverå°±æ˜¯ç»‡å…¥å™¨ã€‚Springåªæ˜¯å€Ÿç”¨äº†AspectJä¸­çš„æ³¨è§£ã€‚</li>
</ul>
<h3 id="342-å‡†å¤‡å·¥ä½œ">3.4.2ã€å‡†å¤‡å·¥ä½œ</h3>
<h4 id="1æ·»åŠ ä¾èµ–">â‘ æ·»åŠ ä¾èµ–</h4>
<p>åœ¨IOCæ‰€éœ€ä¾èµ–åŸºç¡€ä¸Šå†åŠ å…¥ä¸‹é¢ä¾èµ–å³å¯ï¼š</p>
<pre><code class="language-xml">&lt;!-- spring-aspectsä¼šå¸®æˆ‘ä»¬ä¼ é€’è¿‡æ¥aspectjweaver --&gt;
&lt;dependency&gt;
		&lt;groupId&gt;org.springframework&lt;/groupId&gt;
		&lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
		&lt;version&gt;5.3.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4 id="2å‡†å¤‡è¢«ä»£ç†çš„ç›®æ ‡èµ„æº">â‘¡å‡†å¤‡è¢«ä»£ç†çš„ç›®æ ‡èµ„æº</h4>
<p>æ¥å£ï¼š</p>
<pre><code class="language-java">public interface Calculator {
    
    int add(int i, int j);
  
    int sub(int i, int j);
  
    int mul(int i, int j);
  
    int div(int i, int j);
    
}
</code></pre>
<p>å®ç°ç±»ï¼š</p>
<pre><code class="language-java">public class CalculatorPureImpl implements Calculator {
    
    @Override
    public int add(int i, int j) {
        int result = i + j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
    @Override
    public int sub(int i, int j) {
        int result = i - j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
    @Override
    public int mul(int i, int j) {
        int result = i * j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
    @Override
    public int div(int i, int j) {
        int result = i / j;
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ result = &quot; + result);
        return result;
    }
}
</code></pre>
<h3 id="343-åˆ›å»ºåˆ‡é¢ç±»å¹¶é…ç½®">3.4.3ã€åˆ›å»ºåˆ‡é¢ç±»å¹¶é…ç½®</h3>
<pre><code class="language-java">// @Aspectè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»
@Aspect
// @Componentæ³¨è§£ä¿è¯è¿™ä¸ªåˆ‡é¢ç±»èƒ½å¤Ÿæ”¾å…¥IOCå®¹å™¨
@Component
public class LogAspect {

    // @Beforeæ³¨è§£ï¼šå£°æ˜å½“å‰æ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥æ–¹æ³•
    // valueå±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œç”±åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ§åˆ¶å½“å‰é€šçŸ¥æ–¹æ³•è¦ä½œç”¨åœ¨å“ªä¸€ä¸ªç›®æ ‡æ–¹æ³•ä¸Š
    @Before(&quot;execution(public int com.atguigu.aop.annotation.CalculatorImpl.*(..))&quot;)
    public void printLogBeforeCore(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        String args = Arrays.toString(joinPoint.getArgs());
        System.out.println(&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œå‚æ•°ï¼š&quot; + args);
    }

    @Afterr(&quot;execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))&quot;)
    public void printLogFinallyEnd() {
        String methodName = joinPoint.getSignature().getName();
        System.out.println(&quot;Logger--&gt;åç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName);
    }

    @AfterReturningg(value = &quot;execution(*
            com.atguigu.aop.annotation.CalculatorImpl.*(..))&quot;, returning = &quot;result&quot;)

    public void printLogAfterException(JoinPoint joinPoint, Object result) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println(&quot;Logger--&gt;è¿”å›é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œç»“æœï¼š&quot; + result);
    }


    @AfterThrowing(value = &quot;execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))&quot;, throwing = &quot;ex&quot;)
    public void printLogAfterSuccess(JoinPoint joinPoint, Throwable ex) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println(&quot;Logger--&gt;å¼‚å¸¸é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œå¼‚å¸¸ï¼š&quot; + ex);
    }


    @Around(&quot;execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))&quot;)
    public Object aroundMethod(ProceedingJoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        String args = Arrays.toString(joinPoint.getArgs());
        Object result = null;
        try {
            System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œä¹‹å‰&quot;);
            //ç›®æ ‡å¯¹è±¡ï¼ˆè¿æ¥ç‚¹ï¼‰æ–¹æ³•çš„æ‰§è¡Œ
            result = joinPoint.proceed();
            System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•è¿”å›å€¼ä¹‹å&quot;);
        } catch (Throwable throwable) {
            throwable.printStackTrace();
            System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•å‡ºç°å¼‚å¸¸æ—¶&quot;);
        } finally {
            System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•&quot;);
        }
        return result;
    }

}
</code></pre>
<p>åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p>
<pre><code class="language-xml">&lt;!--
åŸºäºæ³¨è§£çš„AOPçš„å®ç°ï¼š
1ã€å°†ç›®æ ‡å¯¹è±¡å’Œåˆ‡é¢äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼ˆæ³¨è§£+æ‰«æï¼‰
2ã€å¼€å¯åŸºäºæ³¨è§£çš„AOPåŠŸèƒ½ (å¼€å¯AspectJçš„è‡ªåŠ¨ä»£ç†ï¼Œä¸ºç›®æ ‡å¯¹è±¡è‡ªåŠ¨ç”Ÿæˆä»£ç†)
3ã€å°†åˆ‡é¢ç±»é€šè¿‡æ³¨è§£@Aspectæ ‡è¯†
 --&gt;

&lt;!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… --&gt;
&lt;context:component-scan base-package=&quot;com.atguigu.aop.annotation&quot;/&gt;

&lt;!-- å¼€å¯åŸºäºæ³¨è§£çš„AOPåŠŸèƒ½ --&gt;
&lt;aop:aspectj-autoproxy/&gt;
</code></pre>
<h3 id="344-å„ç§é€šçŸ¥">3.4.4ã€å„ç§é€šçŸ¥</h3>
<ul>
<li>å‰ç½®é€šçŸ¥ï¼šä½¿ç”¨@Beforeæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å‰</strong>æ‰§è¡Œ</li>
<li>è¿”å›é€šçŸ¥ï¼šä½¿ç”¨@AfterReturningæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æˆåŠŸç»“æŸ</strong>åæ‰§è¡Œ</li>
<li>å¼‚å¸¸é€šçŸ¥ï¼šä½¿ç”¨@AfterThrowingæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å¼‚å¸¸ç»“æŸ</strong>åæ‰§è¡Œ</li>
<li>åç½®é€šçŸ¥ï¼šä½¿ç”¨@Afteræ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æœ€ç»ˆç»“æŸ</strong>åæ‰§è¡Œ</li>
<li>ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨@Aroundæ³¨è§£æ ‡è¯†ï¼Œä½¿ç”¨try...catch...finallyç»“æ„å›´ç»•<strong>æ•´ä¸ª</strong>è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®</li>
</ul>
<blockquote>
<h4 id="å„ç§é€šçŸ¥çš„æ‰§è¡Œé¡ºåº">å„ç§é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼š</h4>
<ul>
<li>Springç‰ˆæœ¬5.3.xä»¥å‰ï¼š
<ul>
<li>å‰ç½®é€šçŸ¥</li>
<li>ç›®æ ‡æ“ä½œ</li>
<li>åç½®é€šçŸ¥</li>
<li>è¿”å›é€šçŸ¥æˆ–å¼‚å¸¸é€šçŸ¥</li>
</ul>
</li>
<li>Springç‰ˆæœ¬5.3.xä»¥åï¼š
<ul>
<li>å‰ç½®é€šçŸ¥</li>
<li>ç›®æ ‡æ“ä½œ</li>
<li>è¿”å›é€šçŸ¥æˆ–å¼‚å¸¸é€šçŸ¥</li>
<li>åç½®é€šçŸ¥</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="345-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•">3.4.5ã€åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•</h3>
<h4 id="1ä½œç”¨">â‘ ä½œç”¨</h4>
<figure data-type="image" tabindex="25"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722165001.png" alt="" loading="lazy"></figure>
<h4 id="2è¯­æ³•ç»†èŠ‚">â‘¡è¯­æ³•ç»†èŠ‚</h4>
<ul>
<li>ç”¨ * å·ä»£æ›¿â€œæƒé™ä¿®é¥°ç¬¦â€å’Œâ€œè¿”å›å€¼â€éƒ¨åˆ†è¡¨ç¤ºâ€œæƒé™ä¿®é¥°ç¬¦â€å’Œâ€œè¿”å›å€¼â€ä¸é™</li>
<li>åœ¨åŒ…åçš„éƒ¨åˆ†ï¼Œä¸€ä¸ª * å·åªèƒ½ä»£è¡¨åŒ…çš„å±‚æ¬¡ç»“æ„ä¸­çš„ä¸€å±‚ï¼Œè¡¨ç¤ºè¿™ä¸€å±‚æ˜¯ä»»æ„çš„ã€‚
<ul>
<li>ä¾‹å¦‚ï¼š*.HelloåŒ¹é…com.Helloï¼Œä¸åŒ¹é…com.atguigu.Hello</li>
</ul>
</li>
<li>åœ¨åŒ…åçš„éƒ¨åˆ†ï¼Œä½¿ç”¨â€œ*..â€è¡¨ç¤ºåŒ…åä»»æ„ã€åŒ…çš„å±‚æ¬¡æ·±åº¦ä»»æ„</li>
<li>åœ¨ç±»åçš„éƒ¨åˆ†ï¼Œç±»åéƒ¨åˆ†æ•´ä½“ç”¨*å·ä»£æ›¿ï¼Œè¡¨ç¤ºç±»åä»»æ„</li>
<li>åœ¨ç±»åçš„éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿ç±»åçš„ä¸€éƒ¨åˆ†
<ul>
<li>ä¾‹å¦‚ï¼š*ServiceåŒ¹é…æ‰€æœ‰åç§°ä»¥Serviceç»“å°¾çš„ç±»æˆ–æ¥å£</li>
</ul>
</li>
<li>åœ¨æ–¹æ³•åéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·è¡¨ç¤ºæ–¹æ³•åä»»æ„</li>
<li>åœ¨æ–¹æ³•åéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿æ–¹æ³•åçš„ä¸€éƒ¨åˆ†
<ul>
<li>ä¾‹å¦‚ï¼š*OperationåŒ¹é…æ‰€æœ‰æ–¹æ³•åä»¥Operationç»“å°¾çš„æ–¹æ³•</li>
</ul>
</li>
<li>åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼Œä½¿ç”¨(..)è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä»»æ„</li>
<li>åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼Œä½¿ç”¨(int,..)è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä»¥ä¸€ä¸ªintç±»å‹çš„å‚æ•°å¼€å¤´</li>
<li>åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹åº”çš„åŒ…è£…ç±»å‹æ˜¯ä¸ä¸€æ ·çš„
<ul>
<li>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸­ä½¿ç”¨ int å’Œå®é™…æ–¹æ³•ä¸­ Integer æ˜¯ä¸åŒ¹é…çš„</li>
</ul>
</li>
<li>åœ¨æ–¹æ³•è¿”å›å€¼éƒ¨åˆ†ï¼Œå¦‚æœæƒ³è¦æ˜ç¡®æŒ‡å®šä¸€ä¸ªè¿”å›å€¼ç±»å‹ï¼Œé‚£ä¹ˆå¿…é¡»åŒæ—¶å†™æ˜æƒé™ä¿®é¥°ç¬¦
<ul>
<li>ä¾‹å¦‚ï¼šexecution(public int ..Service.*(.., int)) <code>æ­£ç¡®</code></li>
<li>ä¾‹å¦‚ï¼šexecution(* int ..Service.*(.., int)) <code>é”™è¯¯</code></li>
</ul>
</li>
</ul>
<figure data-type="image" tabindex="26"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722170459.png" alt="" loading="lazy"></figure>
<blockquote>
<h4 id="tip">TIP</h4>
<p>è™½ç„¶æˆ‘ä»¬ä¸Šé¢ä»‹ç»è¿‡çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•ç»†èŠ‚å¾ˆå¤šï¼Œæœ‰å¾ˆå¤šå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šå…·ä½“åœ¨é¡¹ç›®ä¸­åº”ç”¨æ—¶æœ‰æ¯”è¾ƒå›ºå®šçš„å†™æ³•ã€‚</p>
<p>å…¸å‹åœºæ™¯ï¼šåœ¨åŸºäº XML çš„å£°æ˜å¼äº‹åŠ¡é…ç½®ä¸­éœ€è¦æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚è¿™ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼é€šå¸¸éƒ½ä¼šå¥—ç”¨åˆ°æ‰€æœ‰ Service ç±»ï¼ˆæ¥å£ï¼‰çš„æ‰€æœ‰æ–¹æ³•ã€‚é‚£ä¹ˆåˆ‡å…¥ç‚¹è¡¨è¾¾å¼å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><code>execution(* *..*Service.*(..))</code></p>
</blockquote>
<h3 id="346-é‡ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼">3.4.6ã€é‡ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h3>
<h4 id="1å£°æ˜">â‘ å£°æ˜</h4>
<pre><code class="language-java">@Pointcut(&quot;execution(* com.atguigu.aop.annotation.*.*(..))&quot;)
public void pointCut(){}
</code></pre>
<h4 id="2åœ¨åŒä¸€ä¸ªåˆ‡é¢ä¸­ä½¿ç”¨">â‘¡åœ¨åŒä¸€ä¸ªåˆ‡é¢ä¸­ä½¿ç”¨</h4>
<pre><code class="language-java">@Before(&quot;pointCut()&quot;)
public void beforeMethod(JoinPoint joinPoint) {
    String methodName = joinPoint.getSignature().getName();
    String args = Arrays.toString(joinPoint.getArgs());
    System.out.println(&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œå‚æ•°ï¼š&quot; + args);
}
</code></pre>
<h4 id="3åœ¨ä¸åŒåˆ‡é¢ä¸­ä½¿ç”¨">â‘¢åœ¨ä¸åŒåˆ‡é¢ä¸­ä½¿ç”¨</h4>
<pre><code class="language-java">@Before(&quot;com.atguigu.aop.CommonPointCut.pointCut()&quot;)
public void beforeMethod(JoinPoint joinPoint) {
    String methodName = joinPoint.getSignature().getName();
    String args = Arrays.toString(joinPoint.getArgs());
    System.out.println(&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œå‚æ•°ï¼š&quot; + args);
}
</code></pre>
<h3 id="347-è·å–é€šçŸ¥çš„ç›¸å…³ä¿¡æ¯">3.4.7ã€è·å–é€šçŸ¥çš„ç›¸å…³ä¿¡æ¯</h3>
<h4 id="1è·å–è¿æ¥ç‚¹ä¿¡æ¯">â‘ è·å–è¿æ¥ç‚¹ä¿¡æ¯</h4>
<p>è·å–è¿æ¥ç‚¹ä¿¡æ¯å¯ä»¥åœ¨é€šçŸ¥æ–¹æ³•çš„å‚æ•°ä½ç½®è®¾ç½®<code>JoinPoint</code>ç±»å‹çš„å½¢å‚</p>
<pre><code class="language-java">@Before(&quot;execution(public int com.atguigu.aop.annotation.CalculatorImpl.*(..))&quot;)
public void beforeMethod(JoinPoint joinPoint) {
    //è·å–è¿æ¥ç‚¹çš„ç­¾åä¿¡æ¯
    String methodName = joinPoint.getSignature().getName();
    //è·å–ç›®æ ‡æ–¹æ³•åˆ°çš„å®å‚ä¿¡æ¯
    String args = Arrays.toString(joinPoint.getArgs());
    System.out.println(&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œå‚æ•°ï¼š&quot; + args);
}
</code></pre>
<h4 id="2è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼">â‘¡è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼</h4>
<p><code>@AfterReturning</code>ä¸­çš„å±æ€§<code>returning</code>ï¼Œç”¨æ¥å°†é€šçŸ¥æ–¹æ³•çš„æŸä¸ªå½¢å‚ï¼Œæ¥æ”¶ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼</p>
<pre><code class="language-java">@AfterReturning(value = &quot;execution(* com.atguigu.aop.annotation.CalculatorImpl.* (..))&quot;, returning = &quot;result&quot;)
public void afterReturningMethod(JoinPoint joinPoint, Object result) {
    String methodName = joinPoint.getSignature().getName();
    System.out.println(&quot;Logger--&gt;è¿”å›é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œç»“æœï¼š&quot; + result);
}
</code></pre>
<h4 id="3è·å–ç›®æ ‡æ–¹æ³•çš„å¼‚å¸¸">â‘¢è·å–ç›®æ ‡æ–¹æ³•çš„å¼‚å¸¸</h4>
<p><code>@AfterThrowing</code>ä¸­çš„å±æ€§<code>throwing</code>ï¼Œç”¨æ¥å°†é€šçŸ¥æ–¹æ³•çš„æŸä¸ªå½¢å‚ï¼Œæ¥æ”¶ç›®æ ‡æ–¹æ³•çš„å¼‚å¸¸</p>
<pre><code class="language-java">@AfterThrowing(value = &quot;execution(* com.atguigu.aop.annotation.CalculatorImpl.* (..))&quot;, throwing = &quot;ex&quot;)
public void afterThrowingMethod(JoinPoint joinPoint, Throwable ex) {
    String methodName = joinPoint.getSignature().getName();
    System.out.println(&quot;Logger--&gt;å¼‚å¸¸é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot; + methodName + &quot;ï¼Œå¼‚å¸¸ï¼š&quot; + ex);
}
</code></pre>
<h3 id="348-ç¯ç»•é€šçŸ¥">3.4.8ã€ç¯ç»•é€šçŸ¥</h3>
<ul>
<li>ç¯ç»•é€šçŸ¥ç±»ä¼¼äºåŠ¨æ€ä»£ç†çš„å…·ä½“å®ç°</li>
<li>æ³¨æ„ç¯ç»•é€šçŸ¥çš„JoinPointç±»å‹æ˜¯<code>ProceedingJoinPoint</code></li>
</ul>
<pre><code class="language-java">@Around(&quot;execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))&quot;)
public Object aroundMethod(ProceedingJoinPoint joinPoint){
    String methodName = joinPoint.getSignature().getName();
    String args = Arrays.toString(joinPoint.getArgs());
    Object result = null;
    try {
        System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œä¹‹å‰&quot;);
        //ç›®æ ‡å¯¹è±¡ï¼ˆè¿æ¥ç‚¹ï¼‰æ–¹æ³•çš„æ‰§è¡Œ
        result = joinPoint.proceed();
        System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•è¿”å›å€¼ä¹‹å&quot;);
    } catch (Throwable throwable) {
        throwable.printStackTrace();
        System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•å‡ºç°å¼‚å¸¸æ—¶&quot;);
    } finally {
        System.out.println(&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•&quot;);
    }
    return result;
}
</code></pre>
<h3 id="349-åˆ‡é¢çš„ä¼˜å…ˆçº§">3.4.9ã€åˆ‡é¢çš„ä¼˜å…ˆçº§</h3>
<h4 id="1æ¦‚å¿µ-2">â‘ æ¦‚å¿µ</h4>
<p>ç›¸åŒç›®æ ‡æ–¹æ³•ä¸ŠåŒæ—¶å­˜åœ¨å¤šä¸ªåˆ‡é¢æ—¶ï¼Œåˆ‡é¢çš„ä¼˜å…ˆçº§æ§åˆ¶æŒ‰ç…§åˆ‡é¢çš„<code>å†…å¤–åµŒå¥—</code>é¡ºåºã€‚</p>
<ul>
<li>ä¼˜å…ˆçº§é«˜çš„åˆ‡é¢ï¼šå¤–é¢</li>
<li>ä¼˜å…ˆçº§ä½çš„åˆ‡é¢ï¼šé‡Œé¢</li>
</ul>
<p>ä½¿ç”¨<code>@Order</code>æ³¨è§£å¯ä»¥æ§åˆ¶åˆ‡é¢çš„ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li>@Order(è¾ƒå°çš„æ•°)ï¼šä¼˜å…ˆçº§é«˜</li>
<li>@Order(è¾ƒå¤§çš„æ•°)ï¼šä¼˜å…ˆçº§ä½</li>
</ul>
<figure data-type="image" tabindex="27"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722173445.png" alt="" loading="lazy"></figure>
<h4 id="2å®é™…æ„ä¹‰">â‘¡å®é™…æ„ä¹‰</h4>
<p>å®é™…å¼€å‘æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ‡é¢åµŒå¥—çš„æƒ…å†µï¼Œè¦æ…é‡è€ƒè™‘ã€‚ä¾‹å¦‚ï¼šå¦‚æœäº‹åŠ¡åˆ‡é¢ä¼˜å…ˆçº§é«˜ï¼Œé‚£ä¹ˆåœ¨ç¼“å­˜ä¸­å‘½ä¸­æ•°æ®çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åˆ‡é¢çš„æ“ä½œéƒ½æµªè´¹äº†ã€‚</p>
<figure data-type="image" tabindex="28"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722174955.png" alt="" loading="lazy"></figure>
<p>æ­¤æ—¶åº”è¯¥å°†ç¼“å­˜åˆ‡é¢çš„ä¼˜å…ˆçº§æé«˜ï¼Œåœ¨äº‹åŠ¡æ“ä½œä¹‹å‰å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›®æ ‡æ•°æ®ã€‚</p>
<figure data-type="image" tabindex="29"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722175037.png" alt="" loading="lazy"></figure>
<h3 id="3410-æ²¡æœ‰æ¥å£çš„æƒ…å†µ">3.4.10ã€æ²¡æœ‰æ¥å£çš„æƒ…å†µ</h3>
<ul>
<li>åœ¨ç›®æ ‡ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£çš„æƒ…å†µä¸‹ï¼ŒSpringä¼šè‡ªåŠ¨ä½¿ç”¨cglibæŠ€æœ¯å®ç°ä»£ç†ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åšä¸‹é¢çš„æµ‹è¯•ï¼š</li>
</ul>
<h4 id="1åˆ›å»ºç›®æ ‡ç±»">â‘ åˆ›å»ºç›®æ ‡ç±»</h4>
<p>è¯·ç¡®ä¿è¿™ä¸ªç±»åœ¨è‡ªåŠ¨æ‰«æçš„åŒ…ä¸‹ï¼ŒåŒæ—¶ç¡®ä¿åˆ‡é¢çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼èƒ½å¤Ÿè¦†ç›–åˆ°ç±»ä¸­çš„æ–¹æ³•ã€‚</p>
<pre><code class="language-java">@Service
public class EmployeeService {
    
    public void getEmpList() {
        System.out.println(&quot;æ–¹æ³•å†…éƒ¨ com.atguigu.aop.imp.EmployeeService.getEmpList&quot;);
    }
    
}
</code></pre>
<h4 id="2æµ‹è¯•">â‘¡æµ‹è¯•</h4>
<pre><code class="language-java">@Autowired
private EmployeeService employeeService;

@Test
public void testNoInterfaceProxy() {
    employeeService.getEmpList();
    System.out.println();
}
</code></pre>
<h4 id="3debugæŸ¥çœ‹">â‘¢DebugæŸ¥çœ‹</h4>
<ul>
<li>
<p>æ²¡æœ‰å®ç°æ¥å£æƒ…å†µ</p>
<figure data-type="image" tabindex="30"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722180742.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>æœ‰å®ç°æ¥å£çš„æƒ…å†µ</p>
<figure data-type="image" tabindex="31"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722180811.png" alt="" loading="lazy"></figure>
</li>
</ul>
<p>åŒæ—¶æˆ‘ä»¬å‘ç°ï¼šMybatis è°ƒç”¨çš„ Mapper æ¥å£ç±»å‹çš„å¯¹è±¡å…¶å®ä¹Ÿæ˜¯åŠ¨æ€ä»£ç†æœºåˆ¶</p>
<figure data-type="image" tabindex="32"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722180853.png" alt="" loading="lazy"></figure>
<h2 id="35-åŸºäºxmlçš„aopäº†è§£">3.5ã€åŸºäºXMLçš„AOPï¼ˆäº†è§£ï¼‰</h2>
<h3 id="351-å‡†å¤‡å·¥ä½œ">3.5.1ã€å‡†å¤‡å·¥ä½œ</h3>
<h4 id="1æ·»åŠ ä¾èµ–-2">â‘ æ·»åŠ ä¾èµ–</h4>
<p>å’ŒåŸºäºæ³¨è§£çš„ AOP æ—¶ä¸€æ ·ã€‚</p>
<h4 id="2å‡†å¤‡ä»£ç ">â‘¡å‡†å¤‡ä»£ç </h4>
<p>æŠŠæµ‹è¯•åŸºäºæ³¨è§£åŠŸèƒ½æ—¶çš„Javaç±»å¤åˆ¶åˆ°æ–°moduleä¸­ï¼Œå»é™¤æ‰€æœ‰æ³¨è§£ã€‚</p>
<h3 id="352-å®ç°">3.5.2ã€å®ç°</h3>
<pre><code class="language-xml">&lt;!-- é…ç½®ç›®æ ‡ç±»çš„bean --&gt;
&lt;bean id=&quot;calculatorPure&quot; class=&quot;com.atguigu.aop.imp.CalculatorPureImpl&quot;/&gt;
    
&lt;!-- é…ç½®åˆ‡é¢ç±»çš„bean --&gt;
&lt;bean id=&quot;logAspect&quot; class=&quot;com.atguigu.aop.aspect.LogAspect&quot;/&gt;
    
&lt;!-- é…ç½®AOP --&gt;
&lt;aop:config&gt;
    
    &lt;!-- é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --&gt;
    &lt;aop:pointcut id=&quot;logPointCut&quot; expression=&quot;execution(* *..*.*(..))&quot;/&gt;
    
    &lt;!-- aop:aspectæ ‡ç­¾ï¼šé…ç½®åˆ‡é¢ --&gt;
    &lt;!-- refå±æ€§ï¼šå…³è”åˆ‡é¢ç±»çš„bean --&gt;
    &lt;aop:aspect ref=&quot;logAspect&quot;&gt;
        &lt;!-- aop:beforeæ ‡ç­¾ï¼šé…ç½®å‰ç½®é€šçŸ¥ --&gt;
        &lt;!-- methodå±æ€§ï¼šæŒ‡å®šå‰ç½®é€šçŸ¥çš„æ–¹æ³•å --&gt;
        &lt;!-- pointcut-refå±æ€§ï¼šå¼•ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --&gt;
        &lt;aop:before method=&quot;printLogBeforeCore&quot; pointcut-ref=&quot;logPointCut&quot;/&gt;
    
        &lt;!-- aop:after-returningæ ‡ç­¾ï¼šé…ç½®è¿”å›é€šçŸ¥ --&gt;
        &lt;!-- returningå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•è¿”å›å€¼çš„å‚æ•°å --&gt;
        &lt;aop:after-returning
                method=&quot;printLogAfterCoreSuccess&quot;
                pointcut-ref=&quot;logPointCut&quot;
                returning=&quot;targetMethodReturnValue&quot;/&gt;
    
        &lt;!-- aop:after-throwingæ ‡ç­¾ï¼šé…ç½®å¼‚å¸¸é€šçŸ¥ --&gt;
        &lt;!-- throwingå±æ€§ï¼šæŒ‡å®šé€šçŸ¥æ–¹æ³•ä¸­ç”¨æ¥æ¥æ”¶ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„å¼‚å¸¸å¯¹è±¡çš„å‚æ•°å --&gt;
        &lt;aop:after-throwing
                method=&quot;printLogAfterCoreException&quot;
                pointcut-ref=&quot;logPointCut&quot;
                throwing=&quot;targetMethodException&quot;/&gt;
    
        &lt;!-- aop:afteræ ‡ç­¾ï¼šé…ç½®åç½®é€šçŸ¥ --&gt;
        &lt;aop:after method=&quot;printLogCoreFinallyEnd&quot; pointcut-ref=&quot;logPointCut&quot;/&gt;
    
        &lt;!-- aop:aroundæ ‡ç­¾ï¼šé…ç½®ç¯ç»•é€šçŸ¥ --&gt;
        &lt;!--&lt;aop:around method=&quot;â€¦â€¦&quot; pointcut-ref=&quot;logPointCut&quot;/&gt;--&gt;
    &lt;/aop:aspect&gt;
    
&lt;/aop:config&gt;
</code></pre>
<h3 id="352-æµ‹è¯•">3.5.2ã€æµ‹è¯•</h3>
<pre><code class="language-java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(value = {&quot;classpath:spring-context.xml&quot;})
public class AOPTest {
    
    @Autowired
    private Calculator calculator;
    
    @Test
    public void testLogAspect() {
        int add = calculator.add(10, 2);
        System.out.println(&quot;add = &quot; + add);
    }
}
</code></pre>
<h2 id="36-aop-å¯¹è·å–-bean-çš„å½±å“">3.6ã€AOP å¯¹è·å– bean çš„å½±å“</h2>
<h3 id="351-å®éªŒ">3.5.1ã€å®éªŒ</h3>
<h4 id="1æƒ…æ™¯ä¸€">â‘ æƒ…æ™¯ä¸€</h4>
<ul>
<li>å£°æ˜ä¸€ä¸ªæ¥å£</li>
<li>æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»</li>
<li>åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢æ¥å£çš„å®ç°ç±»åº”ç”¨é€šçŸ¥
<ul>
<li>æµ‹è¯•ï¼šæ ¹æ®æ¥å£ç±»å‹è·å–bean</li>
<li>æµ‹è¯•ï¼šæ ¹æ®ç±»è·å–bean</li>
</ul>
</li>
</ul>
<p>åŸå› åˆ†æï¼š</p>
<p>åº”ç”¨äº†åˆ‡é¢åï¼ŒçœŸæ­£æ”¾åœ¨IOCå®¹å™¨ä¸­çš„æ˜¯ä»£ç†ç±»çš„å¯¹è±¡</p>
<p>ç›®æ ‡ç±»å¹¶æ²¡æœ‰è¢«æ”¾åˆ°IOCå®¹å™¨ä¸­ï¼Œæ‰€ä»¥<code>æ ¹æ®ç›®æ ‡ç±»çš„ç±»å‹ä»IOCå®¹å™¨ä¸­æ˜¯æ‰¾ä¸åˆ°çš„</code></p>
<figure data-type="image" tabindex="33"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722191357.png" alt="" loading="lazy"></figure>
<p>ä»å†…å­˜åˆ†æçš„è§’åº¦æ¥è¯´ï¼ŒIOCå®¹å™¨ä¸­å¼•ç”¨çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å¼•ç”¨çš„æ˜¯ç›®æ ‡å¯¹è±¡ã€‚IOCå®¹å™¨å¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨ç›®æ ‡å¯¹è±¡ï¼Œæ‰€ä»¥æ ¹æ®ç›®æ ‡ç±»æœ¬èº«åœ¨IOCå®¹å™¨èŒƒå›´å†…æŸ¥æ‰¾ä¸åˆ°ã€‚</p>
<figure data-type="image" tabindex="34"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722191614.png" alt="" loading="lazy"></figure>
<p>debugæŸ¥çœ‹ä»£ç†ç±»çš„ç±»å‹ï¼š</p>
<figure data-type="image" tabindex="35"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722191640.png" alt="" loading="lazy"></figure>
<h4 id="2æƒ…æ™¯äºŒ">â‘¡æƒ…æ™¯äºŒ</h4>
<ul>
<li>
<p>å£°æ˜ä¸€ä¸ªç±»</p>
</li>
<li>
<p>åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹ä¸Šé¢çš„ç±»åº”ç”¨é€šçŸ¥</p>
<ul>
<li>æµ‹è¯•ï¼šæ ¹æ®ç±»è·å– beanï¼Œèƒ½è·å–åˆ°ã€‚ï¼ˆå®é™…ä¸Šç›¸å½“äºæ ¹æ®çˆ¶ç±»ç±»å‹è·å–å­ç±»beanï¼Œå‰æä¿è¯åªæœ‰ä¸€ä¸ªå­ç±»ï¼‰</li>
</ul>
<figure data-type="image" tabindex="36"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722192250.png" alt="" loading="lazy"></figure>
<p>debugæŸ¥çœ‹å®é™…ç±»å‹ï¼š</p>
<figure data-type="image" tabindex="37"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722192327.png" alt="" loading="lazy"></figure>
</li>
</ul>
<h3 id="352-æ€»ç»“">3.5.2ã€æ€»ç»“</h3>
<h4 id="1å¯¹å®ç°äº†æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢">â‘ å¯¹å®ç°äº†æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢</h4>
<p><code>åº”ç”¨åˆ‡é¢åçš„ä»£ç†ç±»</code>æ”¾å…¥IOCå®¹å™¨</p>
<figure data-type="image" tabindex="38"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722190152.png" alt="" loading="lazy"></figure>
<h4 id="2å¯¹æ²¡å®ç°æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢">â‘¡å¯¹æ²¡å®ç°æ¥å£çš„ç±»åº”ç”¨åˆ‡é¢</h4>
<p><code>CGLIBç”Ÿæˆçš„ä»£ç†ç±»</code>æ”¾å…¥IOCå®¹å™¨</p>
<figure data-type="image" tabindex="39"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220722190211.png" alt="" loading="lazy"></figure>
<h1 id="4-å£°æ˜å¼äº‹åŠ¡">4ã€å£°æ˜å¼äº‹åŠ¡</h1>
<h2 id="41-jdbctemplate">4.1ã€JdbcTemplate</h2>
<h3 id="411-ç®€ä»‹">4.1.1ã€ç®€ä»‹</h3>
<p>Spring æ¡†æ¶å¯¹ JDBC è¿›è¡Œå°è£…ï¼Œä½¿ç”¨ JdbcTemplate æ–¹ä¾¿å®ç°å¯¹æ•°æ®åº“æ“ä½œ</p>
<h3 id="412-å‡†å¤‡å·¥ä½œ">4.1.2ã€å‡†å¤‡å·¥ä½œ</h3>
<h4 id="1åŠ å…¥ä¾èµ–-2">â‘ åŠ å…¥ä¾èµ–</h4>
<pre><code class="language-xml">&lt;dependencies&gt;

    &lt;!-- åŸºäºMavenä¾èµ–ä¼ é€’æ€§ï¼Œå¯¼å…¥spring-contextä¾èµ–å³å¯å¯¼å…¥å½“å‰æ‰€éœ€æ‰€æœ‰jaråŒ… --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- Spring æŒä¹…åŒ–å±‚æ”¯æŒjaråŒ… --&gt;
    &lt;!-- Spring åœ¨æ‰§è¡ŒæŒä¹…åŒ–å±‚æ“ä½œã€ä¸æŒä¹…åŒ–å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½¿ç”¨ormã€jdbcã€txä¸‰ä¸ªjaråŒ… --&gt;
    &lt;!-- å¯¼å…¥ orm åŒ…å°±å¯ä»¥é€šè¿‡ Maven çš„ä¾èµ–ä¼ é€’æ€§æŠŠå…¶ä»–ä¸¤ä¸ªä¹Ÿå¯¼å…¥ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- Spring æµ‹è¯•ç›¸å…³ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- junitæµ‹è¯• --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;!-- MySQLé©±åŠ¨ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;5.1.3&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- æ•°æ®æº --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
        &lt;artifactId&gt;druid&lt;/artifactId&gt;
        &lt;version&gt;1.0.31&lt;/version&gt;
    &lt;/dependency&gt;

&lt;/dependencies&gt;
</code></pre>
<h4 id="2åˆ›å»ºjdbcproperties">â‘¡åˆ›å»ºjdbc.properties</h4>
<pre><code class="language-properties">jdbc.driver=com.mysql.jdbc.Driver
#jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://127.0.0.1:3305/ssm?characterEncoding=utf8&amp;useUnicode=true
jdbc.username=root
jdbc.password=
</code></pre>
<h4 id="3é…ç½®springçš„é…ç½®æ–‡ä»¶">â‘¢é…ç½®Springçš„é…ç½®æ–‡ä»¶</h4>
<p>spring-jdbc.xml</p>
<pre><code class="language-xml">&lt;!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ --&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot; /&gt;

&lt;!-- é…ç½®æ•°æ®æº --&gt;
&lt;bean id=&quot;druidDataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
		&lt;property name=&quot;url&quot; value=&quot;${atguigu.url}&quot;/&gt;
		&lt;property name=&quot;driverClassName&quot; value=&quot;${atguigu.driver}&quot;/&gt;
		&lt;property name=&quot;username&quot; value=&quot;${atguigu.username}&quot;/&gt;
		&lt;property name=&quot;password&quot; value=&quot;${atguigu.password}&quot;/&gt;
&lt;/bean&gt;

&lt;!-- é…ç½® JdbcTemplate --&gt;
&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
		&lt;!-- è£…é…æ•°æ®æº --&gt;
		&lt;property name=&quot;dataSource&quot; ref=&quot;druidDataSource&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<h3 id="413-æµ‹è¯•">4.1.3ã€æµ‹è¯•</h3>
<h4 id="1åœ¨æµ‹è¯•ç±»è£…é…-jdbctemplate">â‘ åœ¨æµ‹è¯•ç±»è£…é… JdbcTemplate</h4>
<pre><code class="language-java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(&quot;classpath:spring-jdbc.xml&quot;)
public class JDBCTemplateTest {
  
    @Autowired
    private JdbcTemplate jdbcTemplate;
  
}
</code></pre>
<h4 id="2æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½">â‘¡æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½</h4>
<pre><code class="language-java">@Test
//æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½
public void testUpdate() {
    String sql = &quot;insert into t_emp values(null,?,?,?)&quot;;
    int result = jdbcTemplate.update(sql, &quot;å¼ ä¸‰&quot;, 23, &quot;ç”·&quot;);
    System.out.println(result);
}
</code></pre>
<h4 id="3æŸ¥è¯¢ä¸€æ¡æ•°æ®ä¸ºå®ä½“ç±»å¯¹è±¡">â‘¢æŸ¥è¯¢ä¸€æ¡æ•°æ®ä¸ºå®ä½“ç±»å¯¹è±¡</h4>
<pre><code class="language-java">@Test
//æŸ¥è¯¢ä¸€æ¡æ•°æ®ä¸ºä¸€ä¸ªå®ä½“ç±»å¯¹è±¡
public void testSelectEmpById() {
    String sql = &quot;select * from t_emp where id = ?&quot;;
    Emp emp = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;&gt;(Emp.class), 1);
    System.out.println(emp);
}
</code></pre>
<h4 id="4æŸ¥è¯¢å¤šæ¡æ•°æ®ä¸ºä¸€ä¸ªlisté›†åˆ">â‘£æŸ¥è¯¢å¤šæ¡æ•°æ®ä¸ºä¸€ä¸ªlisté›†åˆ</h4>
<pre><code class="language-java">@Test
//æŸ¥è¯¢å¤šæ¡æ•°æ®ä¸ºä¸€ä¸ªlisté›†åˆ
public void testSelectList() {
    String sql = &quot;select * from t_emp&quot;;
    List&lt;Emp&gt; list = jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;&gt;(Emp.class));
    list.forEach(emp -&gt; System.out.println(emp));
}
</code></pre>
<h4 id="5æŸ¥è¯¢å•è¡Œå•åˆ—çš„å€¼">â‘¤æŸ¥è¯¢å•è¡Œå•åˆ—çš„å€¼</h4>
<pre><code class="language-java">@Test
//æŸ¥è¯¢å•è¡Œå•åˆ—çš„å€¼
public void selectCount() {
    String sql = &quot;select count(id) from t_emp&quot;;
    Integer count = jdbcTemplate.queryForObject(sql, Integer.class);
    System.out.println(count);
}
</code></pre>
<h2 id="42-å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ">4.2ã€å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ</h2>
<h3 id="421-ç¼–ç¨‹å¼äº‹åŠ¡">4.2.1ã€ç¼–ç¨‹å¼äº‹åŠ¡</h3>
<p>äº‹åŠ¡åŠŸèƒ½çš„ç›¸å…³æ“ä½œå…¨éƒ¨é€šè¿‡è‡ªå·±ç¼–å†™ä»£ç æ¥å®ç°ï¼š</p>
<pre><code class="language-java">Connection conn = ...;
	
try {
	
	// å¼€å¯äº‹åŠ¡ï¼šå…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤
	conn.setAutoCommit(false);
	
	// æ ¸å¿ƒæ“ä½œ
	
	// æäº¤äº‹åŠ¡
	conn.commit();
	
}catch(Exception e){
	
	// å›æ»šäº‹åŠ¡
	conn.rollBack();
	
}finally{
	
	// é‡Šæ”¾æ•°æ®åº“è¿æ¥
	conn.close();
	
}
</code></pre>
<p>ç¼–ç¨‹å¼çš„å®ç°æ–¹å¼å­˜åœ¨ç¼ºé™·ï¼š</p>
<ul>
<li>ç»†èŠ‚æ²¡æœ‰è¢«å±è”½ï¼šå…·ä½“æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥å®Œæˆï¼Œæ¯”è¾ƒç¹çã€‚</li>
<li>ä»£ç å¤ç”¨æ€§ä¸é«˜ï¼šå¦‚æœæ²¡æœ‰æœ‰æ•ˆæŠ½å–å‡ºæ¥ï¼Œæ¯æ¬¡å®ç°åŠŸèƒ½éƒ½éœ€è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œä»£ç å°±æ²¡æœ‰å¾—åˆ°å¤ç”¨ã€‚</li>
</ul>
<h3 id="422-å£°æ˜å¼äº‹åŠ¡">4.2.2ã€å£°æ˜å¼äº‹åŠ¡</h3>
<p>æ—¢ç„¶äº‹åŠ¡æ§åˆ¶çš„ä»£ç æœ‰è§„å¾‹å¯å¾ªï¼Œä»£ç çš„ç»“æ„åŸºæœ¬æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥æ¡†æ¶å°±å¯ä»¥å°†å›ºå®šæ¨¡å¼çš„ä»£ç æŠ½å–å‡ºæ¥ï¼Œè¿›è¡Œç›¸å…³çš„å°è£…ã€‚</p>
<p>å°è£…èµ·æ¥åï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç®€å•çš„é…ç½®å³å¯å®Œæˆæ“ä½œã€‚</p>
<ul>
<li>å¥½å¤„1ï¼šæé«˜å¼€å‘æ•ˆç‡</li>
<li>å¥½å¤„2ï¼šæ¶ˆé™¤äº†å†—ä½™çš„ä»£ç </li>
<li>å¥½å¤„3ï¼šæ¡†æ¶ä¼šç»¼åˆè€ƒè™‘ç›¸å…³é¢†åŸŸä¸­åœ¨å®é™…å¼€å‘ç¯å¢ƒä¸‹æœ‰å¯èƒ½é‡åˆ°çš„å„ç§é—®é¢˜ï¼Œè¿›è¡Œäº†å¥å£®æ€§ã€æ€§èƒ½ç­‰å„ä¸ªæ–¹é¢çš„ä¼˜åŒ–</li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸‹é¢ä¸¤ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li><strong>ç¼–ç¨‹å¼</strong>ï¼š<strong>è‡ªå·±å†™ä»£ç </strong>å®ç°åŠŸèƒ½</li>
<li><strong>å£°æ˜å¼</strong>ï¼šé€šè¿‡<strong>é…ç½®</strong>è®©<strong>æ¡†æ¶</strong>å®ç°åŠŸèƒ½</li>
</ul>
<h2 id="43-åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡">4.3ã€åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</h2>
<h3 id="431-å‡†å¤‡å·¥ä½œ">4.3.1ã€å‡†å¤‡å·¥ä½œ</h3>
<h4 id="1åŠ å…¥ä¾èµ–-3">â‘ åŠ å…¥ä¾èµ–</h4>
<pre><code class="language-xml">&lt;dependencies&gt;

    &lt;!-- åŸºäºMavenä¾èµ–ä¼ é€’æ€§ï¼Œå¯¼å…¥spring-contextä¾èµ–å³å¯å¯¼å…¥å½“å‰æ‰€éœ€æ‰€æœ‰jaråŒ… --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- Spring æŒä¹…åŒ–å±‚æ”¯æŒjaråŒ… --&gt;
    &lt;!-- Spring åœ¨æ‰§è¡ŒæŒä¹…åŒ–å±‚æ“ä½œã€ä¸æŒä¹…åŒ–å±‚æŠ€æœ¯è¿›è¡Œæ•´åˆè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½¿ç”¨ormã€jdbcã€txä¸‰ä¸ªjaråŒ… --&gt;
    &lt;!-- å¯¼å…¥ orm åŒ…å°±å¯ä»¥é€šè¿‡ Maven çš„ä¾èµ–ä¼ é€’æ€§æŠŠå…¶ä»–ä¸¤ä¸ªä¹Ÿå¯¼å…¥ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- Spring æµ‹è¯•ç›¸å…³ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
        &lt;version&gt;5.3.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- junitæµ‹è¯• --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;!-- MySQLé©±åŠ¨ --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;5.1.3&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- æ•°æ®æº --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
        &lt;artifactId&gt;druid&lt;/artifactId&gt;
        &lt;version&gt;1.0.31&lt;/version&gt;
    &lt;/dependency&gt;

&lt;/dependencies&gt;
</code></pre>
<h4 id="2åˆ›å»ºjdbcproperties-2">â‘¡åˆ›å»ºjdbc.properties</h4>
<pre><code class="language-properties">jdbc.driver=com.mysql.jdbc.Driver
#jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://127.0.0.1:3305/ssm?characterEncoding=utf8&amp;useUnicode=true
jdbc.username=root
jdbc.password=
</code></pre>
<h4 id="3é…ç½®springçš„é…ç½®æ–‡ä»¶-2">â‘¢é…ç½®Springçš„é…ç½®æ–‡ä»¶</h4>
<p>tx-annotation.xml</p>
<pre><code class="language-xml">&lt;!--æ‰«æç»„ä»¶--&gt;
&lt;context:component-scan base-package=&quot;com.atguigu.spring.tx.annotation&quot;&gt;
&lt;/context:component-scan&gt;

&lt;!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ --&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;

&lt;!-- é…ç½®æ•°æ®æº --&gt;
&lt;bean id=&quot;druidDataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;url&quot; value=&quot;${atguigu.url}&quot;/&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;${atguigu.driver}&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;${atguigu.username}&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;${atguigu.password}&quot;/&gt;
&lt;/bean&gt;

&lt;!-- é…ç½® JdbcTemplate --&gt;
&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;!-- è£…é…æ•°æ®æº --&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;druidDataSource&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<h4 id="4åˆ›å»ºè¡¨">â‘£åˆ›å»ºè¡¨</h4>
<pre><code class="language-sql">CREATE TABLE `t_book` (
	`book_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
	`book_name` varchar(20) DEFAULT NULL COMMENT 'å›¾ä¹¦åç§°',
	`price` int(11) DEFAULT NULL COMMENT 'ä»·æ ¼',
	`stock` int(10) unsigned DEFAULT NULL COMMENT 'åº“å­˜ï¼ˆæ— ç¬¦å·ï¼‰',
PRIMARY KEY (`book_id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;

insert into `t_book`(`book_id`,`book_name`,`price`,`stock`) values (1,'æ–—ç ´è‹
ç©¹',80,100),(2,'æ–—ç½—å¤§é™†',50,100);

CREATE TABLE `t_user` (
	`user_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
	`username` varchar(20) DEFAULT NULL COMMENT 'ç”¨æˆ·å',
	`balance` int(10) unsigned DEFAULT NULL COMMENT 'ä½™é¢ï¼ˆæ— ç¬¦å·ï¼‰',
PRIMARY KEY (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

insert into `t_user`(`user_id`,`username`,`balance`) values (1,'admin',50);
</code></pre>
<h4 id="5åˆ›å»ºç»„ä»¶">â‘¤åˆ›å»ºç»„ä»¶</h4>
<p>åˆ›å»ºBookController</p>
<pre><code class="language-java">@Controller
public class BookController {
  
    @Autowired
    private BookService bookService;
  
    public void buyBook(Integer bookId, Integer userId) {
        bookService.buyBook(bookId, userId);
    }
  
}
</code></pre>
<p>åˆ›å»ºæ¥å£BookService</p>
<pre><code class="language-java">public interface BookService {
  
    void buyBook(Integer bookId, Integer userId);
  
}
</code></pre>
<p>åˆ›å»ºå®ç°ç±»BookServiceImpl</p>
<pre><code class="language-java">@Service
public class BookServiceImpl implements BookService {
  
    @Autowired
    private BookDao bookDao;
  
    @Override
    public void buyBook(Integer bookId, Integer userId) {
        //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
        Integer price = bookDao.getPriceByBookId(bookId);
        //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
        bookDao.updateStock(bookId);
        //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
        bookDao.updateBalance(userId, price);
    }
  
}
</code></pre>
<p>åˆ›å»ºæ¥å£BookDao</p>
<pre><code class="language-java">public interface BookDao {

    Integer getPriceByBookId(Integer bookId);
    
    void updateStock(Integer bookId);
    
    void updateBalance(Integer userId, Integer price);
    
}
</code></pre>
<p>åˆ›å»ºå®ç°ç±»BookDaoImpl</p>
<pre><code class="language-java">@Repository
public class BookDaoImpl implements BookDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;
    @Override
    public Integer getPriceByBookId(Integer bookId) {
        String sql = &quot;select price from t_book where book_id = ?&quot;;
        return jdbcTemplate.queryForObject(sql, Integer.class, bookId);
    }
    @Override
    public void updateStock(Integer bookId) {
        String sql = &quot;update t_book set stock = stock - 1 where book_id = ?&quot;;
        jdbcTemplate.update(sql, bookId);
    }
    @Override
    public void updateBalance(Integer userId, Integer price) {
        String sql = &quot;update t_user set balance = balance - ? where user_id = ? &quot;;
        jdbcTemplate.update(sql, price, userId);
    }
}
</code></pre>
<h3 id="432-æµ‹è¯•æ— äº‹åŠ¡æƒ…å†µ">4.3.2ã€æµ‹è¯•æ— äº‹åŠ¡æƒ…å†µ</h3>
<h4 id="1åˆ›å»ºæµ‹è¯•ç±»">â‘ åˆ›å»ºæµ‹è¯•ç±»</h4>
<pre><code class="language-java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(&quot;classpath:tx-annotation.xml&quot;)
public class TxByAnnotationTest {
  
    @Autowired
    private BookController bookController;
  
    @Test
    public void testBuyBook() {
        bookController.buyBook(1, 1);
    }
 
}
</code></pre>
<h4 id="2æ¨¡æ‹Ÿåœºæ™¯">â‘¡æ¨¡æ‹Ÿåœºæ™¯</h4>
<ul>
<li>
<p>ç”¨æˆ·è´­ä¹°å›¾ä¹¦ï¼Œå…ˆæŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼ï¼Œå†æ›´æ–°å›¾ä¹¦çš„åº“å­˜å’Œç”¨æˆ·çš„ä½™é¢</p>
</li>
<li>
<p>å‡è®¾ç”¨æˆ·idä¸º1çš„ç”¨æˆ·ï¼Œè´­ä¹°idä¸º1çš„å›¾ä¹¦</p>
</li>
<li>
<p>ç”¨æˆ·ä½™é¢ä¸º50ï¼Œè€Œå›¾ä¹¦ä»·æ ¼ä¸º80</p>
</li>
<li>
<p>è´­ä¹°å›¾ä¹¦ä¹‹åï¼Œç”¨æˆ·çš„ä½™é¢ä¸º-30ï¼Œæ•°æ®åº“ä¸­ä½™é¢å­—æ®µè®¾ç½®äº†æ— ç¬¦å·ï¼Œå› æ­¤æ— æ³•å°†-30æ’å…¥åˆ°ä½™é¢å­—æ®µ</p>
</li>
<li>
<p>æ­¤æ—¶æ‰§è¡Œsqlè¯­å¥ä¼šæŠ›å‡ºSQLException</p>
</li>
</ul>
<h4 id="3è§‚å¯Ÿç»“æœ">â‘¢è§‚å¯Ÿç»“æœ</h4>
<ul>
<li>å› ä¸ºæ²¡æœ‰æ·»åŠ äº‹åŠ¡ï¼Œå›¾ä¹¦çš„åº“å­˜æ›´æ–°äº†ï¼Œä½†æ˜¯ç”¨æˆ·çš„ä½™é¢æ²¡æœ‰æ›´æ–°</li>
<li>æ˜¾ç„¶è¿™æ ·çš„ç»“æœæ˜¯é”™è¯¯çš„ï¼Œè´­ä¹°å›¾ä¹¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ï¼Œæ›´æ–°åº“å­˜å’Œæ›´æ–°ä½™é¢è¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥</li>
</ul>
<h3 id="433-åŠ å…¥äº‹åŠ¡">4.3.3ã€åŠ å…¥äº‹åŠ¡</h3>
<h4 id="1æ·»åŠ äº‹åŠ¡é…ç½®">â‘ æ·»åŠ äº‹åŠ¡é…ç½®</h4>
<p>åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®ï¼š</p>
<pre><code class="language-xml">&lt;!--åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨bean--&gt;
&lt;bean id=&quot;transactionManager&quot;
      class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;!--
 å¼€å¯äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨
 é€šè¿‡æ³¨è§£@Transactionalæ‰€æ ‡è¯†çš„æ–¹æ³•æˆ–æ ‡è¯†çš„ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«äº‹åŠ¡ç®¡ç†å™¨ç®¡ç†äº‹åŠ¡
--&gt;
&lt;!--
 transaction-managerå±æ€§çš„é»˜è®¤å€¼æ˜¯transactionManagerï¼Œ
 å¦‚æœäº‹åŠ¡ç®¡ç†å™¨beançš„idæ­£å¥½å°±æ˜¯è¿™ä¸ªé»˜è®¤å€¼ï¼Œåˆ™å¯ä»¥çœç•¥è¿™ä¸ªå±æ€§
--&gt;
&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt;
</code></pre>
<p>æ³¨æ„ï¼šå¯¼å…¥çš„åç§°ç©ºé—´éœ€è¦ <strong>tx ç»“å°¾</strong>çš„é‚£ä¸ªã€‚</p>
<figure data-type="image" tabindex="40"><img src="https://cdn.jsdelivr.net/gh/kuangyang828/jsDeliverCDN1/img/20220723004522.png" alt="" loading="lazy"></figure>
<blockquote>
<p>è¯¥é…ç½®å¯¹åº”çš„æ³¨è§£æ–¹å¼ä¸º</p>
<p><code>@EnableTransactionManagement //å¯ç”¨äº‹åŠ¡ç®¡ç†</code></p>
</blockquote>
<h4 id="2æ·»åŠ äº‹åŠ¡æ³¨è§£">â‘¡æ·»åŠ äº‹åŠ¡æ³¨è§£</h4>
<p>å› ä¸ºserviceå±‚è¡¨ç¤ºä¸šåŠ¡é€»è¾‘å±‚ï¼Œä¸€ä¸ªæ–¹æ³•è¡¨ç¤ºä¸€ä¸ªå®Œæˆçš„åŠŸèƒ½ï¼Œå› æ­¤å¤„ç†äº‹åŠ¡ä¸€èˆ¬åœ¨serviceå±‚å¤„ç† åœ¨BookServiceImplçš„buybook()æ·»åŠ æ³¨è§£<code>@Transactional</code></p>
<h4 id="3è§‚å¯Ÿç»“æœ-2">â‘¢è§‚å¯Ÿç»“æœ</h4>
<p>ç”±äºä½¿ç”¨äº†Springçš„å£°æ˜å¼äº‹åŠ¡ï¼Œæ›´æ–°åº“å­˜å’Œæ›´æ–°ä½™é¢éƒ½æ²¡æœ‰æ‰§è¡Œ</p>
<h3 id="434-transactionalæ³¨è§£æ ‡è¯†çš„ä½ç½®">4.3.4ã€@Transactionalæ³¨è§£æ ‡è¯†çš„ä½ç½®</h3>
<ul>
<li>@Transactionalæ ‡è¯†åœ¨æ–¹æ³•ä¸Šï¼Œåˆ™åªä¼šå½±å“è¯¥æ–¹æ³•</li>
<li>@Transactionalæ ‡è¯†çš„ç±»ä¸Šï¼Œåˆ™ä¼šå½±å“ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•</li>
</ul>
<blockquote>
<h4 id="tip-2">TIP</h4>
<p>Spring ç¯å¢ƒä¸‹å¾ˆå¤šåœºåˆéƒ½æœ‰ç±»ä¼¼è®¾å®šï¼Œä¸€ä¸ªæ³¨è§£å¦‚æœæ ‡è®°äº†ç±»çš„æ¯ä¸€ä¸ªæ–¹æ³•é‚£ä¹ˆé€šå¸¸å°±å¯ä»¥æå–åˆ°ç±»çº§åˆ«ã€‚</p>
</blockquote>
<h3 id="435-äº‹åŠ¡å±æ€§åªè¯»">4.3.5ã€äº‹åŠ¡å±æ€§ï¼šåªè¯»</h3>
<h4 id="1ä»‹ç»-2">â‘ ä»‹ç»</h4>
<p>å¯¹ä¸€ä¸ªæŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒè®¾ç½®æˆåªè¯»ï¼Œå°±èƒ½å¤Ÿæ˜ç¡®å‘Šè¯‰æ•°æ®åº“ï¼Œè¿™ä¸ªæ“ä½œä¸æ¶‰åŠå†™æ“ä½œã€‚è¿™ æ ·æ•°æ®åº“å°±èƒ½å¤Ÿé’ˆå¯¹æŸ¥è¯¢æ“ä½œæ¥è¿›è¡Œä¼˜åŒ–ã€‚</p>
<h4 id="2ä½¿ç”¨æ–¹å¼">â‘¡ä½¿ç”¨æ–¹å¼</h4>
<pre><code class="language-java">@Transactional(readOnly = true)
public void buyBook(Integer bookId, Integer userId) {
    //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
    Integer price = bookDao.getPriceByBookId(bookId);
    //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
    bookDao.updateStock(bookId);
    //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
    bookDao.updateBalance(userId, price);
    //System.out.println(1/0);
}
</code></pre>
<h4 id="3æ³¨æ„">â‘¢æ³¨æ„</h4>
<ul>
<li>
<p>å¯¹å¢åˆ æ”¹æ“ä½œè®¾ç½®åªè¯»å±æ€§ä¼šæŠ›å‡ºä¸‹é¢å¼‚å¸¸ï¼š</p>
</li>
<li>
<p>Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed</p>
</li>
</ul>
<h3 id="436-äº‹åŠ¡å±æ€§è¶…æ—¶">4.3.6ã€äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶</h3>
<h4 id="1ä»‹ç»-3">â‘ ä»‹ç»</h4>
<ul>
<li>
<p>äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºé‡åˆ°æŸäº›é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå¡ä½ï¼Œä»è€Œé•¿æ—¶é—´å ç”¨æ•°æ®åº“èµ„æºã€‚è€Œé•¿æ—¶é—´ å ç”¨èµ„æºï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå‡ºç°äº†é—®é¢˜ï¼ˆå¯èƒ½æ˜¯Javaç¨‹åºæˆ–MySQLæ•°æ®åº“æˆ–ç½‘ç»œè¿æ¥ç­‰ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p>æ­¤æ—¶è¿™ä¸ªå¾ˆå¯èƒ½å‡ºé—®é¢˜çš„ç¨‹åºåº”è¯¥è¢«å›æ»šï¼Œæ’¤é”€å®ƒå·²åšçš„æ“ä½œï¼Œäº‹åŠ¡ç»“æŸï¼ŒæŠŠèµ„æºè®©å‡ºæ¥ï¼Œè®©å…¶ä»–æ­£å¸¸ç¨‹åºå¯ä»¥æ‰§è¡Œã€‚</p>
</li>
<li>
<p>æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸€å¥è¯ï¼šè¶…æ—¶å°±è¦å›æ»šï¼Œé‡Šæ”¾èµ„æºã€‚</p>
</li>
</ul>
<h4 id="2ä½¿ç”¨æ–¹å¼-2">â‘¡ä½¿ç”¨æ–¹å¼</h4>
<pre><code class="language-java">@Transactional(timeout = 3)
public void buyBook(Integer bookId, Integer userId) {
    try {
        TimeUnit.SECONDS.sleep(5);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
  
    //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
    Integer price = bookDao.getPriceByBookId(bookId);
    //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
    bookDao.updateStock(bookId);
    //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
    bookDao.updateBalance(userId, price);
    //System.out.println(1/0);
}
</code></pre>
<h4 id="3è§‚å¯Ÿç»“æœ-3">â‘¢è§‚å¯Ÿç»“æœ</h4>
<ul>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼š</li>
<li>org.springframework.transaction.<strong>TransactionTimedOutException</strong>: Transaction timed out: deadline was Fri Jun 04 16:25:39 CST 2022</li>
</ul>
<h3 id="437-äº‹åŠ¡å±æ€§å›æ»šç­–ç•¥">4.3.7ã€äº‹åŠ¡å±æ€§ï¼šå›æ»šç­–ç•¥</h3>
<h4 id="1ä»‹ç»-4">â‘ ä»‹ç»</h4>
<p>å£°æ˜å¼äº‹åŠ¡é»˜è®¤åªé’ˆå¯¹è¿è¡Œæ—¶å¼‚å¸¸å›æ»šï¼Œç¼–è¯‘æ—¶å¼‚å¸¸ä¸å›æ»šã€‚</p>
<p>å¯ä»¥é€šè¿‡@Transactionalä¸­ç›¸å…³å±æ€§è®¾ç½®å›æ»šç­–ç•¥</p>
<ul>
<li><code>rollbackFor</code>å±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡</li>
<li><code>rollbackForClassName</code>å±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å…¨ç±»å</li>
<li><code>noRollbackFor</code>å±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡</li>
<li><code>noRollbackFoClassNamer</code>å±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å…¨ç±»å</li>
</ul>
<h4 id="2ä½¿ç”¨æ–¹å¼-3">â‘¡ä½¿ç”¨æ–¹å¼</h4>
<pre><code class="language-java">@Transactional(noRollbackFor = ArithmeticException.class)
//@Transactional(noRollbackForClassName = &quot;java.lang.ArithmeticException&quot;)
public void buyBook(Integer bookId, Integer userId) {
    //æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼
    Integer price = bookDao.getPriceByBookId(bookId);
  
    //æ›´æ–°å›¾ä¹¦çš„åº“å­˜
    bookDao.updateStock(bookId);
  
    //æ›´æ–°ç”¨æˆ·çš„ä½™é¢
    bookDao.updateBalance(userId, price);
  
    System.out.println(1 / 0);
}
</code></pre>
<h4 id="3è§‚å¯Ÿç»“æœ-4">â‘¢è§‚å¯Ÿç»“æœ</h4>
<p>è™½ç„¶è´­ä¹°å›¾ä¹¦åŠŸèƒ½ä¸­å‡ºç°äº†æ•°å­¦è¿ç®—å¼‚å¸¸ï¼ˆArithmeticExceptionï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬è®¾ç½®çš„å›æ»šç­–ç•¥æ˜¯ï¼Œå½“å‡ºç°ArithmeticExceptionä¸å‘ç”Ÿå›æ»šï¼Œå› æ­¤è´­ä¹°å›¾ä¹¦çš„æ“ä½œæ­£å¸¸æ‰§è¡Œ</p>
<h3 id="438-äº‹åŠ¡å±æ€§äº‹åŠ¡éš”ç¦»çº§åˆ«">4.3.8ã€äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«</h3>
<h4 id="1ä»‹ç»-5">â‘ ä»‹ç»</h4>
<p>æ•°æ®åº“ç³»ç»Ÿå¿…é¡»å…·æœ‰éš”ç¦»å¹¶å‘è¿è¡Œå„ä¸ªäº‹åŠ¡çš„èƒ½åŠ›ï¼Œä½¿å®ƒä»¬ä¸ä¼šç›¸äº’å½±å“ï¼Œé¿å…å„ç§å¹¶å‘é—®é¢˜ã€‚ä¸€ä¸ªäº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»çš„ç¨‹åº¦ç§°ä¸ºéš”ç¦»çº§åˆ«ã€‚SQLæ ‡å‡†ä¸­è§„å®šäº†å¤šç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®ä¸€è‡´æ€§å°±è¶Šå¥½ï¼Œä½†å¹¶å‘æ€§è¶Šå¼±ã€‚</p>
<p>éš”ç¦»çº§åˆ«ä¸€å…±æœ‰å››ç§ï¼š</p>
<ul>
<li>
<p>è¯»æœªæäº¤ï¼šREAD UNCOMMITTED</p>
<p>å…è®¸Transaction01è¯»å–Transaction02æœªæäº¤çš„ä¿®æ”¹ã€‚</p>
</li>
<li>
<p>è¯»å·²æäº¤ï¼šREAD COMMITTED</p>
<p>è¦æ±‚Transaction01åªèƒ½è¯»å–Transaction02å·²æäº¤çš„ä¿®æ”¹ã€‚</p>
</li>
<li>
<p>å¯é‡å¤è¯»ï¼šREPEATABLE READ</p>
<p>ç¡®ä¿Transaction01å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªå­—æ®µä¸­è¯»å–åˆ°ç›¸åŒçš„å€¼ï¼Œå³Transaction01æ‰§è¡ŒæœŸé—´ç¦æ­¢å…¶å®ƒäº‹åŠ¡å¯¹è¿™ä¸ªå­—æ®µè¿›è¡Œæ›´æ–°ã€‚</p>
</li>
<li>
<p>ä¸²è¡ŒåŒ–ï¼šSERIALIZABLE</p>
<p>ç¡®ä¿Transaction01å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–åˆ°ç›¸åŒçš„è¡Œï¼Œåœ¨Transaction01æ‰§è¡ŒæœŸé—´ï¼Œç¦æ­¢å…¶å®ƒäº‹åŠ¡å¯¹è¿™ä¸ªè¡¨è¿›è¡Œæ·»åŠ ã€æ›´æ–°ã€åˆ é™¤æ“ä½œã€‚å¯ä»¥é¿å…ä»»ä½•å¹¶å‘é—®é¢˜ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚</p>
</li>
</ul>
<p>å„ä¸ªéš”ç¦»çº§åˆ«è§£å†³å¹¶å‘é—®é¢˜çš„èƒ½åŠ›è§ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
</tr>
</thead>
<tbody>
<tr>
<td>READ UNCOMMITTED</td>
<td>æœ‰</td>
<td>æœ‰</td>
<td>æœ‰</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>æ— </td>
<td>æœ‰</td>
<td>æœ‰</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>æ— </td>
<td>æ— </td>
<td>æœ‰ï¼ˆMySQLæ— ï¼‰</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>æ— </td>
<td>æ— </td>
<td>æ— </td>
</tr>
</tbody>
</table>
<p>å„ç§æ•°æ®åº“äº§å“å¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ”¯æŒç¨‹åº¦ï¼š</p>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>Oracle</th>
<th>MySQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>READ UNCOMMITTED</td>
<td>Ã—</td>
<td>âˆš</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>âˆš(é»˜è®¤)</td>
<td>âˆš</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>Ã—</td>
<td>âˆš(é»˜è®¤)</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
</tbody>
</table>
<h4 id="2ä½¿ç”¨æ–¹å¼-4">â‘¡ä½¿ç”¨æ–¹å¼</h4>
<pre><code class="language-java">@Transactional(isolation = Isolation.DEFAULT)//ä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«
@Transactional(isolation = Isolation.READ_UNCOMMITTED)//è¯»æœªæäº¤
@Transactional(isolation = Isolation.READ_COMMITTED)//è¯»å·²æäº¤
@Transactional(isolation = Isolation.REPEATABLE_READ)//å¯é‡å¤è¯»
@Transactional(isolation = Isolation.SERIALIZABLE)//ä¸²è¡ŒåŒ–
</code></pre>
<h3 id="439-äº‹åŠ¡å±æ€§äº‹åŠ¡ä¼ æ’­è¡Œä¸º">4.3.9ã€äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡ä¼ æ’­è¡Œä¸º</h3>
<h4 id="1ä»‹ç»-6">â‘ ä»‹ç»</h4>
<p>å½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚</p>
<h4 id="2æµ‹è¯•-2">â‘¡æµ‹è¯•</h4>
<p>åˆ›å»ºæ¥å£CheckoutService</p>
<pre><code class="language-java">public interface CheckoutService {

    void checkout(Integer[] bookIds, Integer userId);
    
}
</code></pre>
<p>åˆ›å»ºå®ç°ç±»CheckoutServiceImpl</p>
<pre><code class="language-java">@Service
public class CheckoutServiceImpl implements CheckoutService {
  
    @Autowired
    private BookService bookService;
  
    @Override
    @Transactional
    //ä¸€æ¬¡è´­ä¹°å¤šæœ¬å›¾ä¹¦
    public void checkout(Integer[] bookIds, Integer userId) {
        for (Integer bookId : bookIds) {
            bookService.buyBook(bookId, userId);
        }
    }
  
}
</code></pre>
<p>åœ¨BookControllerä¸­æ·»åŠ æ–¹æ³•</p>
<pre><code class="language-java">@Autowired
private CheckoutService checkoutService;

public void checkout(Integer[] bookIds, Integer userId) {
    checkoutService.checkout(bookIds, userId);
}
</code></pre>
<p>åœ¨æ•°æ®åº“ä¸­å°†ç”¨æˆ·çš„ä½™é¢ä¿®æ”¹ä¸º100å…ƒ</p>
<h4 id="3è§‚å¯Ÿç»“æœ-5">â‘¢è§‚å¯Ÿç»“æœ</h4>
<p>å¯ä»¥é€šè¿‡@Transactionalä¸­çš„<code>propagationå±æ€§</code>è®¾ç½®äº‹åŠ¡ä¼ æ’­è¡Œä¸º</p>
<p>ä¿®æ”¹BookServiceImplä¸­buyBook()ä¸Šï¼Œæ³¨è§£@Transactionalçš„propagationå±æ€§</p>
<ul>
<li>@Transactional(propagation = Propagation.<code>REQUIRED</code>)ï¼Œ<strong>é»˜è®¤</strong>æƒ…å†µï¼Œè¡¨ç¤ºå¦‚æœå½“å‰çº¿ç¨‹ä¸Šæœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡å¯ç”¨ï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¿è¡Œã€‚ç»è¿‡è§‚å¯Ÿï¼Œè´­ä¹°å›¾ä¹¦çš„æ–¹æ³•buyBook()åœ¨checkout()ä¸­è¢«è°ƒç”¨ï¼Œcheckout()ä¸Šæœ‰äº‹åŠ¡æ³¨è§£ï¼Œå› æ­¤åœ¨æ­¤äº‹åŠ¡ä¸­æ‰§è¡Œã€‚æ‰€è´­ä¹°çš„ä¸¤æœ¬å›¾ä¹¦çš„ä»·æ ¼ä¸º80å’Œ50ï¼Œè€Œç”¨æˆ·çš„ä½™é¢ä¸º100ï¼Œå› æ­¤åœ¨è´­ä¹°ç¬¬äºŒæœ¬å›¾ä¹¦æ—¶ä½™é¢ä¸è¶³å¤±è´¥ï¼Œå¯¼è‡´æ•´ä¸ªcheckout()å›æ»šï¼Œ<strong>å³åªè¦æœ‰ä¸€æœ¬ä¹¦ä¹°ä¸äº†ï¼Œå°±éƒ½ä¹°ä¸äº†</strong></li>
<li>@Transactional(propagation = Propagation.<code>REQUIRES_NEW</code>)ï¼Œ<code>å»ºè®®ä½¿ç”¨</code>ã€‚è¡¨ç¤ºä¸ç®¡å½“å‰çº¿ç¨‹ä¸Šæ˜¯å¦æœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡ï¼Œéƒ½è¦å¼€å¯æ–°äº‹åŠ¡ã€‚åŒæ ·çš„åœºæ™¯ï¼Œæ¯æ¬¡è´­ä¹°å›¾ä¹¦éƒ½æ˜¯åœ¨buyBook()çš„äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå› æ­¤ç¬¬ä¸€æœ¬å›¾ä¹¦è´­ä¹°æˆåŠŸï¼Œäº‹åŠ¡ç»“æŸï¼Œç¬¬äºŒæœ¬å›¾ä¹¦è´­ä¹°å¤±è´¥ï¼Œåªåœ¨ç¬¬äºŒæ¬¡çš„buyBook()ä¸­å›æ»šï¼Œè´­ä¹°ç¬¬ä¸€æœ¬å›¾ä¹¦ä¸å½±å“ï¼Œ<strong>å³èƒ½ä¹°å‡ æœ¬å°±ä¹°å‡ æœ¬</strong></li>
</ul>
<h2 id="44-åŸºäºxmlçš„å£°æ˜å¼äº‹åŠ¡">4.4ã€åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡</h2>
<h3 id="431-åœºæ™¯æ¨¡æ‹Ÿ">4.3.1ã€åœºæ™¯æ¨¡æ‹Ÿ</h3>
<p>å‚è€ƒåŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</p>
<h3 id="432-ä¿®æ”¹springé…ç½®æ–‡ä»¶">4.3.2ã€ä¿®æ”¹Springé…ç½®æ–‡ä»¶</h3>
<p>å°†Springé…ç½®æ–‡ä»¶ä¸­å»æ‰tx:annotation-driven æ ‡ç­¾ï¼Œå¹¶æ·»åŠ é…ç½®</p>
<pre><code class="language-xml">&lt;aop:config&gt;
    &lt;!-- é…ç½®äº‹åŠ¡é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --&gt;
    &lt;aop:advisor advice-ref=&quot;txAdvice&quot;
                 pointcut=&quot;execution(* com.atguigu.spring.tx.xml.service.impl.*.*(..))&quot;&gt;&lt;/aop:advisor&gt;
&lt;/aop:config&gt;
&lt;!-- tx:adviceæ ‡ç­¾ï¼šé…ç½®äº‹åŠ¡é€šçŸ¥ --&gt;
&lt;!-- idå±æ€§ï¼šç»™äº‹åŠ¡é€šçŸ¥æ ‡ç­¾è®¾ç½®å”¯ä¸€æ ‡è¯†ï¼Œä¾¿äºå¼•ç”¨ --&gt;
&lt;!-- transaction-managerå±æ€§ï¼šå…³è”äº‹åŠ¡ç®¡ç†å™¨ --&gt;
&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;
    &lt;tx:attributes&gt;
        &lt;!-- tx:methodæ ‡ç­¾ï¼šé…ç½®å…·ä½“çš„äº‹åŠ¡æ–¹æ³• --&gt;
        &lt;!-- nameå±æ€§ï¼šæŒ‡å®šæ–¹æ³•åï¼Œå¯ä»¥ä½¿ç”¨æ˜Ÿå·ä»£è¡¨å¤šä¸ªå­—ç¬¦ --&gt;
        &lt;tx:method name=&quot;get*&quot; read-only=&quot;true&quot;/&gt;
        &lt;tx:method name=&quot;query*&quot; read-only=&quot;true&quot;/&gt;
        &lt;tx:method name=&quot;find*&quot; read-only=&quot;true&quot;/&gt;
        &lt;!-- read-onlyå±æ€§ï¼šè®¾ç½®åªè¯»å±æ€§ --&gt;
        &lt;!-- rollback-forå±æ€§ï¼šè®¾ç½®å›æ»šçš„å¼‚å¸¸ --&gt;
        &lt;!-- no-rollback-forå±æ€§ï¼šè®¾ç½®ä¸å›æ»šçš„å¼‚å¸¸ --&gt;
        &lt;!-- isolationå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ« --&gt;
        &lt;!-- timeoutå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„è¶…æ—¶å±æ€§ --&gt;
        &lt;!-- propagationå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º --&gt;
        &lt;tx:method name=&quot;save*&quot; read-only=&quot;false&quot; rollbackfor=&quot;java.lang.Exception&quot; propagation=&quot;REQUIRES_NEW&quot;/&gt;
        &lt;tx:method name=&quot;update*&quot; read-only=&quot;false&quot; rollbackfor=&quot;java.lang.Exception&quot; propagation=&quot;REQUIRES_NEW&quot;/&gt;
        &lt;tx:method name=&quot;delete*&quot; read-only=&quot;false&quot; rollbackfor=&quot;java.lang.Exception&quot; propagation=&quot;REQUIRES_NEW&quot;/&gt;
    &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šåŸºäºxmlå®ç°çš„å£°æ˜å¼äº‹åŠ¡ï¼Œå¿…é¡»å¼•å…¥aspectJçš„ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
    &lt;version&gt;5.3.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</blockquote>
<h1 id="5-spring5-æ–°ç‰¹æ€§">5ã€Spring5 æ–°ç‰¹æ€§</h1>
<h2 id="51-jsr305æ ‡å‡†ç›¸å…³æ³¨è§£">5.1ã€JSR305æ ‡å‡†ç›¸å…³æ³¨è§£</h2>
<h2 id="52-æ•´åˆjunit5">5.2ã€æ•´åˆjunit5</h2>
]]></content>
    </entry>
</feed>